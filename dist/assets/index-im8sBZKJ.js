var Ho=Object.defineProperty;var Jo=(s,t,r)=>t in s?Ho(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r;var dr=(s,t,r)=>Jo(s,typeof t!="symbol"?t+"":t,r);import{j as e,R as Ni,I as zi,F as ki,S as ja,a as Ci,P as Xo,C as Si,b as _i,V as Yo,c as el,d as Ti,e as sl,T as Di,f as tl,g as Ii,h as Pi,i as rl,k as Ri,l as al,L as Ei,m as Mi,n as il,o as nl,p as Li,q as ol,r as ll,s as Ai,t as qi,u as Oi,v as $i,w as cl,x as Fi,y as dl,z as et,A as Wi,B as ga,D as Us,E as ce,G as ul,H as ml,J as xl,K as Ui,M as pl,N as hl,O as jl,Q as gl,U as Bi,W as Gi,X as Ki,Y as Sr,Z as fl,_ as yl,$ as bl,a0 as wl,a1 as vl,a2 as Nl,a3 as zl,a4 as kl,a5 as Cl,a6 as Sl,a7 as _l,a8 as Tl,a9 as Zi,aa as Dl,ab as Il,ac as Pl,ad as Va,ae as Qi,af as Rl,ag as Vi,ah as Hi,ai as El}from"./radix-ui-B31VQl63.js";import{l as Ml,a as d,n as Ll,R as W,d as fa,e as Q,o as O,u as Me,i as Dt,p as Gt,N as ct,L as It,B as Al,q as ql,O as Ol}from"./react-vendor-DEevTyTQ.js";import{c as $l,t as F,M as fr,T as Fl}from"./utils-DjSV-4e-.js";import{n as Oe,M as Ji,d as Wl,e as ya,f as ze,$ as je,k as Xi,i as Se,j as ut,I as _r,X as _s,H as Ul,w as Bl,l as Gl,m as Kl,o as Zl,p as Ql,D as Vl,t as Hl,E as Ha,u as Jl,_ as Xl,x as Yl}from"./refine-core-CDRYCXQG.js";import{c as ec,k as Ns,b as sc,I as tc}from"./refine-ui-BCfgFEvh.js";import{t as rc,c as ac,U as Ts,M as Ds,G as mt,a as ic,S as Tr,b as Dr,C as ba,d as nc,e as Re,f as wa,X as He,L as Yi,T as qe,H as oc,B as ge,g as aa,A as Lt,h as lc,i as At,F as Ir,j as cc,k as Ie,l as en,m as ws,n as Pr,o as dc,p as Rr,q as Zs,r as sn,P as Gs,s as Os,u as Ne,E as Kt,v as Ce,w as ms,x as Er,y as Qs,z as $s,D as Ee,I as is,J as ye,K as tn,N as Ks,O as Mr,Q as rs,W as Lr,R as uc,V as Fs,Y as mc,Z as Zt,_ as Is,$ as qt,a0 as Qt,a1 as Vs,a2 as gs,a3 as Ja,a4 as va,a5 as xc,a6 as rn,a7 as pc,a8 as hc,a9 as Vt,aa as Na,ab as Ar,ac as jc,ad as gc,ae as fc,af as xt,ag as ur,ah as yc,ai as bc,aj as za,ak as wc,al as an,am as Hs,an as vc,ao as Nc,ap as zc,aq as kc,ar as Xa}from"./ui-utils-B3gDjuds.js";import{R as Cc,A as Sc,a as _c,X as Tc,Y as Dc}from"./tables-B0I0ep1Q.js";import"./forms-B2VSq9sJ.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();var mr={},Ya;function Ic(){if(Ya)return mr;Ya=1;var s=Ml();return mr.createRoot=s.createRoot,mr.hydrateRoot=s.hydrateRoot,mr}var Pc=Ic();const Rc="https://hqsyimochfcfqahcuprn.supabase.co",Ec="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhxc3lpbW9jaGZjZnFhaGN1cHJuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4NjU4NTYsImV4cCI6MjA2OTQ0MTg1Nn0.KutvVrkDKuVyvrYQosU3SI6QrrMnWqDCSZ2E3fhCteI",se=ec(Rc,Ec,{db:{schema:"public"},auth:{persistSession:!0}}),K=(...s)=>rc(ac(s));class Xr extends Error{constructor(r,a,n,i){super(r);dr(this,"code");dr(this,"statusCode");dr(this,"details");this.name="AuthError",this.code=a,this.statusCode=n||400,this.details=i}}const xr={user_already_exists:"Konto z tym adresem email już istnieje.",password_too_short:"Hasło musi mieć co najmniej 6 znaków.",password_too_long:"Hasło nie może być dłuższe niż 72 znaki.",invalid_email:"Nieprawidłowy format adresu email.",over_email_send_rate_limit:"Za szybko! Poczekaj 2 sekundy przed ponowną próbą.",registration_failed:"Rejestracja nie powiodła się.",invalid_credentials:"Nieprawidłowy email lub hasło.",email_not_confirmed:"Potwierdź swój adres email przed zalogowaniem.",user_not_found:"Nie znaleziono użytkownika.",reset_password_rate_limit:"Zbyt wiele prób. Spróbuj ponownie za chwilę.",invalid_recovery_token:"Link do resetowania hasła wygasł lub jest nieprawidłowy.",update_failed:"Aktualizacja nie powiodła się.",session_expired:"Sesja wygasła. Zaloguj się ponownie.",oauth_error:"Błąd podczas logowania przez zewnętrznego dostawcę.",oauth_cancelled:"Logowanie zostało anulowane.",unknown_error:"Wystąpił nieoczekiwany błąd. Spróbuj ponownie.",network_error:"Błąd połączenia. Sprawdź swoje połączenie internetowe."},Ae=s=>{if(!s)return new Xr(xr.unknown_error,"unknown_error");if(s instanceof Xr)return s;const t=s.message||s.error_description||"",r=s.code||s.error||"";let a="unknown_error",n=xr.unknown_error,i=400;if(r)switch(r){case"user_already_exists":case"user_already_registered":a="user_already_exists",i=409;break;case"weak_password":a="password_too_short",i=422;break;case"invalid_email":a="invalid_email",i=422;break;case"over_email_send_rate_limit":a="over_email_send_rate_limit",i=429;break;case"invalid_credentials":a="invalid_credentials",i=401;break;case"email_not_confirmed":a="email_not_confirmed",i=403;break;case"session_not_found":a="session_expired",i=401;break}return a==="unknown_error"&&(t.includes("User already registered")||t.includes("already exists")?(a="user_already_exists",i=409):t.includes("Password should be at least")?(a="password_too_short",i=422):t.includes("Password cannot be longer than 72")?(a="password_too_long",i=422):t.includes("Invalid email")?(a="invalid_email",i=422):t.includes("over_email_send_rate_limit")?(a="over_email_send_rate_limit",i=429):t.includes("Invalid login credentials")?(a="invalid_credentials",i=401):t.includes("Email not confirmed")?(a="email_not_confirmed",i=403):t.includes("Network request failed")&&(a="network_error",i=503)),n=xr[a]||t||xr.unknown_error,new Xr(n,a,i,{originalError:t,originalCode:r})};let Bs=null,_t=0;const ei=6e4,ia={login:async({email:s,password:t})=>{try{const{data:r,error:a}=await se.auth.signInWithPassword({email:s,password:t});return a?{success:!1,error:Ae(a)}:(Bs=null,_t=0,{success:!0,redirectTo:"/dashboard/overview"})}catch(r){return{success:!1,error:Ae(r)}}},logout:async()=>{try{const{error:s}=await se.auth.signOut();return Bs=null,_t=0,s?{success:!1,error:Ae(s)}:{success:!0,redirectTo:"/login"}}catch(s){return{success:!1,error:Ae(s)}}},check:async()=>{try{const{data:s}=await se.auth.getSession();return s?.session?{authenticated:!0}:{authenticated:!1,redirectTo:"/login"}}catch{return{authenticated:!1,redirectTo:"/login"}}},getIdentity:async()=>{try{const s=Date.now();if(Bs&&s-_t<ei)return Bs;const{data:{session:t}}=await se.auth.getSession();if(!t)return null;const{data:r,error:a}=await se.from("users").select("*").eq("id",t.user.id).single();if(a||!r)return console.error("Error fetching user data:",a),{id:t.user.id,email:t.user.email||"",full_name:t.user.user_metadata?.full_name||"User",vendor_id:1,role:"student"};const n={id:r.id,email:r.email,full_name:r.full_name,vendor_id:r.vendor_id,role:r.role,is_active:r.is_active,created_at:r.created_at};return Bs=n,_t=s,n}catch(s){return console.error("Error in getIdentity:",s),null}},register:async({email:s,password:t,name:r})=>{try{if(console.log("🚀 Starting registration:",{email:s,name:r}),!s||!t)return{success:!1,error:Ae({message:"Email i hasło są wymagane",code:"validation_error"})};if(t.length<6)return{success:!1,error:Ae({message:"Password should be at least 6 characters",code:"weak_password"})};if(t.length>72)return{success:!1,error:Ae({message:"Password cannot be longer than 72 characters",code:"password_too_long"})};const{data:a,error:n}=await se.auth.signUp({email:s.trim(),password:t,options:{data:{full_name:r||s.split("@")[0],role:"student"},emailRedirectTo:`${window.location.origin}/login?verified=true`}});return n?(console.error("❌ Registration error:",n),{success:!1,error:Ae(n)}):a.user?(console.log("✅ Registration successful:",a.user.id),{success:!0,successNotification:{message:"Rejestracja udana! Sprawdź swoją skrzynkę email.",description:"Wysłaliśmy link aktywacyjny na podany adres email."}}):{success:!1,error:Ae({message:"Rejestracja nie powiodła się - brak danych użytkownika",code:"registration_failed"})}}catch(a){return console.error("❌ Unexpected registration error:",a),{success:!1,error:Ae(a)}}},forgotPassword:async({email:s})=>{try{const{error:t}=await se.auth.resetPasswordForEmail(s,{redirectTo:`${window.location.origin}/update-password`});return t?{success:!1,error:Ae(t)}:{success:!0,successNotification:{message:"Email wysłany!",description:"Sprawdź swoją skrzynkę odbiorczą"}}}catch(t){return{success:!1,error:Ae(t)}}},updatePassword:async({password:s})=>{try{const{error:t}=await se.auth.updateUser({password:s});return t?{success:!1,error:Ae(t)}:{success:!0,redirectTo:"/login?passwordChanged=true"}}catch(t){return{success:!1,error:Ae(t)}}},getPermissions:async()=>{try{const s=Date.now();if(Bs&&s-_t<ei)return Bs.role;const{data:{session:t}}=await se.auth.getSession();if(!t)return null;const{data:r,error:a}=await se.from("users").select("role").eq("id",t.user.id).single();return a||!r?(console.error("Error fetching user permissions:",a),"student"):r.role}catch{return null}},onError:async s=>(console.error("Auth error:",s),s?.statusCode===401?{redirectTo:"/login",logout:!0,error:s}:{error:s})},qr=({isLoading:s,isError:t,loadingText:r="Loading...",errorMsg:a="Error loading data"})=>s?e.jsx("div",{className:"p-6 text-gray-600 animate-reverse-pulse",children:r}):t?e.jsx("div",{className:"p-6 text-red-500",children:a}):null;function Mc(s,t){let r;try{r=s()}catch{return}return{getItem:n=>{var i;const o=c=>c===null?null:JSON.parse(c,void 0),l=(i=r.getItem(n))!=null?i:null;return l instanceof Promise?l.then(o):o(l)},setItem:(n,i)=>r.setItem(n,JSON.stringify(i,void 0)),removeItem:n=>r.removeItem(n)}}const na=s=>t=>{try{const r=s(t);return r instanceof Promise?r:{then(a){return na(a)(r)},catch(a){return this}}}catch(r){return{then(a){return this},catch(a){return na(a)(r)}}}},Lc=(s,t)=>(r,a,n)=>{let i={storage:Mc(()=>localStorage),partialize:h=>h,version:0,merge:(h,f)=>({...f,...h}),...t},o=!1;const l=new Set,c=new Set;let u=i.storage;if(!u)return s((...h)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),r(...h)},a,n);const x=()=>{const h=i.partialize({...a()});return u.setItem(i.name,{state:h,version:i.version})},m=n.setState;n.setState=(h,f)=>{m(h,f),x()};const p=s((...h)=>{r(...h),x()},a,n);n.getInitialState=()=>p;let g;const b=()=>{var h,f;if(!u)return;o=!1,l.forEach(j=>{var v;return j((v=a())!=null?v:p)});const y=((f=i.onRehydrateStorage)==null?void 0:f.call(i,(h=a())!=null?h:p))||void 0;return na(u.getItem.bind(u))(i.name).then(j=>{if(j)if(typeof j.version=="number"&&j.version!==i.version){if(i.migrate){const v=i.migrate(j.state,j.version);return v instanceof Promise?v.then(k=>[!0,k]):[!0,v]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,j.state];return[!1,void 0]}).then(j=>{var v;const[k,C]=j;if(g=i.merge(C,(v=a())!=null?v:p),r(g,!0),k)return x()}).then(()=>{y?.(g,void 0),g=a(),o=!0,c.forEach(j=>j(g))}).catch(j=>{y?.(void 0,j)})};return n.persist={setOptions:h=>{i={...i,...h},h.storage&&(u=h.storage)},clearStorage:()=>{u?.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>b(),hasHydrated:()=>o,onHydrate:h=>(l.add(h),()=>{l.delete(h)}),onFinishHydration:h=>(c.add(h),()=>{c.delete(h)})},i.skipHydration||b(),g||p},Ac=Lc;class qc{static async call(t,r,a={}){const i={message:this.interpolateTemplate(r.user,a),...r.system&&{system:r.system},...t.model&&{model:t.model}},o=await fetch(t.endpoint,{method:"POST",headers:{"Content-Type":"application/json",...t.apiKey&&{Authorization:`Bearer ${t.apiKey}`}},body:JSON.stringify(i)});let l;try{l=await o.json()}catch{throw new Error(`LLM API Error: ${o.status} ${o.statusText}`)}if(!o.ok||l.error){if(l.message||l.error){const u=l.message||l.error,x=l.suggestion?` ${l.suggestion}`:"";throw new Error(`${u}${x}`)}throw new Error(`LLM API Error: ${o.status} ${o.statusText}`)}let c="";return l.response?c=l.response:l.data?c=l.data:l.text?c=l.text:typeof l=="string"?c=l:c=JSON.stringify(l),r.responseFormat==="json"?this.parseJsonResponse(c):c}static interpolateTemplate(t,r){return t.replace(/\{\{(\w+)\}\}/g,(a,n)=>r[n]!==void 0?String(r[n]):a)}static cleanJsonResponse(t){return t.replace(/```(?:json)?\s*([\s\S]*?)\s*```/,"$1").trim()}static parseJsonResponse(t){const r=this.cleanJsonResponse(t);try{return JSON.parse(r)}catch{try{return JSON.parse(t)}catch{throw console.error("Failed to parse JSON response:",t),new Error("Nie udało się przetworzyć odpowiedzi JSON z API")}}}}const me=$l()(Ac((s,t)=>({processes:{},formData:{},llmOperations:{},registeredLLMOperations:{},register:r=>s(a=>({processes:{...a.processes,[r.id]:r}})),unregister:(r,a="all")=>s(n=>{switch(a){case"all":{const{[r]:i,...o}=n.processes,{[r]:l,...c}=n.formData,u=Object.keys(n.llmOperations).filter(m=>!m.startsWith(`${r}-`)).reduce((m,p)=>(m[p]=n.llmOperations[p],m),{}),x=Object.keys(n.registeredLLMOperations).filter(m=>!m.startsWith(`${r}-`)).reduce((m,p)=>(m[p]=n.registeredLLMOperations[p],m),{});return{processes:o,formData:c,llmOperations:u,registeredLLMOperations:x}}case"data":{const{[r]:i,...o}=n.formData;return{...n,formData:o}}default:return n}}),get:r=>t().processes[r]||null,getSchemaFragment:r=>{const[a,...n]=r.split("."),i=t().processes[a];if(!i)return null;let o=i.schema;for(const l of n)o=o?.[l];return o},setData:(r,a)=>s(n=>({formData:{...n.formData,[r]:{...n.formData[r],...a}}})),getData:r=>t().formData[r]||{},reset:r=>s(a=>({formData:{...a.formData,[r]:{}}})),registerLLMOperation:(r,a)=>s(n=>({registeredLLMOperations:{...n.registeredLLMOperations,[`${r}-${a.id}`]:a}})),unregisterLLMOperation:(r,a)=>s(n=>{const{[`${r}-${a}`]:i,...o}=n.registeredLLMOperations;return{registeredLLMOperations:o}}),executeLLMOperation:async(r,a,n={})=>{const i=`${r}-${a}`,o=t().registeredLLMOperations[i];if(!o)throw new Error(`LLM Operation not found: ${i}`);try{t().setLLMOperationState(r,a,{loading:!0,error:null});const l=t().getData(r),c={...l,...n},u=o.inputMapping?o.inputMapping(c):c,x=await qc.call(o.config,o.prompt,u);if(o.validation&&!o.validation(x))throw new Error("LLM result failed validation");let m=x;return o.outputMapping&&(m=o.outputMapping(x,l),t().setData(r,m)),t().setLLMOperationState(r,a,{loading:!1,error:null,result:x}),x}catch(l){throw t().setLLMOperationState(r,a,{loading:!1,error:l.message||"Unknown error",result:null}),l}},setLLMOperationState:(r,a,n)=>s(i=>({llmOperations:{...i.llmOperations,[`${r}-${a}`]:n}})),getLLMOperationState:(r,a)=>t().llmOperations[`${r}-${a}`]||{loading:!1,error:null},clearLLMOperation:(r,a)=>s(n=>{const{[`${r}-${a}`]:i,...o}=n.llmOperations;return{llmOperations:o}})}),{name:"form-schema-store",version:2,partialize:s=>({processes:s.processes,formData:s.formData})})),jt=(s,t)=>{const{registerLLMOperation:r,unregisterLLMOperation:a,executeLLMOperation:n,getLLMOperationState:i,clearLLMOperation:o}=me();return{...i(s,t),registerOperation:p=>{r(s,p)},executeOperation:async p=>await n(s,t,p),clearOperation:()=>{o(s,t)},unregisterOperation:()=>{a(s,t)}}},oa=d.forwardRef(({className:s,...t},r)=>e.jsx(Ni,{ref:r,className:K("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...t}));oa.displayName=Ni.displayName;const Oc=d.forwardRef(({className:s,...t},r)=>e.jsx(zi,{ref:r,className:K("aspect-square h-full w-full object-cover",s),...t}));Oc.displayName=zi.displayName;const la=d.forwardRef(({className:s,...t},r)=>e.jsx(ki,{ref:r,className:K("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...t}));la.displayName=ki.displayName;function pr({className:s,...t}){return e.jsx("div",{className:K("animate-pulse rounded-md bg-primary/10",s),...t})}const $c=({className:s="",showRole:t=!0,showEmail:r=!0,compact:a=!1})=>{const{data:n,isLoading:i,error:o}=Oe(),l=p=>{switch(p){case"admin":return e.jsx(Tr,{className:"h-3 w-3"});case"teacher":return e.jsx(ic,{className:"h-3 w-3"});case"student":return e.jsx(mt,{className:"h-3 w-3"});default:return e.jsx(Ts,{className:"h-3 w-3"})}},c=p=>{switch(p){case"admin":return"Administrator";case"teacher":return"Nauczyciel";case"student":return"Uczeń";default:return"Użytkownik"}},u=p=>{switch(p){case"admin":return"text-purple-600 bg-purple-50";case"teacher":return"text-blue-600 bg-blue-50";case"student":return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}};if(i)return e.jsxs("div",{className:`flex items-center space-x-3 p-3 ${s}`,children:[e.jsx(pr,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(pr,{className:"h-4 w-28"}),e.jsx(pr,{className:"h-3 w-20"}),t&&e.jsx(pr,{className:"h-3 w-16"})]})]});if(o||!n)return e.jsxs("div",{className:`flex items-center space-x-3 p-3 text-muted-foreground ${s}`,children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(Ts,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium text-gray-500",children:"Nie zalogowano"}),e.jsx("div",{className:"text-xs opacity-70",children:"Brak danych użytkownika"})]})]});const m=(p=>{if(!p)return"U";const g=p.trim().split(" ");return g.length>=2?`${g[0][0]}${g[g.length-1][0]}`.toUpperCase():p.slice(0,2).toUpperCase()})(n.full_name||n.email);return a?e.jsxs("div",{className:`flex items-center space-x-2 p-2 ${s}`,children:[e.jsx(oa,{className:"h-8 w-8",children:e.jsx(la,{className:"bg-gradient-to-br from-purple-500 to-pink-500 text-white text-xs",children:m})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"font-medium text-sm truncate",children:n.full_name})})]}):e.jsxs("div",{className:`flex items-center space-x-3 px-4 pt-4 rounded-lg bg-white/50 backdrop-blur-sm border border-purple-100/20 ${s}`,children:[e.jsx(oa,{className:"h-12 w-12 ring-2 ring-purple-100 ring-offset-2",children:e.jsx(la,{className:"bg-gradient-to-br from-purple-500 to-pink-500 text-white font-medium",children:m})}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-1",children:[e.jsx("div",{className:"font-semibold text-gray-900 truncate",title:n.full_name,children:n.full_name}),r&&n.email&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500",children:[e.jsx(Ds,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate",title:n.email,children:n.email})]}),t&&n.role&&e.jsx("div",{className:"inline-flex items-center gap-1.5",children:e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full text-xs font-medium ${u(n.role)}`,children:[l(n.role),c(n.role)]})})]})]})},Fc=Dr("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),oe=d.forwardRef(({className:s,variant:t,...r},a)=>e.jsx("div",{ref:a,role:"alert",className:K(Fc({variant:t}),s),...r}));oe.displayName="Alert";const Wc=d.forwardRef(({className:s,...t},r)=>e.jsx("h5",{ref:r,className:K("mb-1 font-medium leading-none tracking-tight",s),...t}));Wc.displayName="AlertTitle";const le=d.forwardRef(({className:s,...t},r)=>e.jsx("div",{ref:r,className:K("text-sm [&_p]:leading-relaxed",s),...t}));le.displayName="AlertDescription";const Uc=Dr("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function H({className:s,variant:t,asChild:r=!1,...a}){const n=r?ja:"span";return e.jsx(n,{"data-slot":"badge",className:K(Uc({variant:t}),s),...a})}const Bc=d.forwardRef(({...s},t)=>e.jsx("nav",{ref:t,"aria-label":"breadcrumb",...s}));Bc.displayName="Breadcrumb";const Gc=d.forwardRef(({className:s,...t},r)=>e.jsx("ol",{ref:r,className:K("flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",s),...t}));Gc.displayName="BreadcrumbList";const Kc=d.forwardRef(({className:s,...t},r)=>e.jsx("li",{ref:r,className:K("inline-flex items-center gap-1.5",s),...t}));Kc.displayName="BreadcrumbItem";const Zc=d.forwardRef(({asChild:s,className:t,...r},a)=>{const n=s?ja:"a";return e.jsx(n,{ref:a,className:K("transition-colors hover:text-foreground",t),...r})});Zc.displayName="BreadcrumbLink";const Qc=d.forwardRef(({className:s,...t},r)=>e.jsx("span",{ref:r,role:"link","aria-disabled":"true","aria-current":"page",className:K("font-normal text-foreground",s),...t}));Qc.displayName="BreadcrumbPage";const Vc=Dr("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),w=d.forwardRef(({className:s,variant:t,size:r,asChild:a=!1,...n},i)=>{const o=a?ja:"button";return e.jsx(o,{className:K(Vc({variant:t,size:r,className:s})),ref:i,...n})});w.displayName="Button";const S=d.forwardRef(({className:s,...t},r)=>e.jsx("div",{ref:r,className:K("rounded-xl border bg-card text-card-foreground shadow flex flex-col overflow-hidden",s),...t}));S.displayName="Card";const A=d.forwardRef(({className:s,...t},r)=>e.jsx("div",{ref:r,className:K("flex flex-col space-y-1.5 p-6 pb-3 bg-pink-200/25",s),...t}));A.displayName="CardHeader";const L=d.forwardRef(({className:s,...t},r)=>e.jsx("div",{ref:r,className:K("text-lg font-semibold leading-tight tracking-tight pt-3",s),...t}));L.displayName="CardTitle";const Ws=d.forwardRef(({className:s,...t},r)=>e.jsx("div",{ref:r,className:K("text-sm text-muted-foreground",s),...t}));Ws.displayName="CardDescription";const _=d.forwardRef(({className:s,...t},r)=>e.jsx("div",{ref:r,className:K("p-3 lg:p-6 pt-3 space-y-3 flex-1 bg-background",s),...t}));_.displayName="CardContent";const Hc=d.forwardRef(({className:s,...t},r)=>e.jsx("div",{ref:r,className:K("flex items-center justify-between p-6 pt-0",s),...t}));Hc.displayName="CardFooter";const Jc=Dr("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),V=d.forwardRef(({className:s,...t},r)=>e.jsx(Ci,{ref:r,className:K(Jc(),s),...t}));V.displayName=Ci.displayName;d.createContext({});d.createContext({});const $=d.forwardRef(({className:s,type:t,...r},a)=>e.jsx("input",{type:t,className:K("flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:a,...r}));$.displayName="Input";const Xc=d.forwardRef(({className:s,align:t="center",sideOffset:r=4,...a},n)=>e.jsx(Xo,{children:e.jsx(Si,{ref:n,align:t,sideOffset:r,className:K("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",s),...a})}));Xc.displayName=Si.displayName;const nn=d.forwardRef(({className:s,children:t,...r},a)=>e.jsxs(_i,{ref:a,className:K("relative overflow-hidden",s),...r,children:[e.jsx(Yo,{className:"h-full w-full rounded-[inherit]",children:t}),e.jsx(on,{}),e.jsx(el,{})]}));nn.displayName=_i.displayName;const on=d.forwardRef(({className:s,orientation:t="vertical",...r},a)=>e.jsx(Ti,{ref:a,orientation:t,className:K("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...r,children:e.jsx(sl,{className:"relative flex-1 rounded-full bg-border"})}));on.displayName=Ti.displayName;const xe=ol,pe=ll,de=d.forwardRef(({className:s,children:t,...r},a)=>e.jsxs(Di,{ref:a,className:K("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-background px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...r,children:[t,e.jsx(tl,{asChild:!0,children:e.jsx(ba,{className:"h-4 w-4 opacity-50"})})]}));de.displayName=Di.displayName;const ln=d.forwardRef(({className:s,...t},r)=>e.jsx(Ii,{ref:r,className:K("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(nc,{className:"h-4 w-4"})}));ln.displayName=Ii.displayName;const cn=d.forwardRef(({className:s,...t},r)=>e.jsx(Pi,{ref:r,className:K("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(ba,{className:"h-4 w-4"})}));cn.displayName=Pi.displayName;const ue=d.forwardRef(({className:s,children:t,position:r="popper",...a},n)=>e.jsx(rl,{children:e.jsxs(Ri,{ref:n,className:K("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:r,...a,children:[e.jsx(ln,{}),e.jsx(al,{className:K("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),e.jsx(cn,{})]})}));ue.displayName=Ri.displayName;const Yc=d.forwardRef(({className:s,...t},r)=>e.jsx(Ei,{ref:r,className:K("px-2 py-1.5 text-sm font-semibold",s),...t}));Yc.displayName=Ei.displayName;const U=d.forwardRef(({className:s,children:t,...r},a)=>e.jsxs(Mi,{ref:a,className:K("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...r,children:[e.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(il,{children:e.jsx(Re,{className:"h-4 w-4"})})}),e.jsx(nl,{children:t})]}));U.displayName=Mi.displayName;const ed=d.forwardRef(({className:s,...t},r)=>e.jsx(Li,{ref:r,className:K("-mx-1 my-1 h-px bg-muted",s),...t}));ed.displayName=Li.displayName;const zs=d.forwardRef(({className:s,orientation:t="horizontal",decorative:r=!0,...a},n)=>e.jsx(Ai,{ref:n,decorative:r,orientation:t,className:K("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",s),...a}));zs.displayName=Ai.displayName;const as=d.forwardRef(({className:s,...t},r)=>e.jsx("textarea",{className:K("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:r,...t}));as.displayName="Textarea";const sd=cl,dn=d.forwardRef(({className:s,...t},r)=>e.jsx(qi,{ref:r,className:K("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",s),...t}));dn.displayName=qi.displayName;const yr=d.forwardRef(({className:s,...t},r)=>e.jsx(Oi,{ref:r,className:K("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",s),...t}));yr.displayName=Oi.displayName;const un=d.forwardRef(({className:s,...t},r)=>e.jsx($i,{ref:r,className:K("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...t}));un.displayName=$i.displayName;const Ve=d.forwardRef(({className:s,...t},r)=>e.jsx(Fi,{ref:r,className:K("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...t,children:e.jsx(dl,{className:K("flex items-center justify-center text-current"),children:e.jsx(Re,{className:"h-4 w-4"})})}));Ve.displayName=Fi.displayName;var Or="Switch",[td,kh]=ga(Or),[rd,ad]=td(Or),mn=d.forwardRef((s,t)=>{const{__scopeSwitch:r,name:a,checked:n,defaultChecked:i,required:o,disabled:l,value:c="on",onCheckedChange:u,form:x,...m}=s,[p,g]=d.useState(null),b=et(t,v=>g(v)),h=d.useRef(!1),f=p?x||!!p.closest("form"):!0,[y,j]=Wi({prop:n,defaultProp:i??!1,onChange:u,caller:Or});return e.jsxs(rd,{scope:r,checked:y,disabled:l,children:[e.jsx(Us.button,{type:"button",role:"switch","aria-checked":y,"aria-required":o,"data-state":jn(y),"data-disabled":l?"":void 0,disabled:l,value:c,...m,ref:b,onClick:ce(s.onClick,v=>{j(k=>!k),f&&(h.current=v.isPropagationStopped(),h.current||v.stopPropagation())})}),f&&e.jsx(hn,{control:p,bubbles:!h.current,name:a,value:c,checked:y,required:o,disabled:l,form:x,style:{transform:"translateX(-100%)"}})]})});mn.displayName=Or;var xn="SwitchThumb",pn=d.forwardRef((s,t)=>{const{__scopeSwitch:r,...a}=s,n=ad(xn,r);return e.jsx(Us.span,{"data-state":jn(n.checked),"data-disabled":n.disabled?"":void 0,...a,ref:t})});pn.displayName=xn;var id="SwitchBubbleInput",hn=d.forwardRef(({__scopeSwitch:s,control:t,checked:r,bubbles:a=!0,...n},i)=>{const o=d.useRef(null),l=et(o,i),c=ul(r),u=ml(t);return d.useEffect(()=>{const x=o.current;if(!x)return;const m=window.HTMLInputElement.prototype,g=Object.getOwnPropertyDescriptor(m,"checked").set;if(c!==r&&g){const b=new Event("click",{bubbles:a});g.call(x,r),x.dispatchEvent(b)}},[c,r,a]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...n,tabIndex:-1,ref:l,style:{...n.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});hn.displayName=id;function jn(s){return s?"checked":"unchecked"}var gn=mn,nd=pn;const xs=d.forwardRef(({className:s,...t},r)=>e.jsx(gn,{className:K("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...t,ref:r,children:e.jsx(nd,{className:K("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));xs.displayName=gn.displayName;const fs=pl,ys=hl,bs=jl,ds=d.forwardRef(({className:s,sideOffset:t=4,...r},a)=>e.jsx(xl,{children:e.jsx(Ui,{ref:a,sideOffset:t,className:K("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",s),...r})}));ds.displayName=Ui.displayName;const od=({onClose:s})=>{const{mutate:t}=Ji(),{menuItems:r}=Wl(),{data:a}=Oe(),n=()=>{s&&s()},i=a?.role,o=r.filter(l=>l.meta?.roles?l.meta.roles.includes(i):!0);return e.jsxs("div",{className:"flex h-full w-64 flex-col border-r bg-background",children:[e.jsxs("div",{className:"flex h-16 items-center justify-between border-b px-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(wa,{className:"h-6 w-6 mr-2"}),e.jsx("span",{className:"font-semibold",children:"Smart Up"})]}),s&&e.jsx(w,{variant:"ghost",size:"sm",onClick:s,className:"lg:hidden",children:e.jsx(He,{className:"h-4 w-4"})})]}),e.jsx(nn,{className:"flex-1 px-3 py-4",children:e.jsx("nav",{className:"space-y-2",children:o.map(l=>e.jsxs(Ll,{to:l.route??"/",onClick:n,className:({isActive:c})=>K("flex items-center rounded-md px-3 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground",c?"bg-accent text-accent-foreground":"text-muted-foreground"),children:[l.icon&&e.jsx("span",{className:"mr-3 flex items-center",children:(W.isValidElement(l.icon),l.icon)}),l.label]},l.key))})}),e.jsx(zs,{}),e.jsx($c,{className:"border-b"}),e.jsx("div",{className:"p-4",children:e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>{t(),s&&s()},className:"w-full justify-start",children:[e.jsx(Yi,{className:"mr-2 h-4 w-4"}),"Logout"]})})]})},ld=({onClose:s})=>{const t=fa(),r=Q(),{data:a}=Oe(),{mutate:n}=Ji(),i=[{id:"dashboard",path:"/student/dashboard",label:"Dashboard",icon:oc},{id:"courses",path:"/student/courses",label:"Kursy",icon:ge},{id:"gamification",path:"/student/gamification",label:"Gamifikacja",icon:aa},{id:"leaderboard",path:"/student/leaderboard",label:"Ranking",icon:qe},{id:"achievements",path:"/student/achievements",label:"Osiągnięcia",icon:Lt},{id:"profile",path:"/student/profile",label:"Profil",icon:Ts}],o=c=>t.pathname.startsWith(c),l=c=>{r(c),s?.()};return e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-pink-600 to-purple-700 rounded-xl flex items-center justify-center",children:e.jsx(qe,{className:"w-5 h-5 text-white"})}),e.jsx("span",{className:"text-xl font-bold",children:"Smart Up"})]}),s&&e.jsx(w,{variant:"ghost",size:"icon",onClick:s,className:"lg:hidden",children:e.jsx(He,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center text-white font-bold",children:a?.full_name?.charAt(0)||"U"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:a?.full_name}),e.jsx("p",{className:"text-xs text-gray-500",children:"Uczeń"})]})]})}),e.jsx("nav",{className:"flex-1 p-4 space-y-1",children:i.map(c=>e.jsxs("button",{onClick:()=>l(c.path),className:K("w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all",o(c.path)?"bg-purple-50 text-purple-700 font-medium":"text-gray-600 hover:bg-gray-50"),children:[e.jsx(c.icon,{className:"w-5 h-5"}),e.jsx("span",{children:c.label})]},c.id))}),e.jsxs("div",{className:"p-4 border-t space-y-1",children:[e.jsxs("button",{onClick:()=>l("/student/settings"),className:"w-full flex items-center gap-3 px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg transition-all",children:[e.jsx(lc,{className:"w-5 h-5"}),e.jsx("span",{children:"Ustawienia"})]}),e.jsxs("button",{onClick:()=>n(),className:"w-full flex items-center gap-3 px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg transition-all",children:[e.jsx(Yi,{className:"w-5 h-5"}),e.jsx("span",{children:"Wyloguj"})]})]})]})},$r=()=>{const[s,t]=d.useState({points:0,level:1,streak:0,idle_rate:1,next_level_points:200,quizzes_completed:0,perfect_scores:0,total_time:0,rank:0}),[r,a]=d.useState(!0),n=d.useCallback(async()=>{try{a(!0);const{data:i,error:o}=await se.rpc("get_my_stats");if(o)throw o;i&&t({points:i.points||0,level:i.level||1,streak:i.streak||0,idle_rate:i.idle_rate||1,next_level_points:i.next_level_points||200,quizzes_completed:i.quizzes_completed||0,perfect_scores:i.perfect_scores||0,total_time:i.total_time||0,rank:i.rank||0})}catch(i){console.error("Error fetching stats:",i)}finally{a(!1)}},[]);return d.useEffect(()=>{n()},[n]),{stats:s,setStats:t,isLoading:r,refetch:n}},Ht=(s,t,r)=>{const[a,n]=d.useState(null),[i,o]=d.useState(!0),[l,c]=d.useState(null),u=d.useCallback(async()=>{if(r?.enabled!==!1)try{o(!0),c(null);const{data:x,error:m}=await se.rpc(s,t);if(m)throw m;n(x),r?.onSuccess?.(x)}catch(x){c(x),r?.onError?.(x)}finally{o(!1)}},[s,JSON.stringify(t),r?.enabled]);return d.useEffect(()=>{u()},[u]),{data:a,isLoading:i,error:l,refetch:u}},fn=(s,t)=>{const[r,a]=d.useState([]),[n,i]=d.useState(!0),[o,l]=d.useState(null),c=d.useCallback(async()=>{if(t?.enabled!==!1)try{i(!0),l(null);let u=se.from(s).select(t?.select||"*");t?.filters?.forEach(p=>{switch(p.operator){case"eq":u=u.eq(p.field,p.value);break;case"in":u=u.in(p.field,p.value);break;case"contains":u=u.ilike(p.field,`%${p.value}%`);break}}),t?.sorts?.forEach(p=>{u=u.order(p.field,{ascending:p.order==="asc"})}),t?.limit&&(u=u.limit(t.limit));const{data:x,error:m}=await u;if(m)throw m;a(x||[])}catch(u){l(u)}finally{i(!1)}},[s,JSON.stringify(t)]);return d.useEffect(()=>{c()},[c]),{data:r,isLoading:n,error:o,refetch:c}},cd=({onMenuClick:s})=>{const{stats:t}=$r();return e.jsx("div",{className:"sticky top-0 z-30 border-b border-purple-200/20 bg-background/80 backdrop-blur-md",children:e.jsxs("div",{className:"flex h-16 items-center justify-between px-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(w,{variant:"ghost",size:"sm",onClick:s,className:"lg:hidden hover:bg-purple-100/20 hover:text-purple-700",children:e.jsx(wa,{className:"h-6 w-6"})}),e.jsx("span",{className:"font-semibold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent lg:hidden",children:"Smart Up"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-purple-50 px-3 py-1.5 rounded-full",children:[e.jsx(At,{className:"w-4 h-4 text-purple-700"}),e.jsx("span",{className:"font-bold text-purple-700 text-sm",children:t.points})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-orange-50 px-3 py-1.5 rounded-full",children:[e.jsx(Ir,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"font-bold text-orange-600 text-sm",children:t.streak})]}),e.jsxs(w,{variant:"ghost",size:"icon",className:"relative",children:[e.jsx(cc,{className:"w-5 h-5"}),e.jsx("span",{className:"absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"})]})]})]})})},M=({children:s})=>e.jsx("div",{className:"p-2 md:p-12 space-y-6 max-w-7xl mx-auto",children:s}),dd=({children:s})=>{const[t,r]=d.useState(!1),{data:a}=Oe(),n=a?.role==="student",i=()=>{r(!t)};return e.jsx("div",{className:"min-h-screen bg-stone-200 relative overflow-x-hidden",children:e.jsxs("div",{className:"flex relative",children:[t&&e.jsx("div",{className:"fixed inset-0 z-40 bg-purple-900/20 backdrop-blur-sm lg:hidden",onClick:()=>r(!1)}),e.jsx("aside",{className:`
            h-screen w-64 transform transition-transform duration-300 ease-in-out
            fixed left-0 top-0 z-50
            ${t?"translate-x-0":"-translate-x-full"}
            lg:translate-x-0
            bg-background/95 backdrop-blur-md border-r border-purple-200/20
          `,children:n?e.jsx(ld,{onClose:()=>r(!1)}):e.jsx(od,{onClose:()=>r(!1)})}),e.jsxs("main",{className:"flex-1 lg:ml-64 min-w-0 relative z-10",children:[n?e.jsx(cd,{onMenuClick:i}):e.jsxs("div",{className:"sticky top-0 z-30 flex h-16 items-center border-b border-purple-200/20 bg-background/80 backdrop-blur-md px-4 lg:hidden",children:[e.jsx(w,{variant:"ghost",size:"sm",onClick:i,className:"mr-2 hover:bg-purple-100/20 hover:text-purple-700",children:e.jsx(wa,{className:"h-6 w-6"})}),e.jsx("span",{className:"font-semibold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Smart Up"})]}),s]})]})})},ud={"between-center":"flex justify-between items-center gap-2",center:"flex justify-center items-center gap-2",start:"flex justify-start items-center gap-2",end:"flex justify-end items-center gap-2"},R=({children:s,variant:t="between-center",className:r=""})=>{const a=ud[t],n=r?`${a} ${r}`:a;return e.jsx("div",{className:n,children:s})},md={"1-2-3":"grid gap-6 md:grid-cols-2 lg:grid-cols-3","1-2-2":"grid gap-6 md:grid-cols-2","1-1-1":"grid gap-6","2-2-4":"grid gap-6 grid-cols-2 lg:grid-cols-4"},te=({children:s,variant:t="1-2-3",className:r=""})=>{const a=md[t],n=r?`${a} ${r}`:a;return e.jsx("div",{className:n,children:s})},xd={card:{wrap:"space-y-0",title:"font-medium",description:"text-muted-foreground"},lg:{wrap:"space-y-0",title:"text-3xl font-bold tracking-tight",description:"text-muted-foreground"},md:{wrap:"space-y-0",title:"font-medium",description:"text-muted-foreground"},sm:{wrap:"space-y-1",title:"font-medium text-sm text-muted-foreground mb-1",description:"text-sm"}},J=({title:s,description:t,variant:r="lg"})=>{const a=xd[r],n=()=>{switch(r){case"lg":return e.jsx("h1",{className:a.title,children:s});case"md":return e.jsx("h2",{className:a.title,children:s});case"sm":return e.jsx("h3",{className:a.title,children:s});default:return e.jsx("h1",{className:a.title,children:s})}};return r==="card"?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"text-lg font-semibold leading-tight flex items-center gap-2",children:s}),e.jsx(Ws,{className:"text-sm text-muted-foreground mt-2",children:t})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:a.wrap,children:[n(),e.jsx("p",{className:`prose ${a.description}`,children:t})]})})},pd=()=>{const{data:s,isLoading:t}=Oe(),[r,a]=d.useState(null),[n,i]=d.useState(!0);return d.useEffect(()=>{if(t||!s?.vendor_id){i(!1);return}let o=!0;return(async()=>{try{const[c,u,x,m,p]=await Promise.all([se.from("users").select("*",{count:"exact",head:!0}).eq("vendor_id",s.vendor_id),se.from("courses").select("*",{count:"exact"}).eq("vendor_id",s.vendor_id),se.from("activities").select("*, topics!inner(course_id, courses!inner(vendor_id))",{count:"exact"}).eq("topics.courses.vendor_id",s.vendor_id),se.from("activity_progress").select("score, completed_at").not("completed_at","is",null),se.from("user_stats").select("total_points")]);if(!o)return;const g=m.data?.length?m.data.reduce((h,f)=>h+(f.score||0),0)/m.data.length:0,b=p.data?.reduce((h,f)=>h+f.total_points,0)||0;a({totalUsers:c.count||0,activeUsers:c.count||0,totalCourses:u.count||0,publishedCourses:u.data?.filter(h=>h.is_published).length||0,totalActivities:x.count||0,completedActivities:m.data?.length||0,averageScore:Math.round(g),totalPoints:b})}catch(c){console.error("Error fetching dashboard stats:",c)}finally{o&&i(!1)}})(),()=>{o=!1}},[s?.vendor_id,t]),n||t?e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):s?e.jsxs(M,{children:[e.jsx(J,{title:"Dashboard",description:"Przegląd statystyk systemu e-learning"}),e.jsxs(te,{variant:"1-2-2",children:[e.jsxs(S,{children:[e.jsxs(A,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"Użytkownicy"}),e.jsx(Ie,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(_,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r?.totalUsers||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r?.activeUsers||0," aktywnych"]})]})]}),e.jsxs(S,{children:[e.jsxs(A,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"Kursy"}),e.jsx(ge,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(_,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r?.totalCourses||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r?.publishedCourses||0," opublikowanych"]})]})]}),e.jsxs(S,{children:[e.jsxs(A,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"Aktywności"}),e.jsx(en,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(_,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r?.totalActivities||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r?.completedActivities||0," ukończonych"]})]})]}),e.jsxs(S,{children:[e.jsxs(A,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"Średni wynik"}),e.jsx(ws,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(_,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[r?.averageScore||0,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"z wszystkich quizów"})]})]})]}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Aktywność w ostatnich 7 dniach"})}),e.jsx(_,{children:e.jsxs("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:[e.jsx(Pr,{className:"h-8 w-8 mr-2"}),"Wykres aktywności (do implementacji)"]})})]}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Top 5 użytkowników"})}),e.jsx(_,{children:e.jsx("div",{className:"space-y-4",children:[1,2,3,4,5].map(o=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(qe,{className:`h-5 w-5 ${o<=3?"text-yellow-500":"text-muted-foreground"}`}),e.jsxs("span",{children:["Użytkownik ",o]})]}),e.jsxs("span",{className:"font-semibold",children:[1e3-o*100," pkt"]})]},o))})})]})]}):e.jsx(M,{children:e.jsx("div",{className:"text-center text-muted-foreground",children:"Nie można załadować danych użytkownika"})})},hd={name:"dashboard",list:"/dashboard/overview",meta:{label:"Dashboard",icon:e.jsx(dc,{className:"h-4 w-4"})}},jd=[e.jsx(O,{path:"/dashboard/overview",element:e.jsx(pd,{})},"dashboard")],Fr=({current:s,pageSize:t,total:r,setCurrent:a,setPageSize:n,itemName:i="elementów",pageSizeOptions:o=[10,20,50]})=>{const l=Math.ceil(r/t),c=(s-1)*t+1,u=Math.min(s*t,r),x=s>1,m=s<l,p=()=>{const g=[];if(l<=5)for(let h=1;h<=l;h++)g.push(h);else{g.push(1),s>3&&g.push("...");const h=Math.max(2,s-1),f=Math.min(l-1,s+1);for(let y=h;y<=f;y++)g.push(y);s<l-2&&g.push("..."),g.push(l)}return g};return r===0?null:e.jsxs(R,{className:"mt-6",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Pokazuje ",c,"-",u," z ",r," ",i]}),e.jsxs(R,{className:"gap-2",children:[n&&e.jsxs(xe,{value:t.toString(),onValueChange:g=>{n(parseInt(g)),a(1)},children:[e.jsx(de,{className:"w-[100px]",children:e.jsx(pe,{})}),e.jsx(ue,{children:o.map(g=>e.jsxs(U,{value:g.toString(),children:[g," / str."]},g))})]}),e.jsx(w,{variant:"outline",size:"sm",onClick:()=>a(s-1),disabled:!x,children:e.jsx(Rr,{className:"w-4 h-4"})}),e.jsx("div",{className:"hidden sm:flex gap-1",children:p().map((g,b)=>g==="..."?e.jsx("span",{className:"px-3 py-1 text-sm text-muted-foreground",children:"..."},`ellipsis-${b}`):e.jsx(w,{variant:s===g?"default":"outline",size:"sm",onClick:()=>a(g),className:"min-w-[40px]",children:g},g))}),e.jsxs("div",{className:"flex sm:hidden items-center px-3 text-sm",children:[s," / ",l]}),e.jsx(w,{variant:"outline",size:"sm",onClick:()=>a(s+1),disabled:!m,children:e.jsx(Zs,{className:"w-4 h-4"})})]})]})};var ca=["Enter"," "],gd=["ArrowDown","PageUp","Home"],yn=["ArrowUp","PageDown","End"],fd=[...gd,...yn],yd={ltr:[...ca,"ArrowRight"],rtl:[...ca,"ArrowLeft"]},bd={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Jt="Menu",[Ot,wd,vd]=gl(Jt),[st,bn]=ga(Jt,[vd,Bi,Gi]),Wr=Bi(),wn=Gi(),[Nd,tt]=st(Jt),[zd,Xt]=st(Jt),vn=s=>{const{__scopeMenu:t,open:r=!1,children:a,dir:n,onOpenChange:i,modal:o=!0}=s,l=Wr(t),[c,u]=d.useState(null),x=d.useRef(!1),m=Zi(i),p=Dl(n);return d.useEffect(()=>{const g=()=>{x.current=!0,document.addEventListener("pointerdown",b,{capture:!0,once:!0}),document.addEventListener("pointermove",b,{capture:!0,once:!0})},b=()=>x.current=!1;return document.addEventListener("keydown",g,{capture:!0}),()=>{document.removeEventListener("keydown",g,{capture:!0}),document.removeEventListener("pointerdown",b,{capture:!0}),document.removeEventListener("pointermove",b,{capture:!0})}},[]),e.jsx(Il,{...l,children:e.jsx(Nd,{scope:t,open:r,onOpenChange:m,content:c,onContentChange:u,children:e.jsx(zd,{scope:t,onClose:d.useCallback(()=>m(!1),[m]),isUsingKeyboardRef:x,dir:p,modal:o,children:a})})})};vn.displayName=Jt;var kd="MenuAnchor",ka=d.forwardRef((s,t)=>{const{__scopeMenu:r,...a}=s,n=Wr(r);return e.jsx(yl,{...n,...a,ref:t})});ka.displayName=kd;var Ca="MenuPortal",[Cd,Nn]=st(Ca,{forceMount:void 0}),zn=s=>{const{__scopeMenu:t,forceMount:r,children:a,container:n}=s,i=tt(Ca,t);return e.jsx(Cd,{scope:t,forceMount:r,children:e.jsx(Sr,{present:r||i.open,children:e.jsx(fl,{asChild:!0,container:n,children:a})})})};zn.displayName=Ca;var es="MenuContent",[Sd,Sa]=st(es),kn=d.forwardRef((s,t)=>{const r=Nn(es,s.__scopeMenu),{forceMount:a=r.forceMount,...n}=s,i=tt(es,s.__scopeMenu),o=Xt(es,s.__scopeMenu);return e.jsx(Ot.Provider,{scope:s.__scopeMenu,children:e.jsx(Sr,{present:a||i.open,children:e.jsx(Ot.Slot,{scope:s.__scopeMenu,children:o.modal?e.jsx(_d,{...n,ref:t}):e.jsx(Td,{...n,ref:t})})})})}),_d=d.forwardRef((s,t)=>{const r=tt(es,s.__scopeMenu),a=d.useRef(null),n=et(t,a);return d.useEffect(()=>{const i=a.current;if(i)return _l(i)},[]),e.jsx(_a,{...s,ref:n,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:ce(s.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),Td=d.forwardRef((s,t)=>{const r=tt(es,s.__scopeMenu);return e.jsx(_a,{...s,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),Dd=Nl("MenuContent.ScrollLock"),_a=d.forwardRef((s,t)=>{const{__scopeMenu:r,loop:a=!1,trapFocus:n,onOpenAutoFocus:i,onCloseAutoFocus:o,disableOutsidePointerEvents:l,onEntryFocus:c,onEscapeKeyDown:u,onPointerDownOutside:x,onFocusOutside:m,onInteractOutside:p,onDismiss:g,disableOutsideScroll:b,...h}=s,f=tt(es,r),y=Xt(es,r),j=Wr(r),v=wn(r),k=wd(r),[C,z]=d.useState(null),N=d.useRef(null),I=et(t,N,f.onContentChange),q=d.useRef(0),P=d.useRef(""),B=d.useRef(0),T=d.useRef(null),E=d.useRef("right"),D=d.useRef(0),ee=b?vl:d.Fragment,Pe=b?{as:Dd,allowPinchZoom:!0}:void 0,ae=G=>{const _e=P.current+G,Te=k().filter(we=>!we.disabled),he=document.activeElement,Fe=Te.find(we=>we.ref.current===he)?.textValue,ls=Te.map(we=>we.textValue),Ps=Wd(ls,_e,Fe),be=Te.find(we=>we.textValue===Ps)?.ref.current;(function we(cs){P.current=cs,window.clearTimeout(q.current),cs!==""&&(q.current=window.setTimeout(()=>we(""),1e3))})(_e),be&&setTimeout(()=>be.focus())};d.useEffect(()=>()=>window.clearTimeout(q.current),[]),wl();const Y=d.useCallback(G=>E.current===T.current?.side&&Bd(G,T.current?.area),[]);return e.jsx(Sd,{scope:r,searchRef:P,onItemEnter:d.useCallback(G=>{Y(G)&&G.preventDefault()},[Y]),onItemLeave:d.useCallback(G=>{Y(G)||(N.current?.focus(),z(null))},[Y]),onTriggerLeave:d.useCallback(G=>{Y(G)&&G.preventDefault()},[Y]),pointerGraceTimerRef:B,onPointerGraceIntentChange:d.useCallback(G=>{T.current=G},[]),children:e.jsx(ee,{...Pe,children:e.jsx(zl,{asChild:!0,trapped:n,onMountAutoFocus:ce(i,G=>{G.preventDefault(),N.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:e.jsx(kl,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:u,onPointerDownOutside:x,onFocusOutside:m,onInteractOutside:p,onDismiss:g,children:e.jsx(Cl,{asChild:!0,...v,dir:y.dir,orientation:"vertical",loop:a,currentTabStopId:C,onCurrentTabStopIdChange:z,onEntryFocus:ce(c,G=>{y.isUsingKeyboardRef.current||G.preventDefault()}),preventScrollOnEntryFocus:!0,children:e.jsx(Sl,{role:"menu","aria-orientation":"vertical","data-state":Fn(f.open),"data-radix-menu-content":"",dir:y.dir,...j,...h,ref:I,style:{outline:"none",...h.style},onKeyDown:ce(h.onKeyDown,G=>{const Te=G.target.closest("[data-radix-menu-content]")===G.currentTarget,he=G.ctrlKey||G.altKey||G.metaKey,Fe=G.key.length===1;Te&&(G.key==="Tab"&&G.preventDefault(),!he&&Fe&&ae(G.key));const ls=N.current;if(G.target!==ls||!fd.includes(G.key))return;G.preventDefault();const be=k().filter(we=>!we.disabled).map(we=>we.ref.current);yn.includes(G.key)&&be.reverse(),$d(be)}),onBlur:ce(s.onBlur,G=>{G.currentTarget.contains(G.target)||(window.clearTimeout(q.current),P.current="")}),onPointerMove:ce(s.onPointerMove,$t(G=>{const _e=G.target,Te=D.current!==G.clientX;if(G.currentTarget.contains(_e)&&Te){const he=G.clientX>D.current?"right":"left";E.current=he,D.current=G.clientX}}))})})})})})})});kn.displayName=es;var Id="MenuGroup",Ta=d.forwardRef((s,t)=>{const{__scopeMenu:r,...a}=s;return e.jsx(Us.div,{role:"group",...a,ref:t})});Ta.displayName=Id;var Pd="MenuLabel",Cn=d.forwardRef((s,t)=>{const{__scopeMenu:r,...a}=s;return e.jsx(Us.div,{...a,ref:t})});Cn.displayName=Pd;var wr="MenuItem",si="menu.itemSelect",Ur=d.forwardRef((s,t)=>{const{disabled:r=!1,onSelect:a,...n}=s,i=d.useRef(null),o=Xt(wr,s.__scopeMenu),l=Sa(wr,s.__scopeMenu),c=et(t,i),u=d.useRef(!1),x=()=>{const m=i.current;if(!r&&m){const p=new CustomEvent(si,{bubbles:!0,cancelable:!0});m.addEventListener(si,g=>a?.(g),{once:!0}),Tl(m,p),p.defaultPrevented?u.current=!1:o.onClose()}};return e.jsx(Sn,{...n,ref:c,disabled:r,onClick:ce(s.onClick,x),onPointerDown:m=>{s.onPointerDown?.(m),u.current=!0},onPointerUp:ce(s.onPointerUp,m=>{u.current||m.currentTarget?.click()}),onKeyDown:ce(s.onKeyDown,m=>{const p=l.searchRef.current!=="";r||p&&m.key===" "||ca.includes(m.key)&&(m.currentTarget.click(),m.preventDefault())})})});Ur.displayName=wr;var Sn=d.forwardRef((s,t)=>{const{__scopeMenu:r,disabled:a=!1,textValue:n,...i}=s,o=Sa(wr,r),l=wn(r),c=d.useRef(null),u=et(t,c),[x,m]=d.useState(!1),[p,g]=d.useState("");return d.useEffect(()=>{const b=c.current;b&&g((b.textContent??"").trim())},[i.children]),e.jsx(Ot.ItemSlot,{scope:r,disabled:a,textValue:n??p,children:e.jsx(bl,{asChild:!0,...l,focusable:!a,children:e.jsx(Us.div,{role:"menuitem","data-highlighted":x?"":void 0,"aria-disabled":a||void 0,"data-disabled":a?"":void 0,...i,ref:u,onPointerMove:ce(s.onPointerMove,$t(b=>{a?o.onItemLeave(b):(o.onItemEnter(b),b.defaultPrevented||b.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:ce(s.onPointerLeave,$t(b=>o.onItemLeave(b))),onFocus:ce(s.onFocus,()=>m(!0)),onBlur:ce(s.onBlur,()=>m(!1))})})})}),Rd="MenuCheckboxItem",_n=d.forwardRef((s,t)=>{const{checked:r=!1,onCheckedChange:a,...n}=s;return e.jsx(Rn,{scope:s.__scopeMenu,checked:r,children:e.jsx(Ur,{role:"menuitemcheckbox","aria-checked":vr(r)?"mixed":r,...n,ref:t,"data-state":Ia(r),onSelect:ce(n.onSelect,()=>a?.(vr(r)?!0:!r),{checkForDefaultPrevented:!1})})})});_n.displayName=Rd;var Tn="MenuRadioGroup",[Ed,Md]=st(Tn,{value:void 0,onValueChange:()=>{}}),Dn=d.forwardRef((s,t)=>{const{value:r,onValueChange:a,...n}=s,i=Zi(a);return e.jsx(Ed,{scope:s.__scopeMenu,value:r,onValueChange:i,children:e.jsx(Ta,{...n,ref:t})})});Dn.displayName=Tn;var In="MenuRadioItem",Pn=d.forwardRef((s,t)=>{const{value:r,...a}=s,n=Md(In,s.__scopeMenu),i=r===n.value;return e.jsx(Rn,{scope:s.__scopeMenu,checked:i,children:e.jsx(Ur,{role:"menuitemradio","aria-checked":i,...a,ref:t,"data-state":Ia(i),onSelect:ce(a.onSelect,()=>n.onValueChange?.(r),{checkForDefaultPrevented:!1})})})});Pn.displayName=In;var Da="MenuItemIndicator",[Rn,Ld]=st(Da,{checked:!1}),En=d.forwardRef((s,t)=>{const{__scopeMenu:r,forceMount:a,...n}=s,i=Ld(Da,r);return e.jsx(Sr,{present:a||vr(i.checked)||i.checked===!0,children:e.jsx(Us.span,{...n,ref:t,"data-state":Ia(i.checked)})})});En.displayName=Da;var Ad="MenuSeparator",Mn=d.forwardRef((s,t)=>{const{__scopeMenu:r,...a}=s;return e.jsx(Us.div,{role:"separator","aria-orientation":"horizontal",...a,ref:t})});Mn.displayName=Ad;var qd="MenuArrow",Ln=d.forwardRef((s,t)=>{const{__scopeMenu:r,...a}=s,n=Wr(r);return e.jsx(Pl,{...n,...a,ref:t})});Ln.displayName=qd;var Od="MenuSub",[Ch,An]=st(Od),Pt="MenuSubTrigger",qn=d.forwardRef((s,t)=>{const r=tt(Pt,s.__scopeMenu),a=Xt(Pt,s.__scopeMenu),n=An(Pt,s.__scopeMenu),i=Sa(Pt,s.__scopeMenu),o=d.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:c}=i,u={__scopeMenu:s.__scopeMenu},x=d.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return d.useEffect(()=>x,[x]),d.useEffect(()=>{const m=l.current;return()=>{window.clearTimeout(m),c(null)}},[l,c]),e.jsx(ka,{asChild:!0,...u,children:e.jsx(Sn,{id:n.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":n.contentId,"data-state":Fn(r.open),...s,ref:Ki(t,n.onTriggerChange),onClick:m=>{s.onClick?.(m),!(s.disabled||m.defaultPrevented)&&(m.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:ce(s.onPointerMove,$t(m=>{i.onItemEnter(m),!m.defaultPrevented&&!s.disabled&&!r.open&&!o.current&&(i.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{r.onOpenChange(!0),x()},100))})),onPointerLeave:ce(s.onPointerLeave,$t(m=>{x();const p=r.content?.getBoundingClientRect();if(p){const g=r.content?.dataset.side,b=g==="right",h=b?-5:5,f=p[b?"left":"right"],y=p[b?"right":"left"];i.onPointerGraceIntentChange({area:[{x:m.clientX+h,y:m.clientY},{x:f,y:p.top},{x:y,y:p.top},{x:y,y:p.bottom},{x:f,y:p.bottom}],side:g}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>i.onPointerGraceIntentChange(null),300)}else{if(i.onTriggerLeave(m),m.defaultPrevented)return;i.onPointerGraceIntentChange(null)}})),onKeyDown:ce(s.onKeyDown,m=>{const p=i.searchRef.current!=="";s.disabled||p&&m.key===" "||yd[a.dir].includes(m.key)&&(r.onOpenChange(!0),r.content?.focus(),m.preventDefault())})})})});qn.displayName=Pt;var On="MenuSubContent",$n=d.forwardRef((s,t)=>{const r=Nn(es,s.__scopeMenu),{forceMount:a=r.forceMount,...n}=s,i=tt(es,s.__scopeMenu),o=Xt(es,s.__scopeMenu),l=An(On,s.__scopeMenu),c=d.useRef(null),u=et(t,c);return e.jsx(Ot.Provider,{scope:s.__scopeMenu,children:e.jsx(Sr,{present:a||i.open,children:e.jsx(Ot.Slot,{scope:s.__scopeMenu,children:e.jsx(_a,{id:l.contentId,"aria-labelledby":l.triggerId,...n,ref:u,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:x=>{o.isUsingKeyboardRef.current&&c.current?.focus(),x.preventDefault()},onCloseAutoFocus:x=>x.preventDefault(),onFocusOutside:ce(s.onFocusOutside,x=>{x.target!==l.trigger&&i.onOpenChange(!1)}),onEscapeKeyDown:ce(s.onEscapeKeyDown,x=>{o.onClose(),x.preventDefault()}),onKeyDown:ce(s.onKeyDown,x=>{const m=x.currentTarget.contains(x.target),p=bd[o.dir].includes(x.key);m&&p&&(i.onOpenChange(!1),l.trigger?.focus(),x.preventDefault())})})})})})});$n.displayName=On;function Fn(s){return s?"open":"closed"}function vr(s){return s==="indeterminate"}function Ia(s){return vr(s)?"indeterminate":s?"checked":"unchecked"}function $d(s){const t=document.activeElement;for(const r of s)if(r===t||(r.focus(),document.activeElement!==t))return}function Fd(s,t){return s.map((r,a)=>s[(t+a)%s.length])}function Wd(s,t,r){const n=t.length>1&&Array.from(t).every(u=>u===t[0])?t[0]:t,i=r?s.indexOf(r):-1;let o=Fd(s,Math.max(i,0));n.length===1&&(o=o.filter(u=>u!==r));const c=o.find(u=>u.toLowerCase().startsWith(n.toLowerCase()));return c!==r?c:void 0}function Ud(s,t){const{x:r,y:a}=s;let n=!1;for(let i=0,o=t.length-1;i<t.length;o=i++){const l=t[i],c=t[o],u=l.x,x=l.y,m=c.x,p=c.y;x>a!=p>a&&r<(m-u)*(a-x)/(p-x)+u&&(n=!n)}return n}function Bd(s,t){if(!t)return!1;const r={x:s.clientX,y:s.clientY};return Ud(r,t)}function $t(s){return t=>t.pointerType==="mouse"?s(t):void 0}var Gd=vn,Kd=ka,Zd=zn,Qd=kn,Vd=Ta,Hd=Cn,Jd=Ur,Xd=_n,Yd=Dn,eu=Pn,su=En,tu=Mn,ru=Ln,au=qn,iu=$n,Br="DropdownMenu",[nu,Sh]=ga(Br,[bn]),Le=bn(),[ou,Wn]=nu(Br),Un=s=>{const{__scopeDropdownMenu:t,children:r,dir:a,open:n,defaultOpen:i,onOpenChange:o,modal:l=!0}=s,c=Le(t),u=d.useRef(null),[x,m]=Wi({prop:n,defaultProp:i??!1,onChange:o,caller:Br});return e.jsx(ou,{scope:t,triggerId:Va(),triggerRef:u,contentId:Va(),open:x,onOpenChange:m,onOpenToggle:d.useCallback(()=>m(p=>!p),[m]),modal:l,children:e.jsx(Gd,{...c,open:x,onOpenChange:m,dir:a,modal:l,children:r})})};Un.displayName=Br;var Bn="DropdownMenuTrigger",Gn=d.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,disabled:a=!1,...n}=s,i=Wn(Bn,r),o=Le(r);return e.jsx(Kd,{asChild:!0,...o,children:e.jsx(Us.button,{type:"button",id:i.triggerId,"aria-haspopup":"menu","aria-expanded":i.open,"aria-controls":i.open?i.contentId:void 0,"data-state":i.open?"open":"closed","data-disabled":a?"":void 0,disabled:a,...n,ref:Ki(t,i.triggerRef),onPointerDown:ce(s.onPointerDown,l=>{!a&&l.button===0&&l.ctrlKey===!1&&(i.onOpenToggle(),i.open||l.preventDefault())}),onKeyDown:ce(s.onKeyDown,l=>{a||(["Enter"," "].includes(l.key)&&i.onOpenToggle(),l.key==="ArrowDown"&&i.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(l.key)&&l.preventDefault())})})})});Gn.displayName=Bn;var lu="DropdownMenuPortal",Kn=s=>{const{__scopeDropdownMenu:t,...r}=s,a=Le(t);return e.jsx(Zd,{...a,...r})};Kn.displayName=lu;var Zn="DropdownMenuContent",Qn=d.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,...a}=s,n=Wn(Zn,r),i=Le(r),o=d.useRef(!1);return e.jsx(Qd,{id:n.contentId,"aria-labelledby":n.triggerId,...i,...a,ref:t,onCloseAutoFocus:ce(s.onCloseAutoFocus,l=>{o.current||n.triggerRef.current?.focus(),o.current=!1,l.preventDefault()}),onInteractOutside:ce(s.onInteractOutside,l=>{const c=l.detail.originalEvent,u=c.button===0&&c.ctrlKey===!0,x=c.button===2||u;(!n.modal||x)&&(o.current=!0)}),style:{...s.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Qn.displayName=Zn;var cu="DropdownMenuGroup",du=d.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,...a}=s,n=Le(r);return e.jsx(Vd,{...n,...a,ref:t})});du.displayName=cu;var uu="DropdownMenuLabel",Vn=d.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,...a}=s,n=Le(r);return e.jsx(Hd,{...n,...a,ref:t})});Vn.displayName=uu;var mu="DropdownMenuItem",Hn=d.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,...a}=s,n=Le(r);return e.jsx(Jd,{...n,...a,ref:t})});Hn.displayName=mu;var xu="DropdownMenuCheckboxItem",Jn=d.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,...a}=s,n=Le(r);return e.jsx(Xd,{...n,...a,ref:t})});Jn.displayName=xu;var pu="DropdownMenuRadioGroup",hu=d.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,...a}=s,n=Le(r);return e.jsx(Yd,{...n,...a,ref:t})});hu.displayName=pu;var ju="DropdownMenuRadioItem",Xn=d.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,...a}=s,n=Le(r);return e.jsx(eu,{...n,...a,ref:t})});Xn.displayName=ju;var gu="DropdownMenuItemIndicator",Yn=d.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,...a}=s,n=Le(r);return e.jsx(su,{...n,...a,ref:t})});Yn.displayName=gu;var fu="DropdownMenuSeparator",eo=d.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,...a}=s,n=Le(r);return e.jsx(tu,{...n,...a,ref:t})});eo.displayName=fu;var yu="DropdownMenuArrow",bu=d.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,...a}=s,n=Le(r);return e.jsx(ru,{...n,...a,ref:t})});bu.displayName=yu;var wu="DropdownMenuSubTrigger",so=d.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,...a}=s,n=Le(r);return e.jsx(au,{...n,...a,ref:t})});so.displayName=wu;var vu="DropdownMenuSubContent",to=d.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,...a}=s,n=Le(r);return e.jsx(iu,{...n,...a,ref:t,style:{...s.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});to.displayName=vu;var Nu=Un,zu=Gn,ku=Kn,ro=Qn,ao=Vn,io=Hn,no=Jn,oo=Xn,lo=Yn,co=eo,uo=so,mo=to;const pt=Nu,ht=zu,Cu=d.forwardRef(({className:s,inset:t,children:r,...a},n)=>e.jsxs(uo,{ref:n,className:K("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",s),...a,children:[r,e.jsx(Zs,{className:"ml-auto"})]}));Cu.displayName=uo.displayName;const Su=d.forwardRef(({className:s,...t},r)=>e.jsx(mo,{ref:r,className:K("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",s),...t}));Su.displayName=mo.displayName;const Js=d.forwardRef(({className:s,sideOffset:t=4,...r},a)=>e.jsx(ku,{children:e.jsx(ro,{ref:a,sideOffset:t,className:K("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",s),...r})}));Js.displayName=ro.displayName;const ne=d.forwardRef(({className:s,inset:t,...r},a)=>e.jsx(io,{ref:a,className:K("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",t&&"pl-8",s),...r}));ne.displayName=io.displayName;const _u=d.forwardRef(({className:s,children:t,checked:r,...a},n)=>e.jsxs(no,{ref:n,className:K("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:r,...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(lo,{children:e.jsx(Re,{className:"h-4 w-4"})})}),t]}));_u.displayName=no.displayName;const Tu=d.forwardRef(({className:s,children:t,...r},a)=>e.jsxs(oo,{ref:a,className:K("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(lo,{children:e.jsx(sn,{className:"h-2 w-2 fill-current"})})}),t]}));Tu.displayName=oo.displayName;const xo=d.forwardRef(({className:s,inset:t,...r},a)=>e.jsx(ao,{ref:a,className:K("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",s),...r}));xo.displayName=ao.displayName;const ss=d.forwardRef(({className:s,...t},r)=>e.jsx(co,{ref:r,className:K("-mx-1 my-1 h-px bg-muted",s),...t}));ss.displayName=co.displayName;const Du=()=>{const s=Q(),t=fa(),r=()=>{const o=`${t.pathname}${t.search}`;sessionStorage.setItem("returnUrl",o)};return{navigateWithReturn:o=>{r(),s(o)},goBack:o=>{const l=sessionStorage.getItem("returnUrl");l?(sessionStorage.removeItem("returnUrl"),s(l)):s(o||-1)},saveReturnUrl:r,navigateToWizard:(o,l)=>{l&&sessionStorage.setItem("wizardContext",JSON.stringify(l)),r(),s(o)},currentUrl:`${t.pathname}${t.search}`}},da=s=>{const{mutate:t,isLoading:r}=ya();return{togglePublish:async(n,i,o,l)=>{t({resource:s,id:n,values:{is_published:!i}},{onSuccess:()=>{F.success(i?`${o} został ukryty`:`${o} został opublikowany`),l?.()},onError:c=>{F.error("Nie udało się zmienić statusu publikacji"),console.error("Publish toggle error:",c)}})},isToggling:r}},ti=s=>{const{mutate:t}=ya(),r=Xi(),[a,n]=d.useState(!1);return{updatePosition:d.useCallback(async(o,l)=>{if(!a){n(!0);try{await new Promise((c,u)=>{t({resource:s,id:o,values:{position:l},mutationMode:"optimistic"},{onSuccess:()=>{console.log(`Updated position for ${s} ${o} to ${l}`),c()},onError:x=>u(x)})}),setTimeout(()=>{r({resource:s,invalidates:["list"]})},1e3)}catch(c){console.error("Position update error:",c),F.error("Nie udało się zaktualizować pozycji"),await r({resource:s,invalidates:["list"]})}finally{n(!1)}}},[s,t,r,a]),isUpdating:a}},Iu=s=>{const{data:t,isLoading:r}=ze({resource:"courses",id:s,queryOptions:{enabled:!!s}}),{data:a,isLoading:n,refetch:i}=je({resource:"topics",filters:[{field:"course_id",operator:"eq",value:s}],sorters:[{field:"position",order:"asc"}],meta:{select:"*, activities(count)"},queryOptions:{enabled:!!s}}),{data:o,refetch:l}=je({resource:"activities",filters:[{field:"topic_id",operator:"in",value:a?.data?.map(p=>p.id)||[]}],sorters:[{field:"position",order:"asc"}],meta:{select:"*, questions(count)"},queryOptions:{enabled:!!a?.data?.length}}),{data:c}=je({resource:"course_access",filters:[{field:"course_id",operator:"eq",value:s}],queryOptions:{enabled:!!s}}),u=r||n,x={topicsCount:a?.total||0,activitiesCount:o?.total||0,accessCount:c?.total||0},m=p=>o?.data?.filter(g=>g.topic_id===p)||[];return{course:t?.data,topics:a?.data||[],activities:o?.data||[],stats:x,isLoading:u,refetchTopics:i,refetchActivities:l,getActivitiesForTopic:m}},Pu=()=>{const{create:s,edit:t,show:r}=Se(),{mutate:a}=ut(),{togglePublish:n}=da("courses"),{tableQuery:{data:i,isLoading:o,isError:l,refetch:c},current:u,setCurrent:x,pageSize:m,setFilters:p}=_r({sorters:{initial:[{field:"created_at",order:"desc"}]},meta:{select:"*, topics(count), course_access(count)"}}),g=qr({isLoading:o,isError:l});if(g)return g;const b=(f,y)=>{confirm(`Czy na pewno chcesz usunąć kurs "${y}"?`)&&a({resource:"courses",id:f},{onSuccess:()=>{F.success("Kurs został usunięty"),c()}})},h=(f,y,j)=>{y&&j&&sessionStorage.setItem("wizardContext",JSON.stringify({courseId:y,courseTitle:j})),window.location.href=f};return e.jsxs(M,{children:[e.jsxs(R,{children:[e.jsx(J,{title:"Kursy",description:"Zarządzaj kursami w systemie"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(fs,{children:e.jsxs(ys,{children:[e.jsx(bs,{asChild:!0,children:e.jsxs(w,{variant:"outline",onClick:()=>h("/course-structure/step1"),children:[e.jsx(Gs,{className:"w-4 h-4 mr-2"}),e.jsx(Os,{className:"w-3 h-3"})]})}),e.jsx(ds,{children:e.jsx("p",{children:"Stwórz kurs z pomocą AI"})})]})}),e.jsxs(w,{onClick:()=>s("courses"),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Dodaj kurs"]})]})]}),e.jsx(R,{children:e.jsx($,{placeholder:"Szukaj kursów...",className:"max-w-sm",onChange:f=>{p([{field:"title",operator:"contains",value:f.target.value}])}})}),e.jsx(te,{children:i?.data?.map(f=>e.jsxs(S,{className:`relative cursor-pointer transition-all duration-200 ${f.is_published?"hover:shadow-lg":"opacity-80 hover:opacity-90 "}`,onClick:y=>{y.target.closest('[role="menu"]')||r("courses",f.id)},children:[e.jsx(A,{children:e.jsxs(R,{children:[e.jsxs(L,{className:"flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"flex-shrink-0",children:f.icon_emoji?e.jsx("span",{className:"text-2xl",children:f.icon_emoji}):e.jsx(ge,{className:"w-5 h-5"})}),e.jsx(fs,{delayDuration:200,children:e.jsxs(ys,{children:[e.jsx(bs,{asChild:!0,children:e.jsx("span",{className:"truncate",children:f.title})}),f.title.length>30&&e.jsx(ds,{children:e.jsx("p",{className:"max-w-xs",children:f.title})})]})})]}),e.jsxs(pt,{children:[e.jsx(ht,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"sm",onClick:y=>y.stopPropagation(),children:e.jsx(Kt,{className:"h-4 w-4"})})}),e.jsxs(Js,{align:"end",children:[e.jsxs(ne,{onClick:()=>r("courses",f.id),children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"}),"Podgląd"]}),e.jsxs(ne,{onClick:()=>t("courses",f.id),children:[e.jsx(ms,{className:"mr-2 h-4 w-4"}),"Edytuj"]}),e.jsx(ss,{}),e.jsx(ne,{onClick:()=>n(f.id,f.is_published,f.title,c),children:f.is_published?e.jsxs(e.Fragment,{children:[e.jsx(Er,{className:"mr-2 h-4 w-4"}),"Ukryj kurs"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"}),"Opublikuj kurs"]})}),e.jsx(ss,{}),e.jsxs(ne,{onClick:()=>h("/educational-material/step1",f.id,f.title),className:"text-purple-600 focus:text-purple-600",children:[e.jsx(Os,{className:"mr-2 h-4 w-4"}),"Generuj materiał z AI"]}),e.jsxs(ne,{onClick:()=>h("/quiz-wizard/step1",f.id,f.title),className:"text-blue-600 focus:text-blue-600",children:[e.jsx(Qs,{className:"mr-2 h-4 w-4"}),"Generuj quiz z AI"]}),e.jsx(ss,{}),e.jsxs(ne,{onClick:()=>b(f.id,f.title),className:"text-red-600 focus:text-red-600",children:[e.jsx($s,{className:"mr-2 h-4 w-4"}),"Usuń"]})]})]})]})}),e.jsxs(_,{children:[f.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:f.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-2",children:e.jsx(H,{variant:f.is_published?"default":"secondary",className:f.is_published?"bg-green-600":"",children:f.is_published?"Opublikowany":"Szkic"})}),e.jsxs("div",{className:"flex gap-3 text-sm text-muted-foreground",children:[e.jsx(fs,{children:e.jsxs(ys,{children:[e.jsx(bs,{asChild:!0,children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ee,{className:"w-3 h-3"}),f.topics?.[0]?.count||0]})}),e.jsx(ds,{children:e.jsx("p",{children:"Liczba tematów"})})]})}),e.jsx(fs,{children:e.jsxs(ys,{children:[e.jsx(bs,{asChild:!0,children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ie,{className:"w-3 h-3"}),f.course_access?.[0]?.count||0]})}),e.jsx(ds,{children:e.jsx("p",{children:"Liczba uczestników"})})]})})]})]}),f.created_at&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs text-muted-foreground",children:[e.jsx(is,{className:"w-3 h-3"}),e.jsxs("span",{children:["Utworzono: ",new Date(f.created_at).toLocaleDateString("pl-PL")]})]})]})]},f.id))}),i?.data?.length===0&&e.jsx(S,{className:"border-dashed border-2 bg-gradient-to-r from-indigo-50/50 to-purple-50/50 dark:from-indigo-950/20 dark:to-purple-950/20",children:e.jsxs(_,{className:"text-center py-12",children:[e.jsx(Gs,{className:"w-12 h-12 mx-auto mb-4 text-indigo-600"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Brak kursów"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Rozpocznij od stworzenia pierwszego kursu"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs(w,{variant:"outline",onClick:()=>s("courses"),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Dodaj ręcznie"]}),e.jsxs(w,{onClick:()=>h("/course-structure/step1"),className:"bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700",children:[e.jsx(Os,{className:"w-4 h-4 mr-2"}),"Wygeneruj z AI"]})]})]})}),e.jsx(Fr,{current:u,pageSize:m,total:i?.total||0,setCurrent:x,itemName:"kursów"}),i?.data&&i.data.length>0&&e.jsx("div",{className:"fixed bottom-6 right-6",children:e.jsx(fs,{children:e.jsxs(ys,{children:[e.jsx(bs,{asChild:!0,children:e.jsxs(w,{size:"lg",className:"rounded-full shadow-lg bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700",onClick:()=>h("/course-structure/step1"),children:[e.jsx(Gs,{className:"w-5 h-5 mr-2"}),e.jsx(Os,{className:"w-4 h-4"})]})}),e.jsx(ds,{side:"left",children:e.jsx("p",{children:"Stwórz nowy kurs z pomocą AI"})})]})})})]})},ns=({children:s,onSubmit:t,className:r="",...a})=>{const n="space-y-6",i=r?`${n} ${r}`:n;return e.jsx("form",{onSubmit:t,className:i,...a,children:s})},Z=({children:s,label:t,htmlFor:r,error:a,required:n=!1,className:i="",hint:o})=>{const l="space-y-2",c=i?`${l} ${i}`:l,u=()=>t?typeof t=="string"?e.jsxs(V,{htmlFor:r,children:[t,n&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}):e.jsxs(V,{htmlFor:r,className:"flex items-center",children:[t,n&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}):null,x=d.isValidElement(s)?d.cloneElement(s,{className:`${s.props.className||""} ${a?"border-red-500 ring-1 ring-red-500":""}`.trim()}):s;return e.jsxs("div",{className:c,children:[u(),x,o&&!a&&e.jsx("p",{className:"text-sm text-muted-foreground",children:o}),a&&e.jsx("p",{className:"text-sm text-red-500",children:a})]})},os=({children:s,className:t=""})=>{const r="flex justify-end items-center gap-4 pt-6 border-t",a=t?`${r} ${t}`:r;return e.jsx("div",{className:a,children:s})},Ru=["📚","🎓","💡","🚀","⭐","🏆","🎯","📖","✏️","🧮"],Eu=()=>{const{list:s}=Se(),{data:t}=Oe(),[r,a]=d.useState(!1),{refineCore:{onFinish:n},register:i,handleSubmit:o,setValue:l,watch:c,formState:{errors:u,isSubmitting:x}}=Ns({defaultValues:{title:"",description:"",vendor_id:t?.vendor_id||0,is_published:!1,icon_emoji:"📚"}}),m=c("icon_emoji");return e.jsxs(M,{children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>s("courses"),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsx(R,{children:e.jsx(J,{title:"Dodaj kurs",description:"Utwórz nowy kurs w systemie"})}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Informacje o kursie"})}),e.jsx(_,{children:e.jsxs(ns,{onSubmit:o(n),children:[e.jsxs(te,{variant:"1-2-2",children:[e.jsx(Z,{label:"Tytuł kursu",htmlFor:"title",error:u.title?.message?.toString(),required:!0,children:e.jsx($,{id:"title",placeholder:"np. Podstawy programowania",...i("title",{required:"Tytuł kursu jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),e.jsx(Z,{label:"Ikona kursu",htmlFor:"icon_emoji",children:e.jsxs("div",{className:"relative",children:[e.jsxs(w,{type:"button",variant:"outline",className:"w-full justify-start",onClick:()=>a(!r),children:[e.jsx("span",{className:"text-2xl mr-2",children:m||"📚"}),"Wybierz ikonę"]}),r&&e.jsx("div",{className:"absolute top-full mt-2 p-2 bg-white border rounded-lg shadow-lg z-10",children:e.jsx("div",{className:"grid grid-cols-5 gap-2",children:Ru.map(p=>e.jsx("button",{type:"button",className:"p-2 hover:bg-gray-100 rounded text-2xl",onClick:()=>{l("icon_emoji",p),a(!1)},children:p},p))})})]})})]}),e.jsx(Z,{label:"Opis kursu",htmlFor:"description",error:u.description?.message?.toString(),children:e.jsx(as,{id:"description",placeholder:"Opisz czego uczniowie nauczą się na tym kursie...",rows:4,...i("description")})}),e.jsx(Z,{label:"Status publikacji",children:e.jsxs(R,{variant:"start",children:[e.jsx(xs,{checked:c("is_published")||!1,onCheckedChange:p=>l("is_published",p)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Opublikuj kurs od razu (możesz to zmienić później)"})]})}),e.jsxs(os,{children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>s("courses"),children:"Anuluj"}),e.jsx(w,{type:"submit",disabled:x,children:x?"Tworzenie...":"Utwórz kurs"})]})]})})]})]})},Mu=["📚","🎓","💡","🚀","⭐","🏆","🎯","📖","✏️","🧮"],Lu=()=>{const{list:s}=Se(),{id:t}=Me(),[r,a]=d.useState(!1),{data:n,isLoading:i}=ze({resource:"courses",id:t,liveMode:"off"}),{refineCore:{onFinish:o},register:l,handleSubmit:c,setValue:u,watch:x,formState:{errors:m,isSubmitting:p}}=Ns({refineCoreProps:{resource:"courses",id:t,liveMode:"off"}}),g=x("icon_emoji");return i?e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsxs(M,{children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>s("courses"),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsx(R,{children:e.jsx(J,{title:"Edytuj kurs",description:`Edycja kursu: ${n?.data?.title}`})}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Informacje o kursie"})}),e.jsx(_,{children:e.jsxs(ns,{onSubmit:c(o),children:[e.jsxs(te,{variant:"1-2-2",children:[e.jsx(Z,{label:"Tytuł kursu",htmlFor:"title",error:m.title?.message,required:!0,children:e.jsx($,{id:"title",placeholder:"np. Podstawy programowania",...l("title",{required:"Tytuł kursu jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),e.jsx(Z,{label:"Ikona kursu",htmlFor:"icon_emoji",children:e.jsxs("div",{className:"relative",children:[e.jsxs(w,{type:"button",variant:"outline",className:"w-full justify-start",onClick:()=>a(!r),children:[e.jsx("span",{className:"text-2xl mr-2",children:g||"📚"}),"Wybierz ikonę"]}),r&&e.jsx("div",{className:"absolute top-full mt-2 p-2 bg-white border rounded-lg shadow-lg z-10",children:e.jsx("div",{className:"grid grid-cols-5 gap-2",children:Mu.map(b=>e.jsx("button",{type:"button",className:"p-2 hover:bg-gray-100 rounded text-2xl",onClick:()=>{u("icon_emoji",b),a(!1)},children:b},b))})})]})})]}),e.jsx(Z,{label:"Opis kursu",htmlFor:"description",error:m.description?.message,children:e.jsx(as,{id:"description",placeholder:"Opisz czego uczniowie nauczą się na tym kursie...",rows:4,...l("description")})}),e.jsx(Z,{label:"Status publikacji",children:e.jsxs(R,{variant:"start",children:[e.jsx(xs,{checked:x("is_published")||!1,onCheckedChange:b=>u("is_published",b)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Kurs jest opublikowany i widoczny dla uczniów"})]})}),e.jsxs(os,{children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>s("courses"),children:"Anuluj"}),e.jsx(w,{type:"submit",disabled:p,children:p?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},Au=({topic:s,isExpanded:t,onToggle:r,onDelete:a,onEdit:n,onTogglePublish:i,onNavigateToWizard:o,courseId:l,courseTitle:c,children:u,activitiesCount:x,dragHandleProps:m})=>{const p=Q(),g=h=>{const f=window.location.pathname+window.location.search;sessionStorage.setItem("returnUrl",f),p(h)},b=(h,f)=>{o&&o(h,{courseId:l,courseTitle:c,topicId:s.id,topicTitle:s.title,...f})};return e.jsxs("div",{className:`border-2 rounded-lg overflow-hidden group ${t?"shadow-lg border-primary":"border-border hover:border-primary/50"}`,children:[e.jsx("div",{className:`p-4 ${t?"bg-primary text-primary-foreground":"bg-background hover:bg-muted"}`,children:e.jsxs(R,{children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("button",{onClick:r,className:`p-1 rounded ${t?"text-primary-foreground hover:bg-primary-foreground/20":"hover:bg-muted"}`,"aria-label":t?"Zwiń temat":"Rozwiń temat",children:t?e.jsx(ba,{className:"w-5 h-5"}):e.jsx(Zs,{className:"w-5 h-5"})}),e.jsx("div",{className:"cursor-move",...m,children:e.jsx(tn,{className:`w-4 h-4 ${t?"text-primary-foreground/70":"text-muted-foreground"}`})}),e.jsxs("div",{className:"flex-1 cursor-pointer group",onClick:r,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h4",{className:`font-semibold text-base ${t?"text-primary-foreground":"group-hover:text-primary"}`,children:["Temat ",s.position,": ",s.title]}),e.jsx(H,{variant:s.is_published?t?"secondary":"default":"outline",className:t?"bg-primary-foreground/20 text-primary-foreground border-primary-foreground/30":"",children:s.is_published?"Opublikowany":"Szkic"})]}),e.jsx("div",{className:"flex items-center gap-4 mt-1",children:e.jsxs("span",{className:`text-sm flex items-center gap-1 ${t?"text-primary-foreground/80":"text-muted-foreground"}`,children:[e.jsx(Ee,{className:"w-3 h-3"}),x," ",x===1?"aktywność":"aktywności"]})})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(pt,{children:[e.jsx(ht,{asChild:!0,children:e.jsx(w,{size:"sm",variant:t?"secondary":"ghost",title:"Dodaj aktywność",className:`h-8 w-8 p-0 ${t?"bg-primary-foreground/20 hover:bg-primary-foreground/30 text-primary-foreground":""}`,children:e.jsx(Ne,{className:"h-4 w-4"})})}),e.jsxs(Js,{align:"end",children:[e.jsx(xo,{children:"Dodaj treść"}),e.jsxs(ne,{onClick:()=>g(`/activities/create?topic_id=${s.id}`),children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Dodaj ręcznie"]}),e.jsx(ss,{}),e.jsxs(ne,{onClick:()=>b("/educational-material/step1"),className:"text-purple-600 focus:text-purple-600",children:[e.jsx(Os,{className:"mr-2 h-4 w-4"}),"Generuj materiał z AI"]}),e.jsxs(ne,{onClick:()=>b("/quiz-wizard/step1"),className:"text-blue-600 focus:text-blue-600",children:[e.jsx(Qs,{className:"mr-2 h-4 w-4"}),"Generuj quiz z AI"]})]})]}),e.jsxs(pt,{children:[e.jsx(ht,{asChild:!0,children:e.jsx(w,{variant:t?"secondary":"ghost",size:"sm",className:`h-8 w-8 p-0 ${t?"bg-primary-foreground/20 hover:bg-primary-foreground/30 text-primary-foreground":""}`,children:e.jsx(Kt,{className:"h-4 w-4"})})}),e.jsxs(Js,{align:"end",children:[e.jsxs(ne,{onClick:()=>n("topics",s.id),children:[e.jsx(ms,{className:"mr-2 h-4 w-4"}),"Edytuj temat"]}),e.jsx(ss,{}),e.jsx(ne,{onClick:()=>i(s.id,s.is_published,s.title),children:s.is_published?e.jsxs(e.Fragment,{children:[e.jsx(Er,{className:"mr-2 h-4 w-4"}),"Ukryj temat"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"}),"Opublikuj temat"]})}),e.jsx(ss,{}),e.jsxs(ne,{onClick:()=>a(s.id,s.title),className:"text-red-600 focus:text-red-600",children:[e.jsx($s,{className:"mr-2 h-4 w-4"}),"Usuń temat"]})]})]})]})]})}),t&&e.jsx("div",{className:"p-4 bg-muted/20 border-t-2 border-primary",children:e.jsx("div",{className:"space-y-2",children:u})})]})},qu=({activity:s,topicPosition:t,onDelete:r,onEdit:a,onTogglePublish:n,dragHandleProps:i})=>{const o=Q(),l=()=>s.type==="quiz"?e.jsx("div",{className:"p-2 bg-blue-600 rounded-lg",children:e.jsx(rs,{className:"w-5 h-5 text-white"})}):e.jsx("div",{className:"p-2 bg-green-600 rounded-lg",children:e.jsx(Ee,{className:"w-5 h-5 text-white"})}),c=()=>s.type==="quiz"?"Quiz":"Materiał";return e.jsxs("div",{className:"group flex items-center gap-4 p-4 bg-white border-2 rounded-lg hover:border-primary/50 transition-all duration-200",children:[e.jsx("div",{className:"cursor-move opacity-0 group-hover:opacity-100 transition-opacity",...i,children:e.jsx(tn,{className:"w-4 h-4 text-muted-foreground"})}),l(),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("h5",{className:"font-semibold text-sm text-foreground",children:[t,".",s.position," ",s.title]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{variant:s.type==="quiz"?"default":"secondary",className:"text-xs font-medium",children:c()}),s.type==="quiz"&&s._count?.questions!==void 0&&e.jsxs(H,{variant:"outline",className:"text-xs font-medium border-2",children:[e.jsx(Ks,{className:"w-3 h-3 mr-1"}),s._count.questions," ",s._count.questions===1?"pytanie":"pytań"]}),e.jsx(H,{variant:s.is_published?"default":"outline",className:`text-xs font-medium ${s.is_published?"bg-green-600 hover:bg-green-700":"border-2"}`,children:s.is_published?e.jsxs(e.Fragment,{children:[e.jsx(Mr,{className:"w-3 h-3 mr-1"}),"Opublikowany"]}):"Szkic"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:[s.duration_min&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(is,{className:"w-3 h-3"}),e.jsxs("span",{children:[s.duration_min," min"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ie,{className:"w-3 h-3"}),e.jsx("span",{children:"0 ukończeń"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[s.type==="quiz"&&e.jsx(w,{size:"sm",variant:"ghost",onClick:()=>o(`/questions/manage/${s.id}`),title:"Zarządzaj pytaniami",className:"h-8 w-8 p-0",children:e.jsx(Ks,{className:"h-4 w-4"})}),e.jsx(w,{size:"sm",variant:"ghost",onClick:()=>o(`/activities/show/${s.id}`),title:"Podgląd",className:"h-8 w-8 p-0",children:e.jsx(Ce,{className:"h-4 w-4"})}),e.jsxs(pt,{children:[e.jsx(ht,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(Kt,{className:"h-4 w-4"})})}),e.jsxs(Js,{align:"end",children:[e.jsxs(ne,{onClick:()=>o(`/activities/show/${s.id}`),children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"}),"Podgląd"]}),e.jsxs(ne,{onClick:()=>a("activities",s.id),children:[e.jsx(ms,{className:"mr-2 h-4 w-4"}),"Edytuj"]}),e.jsx(ss,{}),e.jsx(ne,{onClick:()=>n(s.id,s.is_published,s.title),children:s.is_published?e.jsxs(e.Fragment,{children:[e.jsx(Er,{className:"mr-2 h-4 w-4"}),"Ukryj aktywność"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"}),"Opublikuj aktywność"]})}),s.type==="quiz"&&e.jsxs(e.Fragment,{children:[e.jsx(ss,{}),e.jsxs(ne,{onClick:()=>o(`/questions/manage/${s.id}`),className:"text-blue-600 focus:text-blue-600",children:[e.jsx(Ks,{className:"mr-2 h-4 w-4"}),"Zarządzaj pytaniami"]}),e.jsxs(ne,{onClick:()=>o(`/questions/create?activity_id=${s.id}`),className:"text-blue-600 focus:text-blue-600",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Dodaj pytanie"]})]}),e.jsx(ss,{}),e.jsxs(ne,{onClick:()=>r(s.id,s.title),className:"text-red-600 focus:text-red-600",children:[e.jsx($s,{className:"mr-2 h-4 w-4"}),"Usuń"]})]})]})]})]})},Ou=({course:s})=>s?e.jsx(S,{className:"flex-1",children:e.jsx(_,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[s.icon_emoji&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-3xl",children:s.icon_emoji})})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold",children:s.title}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:s.is_published?"Opublikowany":"Szkic"}),s.created_at&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Utworzony: ",new Date(s.created_at).toLocaleDateString("pl-PL")]})]})]}),s.description&&e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("p",{className:"text-muted-foreground leading-relaxed whitespace-pre-wrap",children:s.description})})]})]})})}):null;function $u(){for(var s=arguments.length,t=new Array(s),r=0;r<s;r++)t[r]=arguments[r];return d.useMemo(()=>a=>{t.forEach(n=>n(a))},t)}const Gr=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function gt(s){const t=Object.prototype.toString.call(s);return t==="[object Window]"||t==="[object global]"}function Pa(s){return"nodeType"in s}function $e(s){var t,r;return s?gt(s)?s:Pa(s)&&(t=(r=s.ownerDocument)==null?void 0:r.defaultView)!=null?t:window:window}function Ra(s){const{Document:t}=$e(s);return s instanceof t}function Yt(s){return gt(s)?!1:s instanceof $e(s).HTMLElement}function po(s){return s instanceof $e(s).SVGElement}function ft(s){return s?gt(s)?s.document:Pa(s)?Ra(s)?s:Yt(s)||po(s)?s.ownerDocument:document:document:document}const vs=Gr?d.useLayoutEffect:d.useEffect;function Ea(s){const t=d.useRef(s);return vs(()=>{t.current=s}),d.useCallback(function(){for(var r=arguments.length,a=new Array(r),n=0;n<r;n++)a[n]=arguments[n];return t.current==null?void 0:t.current(...a)},[])}function Fu(){const s=d.useRef(null),t=d.useCallback((a,n)=>{s.current=setInterval(a,n)},[]),r=d.useCallback(()=>{s.current!==null&&(clearInterval(s.current),s.current=null)},[]);return[t,r]}function Ft(s,t){t===void 0&&(t=[s]);const r=d.useRef(s);return vs(()=>{r.current!==s&&(r.current=s)},t),r}function er(s,t){const r=d.useRef();return d.useMemo(()=>{const a=s(r.current);return r.current=a,a},[...t])}function Nr(s){const t=Ea(s),r=d.useRef(null),a=d.useCallback(n=>{n!==r.current&&t?.(n,r.current),r.current=n},[]);return[r,a]}function ua(s){const t=d.useRef();return d.useEffect(()=>{t.current=s},[s]),t.current}let Yr={};function sr(s,t){return d.useMemo(()=>{if(t)return t;const r=Yr[s]==null?0:Yr[s]+1;return Yr[s]=r,s+"-"+r},[s,t])}function ho(s){return function(t){for(var r=arguments.length,a=new Array(r>1?r-1:0),n=1;n<r;n++)a[n-1]=arguments[n];return a.reduce((i,o)=>{const l=Object.entries(o);for(const[c,u]of l){const x=i[c];x!=null&&(i[c]=x+s*u)}return i},{...t})}}const dt=ho(1),Wt=ho(-1);function Wu(s){return"clientX"in s&&"clientY"in s}function Ma(s){if(!s)return!1;const{KeyboardEvent:t}=$e(s.target);return t&&s instanceof t}function Uu(s){if(!s)return!1;const{TouchEvent:t}=$e(s.target);return t&&s instanceof t}function ma(s){if(Uu(s)){if(s.touches&&s.touches.length){const{clientX:t,clientY:r}=s.touches[0];return{x:t,y:r}}else if(s.changedTouches&&s.changedTouches.length){const{clientX:t,clientY:r}=s.changedTouches[0];return{x:t,y:r}}}return Wu(s)?{x:s.clientX,y:s.clientY}:null}const Ut=Object.freeze({Translate:{toString(s){if(!s)return;const{x:t,y:r}=s;return"translate3d("+(t?Math.round(t):0)+"px, "+(r?Math.round(r):0)+"px, 0)"}},Scale:{toString(s){if(!s)return;const{scaleX:t,scaleY:r}=s;return"scaleX("+t+") scaleY("+r+")"}},Transform:{toString(s){if(s)return[Ut.Translate.toString(s),Ut.Scale.toString(s)].join(" ")}},Transition:{toString(s){let{property:t,duration:r,easing:a}=s;return t+" "+r+"ms "+a}}}),ri="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Bu(s){return s.matches(ri)?s:s.querySelector(ri)}const Gu={display:"none"};function Ku(s){let{id:t,value:r}=s;return W.createElement("div",{id:t,style:Gu},r)}function Zu(s){let{id:t,announcement:r,ariaLiveType:a="assertive"}=s;const n={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return W.createElement("div",{id:t,style:n,role:"status","aria-live":a,"aria-atomic":!0},r)}function Qu(){const[s,t]=d.useState("");return{announce:d.useCallback(a=>{a!=null&&t(a)},[]),announcement:s}}const jo=d.createContext(null);function Vu(s){const t=d.useContext(jo);d.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(s)},[s,t])}function Hu(){const[s]=d.useState(()=>new Set),t=d.useCallback(a=>(s.add(a),()=>s.delete(a)),[s]);return[d.useCallback(a=>{let{type:n,event:i}=a;s.forEach(o=>{var l;return(l=o[n])==null?void 0:l.call(o,i)})},[s]),t]}const Ju={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Xu={onDragStart(s){let{active:t}=s;return"Picked up draggable item "+t.id+"."},onDragOver(s){let{active:t,over:r}=s;return r?"Draggable item "+t.id+" was moved over droppable area "+r.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(s){let{active:t,over:r}=s;return r?"Draggable item "+t.id+" was dropped over droppable area "+r.id:"Draggable item "+t.id+" was dropped."},onDragCancel(s){let{active:t}=s;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function Yu(s){let{announcements:t=Xu,container:r,hiddenTextDescribedById:a,screenReaderInstructions:n=Ju}=s;const{announce:i,announcement:o}=Qu(),l=sr("DndLiveRegion"),[c,u]=d.useState(!1);if(d.useEffect(()=>{u(!0)},[]),Vu(d.useMemo(()=>({onDragStart(m){let{active:p}=m;i(t.onDragStart({active:p}))},onDragMove(m){let{active:p,over:g}=m;t.onDragMove&&i(t.onDragMove({active:p,over:g}))},onDragOver(m){let{active:p,over:g}=m;i(t.onDragOver({active:p,over:g}))},onDragEnd(m){let{active:p,over:g}=m;i(t.onDragEnd({active:p,over:g}))},onDragCancel(m){let{active:p,over:g}=m;i(t.onDragCancel({active:p,over:g}))}}),[i,t])),!c)return null;const x=W.createElement(W.Fragment,null,W.createElement(Ku,{id:a,value:n.draggable}),W.createElement(Zu,{id:l,announcement:o}));return r?Dt.createPortal(x,r):x}var fe;(function(s){s.DragStart="dragStart",s.DragMove="dragMove",s.DragEnd="dragEnd",s.DragCancel="dragCancel",s.DragOver="dragOver",s.RegisterDroppable="registerDroppable",s.SetDroppableDisabled="setDroppableDisabled",s.UnregisterDroppable="unregisterDroppable"})(fe||(fe={}));function zr(){}function ai(s,t){return d.useMemo(()=>({sensor:s,options:t??{}}),[s,t])}function em(){for(var s=arguments.length,t=new Array(s),r=0;r<s;r++)t[r]=arguments[r];return d.useMemo(()=>[...t].filter(a=>a!=null),[...t])}const us=Object.freeze({x:0,y:0});function go(s,t){return Math.sqrt(Math.pow(s.x-t.x,2)+Math.pow(s.y-t.y,2))}function fo(s,t){let{data:{value:r}}=s,{data:{value:a}}=t;return r-a}function sm(s,t){let{data:{value:r}}=s,{data:{value:a}}=t;return a-r}function ii(s){let{left:t,top:r,height:a,width:n}=s;return[{x:t,y:r},{x:t+n,y:r},{x:t,y:r+a},{x:t+n,y:r+a}]}function yo(s,t){if(!s||s.length===0)return null;const[r]=s;return r[t]}function ni(s,t,r){return t===void 0&&(t=s.left),r===void 0&&(r=s.top),{x:t+s.width*.5,y:r+s.height*.5}}const tm=s=>{let{collisionRect:t,droppableRects:r,droppableContainers:a}=s;const n=ni(t,t.left,t.top),i=[];for(const o of a){const{id:l}=o,c=r.get(l);if(c){const u=go(ni(c),n);i.push({id:l,data:{droppableContainer:o,value:u}})}}return i.sort(fo)},rm=s=>{let{collisionRect:t,droppableRects:r,droppableContainers:a}=s;const n=ii(t),i=[];for(const o of a){const{id:l}=o,c=r.get(l);if(c){const u=ii(c),x=n.reduce((p,g,b)=>p+go(u[b],g),0),m=Number((x/4).toFixed(4));i.push({id:l,data:{droppableContainer:o,value:m}})}}return i.sort(fo)};function am(s,t){const r=Math.max(t.top,s.top),a=Math.max(t.left,s.left),n=Math.min(t.left+t.width,s.left+s.width),i=Math.min(t.top+t.height,s.top+s.height),o=n-a,l=i-r;if(a<n&&r<i){const c=t.width*t.height,u=s.width*s.height,x=o*l,m=x/(c+u-x);return Number(m.toFixed(4))}return 0}const im=s=>{let{collisionRect:t,droppableRects:r,droppableContainers:a}=s;const n=[];for(const i of a){const{id:o}=i,l=r.get(o);if(l){const c=am(l,t);c>0&&n.push({id:o,data:{droppableContainer:i,value:c}})}}return n.sort(sm)};function nm(s,t,r){return{...s,scaleX:t&&r?t.width/r.width:1,scaleY:t&&r?t.height/r.height:1}}function bo(s,t){return s&&t?{x:s.left-t.left,y:s.top-t.top}:us}function om(s){return function(r){for(var a=arguments.length,n=new Array(a>1?a-1:0),i=1;i<a;i++)n[i-1]=arguments[i];return n.reduce((o,l)=>({...o,top:o.top+s*l.y,bottom:o.bottom+s*l.y,left:o.left+s*l.x,right:o.right+s*l.x}),{...r})}}const lm=om(1);function cm(s){if(s.startsWith("matrix3d(")){const t=s.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(s.startsWith("matrix(")){const t=s.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function dm(s,t,r){const a=cm(t);if(!a)return s;const{scaleX:n,scaleY:i,x:o,y:l}=a,c=s.left-o-(1-n)*parseFloat(r),u=s.top-l-(1-i)*parseFloat(r.slice(r.indexOf(" ")+1)),x=n?s.width/n:s.width,m=i?s.height/i:s.height;return{width:x,height:m,top:u,right:c+x,bottom:u+m,left:c}}const um={ignoreTransform:!1};function yt(s,t){t===void 0&&(t=um);let r=s.getBoundingClientRect();if(t.ignoreTransform){const{transform:u,transformOrigin:x}=$e(s).getComputedStyle(s);u&&(r=dm(r,u,x))}const{top:a,left:n,width:i,height:o,bottom:l,right:c}=r;return{top:a,left:n,width:i,height:o,bottom:l,right:c}}function oi(s){return yt(s,{ignoreTransform:!0})}function mm(s){const t=s.innerWidth,r=s.innerHeight;return{top:0,left:0,right:t,bottom:r,width:t,height:r}}function xm(s,t){return t===void 0&&(t=$e(s).getComputedStyle(s)),t.position==="fixed"}function pm(s,t){t===void 0&&(t=$e(s).getComputedStyle(s));const r=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(n=>{const i=t[n];return typeof i=="string"?r.test(i):!1})}function Kr(s,t){const r=[];function a(n){if(t!=null&&r.length>=t||!n)return r;if(Ra(n)&&n.scrollingElement!=null&&!r.includes(n.scrollingElement))return r.push(n.scrollingElement),r;if(!Yt(n)||po(n)||r.includes(n))return r;const i=$e(s).getComputedStyle(n);return n!==s&&pm(n,i)&&r.push(n),xm(n,i)?r:a(n.parentNode)}return s?a(s):r}function wo(s){const[t]=Kr(s,1);return t??null}function ea(s){return!Gr||!s?null:gt(s)?s:Pa(s)?Ra(s)||s===ft(s).scrollingElement?window:Yt(s)?s:null:null}function vo(s){return gt(s)?s.scrollX:s.scrollLeft}function No(s){return gt(s)?s.scrollY:s.scrollTop}function xa(s){return{x:vo(s),y:No(s)}}var ve;(function(s){s[s.Forward=1]="Forward",s[s.Backward=-1]="Backward"})(ve||(ve={}));function zo(s){return!Gr||!s?!1:s===document.scrollingElement}function ko(s){const t={x:0,y:0},r=zo(s)?{height:window.innerHeight,width:window.innerWidth}:{height:s.clientHeight,width:s.clientWidth},a={x:s.scrollWidth-r.width,y:s.scrollHeight-r.height},n=s.scrollTop<=t.y,i=s.scrollLeft<=t.x,o=s.scrollTop>=a.y,l=s.scrollLeft>=a.x;return{isTop:n,isLeft:i,isBottom:o,isRight:l,maxScroll:a,minScroll:t}}const hm={x:.2,y:.2};function jm(s,t,r,a,n){let{top:i,left:o,right:l,bottom:c}=r;a===void 0&&(a=10),n===void 0&&(n=hm);const{isTop:u,isBottom:x,isLeft:m,isRight:p}=ko(s),g={x:0,y:0},b={x:0,y:0},h={height:t.height*n.y,width:t.width*n.x};return!u&&i<=t.top+h.height?(g.y=ve.Backward,b.y=a*Math.abs((t.top+h.height-i)/h.height)):!x&&c>=t.bottom-h.height&&(g.y=ve.Forward,b.y=a*Math.abs((t.bottom-h.height-c)/h.height)),!p&&l>=t.right-h.width?(g.x=ve.Forward,b.x=a*Math.abs((t.right-h.width-l)/h.width)):!m&&o<=t.left+h.width&&(g.x=ve.Backward,b.x=a*Math.abs((t.left+h.width-o)/h.width)),{direction:g,speed:b}}function gm(s){if(s===document.scrollingElement){const{innerWidth:i,innerHeight:o}=window;return{top:0,left:0,right:i,bottom:o,width:i,height:o}}const{top:t,left:r,right:a,bottom:n}=s.getBoundingClientRect();return{top:t,left:r,right:a,bottom:n,width:s.clientWidth,height:s.clientHeight}}function Co(s){return s.reduce((t,r)=>dt(t,xa(r)),us)}function fm(s){return s.reduce((t,r)=>t+vo(r),0)}function ym(s){return s.reduce((t,r)=>t+No(r),0)}function bm(s,t){if(t===void 0&&(t=yt),!s)return;const{top:r,left:a,bottom:n,right:i}=t(s);wo(s)&&(n<=0||i<=0||r>=window.innerHeight||a>=window.innerWidth)&&s.scrollIntoView({block:"center",inline:"center"})}const wm=[["x",["left","right"],fm],["y",["top","bottom"],ym]];class La{constructor(t,r){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const a=Kr(r),n=Co(a);this.rect={...t},this.width=t.width,this.height=t.height;for(const[i,o,l]of wm)for(const c of o)Object.defineProperty(this,c,{get:()=>{const u=l(a),x=n[i]-u;return this.rect[c]+x},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Rt{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(r=>{var a;return(a=this.target)==null?void 0:a.removeEventListener(...r)})},this.target=t}add(t,r,a){var n;(n=this.target)==null||n.addEventListener(t,r,a),this.listeners.push([t,r,a])}}function vm(s){const{EventTarget:t}=$e(s);return s instanceof t?s:ft(s)}function sa(s,t){const r=Math.abs(s.x),a=Math.abs(s.y);return typeof t=="number"?Math.sqrt(r**2+a**2)>t:"x"in t&&"y"in t?r>t.x&&a>t.y:"x"in t?r>t.x:"y"in t?a>t.y:!1}var Ye;(function(s){s.Click="click",s.DragStart="dragstart",s.Keydown="keydown",s.ContextMenu="contextmenu",s.Resize="resize",s.SelectionChange="selectionchange",s.VisibilityChange="visibilitychange"})(Ye||(Ye={}));function li(s){s.preventDefault()}function Nm(s){s.stopPropagation()}var X;(function(s){s.Space="Space",s.Down="ArrowDown",s.Right="ArrowRight",s.Left="ArrowLeft",s.Up="ArrowUp",s.Esc="Escape",s.Enter="Enter",s.Tab="Tab"})(X||(X={}));const So={start:[X.Space,X.Enter],cancel:[X.Esc],end:[X.Space,X.Enter,X.Tab]},zm=(s,t)=>{let{currentCoordinates:r}=t;switch(s.code){case X.Right:return{...r,x:r.x+25};case X.Left:return{...r,x:r.x-25};case X.Down:return{...r,y:r.y+25};case X.Up:return{...r,y:r.y-25}}};class Aa{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:r}}=t;this.props=t,this.listeners=new Rt(ft(r)),this.windowListeners=new Rt($e(r)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Ye.Resize,this.handleCancel),this.windowListeners.add(Ye.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Ye.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:r}=this.props,a=t.node.current;a&&bm(a),r(us)}handleKeyDown(t){if(Ma(t)){const{active:r,context:a,options:n}=this.props,{keyboardCodes:i=So,coordinateGetter:o=zm,scrollBehavior:l="smooth"}=n,{code:c}=t;if(i.end.includes(c)){this.handleEnd(t);return}if(i.cancel.includes(c)){this.handleCancel(t);return}const{collisionRect:u}=a.current,x=u?{x:u.left,y:u.top}:us;this.referenceCoordinates||(this.referenceCoordinates=x);const m=o(t,{active:r,context:a.current,currentCoordinates:x});if(m){const p=Wt(m,x),g={x:0,y:0},{scrollableAncestors:b}=a.current;for(const h of b){const f=t.code,{isTop:y,isRight:j,isLeft:v,isBottom:k,maxScroll:C,minScroll:z}=ko(h),N=gm(h),I={x:Math.min(f===X.Right?N.right-N.width/2:N.right,Math.max(f===X.Right?N.left:N.left+N.width/2,m.x)),y:Math.min(f===X.Down?N.bottom-N.height/2:N.bottom,Math.max(f===X.Down?N.top:N.top+N.height/2,m.y))},q=f===X.Right&&!j||f===X.Left&&!v,P=f===X.Down&&!k||f===X.Up&&!y;if(q&&I.x!==m.x){const B=h.scrollLeft+p.x,T=f===X.Right&&B<=C.x||f===X.Left&&B>=z.x;if(T&&!p.y){h.scrollTo({left:B,behavior:l});return}T?g.x=h.scrollLeft-B:g.x=f===X.Right?h.scrollLeft-C.x:h.scrollLeft-z.x,g.x&&h.scrollBy({left:-g.x,behavior:l});break}else if(P&&I.y!==m.y){const B=h.scrollTop+p.y,T=f===X.Down&&B<=C.y||f===X.Up&&B>=z.y;if(T&&!p.x){h.scrollTo({top:B,behavior:l});return}T?g.y=h.scrollTop-B:g.y=f===X.Down?h.scrollTop-C.y:h.scrollTop-z.y,g.y&&h.scrollBy({top:-g.y,behavior:l});break}}this.handleMove(t,dt(Wt(m,this.referenceCoordinates),g))}}}handleMove(t,r){const{onMove:a}=this.props;t.preventDefault(),a(r)}handleEnd(t){const{onEnd:r}=this.props;t.preventDefault(),this.detach(),r()}handleCancel(t){const{onCancel:r}=this.props;t.preventDefault(),this.detach(),r()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Aa.activators=[{eventName:"onKeyDown",handler:(s,t,r)=>{let{keyboardCodes:a=So,onActivation:n}=t,{active:i}=r;const{code:o}=s.nativeEvent;if(a.start.includes(o)){const l=i.activatorNode.current;return l&&s.target!==l?!1:(s.preventDefault(),n?.({event:s.nativeEvent}),!0)}return!1}}];function ci(s){return!!(s&&"distance"in s)}function di(s){return!!(s&&"delay"in s)}class qa{constructor(t,r,a){var n;a===void 0&&(a=vm(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=r;const{event:i}=t,{target:o}=i;this.props=t,this.events=r,this.document=ft(o),this.documentListeners=new Rt(this.document),this.listeners=new Rt(a),this.windowListeners=new Rt($e(o)),this.initialCoordinates=(n=ma(i))!=null?n:us,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:r,bypassActivationConstraint:a}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(Ye.Resize,this.handleCancel),this.windowListeners.add(Ye.DragStart,li),this.windowListeners.add(Ye.VisibilityChange,this.handleCancel),this.windowListeners.add(Ye.ContextMenu,li),this.documentListeners.add(Ye.Keydown,this.handleKeydown),r){if(a!=null&&a({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(di(r)){this.timeoutId=setTimeout(this.handleStart,r.delay),this.handlePending(r);return}if(ci(r)){this.handlePending(r);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,r){const{active:a,onPending:n}=this.props;n(a,t,this.initialCoordinates,r)}handleStart(){const{initialCoordinates:t}=this,{onStart:r}=this.props;t&&(this.activated=!0,this.documentListeners.add(Ye.Click,Nm,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Ye.SelectionChange,this.removeTextSelection),r(t))}handleMove(t){var r;const{activated:a,initialCoordinates:n,props:i}=this,{onMove:o,options:{activationConstraint:l}}=i;if(!n)return;const c=(r=ma(t))!=null?r:us,u=Wt(n,c);if(!a&&l){if(ci(l)){if(l.tolerance!=null&&sa(u,l.tolerance))return this.handleCancel();if(sa(u,l.distance))return this.handleStart()}if(di(l)&&sa(u,l.tolerance))return this.handleCancel();this.handlePending(l,u);return}t.cancelable&&t.preventDefault(),o(c)}handleEnd(){const{onAbort:t,onEnd:r}=this.props;this.detach(),this.activated||t(this.props.active),r()}handleCancel(){const{onAbort:t,onCancel:r}=this.props;this.detach(),this.activated||t(this.props.active),r()}handleKeydown(t){t.code===X.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const km={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Oa extends qa{constructor(t){const{event:r}=t,a=ft(r.target);super(t,km,a)}}Oa.activators=[{eventName:"onPointerDown",handler:(s,t)=>{let{nativeEvent:r}=s,{onActivation:a}=t;return!r.isPrimary||r.button!==0?!1:(a?.({event:r}),!0)}}];const Cm={move:{name:"mousemove"},end:{name:"mouseup"}};var pa;(function(s){s[s.RightClick=2]="RightClick"})(pa||(pa={}));class Sm extends qa{constructor(t){super(t,Cm,ft(t.event.target))}}Sm.activators=[{eventName:"onMouseDown",handler:(s,t)=>{let{nativeEvent:r}=s,{onActivation:a}=t;return r.button===pa.RightClick?!1:(a?.({event:r}),!0)}}];const ta={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class _m extends qa{constructor(t){super(t,ta)}static setup(){return window.addEventListener(ta.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(ta.move.name,t)};function t(){}}}_m.activators=[{eventName:"onTouchStart",handler:(s,t)=>{let{nativeEvent:r}=s,{onActivation:a}=t;const{touches:n}=r;return n.length>1?!1:(a?.({event:r}),!0)}}];var Et;(function(s){s[s.Pointer=0]="Pointer",s[s.DraggableRect=1]="DraggableRect"})(Et||(Et={}));var kr;(function(s){s[s.TreeOrder=0]="TreeOrder",s[s.ReversedTreeOrder=1]="ReversedTreeOrder"})(kr||(kr={}));function Tm(s){let{acceleration:t,activator:r=Et.Pointer,canScroll:a,draggingRect:n,enabled:i,interval:o=5,order:l=kr.TreeOrder,pointerCoordinates:c,scrollableAncestors:u,scrollableAncestorRects:x,delta:m,threshold:p}=s;const g=Im({delta:m,disabled:!i}),[b,h]=Fu(),f=d.useRef({x:0,y:0}),y=d.useRef({x:0,y:0}),j=d.useMemo(()=>{switch(r){case Et.Pointer:return c?{top:c.y,bottom:c.y,left:c.x,right:c.x}:null;case Et.DraggableRect:return n}},[r,n,c]),v=d.useRef(null),k=d.useCallback(()=>{const z=v.current;if(!z)return;const N=f.current.x*y.current.x,I=f.current.y*y.current.y;z.scrollBy(N,I)},[]),C=d.useMemo(()=>l===kr.TreeOrder?[...u].reverse():u,[l,u]);d.useEffect(()=>{if(!i||!u.length||!j){h();return}for(const z of C){if(a?.(z)===!1)continue;const N=u.indexOf(z),I=x[N];if(!I)continue;const{direction:q,speed:P}=jm(z,I,j,t,p);for(const B of["x","y"])g[B][q[B]]||(P[B]=0,q[B]=0);if(P.x>0||P.y>0){h(),v.current=z,b(k,o),f.current=P,y.current=q;return}}f.current={x:0,y:0},y.current={x:0,y:0},h()},[t,k,a,h,i,o,JSON.stringify(j),JSON.stringify(g),b,u,C,x,JSON.stringify(p)])}const Dm={x:{[ve.Backward]:!1,[ve.Forward]:!1},y:{[ve.Backward]:!1,[ve.Forward]:!1}};function Im(s){let{delta:t,disabled:r}=s;const a=ua(t);return er(n=>{if(r||!a||!n)return Dm;const i={x:Math.sign(t.x-a.x),y:Math.sign(t.y-a.y)};return{x:{[ve.Backward]:n.x[ve.Backward]||i.x===-1,[ve.Forward]:n.x[ve.Forward]||i.x===1},y:{[ve.Backward]:n.y[ve.Backward]||i.y===-1,[ve.Forward]:n.y[ve.Forward]||i.y===1}}},[r,t,a])}function Pm(s,t){const r=t!=null?s.get(t):void 0,a=r?r.node.current:null;return er(n=>{var i;return t==null?null:(i=a??n)!=null?i:null},[a,t])}function Rm(s,t){return d.useMemo(()=>s.reduce((r,a)=>{const{sensor:n}=a,i=n.activators.map(o=>({eventName:o.eventName,handler:t(o.handler,a)}));return[...r,...i]},[]),[s,t])}var Bt;(function(s){s[s.Always=0]="Always",s[s.BeforeDragging=1]="BeforeDragging",s[s.WhileDragging=2]="WhileDragging"})(Bt||(Bt={}));var ha;(function(s){s.Optimized="optimized"})(ha||(ha={}));const ui=new Map;function Em(s,t){let{dragging:r,dependencies:a,config:n}=t;const[i,o]=d.useState(null),{frequency:l,measure:c,strategy:u}=n,x=d.useRef(s),m=f(),p=Ft(m),g=d.useCallback(function(y){y===void 0&&(y=[]),!p.current&&o(j=>j===null?y:j.concat(y.filter(v=>!j.includes(v))))},[p]),b=d.useRef(null),h=er(y=>{if(m&&!r)return ui;if(!y||y===ui||x.current!==s||i!=null){const j=new Map;for(let v of s){if(!v)continue;if(i&&i.length>0&&!i.includes(v.id)&&v.rect.current){j.set(v.id,v.rect.current);continue}const k=v.node.current,C=k?new La(c(k),k):null;v.rect.current=C,C&&j.set(v.id,C)}return j}return y},[s,i,r,m,c]);return d.useEffect(()=>{x.current=s},[s]),d.useEffect(()=>{m||g()},[r,m]),d.useEffect(()=>{i&&i.length>0&&o(null)},[JSON.stringify(i)]),d.useEffect(()=>{m||typeof l!="number"||b.current!==null||(b.current=setTimeout(()=>{g(),b.current=null},l))},[l,m,g,...a]),{droppableRects:h,measureDroppableContainers:g,measuringScheduled:i!=null};function f(){switch(u){case Bt.Always:return!1;case Bt.BeforeDragging:return r;default:return!r}}}function _o(s,t){return er(r=>s?r||(typeof t=="function"?t(s):s):null,[t,s])}function Mm(s,t){return _o(s,t)}function Lm(s){let{callback:t,disabled:r}=s;const a=Ea(t),n=d.useMemo(()=>{if(r||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(a)},[a,r]);return d.useEffect(()=>()=>n?.disconnect(),[n]),n}function Zr(s){let{callback:t,disabled:r}=s;const a=Ea(t),n=d.useMemo(()=>{if(r||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(a)},[r]);return d.useEffect(()=>()=>n?.disconnect(),[n]),n}function Am(s){return new La(yt(s),s)}function mi(s,t,r){t===void 0&&(t=Am);const[a,n]=d.useState(null);function i(){n(c=>{if(!s)return null;if(s.isConnected===!1){var u;return(u=c??r)!=null?u:null}const x=t(s);return JSON.stringify(c)===JSON.stringify(x)?c:x})}const o=Lm({callback(c){if(s)for(const u of c){const{type:x,target:m}=u;if(x==="childList"&&m instanceof HTMLElement&&m.contains(s)){i();break}}}}),l=Zr({callback:i});return vs(()=>{i(),s?(l?.observe(s),o?.observe(document.body,{childList:!0,subtree:!0})):(l?.disconnect(),o?.disconnect())},[s]),a}function qm(s){const t=_o(s);return bo(s,t)}const xi=[];function Om(s){const t=d.useRef(s),r=er(a=>s?a&&a!==xi&&s&&t.current&&s.parentNode===t.current.parentNode?a:Kr(s):xi,[s]);return d.useEffect(()=>{t.current=s},[s]),r}function $m(s){const[t,r]=d.useState(null),a=d.useRef(s),n=d.useCallback(i=>{const o=ea(i.target);o&&r(l=>l?(l.set(o,xa(o)),new Map(l)):null)},[]);return d.useEffect(()=>{const i=a.current;if(s!==i){o(i);const l=s.map(c=>{const u=ea(c);return u?(u.addEventListener("scroll",n,{passive:!0}),[u,xa(u)]):null}).filter(c=>c!=null);r(l.length?new Map(l):null),a.current=s}return()=>{o(s),o(i)};function o(l){l.forEach(c=>{const u=ea(c);u?.removeEventListener("scroll",n)})}},[n,s]),d.useMemo(()=>s.length?t?Array.from(t.values()).reduce((i,o)=>dt(i,o),us):Co(s):us,[s,t])}function pi(s,t){t===void 0&&(t=[]);const r=d.useRef(null);return d.useEffect(()=>{r.current=null},t),d.useEffect(()=>{const a=s!==us;a&&!r.current&&(r.current=s),!a&&r.current&&(r.current=null)},[s]),r.current?Wt(s,r.current):us}function Fm(s){d.useEffect(()=>{if(!Gr)return;const t=s.map(r=>{let{sensor:a}=r;return a.setup==null?void 0:a.setup()});return()=>{for(const r of t)r?.()}},s.map(t=>{let{sensor:r}=t;return r}))}function Wm(s,t){return d.useMemo(()=>s.reduce((r,a)=>{let{eventName:n,handler:i}=a;return r[n]=o=>{i(o,t)},r},{}),[s,t])}function To(s){return d.useMemo(()=>s?mm(s):null,[s])}const hi=[];function Um(s,t){t===void 0&&(t=yt);const[r]=s,a=To(r?$e(r):null),[n,i]=d.useState(hi);function o(){i(()=>s.length?s.map(c=>zo(c)?a:new La(t(c),c)):hi)}const l=Zr({callback:o});return vs(()=>{l?.disconnect(),o(),s.forEach(c=>l?.observe(c))},[s]),n}function Bm(s){if(!s)return null;if(s.children.length>1)return s;const t=s.children[0];return Yt(t)?t:s}function Gm(s){let{measure:t}=s;const[r,a]=d.useState(null),n=d.useCallback(u=>{for(const{target:x}of u)if(Yt(x)){a(m=>{const p=t(x);return m?{...m,width:p.width,height:p.height}:p});break}},[t]),i=Zr({callback:n}),o=d.useCallback(u=>{const x=Bm(u);i?.disconnect(),x&&i?.observe(x),a(x?t(x):null)},[t,i]),[l,c]=Nr(o);return d.useMemo(()=>({nodeRef:l,rect:r,setRef:c}),[r,l,c])}const Km=[{sensor:Oa,options:{}},{sensor:Aa,options:{}}],Zm={current:{}},br={draggable:{measure:oi},droppable:{measure:oi,strategy:Bt.WhileDragging,frequency:ha.Optimized},dragOverlay:{measure:yt}};class Mt extends Map{get(t){var r;return t!=null&&(r=super.get(t))!=null?r:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:r}=t;return!r})}getNodeFor(t){var r,a;return(r=(a=this.get(t))==null?void 0:a.node.current)!=null?r:void 0}}const Qm={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Mt,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:zr},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:br,measureDroppableContainers:zr,windowRect:null,measuringScheduled:!1},Vm={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:zr,draggableNodes:new Map,over:null,measureDroppableContainers:zr},Qr=d.createContext(Vm),Do=d.createContext(Qm);function Hm(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Mt}}}function Jm(s,t){switch(t.type){case fe.DragStart:return{...s,draggable:{...s.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case fe.DragMove:return s.draggable.active==null?s:{...s,draggable:{...s.draggable,translate:{x:t.coordinates.x-s.draggable.initialCoordinates.x,y:t.coordinates.y-s.draggable.initialCoordinates.y}}};case fe.DragEnd:case fe.DragCancel:return{...s,draggable:{...s.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case fe.RegisterDroppable:{const{element:r}=t,{id:a}=r,n=new Mt(s.droppable.containers);return n.set(a,r),{...s,droppable:{...s.droppable,containers:n}}}case fe.SetDroppableDisabled:{const{id:r,key:a,disabled:n}=t,i=s.droppable.containers.get(r);if(!i||a!==i.key)return s;const o=new Mt(s.droppable.containers);return o.set(r,{...i,disabled:n}),{...s,droppable:{...s.droppable,containers:o}}}case fe.UnregisterDroppable:{const{id:r,key:a}=t,n=s.droppable.containers.get(r);if(!n||a!==n.key)return s;const i=new Mt(s.droppable.containers);return i.delete(r),{...s,droppable:{...s.droppable,containers:i}}}default:return s}}function Xm(s){let{disabled:t}=s;const{active:r,activatorEvent:a,draggableNodes:n}=d.useContext(Qr),i=ua(a),o=ua(r?.id);return d.useEffect(()=>{if(!t&&!a&&i&&o!=null){if(!Ma(i)||document.activeElement===i.target)return;const l=n.get(o);if(!l)return;const{activatorNode:c,node:u}=l;if(!c.current&&!u.current)return;requestAnimationFrame(()=>{for(const x of[c.current,u.current]){if(!x)continue;const m=Bu(x);if(m){m.focus();break}}})}},[a,t,n,o,i]),null}function Ym(s,t){let{transform:r,...a}=t;return s!=null&&s.length?s.reduce((n,i)=>i({transform:n,...a}),r):r}function ex(s){return d.useMemo(()=>({draggable:{...br.draggable,...s?.draggable},droppable:{...br.droppable,...s?.droppable},dragOverlay:{...br.dragOverlay,...s?.dragOverlay}}),[s?.draggable,s?.droppable,s?.dragOverlay])}function sx(s){let{activeNode:t,measure:r,initialRect:a,config:n=!0}=s;const i=d.useRef(!1),{x:o,y:l}=typeof n=="boolean"?{x:n,y:n}:n;vs(()=>{if(!o&&!l||!t){i.current=!1;return}if(i.current||!a)return;const u=t?.node.current;if(!u||u.isConnected===!1)return;const x=r(u),m=bo(x,a);if(o||(m.x=0),l||(m.y=0),i.current=!0,Math.abs(m.x)>0||Math.abs(m.y)>0){const p=wo(u);p&&p.scrollBy({top:m.y,left:m.x})}},[t,o,l,a,r])}const Io=d.createContext({...us,scaleX:1,scaleY:1});var qs;(function(s){s[s.Uninitialized=0]="Uninitialized",s[s.Initializing=1]="Initializing",s[s.Initialized=2]="Initialized"})(qs||(qs={}));const tx=d.memo(function(t){var r,a,n,i;let{id:o,accessibility:l,autoScroll:c=!0,children:u,sensors:x=Km,collisionDetection:m=im,measuring:p,modifiers:g,...b}=t;const h=d.useReducer(Jm,void 0,Hm),[f,y]=h,[j,v]=Hu(),[k,C]=d.useState(qs.Uninitialized),z=k===qs.Initialized,{draggable:{active:N,nodes:I,translate:q},droppable:{containers:P}}=f,B=N!=null?I.get(N):null,T=d.useRef({initial:null,translated:null}),E=d.useMemo(()=>{var De;return N!=null?{id:N,data:(De=B?.data)!=null?De:Zm,rect:T}:null},[N,B]),D=d.useRef(null),[ee,Pe]=d.useState(null),[ae,Y]=d.useState(null),G=Ft(b,Object.values(b)),_e=sr("DndDescribedBy",o),Te=d.useMemo(()=>P.getEnabled(),[P]),he=ex(p),{droppableRects:Fe,measureDroppableContainers:ls,measuringScheduled:Ps}=Em(Te,{dragging:z,dependencies:[q.x,q.y],config:he.droppable}),be=Pm(I,N),we=d.useMemo(()=>ae?ma(ae):null,[ae]),cs=Vo(),ks=Mm(be,he.draggable.measure);sx({activeNode:N!=null?I.get(N):null,config:cs.layoutShiftCompensation,initialRect:ks,measure:he.draggable.measure});const re=mi(be,he.draggable.measure,ks),Nt=mi(be?be.parentElement:null),ps=d.useRef({activatorEvent:null,active:null,activeNode:be,collisionRect:null,collisions:null,droppableRects:Fe,draggableNodes:I,draggingNode:null,draggingNodeRect:null,droppableContainers:P,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),rt=P.getNodeFor((r=ps.current.over)==null?void 0:r.id),Cs=Gm({measure:he.dragOverlay.measure}),at=(a=Cs.nodeRef.current)!=null?a:be,it=z?(n=Cs.rect)!=null?n:re:null,Fa=!!(Cs.nodeRef.current&&Cs.rect),Wa=qm(Fa?null:re),Vr=To(at?$e(at):null),Rs=Om(z?rt??be:null),lr=Um(Rs),cr=Ym(g,{transform:{x:q.x-Wa.x,y:q.y-Wa.y,scaleX:1,scaleY:1},activatorEvent:ae,active:E,activeNodeRect:re,containerNodeRect:Nt,draggingNodeRect:it,over:ps.current.over,overlayNodeRect:Cs.rect,scrollableAncestors:Rs,scrollableAncestorRects:lr,windowRect:Vr}),Ua=we?dt(we,q):null,Ba=$m(Rs),Wo=pi(Ba),Uo=pi(Ba,[re]),nt=dt(cr,Wo),ot=it?lm(it,cr):null,zt=E&&ot?m({active:E,collisionRect:ot,droppableRects:Fe,droppableContainers:Te,pointerCoordinates:Ua}):null,Ga=yo(zt,"id"),[Es,Ka]=d.useState(null),Bo=Fa?cr:dt(cr,Uo),Go=nm(Bo,(i=Es?.rect)!=null?i:null,re),Hr=d.useRef(null),Za=d.useCallback((De,We)=>{let{sensor:Ue,options:Ms}=We;if(D.current==null)return;const Je=I.get(D.current);if(!Je)return;const Be=De.nativeEvent,hs=new Ue({active:D.current,activeNode:Je,event:Be,options:Ms,context:ps,onAbort(ke){if(!I.get(ke))return;const{onDragAbort:js}=G.current,Ss={id:ke};js?.(Ss),j({type:"onDragAbort",event:Ss})},onPending(ke,Ls,js,Ss){if(!I.get(ke))return;const{onDragPending:Ct}=G.current,As={id:ke,constraint:Ls,initialCoordinates:js,offset:Ss};Ct?.(As),j({type:"onDragPending",event:As})},onStart(ke){const Ls=D.current;if(Ls==null)return;const js=I.get(Ls);if(!js)return;const{onDragStart:Ss}=G.current,kt={activatorEvent:Be,active:{id:Ls,data:js.data,rect:T}};Dt.unstable_batchedUpdates(()=>{Ss?.(kt),C(qs.Initializing),y({type:fe.DragStart,initialCoordinates:ke,active:Ls}),j({type:"onDragStart",event:kt}),Pe(Hr.current),Y(Be)})},onMove(ke){y({type:fe.DragMove,coordinates:ke})},onEnd:lt(fe.DragEnd),onCancel:lt(fe.DragCancel)});Hr.current=hs;function lt(ke){return async function(){const{active:js,collisions:Ss,over:kt,scrollAdjustedTranslate:Ct}=ps.current;let As=null;if(js&&Ct){const{cancelDrop:St}=G.current;As={activatorEvent:Be,active:js,collisions:Ss,delta:Ct,over:kt},ke===fe.DragEnd&&typeof St=="function"&&await Promise.resolve(St(As))&&(ke=fe.DragCancel)}D.current=null,Dt.unstable_batchedUpdates(()=>{y({type:ke}),C(qs.Uninitialized),Ka(null),Pe(null),Y(null),Hr.current=null;const St=ke===fe.DragEnd?"onDragEnd":"onDragCancel";if(As){const Jr=G.current[St];Jr?.(As),j({type:St,event:As})}})}}},[I]),Ko=d.useCallback((De,We)=>(Ue,Ms)=>{const Je=Ue.nativeEvent,Be=I.get(Ms);if(D.current!==null||!Be||Je.dndKit||Je.defaultPrevented)return;const hs={active:Be};De(Ue,We.options,hs)===!0&&(Je.dndKit={capturedBy:We.sensor},D.current=Ms,Za(Ue,We))},[I,Za]),Qa=Rm(x,Ko);Fm(x),vs(()=>{re&&k===qs.Initializing&&C(qs.Initialized)},[re,k]),d.useEffect(()=>{const{onDragMove:De}=G.current,{active:We,activatorEvent:Ue,collisions:Ms,over:Je}=ps.current;if(!We||!Ue)return;const Be={active:We,activatorEvent:Ue,collisions:Ms,delta:{x:nt.x,y:nt.y},over:Je};Dt.unstable_batchedUpdates(()=>{De?.(Be),j({type:"onDragMove",event:Be})})},[nt.x,nt.y]),d.useEffect(()=>{const{active:De,activatorEvent:We,collisions:Ue,droppableContainers:Ms,scrollAdjustedTranslate:Je}=ps.current;if(!De||D.current==null||!We||!Je)return;const{onDragOver:Be}=G.current,hs=Ms.get(Ga),lt=hs&&hs.rect.current?{id:hs.id,rect:hs.rect.current,data:hs.data,disabled:hs.disabled}:null,ke={active:De,activatorEvent:We,collisions:Ue,delta:{x:Je.x,y:Je.y},over:lt};Dt.unstable_batchedUpdates(()=>{Ka(lt),Be?.(ke),j({type:"onDragOver",event:ke})})},[Ga]),vs(()=>{ps.current={activatorEvent:ae,active:E,activeNode:be,collisionRect:ot,collisions:zt,droppableRects:Fe,draggableNodes:I,draggingNode:at,draggingNodeRect:it,droppableContainers:P,over:Es,scrollableAncestors:Rs,scrollAdjustedTranslate:nt},T.current={initial:it,translated:ot}},[E,be,zt,ot,I,at,it,Fe,P,Es,Rs,nt]),Tm({...cs,delta:q,draggingRect:ot,pointerCoordinates:Ua,scrollableAncestors:Rs,scrollableAncestorRects:lr});const Zo=d.useMemo(()=>({active:E,activeNode:be,activeNodeRect:re,activatorEvent:ae,collisions:zt,containerNodeRect:Nt,dragOverlay:Cs,draggableNodes:I,droppableContainers:P,droppableRects:Fe,over:Es,measureDroppableContainers:ls,scrollableAncestors:Rs,scrollableAncestorRects:lr,measuringConfiguration:he,measuringScheduled:Ps,windowRect:Vr}),[E,be,re,ae,zt,Nt,Cs,I,P,Fe,Es,ls,Rs,lr,he,Ps,Vr]),Qo=d.useMemo(()=>({activatorEvent:ae,activators:Qa,active:E,activeNodeRect:re,ariaDescribedById:{draggable:_e},dispatch:y,draggableNodes:I,over:Es,measureDroppableContainers:ls}),[ae,Qa,E,re,y,_e,I,Es,ls]);return W.createElement(jo.Provider,{value:v},W.createElement(Qr.Provider,{value:Qo},W.createElement(Do.Provider,{value:Zo},W.createElement(Io.Provider,{value:Go},u)),W.createElement(Xm,{disabled:l?.restoreFocus===!1})),W.createElement(Yu,{...l,hiddenTextDescribedById:_e}));function Vo(){const De=ee?.autoScrollEnabled===!1,We=typeof c=="object"?c.enabled===!1:c===!1,Ue=z&&!De&&!We;return typeof c=="object"?{...c,enabled:Ue}:{enabled:Ue}}}),rx=d.createContext(null),ji="button",ax="Draggable";function ix(s){let{id:t,data:r,disabled:a=!1,attributes:n}=s;const i=sr(ax),{activators:o,activatorEvent:l,active:c,activeNodeRect:u,ariaDescribedById:x,draggableNodes:m,over:p}=d.useContext(Qr),{role:g=ji,roleDescription:b="draggable",tabIndex:h=0}=n??{},f=c?.id===t,y=d.useContext(f?Io:rx),[j,v]=Nr(),[k,C]=Nr(),z=Wm(o,t),N=Ft(r);vs(()=>(m.set(t,{id:t,key:i,node:j,activatorNode:k,data:N}),()=>{const q=m.get(t);q&&q.key===i&&m.delete(t)}),[m,t]);const I=d.useMemo(()=>({role:g,tabIndex:h,"aria-disabled":a,"aria-pressed":f&&g===ji?!0:void 0,"aria-roledescription":b,"aria-describedby":x.draggable}),[a,g,h,f,b,x.draggable]);return{active:c,activatorEvent:l,activeNodeRect:u,attributes:I,isDragging:f,listeners:a?void 0:z,node:j,over:p,setNodeRef:v,setActivatorNodeRef:C,transform:y}}function nx(){return d.useContext(Do)}const ox="Droppable",lx={timeout:25};function cx(s){let{data:t,disabled:r=!1,id:a,resizeObserverConfig:n}=s;const i=sr(ox),{active:o,dispatch:l,over:c,measureDroppableContainers:u}=d.useContext(Qr),x=d.useRef({disabled:r}),m=d.useRef(!1),p=d.useRef(null),g=d.useRef(null),{disabled:b,updateMeasurementsFor:h,timeout:f}={...lx,...n},y=Ft(h??a),j=d.useCallback(()=>{if(!m.current){m.current=!0;return}g.current!=null&&clearTimeout(g.current),g.current=setTimeout(()=>{u(Array.isArray(y.current)?y.current:[y.current]),g.current=null},f)},[f]),v=Zr({callback:j,disabled:b||!o}),k=d.useCallback((I,q)=>{v&&(q&&(v.unobserve(q),m.current=!1),I&&v.observe(I))},[v]),[C,z]=Nr(k),N=Ft(t);return d.useEffect(()=>{!v||!C.current||(v.disconnect(),m.current=!1,v.observe(C.current))},[C,v]),d.useEffect(()=>(l({type:fe.RegisterDroppable,element:{id:a,key:i,disabled:r,node:C,rect:p,data:N}}),()=>l({type:fe.UnregisterDroppable,key:i,id:a})),[a]),d.useEffect(()=>{r!==x.current.disabled&&(l({type:fe.SetDroppableDisabled,id:a,key:i,disabled:r}),x.current.disabled=r)},[a,i,r,l]),{active:o,rect:p,isOver:c?.id===a,node:C,over:c,setNodeRef:z}}function $a(s,t,r){const a=s.slice();return a.splice(r<0?a.length+r:r,0,a.splice(t,1)[0]),a}function dx(s,t){return s.reduce((r,a,n)=>{const i=t.get(a);return i&&(r[n]=i),r},Array(s.length))}function hr(s){return s!==null&&s>=0}function ux(s,t){if(s===t)return!0;if(s.length!==t.length)return!1;for(let r=0;r<s.length;r++)if(s[r]!==t[r])return!1;return!0}function mx(s){return typeof s=="boolean"?{draggable:s,droppable:s}:s}const Po=s=>{let{rects:t,activeIndex:r,overIndex:a,index:n}=s;const i=$a(t,a,r),o=t[n],l=i[n];return!l||!o?null:{x:l.left-o.left,y:l.top-o.top,scaleX:l.width/o.width,scaleY:l.height/o.height}},jr={scaleX:1,scaleY:1},xx=s=>{var t;let{activeIndex:r,activeNodeRect:a,index:n,rects:i,overIndex:o}=s;const l=(t=i[r])!=null?t:a;if(!l)return null;if(n===r){const u=i[o];return u?{x:0,y:r<o?u.top+u.height-(l.top+l.height):u.top-l.top,...jr}:null}const c=px(i,n,r);return n>r&&n<=o?{x:0,y:-l.height-c,...jr}:n<r&&n>=o?{x:0,y:l.height+c,...jr}:{x:0,y:0,...jr}};function px(s,t,r){const a=s[t],n=s[t-1],i=s[t+1];return a?r<t?n?a.top-(n.top+n.height):i?i.top-(a.top+a.height):0:i?i.top-(a.top+a.height):n?a.top-(n.top+n.height):0:0}const Ro="Sortable",Eo=W.createContext({activeIndex:-1,containerId:Ro,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Po,disabled:{draggable:!1,droppable:!1}});function hx(s){let{children:t,id:r,items:a,strategy:n=Po,disabled:i=!1}=s;const{active:o,dragOverlay:l,droppableRects:c,over:u,measureDroppableContainers:x}=nx(),m=sr(Ro,r),p=l.rect!==null,g=d.useMemo(()=>a.map(z=>typeof z=="object"&&"id"in z?z.id:z),[a]),b=o!=null,h=o?g.indexOf(o.id):-1,f=u?g.indexOf(u.id):-1,y=d.useRef(g),j=!ux(g,y.current),v=f!==-1&&h===-1||j,k=mx(i);vs(()=>{j&&b&&x(g)},[j,g,b,x]),d.useEffect(()=>{y.current=g},[g]);const C=d.useMemo(()=>({activeIndex:h,containerId:m,disabled:k,disableTransforms:v,items:g,overIndex:f,useDragOverlay:p,sortedRects:dx(g,c),strategy:n}),[h,m,k.draggable,k.droppable,v,g,f,c,p,n]);return W.createElement(Eo.Provider,{value:C},t)}const jx=s=>{let{id:t,items:r,activeIndex:a,overIndex:n}=s;return $a(r,a,n).indexOf(t)},gx=s=>{let{containerId:t,isSorting:r,wasDragging:a,index:n,items:i,newIndex:o,previousItems:l,previousContainerId:c,transition:u}=s;return!u||!a||l!==i&&n===o?!1:r?!0:o!==n&&t===c},fx={duration:200,easing:"ease"},Mo="transform",yx=Ut.Transition.toString({property:Mo,duration:0,easing:"linear"}),bx={roleDescription:"sortable"};function wx(s){let{disabled:t,index:r,node:a,rect:n}=s;const[i,o]=d.useState(null),l=d.useRef(r);return vs(()=>{if(!t&&r!==l.current&&a.current){const c=n.current;if(c){const u=yt(a.current,{ignoreTransform:!0}),x={x:c.left-u.left,y:c.top-u.top,scaleX:c.width/u.width,scaleY:c.height/u.height};(x.x||x.y)&&o(x)}}r!==l.current&&(l.current=r)},[t,r,a,n]),d.useEffect(()=>{i&&o(null)},[i]),i}function vx(s){let{animateLayoutChanges:t=gx,attributes:r,disabled:a,data:n,getNewIndex:i=jx,id:o,strategy:l,resizeObserverConfig:c,transition:u=fx}=s;const{items:x,containerId:m,activeIndex:p,disabled:g,disableTransforms:b,sortedRects:h,overIndex:f,useDragOverlay:y,strategy:j}=d.useContext(Eo),v=Nx(a,g),k=x.indexOf(o),C=d.useMemo(()=>({sortable:{containerId:m,index:k,items:x},...n}),[m,n,k,x]),z=d.useMemo(()=>x.slice(x.indexOf(o)),[x,o]),{rect:N,node:I,isOver:q,setNodeRef:P}=cx({id:o,data:C,disabled:v.droppable,resizeObserverConfig:{updateMeasurementsFor:z,...c}}),{active:B,activatorEvent:T,activeNodeRect:E,attributes:D,setNodeRef:ee,listeners:Pe,isDragging:ae,over:Y,setActivatorNodeRef:G,transform:_e}=ix({id:o,data:C,attributes:{...bx,...r},disabled:v.draggable}),Te=$u(P,ee),he=!!B,Fe=he&&!b&&hr(p)&&hr(f),ls=!y&&ae,Ps=ls&&Fe?_e:null,we=Fe?Ps??(l??j)({rects:h,activeNodeRect:E,activeIndex:p,overIndex:f,index:k}):null,cs=hr(p)&&hr(f)?i({id:o,items:x,activeIndex:p,overIndex:f}):k,ks=B?.id,re=d.useRef({activeId:ks,items:x,newIndex:cs,containerId:m}),Nt=x!==re.current.items,ps=t({active:B,containerId:m,isDragging:ae,isSorting:he,id:o,index:k,items:x,newIndex:re.current.newIndex,previousItems:re.current.items,previousContainerId:re.current.containerId,transition:u,wasDragging:re.current.activeId!=null}),rt=wx({disabled:!ps,index:k,node:I,rect:N});return d.useEffect(()=>{he&&re.current.newIndex!==cs&&(re.current.newIndex=cs),m!==re.current.containerId&&(re.current.containerId=m),x!==re.current.items&&(re.current.items=x)},[he,cs,m,x]),d.useEffect(()=>{if(ks===re.current.activeId)return;if(ks!=null&&re.current.activeId==null){re.current.activeId=ks;return}const at=setTimeout(()=>{re.current.activeId=ks},50);return()=>clearTimeout(at)},[ks]),{active:B,activeIndex:p,attributes:D,data:C,rect:N,index:k,newIndex:cs,items:x,isOver:q,isSorting:he,isDragging:ae,listeners:Pe,node:I,overIndex:f,over:Y,setNodeRef:Te,setActivatorNodeRef:G,setDroppableNodeRef:P,setDraggableNodeRef:ee,transform:rt??we,transition:Cs()};function Cs(){if(rt||Nt&&re.current.newIndex===k)return yx;if(!(ls&&!Ma(T)||!u)&&(he||ps))return Ut.Transition.toString({...u,property:Mo})}}function Nx(s,t){var r,a;return typeof s=="boolean"?{draggable:s,droppable:!1}:{draggable:(r=s?.draggable)!=null?r:t.draggable,droppable:(a=s?.droppable)!=null?a:t.droppable}}function Cr(s){if(!s)return!1;const t=s.data.current;return!!(t&&"sortable"in t&&typeof t.sortable=="object"&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const zx=[X.Down,X.Right,X.Up,X.Left],kx=(s,t)=>{let{context:{active:r,collisionRect:a,droppableRects:n,droppableContainers:i,over:o,scrollableAncestors:l}}=t;if(zx.includes(s.code)){if(s.preventDefault(),!r||!a)return;const c=[];i.getEnabled().forEach(m=>{if(!m||m!=null&&m.disabled)return;const p=n.get(m.id);if(p)switch(s.code){case X.Down:a.top<p.top&&c.push(m);break;case X.Up:a.top>p.top&&c.push(m);break;case X.Left:a.left>p.left&&c.push(m);break;case X.Right:a.left<p.left&&c.push(m);break}});const u=rm({collisionRect:a,droppableRects:n,droppableContainers:c});let x=yo(u,"id");if(x===o?.id&&u.length>1&&(x=u[1].id),x!=null){const m=i.get(r.id),p=i.get(x),g=p?n.get(p.id):null,b=p?.node.current;if(b&&g&&m&&p){const f=Kr(b).some((z,N)=>l[N]!==z),y=Lo(m,p),j=Cx(m,p),v=f||!y?{x:0,y:0}:{x:j?a.width-g.width:0,y:j?a.height-g.height:0},k={x:g.left,y:g.top};return v.x&&v.y?k:Wt(k,v)}}}};function Lo(s,t){return!Cr(s)||!Cr(t)?!1:s.data.current.sortable.containerId===t.data.current.sortable.containerId}function Cx(s,t){return!Cr(s)||!Cr(t)||!Lo(s,t)?!1:s.data.current.sortable.index<t.data.current.sortable.index}const Sx=()=>e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),_x=({course:s,topicsCount:t,activitiesCount:r,accessCount:a})=>e.jsxs(te,{variant:"2-2-4",children:[e.jsxs(S,{children:[e.jsx(A,{className:"pb-2",children:e.jsx(L,{className:"text-sm font-medium",children:"Status"})}),e.jsx(_,{children:e.jsx(H,{variant:s?.is_published?"default":"secondary",children:s?.is_published?"Opublikowany":"Szkic"})})]}),e.jsxs(S,{children:[e.jsx(A,{className:"pb-2",children:e.jsx(L,{className:"text-sm font-medium",children:"Tematy"})}),e.jsx(_,{children:e.jsx("div",{className:"text-2xl font-bold",children:t})})]}),e.jsxs(S,{children:[e.jsx(A,{className:"pb-2",children:e.jsx(L,{className:"text-sm font-medium",children:"Aktywności"})}),e.jsx(_,{children:e.jsx("div",{className:"text-2xl font-bold",children:r})})]}),e.jsxs(S,{children:[e.jsx(A,{className:"pb-2",children:e.jsx(L,{className:"text-sm font-medium",children:"Uczestników"})}),e.jsx(_,{children:e.jsx("div",{className:"text-2xl font-bold",children:a})})]})]}),Tx=({id:s,disabled:t=!1,children:r})=>{const{attributes:a,listeners:n,setNodeRef:i,transform:o,transition:l,isDragging:c}=vx({id:s,disabled:t}),u={transform:Ut.Transform.toString(o),transition:l,opacity:c?.5:1,cursor:c?"grabbing":"grab"},x=t?{}:{...a,...n,style:{cursor:c?"grabbing":"grab"}};return e.jsx("div",{ref:i,style:u,className:c?"z-50":"",children:r({dragHandleProps:x,isDragging:c})})},gi=({items:s,renderItem:t,onReorder:r,className:a="space-y-2",disabled:n=!1})=>{const[i,o]=d.useState(s),[l,c]=d.useState(null),[u,x]=d.useState(null);d.useEffect(()=>{if(!u)o(s);else{const b=i.map(h=>{const f=s.find(y=>y.id===h.id);return f?{...f,position:h.position}:h});o(b)}},[s]);const m=em(ai(Oa,{activationConstraint:{distance:8}}),ai(Aa,{coordinateGetter:kx})),p=b=>{c(Number(b.active.id))},g=b=>{const{active:h,over:f}=b;if(c(null),f&&h.id!==f.id){const y=i.findIndex(v=>v.id===Number(h.id)),j=i.findIndex(v=>v.id===Number(f.id));if(y!==-1&&j!==-1&&y!==j){let v;const k=i[y];if(j===0)v=i[0].position/2;else if(j===i.length-1)v=i[i.length-1].position+1e3;else if(y<j){const N=i[j],I=j+1<i.length?i[j+1]:null;I?v=(N.position+I.position)/2:v=N.position+1e3}else{const N=j>0?i[j-1]:null,I=i[j];N?v=(N.position+I.position)/2:v=I.position/2}const z=$a(i,y,j).map(N=>N.id===k.id?{...N,position:v}:N);o(z),x({id:k.id,position:v}),r(k.id,v),setTimeout(()=>x(null),2e3)}}};return e.jsx(tx,{sensors:m,collisionDetection:tm,onDragStart:p,onDragEnd:g,children:e.jsx(hx,{items:i.map(b=>b.id),strategy:xx,children:e.jsx("div",{className:a,children:i.map((b,h)=>e.jsx(Tx,{id:b.id,disabled:n||u!==null&&u.id!==b.id,children:f=>t(b,h,f.dragHandleProps)},b.id))})})})},Dx=()=>{const{list:s,edit:t}=Se(),{id:r}=Me(),[a,n]=Gt(),{navigateWithReturn:i,navigateToWizard:o}=Du(),{course:l,topics:c,stats:u,isLoading:x,refetchTopics:m,refetchActivities:p,getActivitiesForTopic:g}=Iu(r),{togglePublish:b}=da("topics"),{togglePublish:h}=da("activities"),{updatePosition:f,isUpdating:y}=ti("topics"),{updatePosition:j,isUpdating:v}=ti("activities"),{mutate:k}=ut(),{mutate:C}=ut(),z=a.get("expanded");if(x)return e.jsx(Sx,{});if(!l)return e.jsx(M,{children:e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Nie znaleziono kursu"})})});const N=T=>{z===T.toString()?(a.delete("expanded"),n(a)):n({expanded:T.toString()})},I=(T,E)=>{confirm(`Czy na pewno chcesz usunąć temat "${E}" wraz ze wszystkimi aktywnościami?`)&&k({resource:"topics",id:T},{onSuccess:()=>{F.success("Temat został usunięty"),m(),p(),z===T.toString()&&(a.delete("expanded"),n(a))}})},q=(T,E)=>{confirm(`Czy na pewno chcesz usunąć aktywność "${E}"?`)&&C({resource:"activities",id:T},{onSuccess:()=>{F.success("Aktywność została usunięta"),p(),m()}})},P=async(T,E)=>{try{await f(T,E)}catch(D){console.error("Failed to reorder topic:",D)}},B=async(T,E)=>{try{await j(T,E)}catch(D){console.error("Failed to reorder activity:",D)}};return e.jsxs(M,{children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>s("courses"),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Szczegóły kursu"}),e.jsxs(w,{onClick:()=>t("courses",l?.id??0),size:"sm",children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Edytuj kurs"]})]}),e.jsx(Ou,{course:l})]}),e.jsx(_x,{course:l,topicsCount:u.topicsCount,activitiesCount:u.activitiesCount,accessCount:u.accessCount}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsxs(R,{children:[e.jsxs(L,{className:"flex items-center gap-2",children:["Struktura kursu",(y||v)&&e.jsxs("span",{className:"text-sm font-normal text-muted-foreground flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),"Zapisywanie..."]})]}),e.jsxs(w,{size:"sm",onClick:()=>i(`/topics/create?course_id=${r}`),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Dodaj temat"]})]})}),e.jsx(_,{children:c.length>0?e.jsx(gi,{items:c,onReorder:P,disabled:y||v,renderItem:(T,E,D)=>{const ee=g(T.id),Pe=z===T.id.toString();return e.jsx(Au,{topic:{...T,position:E+1},isExpanded:Pe,onToggle:()=>N(T.id),onDelete:I,onEdit:(ae,Y)=>i(`/${ae}/edit/${Y}`),onTogglePublish:(ae,Y,G)=>b(ae,Y,G,m),activitiesCount:ee.length,onNavigateToWizard:o,courseId:Number(l?.id),courseTitle:l?.title,dragHandleProps:D,children:ee.length>0?e.jsx(gi,{items:ee,onReorder:B,disabled:v,renderItem:(ae,Y,G)=>e.jsx(qu,{activity:{...ae,position:Y+1},topicPosition:E+1,onDelete:q,onEdit:(_e,Te)=>i(`/${_e}/edit/${Te}`),onTogglePublish:(_e,Te,he)=>h(_e,Te,he,p),dragHandleProps:G},ae.id)}):e.jsxs("div",{className:"text-center py-6 text-muted-foreground",children:[e.jsx("p",{children:"Brak aktywności w tym temacie"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center mt-4",children:[e.jsxs(w,{size:"sm",variant:"outline",onClick:()=>i(`/activities/create?topic_id=${T.id}`),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Dodaj ręcznie"]}),e.jsxs(w,{size:"sm",onClick:()=>o("/educational-material/step1",{courseId:l?.id,courseTitle:l?.title,topicId:T.id,topicTitle:T.title}),children:[e.jsx(Os,{className:"w-4 h-4 mr-2"}),"Generuj materiał z AI"]}),e.jsxs(w,{size:"sm",variant:"secondary",onClick:()=>o("/quiz-wizard/step1",{courseId:l?.id,courseTitle:l?.title,topicId:T.id,topicTitle:T.title}),children:[e.jsx(Qs,{className:"w-4 h-4 mr-2"}),"Generuj quiz z AI"]})]})]})},T.id)}}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Ee,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Brak tematów w tym kursie"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center mt-4",children:[e.jsxs(w,{onClick:()=>i(`/topics/create?course_id=${r}`),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Dodaj pierwszy temat"]}),e.jsxs(w,{variant:"secondary",onClick:()=>o("/course-structure/step1",{courseId:l?.id,courseTitle:l?.title,mode:"extend"}),children:[e.jsx(Gs,{className:"w-4 h-4 mr-2"}),"Wygeneruj strukturę z AI"]})]})]})})]}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Grupy z dostępem"})}),e.jsx(_,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Ie,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Lista grup (do implementacji)"})]})})]}),e.jsxs(S,{className:"border-dashed border-2 bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-950/20 dark:to-blue-950/20",children:[e.jsx(A,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(Os,{className:"w-5 h-5 text-purple-600"}),"Szybkie akcje AI"]})}),e.jsx(_,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx(w,{variant:"outline",className:"justify-start h-auto py-3 px-4 bg-white dark:bg-background",onClick:()=>o("/course-structure/step1"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Gs,{className:"w-5 h-5 text-indigo-600 mt-0.5"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Rozbuduj strukturę kursu"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Dodaj nowe tematy z AI"})]})]})}),e.jsx(w,{variant:"outline",className:"justify-start h-auto py-3 px-4 bg-white dark:bg-background",onClick:()=>o("/educational-material/step1",{courseId:l?.id,courseTitle:l?.title}),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Lr,{className:"w-5 h-5 text-purple-600 mt-0.5"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Generuj materiał"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Stwórz treści z AI"})]})]})}),e.jsx(w,{variant:"outline",className:"justify-start h-auto py-3 px-4 bg-white dark:bg-background",onClick:()=>o("/quiz-wizard/step1",{courseId:l?.id,courseTitle:l?.title}),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Qs,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Stwórz quiz"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Quiz sprawdzający z AI"})]})]})})]})})]})]})},Ix={name:"courses",list:"/courses",create:"/courses/create",edit:"/courses/edit/:id",show:"/courses/show/:id",meta:{label:"Kursy",icon:e.jsx(ge,{className:"h-4 w-4"})}},Px=[e.jsx(O,{path:"/courses",element:e.jsx(Pu,{})},"courses-list"),e.jsx(O,{path:"/courses/create",element:e.jsx(Eu,{})},"courses-create"),e.jsx(O,{path:"/courses/edit/:id",element:e.jsx(Lu,{})},"courses-edit"),e.jsx(O,{path:"/courses/show/:id",element:e.jsx(Dx,{})},"courses-show")],Rx=()=>{const{show:s}=Se(),t=Q(),[r]=Gt(),a=r.get("course_id"),{data:n}=ze({resource:"courses",id:a,queryOptions:{enabled:!!a}}),{data:i,isLoading:o}=je({resource:"topics",filters:[{field:"course_id",operator:"eq",value:a}],sorters:[{field:"position",order:"desc"}],pagination:{pageSize:1},queryOptions:{enabled:!!a}}),{refineCore:{onFinish:l},register:c,handleSubmit:u,setValue:x,watch:m,formState:{errors:p,isSubmitting:g}}=Ns({defaultValues:{course_id:a?parseInt(a):void 0,is_published:!1,position:1},refineCoreProps:{successNotification:()=>({message:"Temat został utworzony",type:"success"}),redirect:!1,onMutationSuccess:()=>{a?s("courses",a):t("/courses")}}});d.useEffect(()=>{if(!o&&i&&i.data.length>0){const h=i.data[0].position+1;x("position",h)}},[i,o,x]);const b=()=>{a?s("courses",a):t("/courses")};return e.jsxs(M,{children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:b,children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Powrót do kursu"]}),e.jsx(R,{children:e.jsx(J,{title:"Dodaj temat",description:n?.data?`Do kursu: ${n.data.title}`:"Utwórz nowy temat"})}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Informacje o temacie"})}),e.jsx(_,{children:e.jsxs(ns,{onSubmit:u(l),children:[e.jsx("input",{type:"hidden",...c("course_id")}),e.jsx(Z,{label:"Tytuł tematu",htmlFor:"title",error:p.title?.message,required:!0,children:e.jsx($,{id:"title",placeholder:"np. Wprowadzenie do zmiennych",...c("title",{required:"Tytuł tematu jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),e.jsx(Z,{label:"Pozycja",htmlFor:"position",error:p.position?.message,required:!0,children:e.jsx($,{id:"position",type:"number",min:"1",disabled:!0,className:"bg-muted",...c("position",{required:"Pozycja jest wymagana",min:{value:1,message:"Pozycja musi być większa od 0"},valueAsNumber:!0})})}),e.jsx(Z,{label:"Status publikacji",children:e.jsxs(R,{variant:"start",children:[e.jsx(xs,{checked:m("is_published")||!1,onCheckedChange:h=>x("is_published",h)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Opublikuj temat od razu"})]})}),e.jsxs(os,{children:[e.jsx(w,{type:"button",variant:"outline",onClick:b,children:"Anuluj"}),e.jsx(w,{type:"submit",disabled:g||!a,children:g?"Tworzenie...":"Utwórz temat"})]})]})})]})]})},Xs=({variant:s="outline",size:t="sm",children:r="Powrót do kursu"})=>{const a=Q(),n=fa(),i=()=>{const l=new URLSearchParams(n.search).get("returnUrl");a(l?decodeURIComponent(l):-1)};return e.jsxs(w,{variant:s,size:t,onClick:i,children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),r]})},Ex=()=>{const{show:s}=Se(),{id:t}=Me(),r=Q(),{data:a,isLoading:n}=ze({resource:"topics",id:t,liveMode:"off"}),i=a?.data,o=i?.course_id,{refineCore:{onFinish:l},register:c,handleSubmit:u,setValue:x,watch:m,formState:{errors:p,isSubmitting:g}}=Ns({refineCoreProps:{resource:"topics",id:t,liveMode:"off",successNotification:()=>({message:"Temat został zaktualizowany",type:"success"}),redirect:!1,onMutationSuccess:()=>{const h=sessionStorage.getItem("returnUrl");h?(sessionStorage.removeItem("returnUrl"),r(h)):o&&r(`/courses/show/${o}?expanded=${t}`)}}}),b=()=>{const h=sessionStorage.getItem("returnUrl");h?(sessionStorage.removeItem("returnUrl"),r(h)):o?r(`/courses/show/${o}?expanded=${t}`):s("courses","")};return n?e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsxs(M,{children:[e.jsx(Xs,{}),e.jsx(R,{children:e.jsx(J,{title:"Edytuj temat",description:`Edycja: ${i?.title}`})}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Informacje o temacie"})}),e.jsx(_,{children:e.jsxs(ns,{onSubmit:u(l),children:[e.jsx(Z,{label:"Tytuł tematu",htmlFor:"title",error:p.title?.message,required:!0,children:e.jsx($,{id:"title",placeholder:"np. Wprowadzenie do zmiennych",...c("title",{required:"Tytuł tematu jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),e.jsx(Z,{label:"Pozycja",htmlFor:"position",error:p.position?.message,required:!0,children:e.jsx($,{id:"position",type:"number",min:"1",...c("position",{required:"Pozycja jest wymagana",min:{value:1,message:"Pozycja musi być większa od 0"},valueAsNumber:!0})})}),e.jsx(Z,{label:"Status publikacji",children:e.jsxs(R,{variant:"start",children:[e.jsx(xs,{checked:m("is_published")||!1,onCheckedChange:h=>x("is_published",h)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Temat jest opublikowany"})]})}),e.jsxs(os,{children:[e.jsx(w,{type:"button",variant:"outline",onClick:b,children:"Anuluj"}),e.jsx(w,{type:"submit",disabled:g,children:g?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},Mx={name:"topics",create:"/topics/create",edit:"/topics/edit/:id",meta:{label:"Tematy",icon:e.jsx(Ee,{className:"h-4 w-4"})}},Lx=[e.jsx(O,{path:"/topics/create",element:e.jsx(Rx,{})},"topics-create"),e.jsx(O,{path:"/topics/edit/:id",element:e.jsx(Ex,{})},"topics-edit")],Ax=()=>{const{show:s}=Se(),t=Q(),[r]=Gt(),a=r.get("topic_id"),{data:n}=ze({resource:"topics",id:a,meta:{select:"*, courses(*)"},queryOptions:{enabled:!!a}}),{data:i,isLoading:o}=je({resource:"activities",filters:[{field:"topic_id",operator:"eq",value:a}],sorters:[{field:"position",order:"desc"}],pagination:{pageSize:1},queryOptions:{enabled:!!a}}),{refineCore:{onFinish:l},register:c,handleSubmit:u,setValue:x,watch:m,formState:{errors:p,isSubmitting:g}}=Ns({defaultValues:{topic_id:a?parseInt(a):void 0,type:"material",is_published:!1,position:1,passing_score:70},refineCoreProps:{successNotification:!1,redirect:!1,onMutationSuccess:f=>{const y=n?.data?.course_id,j=f.data.type;if(F.success("Aktywność została utworzona"),j==="quiz")F.info("Dodaj pytania do quizu"),t(`/questions/manage/${f.data.id}`);else{const v=sessionStorage.getItem("returnUrl");v?(sessionStorage.removeItem("returnUrl"),t(v)):t(y?`/courses/show/${y}?expanded=${a}`:"/courses")}}}}),b=m("type");d.useEffect(()=>{if(!o&&i&&i.data.length>0){const f=i.data[0].position+1;x("position",f)}},[i,o,x]);const h=()=>{const f=sessionStorage.getItem("returnUrl");f?(sessionStorage.removeItem("returnUrl"),t(f)):n?.data?.course_id?t(`/courses/show/${n.data.course_id}?expanded=${a}`):t("/courses")};return n?.data?.course_id,a?e.jsxs(M,{children:[e.jsx(Xs,{}),e.jsx(R,{children:e.jsx(J,{title:"Dodaj aktywność",description:n?.data?e.jsxs("div",{children:[e.jsx("div",{className:"text-lg",children:n.data.courses?.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Temat ",n.data.position,": ",n.data.title]})]}):"Utwórz nowy materiał lub quiz"})}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Informacje o aktywności"})}),e.jsx(_,{children:e.jsxs(ns,{onSubmit:u(l),children:[e.jsx("input",{type:"hidden",...c("topic_id")}),e.jsxs(te,{variant:"1-2-2",children:[e.jsx(Z,{label:"Typ aktywności",error:p.type?.message,required:!0,children:e.jsxs(xe,{value:b,onValueChange:f=>x("type",f),children:[e.jsx(de,{children:e.jsx(pe,{placeholder:"Wybierz typ"})}),e.jsxs(ue,{children:[e.jsx(U,{value:"material",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-4 h-4"}),"Materiał"]})}),e.jsx(U,{value:"quiz",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"w-4 h-4"}),"Quiz"]})})]})]})}),e.jsx(Z,{label:"Tytuł",htmlFor:"title",error:p.title?.message,required:!0,children:e.jsx($,{id:"title",placeholder:b==="quiz"?"np. Test wiedzy z rozdziału":"np. Wprowadzenie do tematu",...c("title",{required:"Tytuł jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),e.jsx(Z,{label:"Pozycja w temacie",htmlFor:"position",error:p.position?.message,required:!0,children:e.jsx($,{id:"position",type:"number",min:"1",disabled:!0,className:"bg-muted",...c("position",{required:"Pozycja jest wymagana",min:{value:1,message:"Pozycja musi być większa od 0"},valueAsNumber:!0})})}),e.jsx(Z,{label:"Czas trwania (min)",htmlFor:"duration_min",hint:"Szacowany czas potrzebny na ukończenie",children:e.jsx($,{id:"duration_min",type:"number",min:"1",placeholder:"np. 15",...c("duration_min",{min:{value:1,message:"Czas musi być większy od 0"},valueAsNumber:!0})})})]}),b==="material"&&e.jsx(Z,{label:"Treść materiału",htmlFor:"content",error:p.content?.message,required:!0,hint:"Możesz używać formatowania Markdown",children:e.jsx(as,{id:"content",placeholder:"Wprowadź treść materiału edukacyjnego...",rows:10,...c("content",{required:b==="material"?"Treść jest wymagana dla materiału":!1})})}),b==="quiz"&&e.jsxs(e.Fragment,{children:[e.jsxs(te,{variant:"1-1-1",children:[e.jsx(Z,{label:"Próg zaliczenia (%)",htmlFor:"passing_score",error:p.passing_score?.message,hint:"Minimalny wynik do zaliczenia",children:e.jsx($,{id:"passing_score",type:"number",min:"0",max:"100",...c("passing_score",{min:{value:0,message:"Wartość minimalna to 0"},max:{value:100,message:"Wartość maksymalna to 100"},valueAsNumber:!0})})}),e.jsx(Z,{label:"Limit czasu (min)",htmlFor:"time_limit",hint:"Pozostaw puste dla braku limitu",children:e.jsx($,{id:"time_limit",type:"number",min:"1",placeholder:"Brak limitu",...c("time_limit",{min:{value:1,message:"Limit musi być większy od 0"},valueAsNumber:!0})})}),e.jsx(Z,{label:"Maksymalna liczba prób",htmlFor:"max_attempts",hint:"Pozostaw puste dla nieograniczonej liczby",children:e.jsx($,{id:"max_attempts",type:"number",min:"1",placeholder:"Bez limitu",...c("max_attempts",{min:{value:1,message:"Minimum 1 próba"},valueAsNumber:!0})})})]}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{className:"text-blue-700 dark:text-blue-300",children:"💡 Wskazówka:"})," ",e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Po utworzeniu quizu zostaniesz przekierowany do ekranu dodawania pytań."})]})})]}),e.jsx(Z,{label:"Status publikacji",children:e.jsxs(R,{variant:"start",children:[e.jsx(xs,{checked:m("is_published")||!1,onCheckedChange:f=>x("is_published",f)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Opublikuj aktywność od razu (uczniowie będą mogli ją zobaczyć)"})]})}),e.jsxs(os,{children:[e.jsx(w,{type:"button",variant:"outline",onClick:h,disabled:g,children:"Anuluj"}),e.jsx(w,{type:"submit",disabled:g||!a,children:g?"Tworzenie...":b==="quiz"?"Utwórz i dodaj pytania":"Utwórz aktywność"})]})]})})]})]}):e.jsx(M,{children:e.jsx(S,{children:e.jsxs(_,{className:"text-center py-12",children:[e.jsx("p",{className:"text-lg font-medium text-muted-foreground mb-4",children:"Nie wybrano tematu"}),e.jsx(w,{onClick:()=>t("/courses"),children:"Przejdź do kursów"})]})})})},qx=()=>{const{list:s}=Se(),{id:t}=Me(),r=Q(),{data:a,isLoading:n}=ze({resource:"activities",id:t,liveMode:"off",meta:{select:"*, topics(*, courses(*))"}}),{data:i}=ze({resource:"questions",id:t,meta:{select:"count",filter:`activity_id.eq.${t}`},queryOptions:{enabled:!!t&&a?.data?.type==="quiz"}}),{refineCore:{onFinish:o,formLoading:l},register:c,handleSubmit:u,setValue:x,watch:m,reset:p,formState:{errors:g,isSubmitting:b}}=Ns({refineCoreProps:{resource:"activities",id:t,liveMode:"off",redirect:!1,successNotification:!1,onMutationSuccess:()=>{const q=a?.data?.topics?.course_id,P=a?.data?.topic_id;F.success("Aktywność została zaktualizowana");const B=sessionStorage.getItem("returnUrl");B?(sessionStorage.removeItem("returnUrl"),r(B)):q?r(`/courses/show/${q}?expanded=${P}`):s("activities")},onMutationError:q=>{console.error("Błąd podczas aktualizacji:",q),q?.code==="PGRST204"?F.error("Błąd konfiguracji - skontaktuj się z administratorem"):q?.code==="23505"?F.error("Aktywność o tej pozycji już istnieje w tym temacie"):q?.code==="23503"?F.error("Nieprawidłowe powiązanie z tematem"):q?.message?F.error(`Błąd: ${q.message}`):F.error("Wystąpił nieoczekiwany błąd. Spróbuj ponownie.")}}});d.useEffect(()=>{if(a?.data){const{topics:q,_count:P,questions:B,...T}=a.data;p(T)}},[a,p]);const h=m("type")||a?.data?.type||"material";if(n||l)return e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const f=a?.data,y=f?.topics,j=y?.courses,v=j?.id,k=f?.topic_id,C=()=>{const q=sessionStorage.getItem("returnUrl");q?(sessionStorage.removeItem("returnUrl"),r(q)):v?r(`/courses/show/${v}?expanded=${k}`):s("activities")},z=()=>h==="quiz"?e.jsx(rs,{className:"w-6 h-6 text-blue-500"}):e.jsx(Ee,{className:"w-6 h-6 text-green-500"}),N=()=>{const q=window.location.pathname+window.location.search;sessionStorage.setItem("returnUrl",q),r(`/questions/manage/${f?.id}`)},I=i?.data?.[0]?.count||0;return e.jsxs(M,{children:[e.jsx(Xs,{}),e.jsxs(R,{children:[e.jsx(J,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[z(),"Edytuj aktywność"]}),description:e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-medium",children:f?.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[j?.title," → Temat ",y?.position,": ",y?.title]})]})}),h==="quiz"&&e.jsxs(w,{onClick:N,variant:"outline",children:[e.jsx(Ks,{className:"w-4 h-4 mr-2"}),"Zarządzaj pytaniami (",I,")"]})]}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Informacje o aktywności"})}),e.jsx(_,{children:e.jsxs(ns,{onSubmit:u(o),children:[e.jsxs(te,{variant:"1-2-2",children:[e.jsxs(Z,{label:"Typ aktywności",error:g.type?.message,required:!0,children:[e.jsxs(xe,{value:h,disabled:!0,children:[e.jsx(de,{className:"bg-muted",children:e.jsx(pe,{placeholder:"Wybierz typ"})}),e.jsxs(ue,{children:[e.jsx(U,{value:"material",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-4 h-4"}),"Materiał"]})}),e.jsx(U,{value:"quiz",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"w-4 h-4"}),"Quiz"]})})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Typ aktywności nie może być zmieniony"})]}),e.jsx(Z,{label:"Tytuł",htmlFor:"title",error:g.title?.message,required:!0,children:e.jsx($,{id:"title",placeholder:h==="quiz"?"np. Test wiedzy":"np. Wprowadzenie",...c("title",{required:"Tytuł jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),e.jsx(Z,{label:"Pozycja w temacie",htmlFor:"position",error:g.position?.message,required:!0,children:e.jsx($,{id:"position",type:"number",min:"1",...c("position",{required:"Pozycja jest wymagana",min:{value:1,message:"Pozycja musi być większa od 0"},valueAsNumber:!0})})}),e.jsx(Z,{label:"Czas trwania (min)",htmlFor:"duration_min",hint:"Szacowany czas potrzebny na ukończenie",children:e.jsx($,{id:"duration_min",type:"number",min:"1",placeholder:"np. 15",...c("duration_min",{min:{value:1,message:"Czas musi być większy od 0"},valueAsNumber:!0})})})]}),h==="material"&&e.jsx(Z,{label:"Treść materiału",htmlFor:"content",error:g.content?.message,required:!0,hint:"Możesz używać formatowania Markdown",children:e.jsx(as,{id:"content",placeholder:"Wprowadź treść materiału...",rows:10,...c("content",{required:h==="material"?"Treść jest wymagana dla materiału":!1})})}),h==="quiz"&&e.jsxs(e.Fragment,{children:[e.jsxs(te,{variant:"1-1-1",children:[e.jsx(Z,{label:"Próg zaliczenia (%)",htmlFor:"passing_score",error:g.passing_score?.message,hint:"Minimalny wynik do zaliczenia",children:e.jsx($,{id:"passing_score",type:"number",min:"0",max:"100",...c("passing_score",{min:{value:0,message:"Wartość minimalna to 0"},max:{value:100,message:"Wartość maksymalna to 100"},valueAsNumber:!0})})}),e.jsx(Z,{label:"Limit czasu (min)",htmlFor:"time_limit",hint:"Pozostaw puste dla braku limitu",children:e.jsx($,{id:"time_limit",type:"number",min:"1",placeholder:"Brak limitu",...c("time_limit",{min:{value:1,message:"Limit musi być większy od 0"},valueAsNumber:!0})})}),e.jsx(Z,{label:"Maksymalna liczba prób",htmlFor:"max_attempts",hint:"Pozostaw puste dla nieograniczonej liczby",children:e.jsx($,{id:"max_attempts",type:"number",min:"1",placeholder:"Bez limitu",...c("max_attempts",{min:{value:1,message:"Minimum 1 próba"},valueAsNumber:!0})})})]}),I>0&&e.jsx(S,{className:"mt-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800",children:e.jsx(_,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:["Ten quiz zawiera ",I," ",I===1?"pytanie":"pytań"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Możesz zarządzać pytaniami klikając przycisk powyżej"})]}),e.jsx(H,{variant:"outline",className:"text-lg px-3 py-1",children:I})]})})})]}),e.jsx(Z,{label:"Status publikacji",children:e.jsxs(R,{variant:"start",children:[e.jsx(xs,{checked:m("is_published")||!1,onCheckedChange:q=>x("is_published",q)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Aktywność jest opublikowana (uczniowie mogą ją zobaczyć)"})]})}),e.jsxs(os,{children:[e.jsx(w,{type:"button",variant:"outline",onClick:C,disabled:b,children:"Anuluj"}),e.jsx(w,{type:"submit",disabled:b,children:b?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},Ox=({activity:s})=>e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1fr,300px]",children:[e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Treść materiału"})}),e.jsx(_,{children:s.content?e.jsx("div",{className:"prose max-w-none",children:e.jsx(fr,{children:s.content})}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Ee,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Brak treści materiału"})]})})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs(S,{children:[e.jsx(A,{className:"pb-3",children:e.jsx(L,{className:"text-base",children:"Informacje"})}),e.jsxs(_,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(is,{className:"w-4 h-4"}),"Czas trwania"]}),e.jsxs("p",{className:"font-medium",children:[s.duration_min||"-"," minut"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(uc,{className:"w-4 h-4"}),"Pozycja w temacie"]}),e.jsx("p",{className:"font-medium",children:s.position})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(Fs,{className:"w-4 h-4"}),"Data utworzenia"]}),e.jsx("p",{className:"font-medium",children:new Date(s.created_at).toLocaleDateString("pl-PL")})]}),s.updated_at&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(Fs,{className:"w-4 h-4"}),"Ostatnia aktualizacja"]}),e.jsx("p",{className:"font-medium",children:new Date(s.updated_at).toLocaleDateString("pl-PL")})]})]})]})})]}),$x=({activity:s,questionsCount:t,questionsData:r,questionsLoading:a,onNavigateToQuestions:n})=>{const i=r?.reduce((l,c)=>l+(c.points||0),0)||0,o=Math.ceil((s.passing_score||70)/100*i);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Parametry quizu"})}),e.jsx(_,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(is,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Czas trwania"})]}),e.jsxs("p",{className:"text-2xl font-bold",children:[s.duration_min||"-"," min"]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ws,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Próg zaliczenia"})]}),e.jsxs("p",{className:"text-2xl font-bold",children:[s.passing_score||70,"%"]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(mc,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Limit czasu"})]}),e.jsx("p",{className:"text-2xl font-bold",children:s.time_limit?`${s.time_limit} min`:"Brak"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Zt,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Liczba prób"})]}),e.jsx("p",{className:"text-2xl font-bold",children:s.max_attempts||"Bez limitu"})]})]})})]}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsxs(L,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Pytania (",t,")"]}),t>0&&e.jsxs(w,{size:"sm",variant:"outline",onClick:()=>n(s.id),children:[e.jsx(ms,{className:"w-3 h-3 mr-1"}),"Zarządzaj"]})]})}),e.jsx(_,{children:t===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(rs,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground/30"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground mb-2",children:"Ten quiz nie ma jeszcze pytań"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Dodaj pytania, aby uczniowie mogli rozwiązać quiz"}),e.jsxs(w,{onClick:()=>n(s.id),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Dodaj pierwsze pytanie"]})]}):a?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})}):e.jsx("div",{className:"space-y-2",children:r?.map((l,c)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg border bg-card hover:bg-muted/50 transition-colors",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-sm font-semibold",children:c+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[l.type==="single_choice"&&e.jsxs(H,{variant:"outline",className:"text-xs",children:[e.jsx(Is,{className:"w-3 h-3 mr-1"}),"Jednokrotny wybór"]}),l.type==="multiple_choice"&&e.jsxs(H,{variant:"outline",className:"text-xs",children:[e.jsx(Ks,{className:"w-3 h-3 mr-1"}),"Wielokrotny wybór"]}),l.type==="true_false"&&e.jsxs(H,{variant:"outline",className:"text-xs",children:[e.jsx(qt,{className:"w-3 h-3 mr-1"}),"Prawda/Fałsz"]}),e.jsxs(H,{variant:"secondary",className:"text-xs",children:[l.points," pkt"]})]}),e.jsx("p",{className:"text-sm font-medium line-clamp-2",children:l.content}),l.explanation&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-1",children:[e.jsx("span",{className:"font-medium",children:"Wyjaśnienie:"})," ",l.explanation]})]})]},l.id))})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(S,{children:[e.jsx(A,{className:"pb-3",children:e.jsx(L,{className:"text-base",children:"Statystyki"})}),e.jsx(_,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Liczba pytań"}),e.jsx("span",{className:"font-medium",children:t})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Maksymalna liczba punktów"}),e.jsx("span",{className:"font-medium",children:i})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Wymagane punkty do zaliczenia"}),e.jsx("span",{className:"font-medium",children:o})]})]})})]}),e.jsxs(S,{children:[e.jsx(A,{className:"pb-3",children:e.jsx(L,{className:"text-base",children:"Informacje"})}),e.jsx(_,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Pozycja w temacie"}),e.jsx("span",{className:"font-medium",children:s.position})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Data utworzenia"}),e.jsx("span",{className:"font-medium",children:new Date(s.created_at).toLocaleDateString("pl-PL")})]}),s.updated_at&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ostatnia aktualizacja"}),e.jsx("span",{className:"font-medium",children:new Date(s.updated_at).toLocaleDateString("pl-PL")})]})]})})]})]})]})},Fx=()=>{const{edit:s}=Se(),{id:t}=Me(),r=Q(),{data:a,isLoading:n}=ze({resource:"activities",id:t,meta:{select:"*, topics(*, courses(*)), questions:questions(count)"}}),{data:i,isLoading:o}=je({resource:"questions",filters:[{field:"activity_id",operator:"eq",value:parseInt(t)}],sorters:[{field:"position",order:"asc"}],queryOptions:{enabled:a?.data?.type==="quiz"&&!!t}});if(n)return e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const l=a?.data;if(!l)return e.jsx(M,{children:e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Nie znaleziono aktywności"})})});const c=l.topics,u=c?.courses,x=l.questions?.[0]?.count||l._count?.questions||0,m=()=>{const h=window.location.pathname+window.location.search;sessionStorage.setItem("returnUrl",h),s("activities",l.id??"")},p=h=>{const f=window.location.pathname+window.location.search;sessionStorage.setItem("returnUrl",f),r(h)},g=()=>l.type==="quiz"?e.jsx(rs,{className:"w-5 h-5"}):e.jsx(Ee,{className:"w-5 h-5"}),b=()=>l.type==="quiz"?"text-blue-500":"text-green-500";return e.jsxs(M,{children:[e.jsx(Xs,{}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:[u?.title," → Temat ",c?.position,": ",c?.title]}),e.jsxs(R,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg bg-muted ${b()}`,children:g()}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:l.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(H,{variant:l.type==="quiz"?"default":"secondary",children:l.type==="quiz"?"Quiz":"Materiał"}),e.jsx(H,{variant:l.is_published?"default":"outline",children:l.is_published?e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-3 h-3 mr-1"})," Opublikowany"]}):e.jsxs(e.Fragment,{children:[e.jsx(Er,{className:"w-3 h-3 mr-1"})," Szkic"]})})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[l.type==="quiz"&&e.jsxs(w,{variant:"outline",onClick:()=>p(`/questions/manage/${l.id}`),children:[e.jsx(Ks,{className:"w-4 h-4 mr-2"}),"Zarządzaj pytaniami (",x,")"]}),e.jsxs(w,{onClick:m,children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Edytuj"]})]})]})]}),l.type==="material"?e.jsx(Ox,{activity:l}):e.jsx($x,{activity:l,questionsCount:x,questionsData:i?.data,questionsLoading:o,onNavigateToQuestions:h=>p(`/questions/manage/${h}`)})]})},Wx={name:"activities",create:"/activities/create",edit:"/activities/edit/:id",show:"/activities/show/:id",meta:{label:"Aktywności",parent:"topics"}},Ux=[e.jsx(O,{path:"/activities/create",element:e.jsx(Ax,{})},"activities-create"),e.jsx(O,{path:"/activities/edit/:id",element:e.jsx(qx,{})},"activities-edit"),e.jsx(O,{path:"/activities/show/:id",element:e.jsx(Fx,{})},"activities-show")],Bx=()=>{const{activityId:s}=Me();Q();const[t,r]=d.useState(null),[a,n]=d.useState(!1),{data:i,isLoading:o}=ze({resource:"activities",id:s,meta:{select:"*, topics(*, courses(*))"}}),{data:l,isLoading:c,refetch:u}=je({resource:"questions",filters:[{field:"activity_id",operator:"eq",value:parseInt(s)}],sorters:[{field:"position",order:"asc"}],pagination:{mode:"off"}}),{mutate:x}=_s(),{mutate:m}=ya(),{mutate:p}=ut();if(o||c)return e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const g=i?.data,b=l?.data||[];return e.jsxs(M,{children:[e.jsx(Xs,{}),e.jsxs(R,{children:[e.jsx(J,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"w-6 h-6 text-blue-500"}),"Pytania quizu"]}),description:e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-medium",children:g?.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[g?.topics?.courses?.title," → Temat"," ",g?.topics?.position,": ",g?.topics?.title]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(H,{variant:"outline",className:"text-base px-3 py-1",children:[b.length," ",b.length===1?"pytanie":"pytań"]}),e.jsxs(w,{onClick:()=>n(!0),disabled:a,children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Dodaj pytanie"]})]})]}),e.jsx(S,{className:"bg-muted/50",children:e.jsx(_,{className:"pt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Próg zaliczenia:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[g?.passing_score||70,"%"]})]}),g?.time_limit&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Limit czasu:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[g.time_limit," min"]})]}),g?.max_attempts&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Max. prób:"}),e.jsx("span",{className:"ml-2 font-medium",children:g.max_attempts})]})]})})}),a&&e.jsx(fi,{activityId:parseInt(s),position:b.length+1,onSave:h=>{x({resource:"questions",values:h},{onSuccess:()=>{F.success("Pytanie zostało dodane"),n(!1),u()}})},onCancel:()=>n(!1)}),e.jsx("div",{className:"space-y-4",children:b.map(h=>e.jsx("div",{children:t===h.id?e.jsx(fi,{question:h,activityId:parseInt(s),position:h.position,onSave:f=>{m({resource:"questions",id:h.id,values:f},{onSuccess:()=>{F.success("Pytanie zostało zaktualizowane"),r(null),u()}})},onCancel:()=>r(null)}):e.jsxs(S,{children:[e.jsx(A,{children:e.jsxs(R,{children:[e.jsxs(L,{className:"text-base",children:[e.jsxs("span",{className:"text-muted-foreground mr-2",children:["#",h.position]}),h.question]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(H,{variant:"outline",children:[h.points," pkt"]}),e.jsx(w,{variant:"outline",size:"sm",onClick:()=>r(h.id),children:e.jsx(ms,{className:"w-3 h-3"})}),e.jsx(w,{variant:"outline",size:"sm",onClick:()=>{confirm("Czy na pewno chcesz usunąć to pytanie?")&&p({resource:"questions",id:h.id},{onSuccess:()=>{F.success("Pytanie zostało usunięte"),u()}})},children:e.jsx($s,{className:"w-3 h-3 text-red-600"})})]})]})}),e.jsxs(_,{children:[e.jsx("div",{className:"space-y-2",children:h.options.map((f,y)=>e.jsxs("div",{className:`flex items-center gap-2 p-2 rounded ${f.is_correct?"bg-green-50 dark:bg-green-950/30 border border-green-200 dark:border-green-800":""}`,children:[f.is_correct?e.jsx(Re,{className:"w-4 h-4 text-green-600"}):e.jsx(He,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:f.is_correct?"font-medium":"",children:f.text})]},f.id||y))}),h.explanation&&e.jsxs("div",{className:"mt-4 p-3 bg-muted rounded",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Wyjaśnienie:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:h.explanation})]})]})]})},h.id))}),b.length===0&&!a&&e.jsx(S,{children:e.jsxs(_,{className:"text-center py-12",children:[e.jsx(rs,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground/50"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground mb-4",children:"Quiz nie ma jeszcze żadnych pytań"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Dodaj pierwsze pytanie, aby uczniowie mogli rozwiązać quiz"}),e.jsxs(w,{onClick:()=>n(!0),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Dodaj pierwsze pytanie"]})]})}),b.length>0&&e.jsxs("div",{className:"flex justify-between items-center pt-6 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Łącznie punktów: ",b.reduce((h,f)=>h+f.points,0)]}),e.jsx(Xs,{variant:"outline",children:"Zakończ edycję"})]})]})},fi=({question:s,activityId:t,position:r,onSave:a,onCancel:n})=>{const[i,o]=d.useState({question:s?.question||"",explanation:s?.explanation||"",points:s?.points||1,position:r,options:s?.options||[{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1}]}),l=()=>{if(!i.question.trim()){F.error("Pytanie jest wymagane");return}const x=i.options.filter(p=>p.text.trim());if(x.length<2){F.error("Dodaj przynajmniej 2 odpowiedzi");return}if(x.filter(p=>p.is_correct).length===0){F.error("Zaznacz przynajmniej jedną poprawną odpowiedź");return}a({activity_id:t,question:i.question,explanation:i.explanation||null,points:i.points,position:i.position,options:x.map((p,g)=>({...p,position:g+1}))})},c=()=>{i.options.length<6&&o({...i,options:[...i.options,{text:"",is_correct:!1}]})},u=x=>{if(i.options.length>2){const m=i.options.filter((p,g)=>g!==x);o({...i,options:m})}};return e.jsxs(S,{className:"border-primary",children:[e.jsx(A,{children:e.jsx(L,{children:s?"Edytuj pytanie":"Nowe pytanie"})}),e.jsxs(_,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Treść pytania"}),e.jsx(as,{placeholder:"Wprowadź treść pytania...",value:i.question,onChange:x=>o({...i,question:x.target.value}),className:"mt-1",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Liczba punktów"}),e.jsx($,{type:"number",min:"1",value:i.points,onChange:x=>o({...i,points:parseInt(x.target.value)||1}),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Pozycja"}),e.jsx($,{type:"number",min:"1",value:i.position,onChange:x=>o({...i,position:parseInt(x.target.value)||1}),className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Odpowiedzi"}),i.options.length<6&&e.jsxs(w,{type:"button",size:"sm",variant:"outline",onClick:c,children:[e.jsx(Ne,{className:"w-3 h-3 mr-1"}),"Dodaj opcję"]})]}),e.jsx("div",{className:"space-y-2",children:i.options.map((x,m)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ve,{checked:x.is_correct,onCheckedChange:p=>{const g=[...i.options];g[m].is_correct=p,o({...i,options:g})}}),e.jsx($,{placeholder:`Odpowiedź ${m+1}`,value:x.text,onChange:p=>{const g=[...i.options];g[m].text=p.target.value,o({...i,options:g})},className:"flex-1"}),i.options.length>2&&e.jsx(w,{type:"button",variant:"ghost",size:"sm",onClick:()=>u(m),children:e.jsx(He,{className:"w-4 h-4"})})]},m))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Zaznacz checkbox przy poprawnych odpowiedziach. Możesz zaznaczyć więcej niż jedną."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Wyjaśnienie (opcjonalne)"}),e.jsx(as,{placeholder:"Wyjaśnienie poprawnej odpowiedzi...",value:i.explanation,onChange:x=>o({...i,explanation:x.target.value}),className:"mt-1",rows:3})]}),e.jsxs(R,{children:[e.jsxs(w,{variant:"outline",onClick:n,children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),"Anuluj"]}),e.jsxs(w,{onClick:l,children:[e.jsx(Qt,{className:"w-4 h-4 mr-2"}),"Zapisz pytanie"]})]})]})]})},Gx=()=>{const[s]=Gt(),t=Q(),r=s.get("activity_id"),{data:a,isLoading:n}=je({resource:"questions",filters:[{field:"activity_id",operator:"eq",value:parseInt(r)}],sorters:[{field:"position",order:"desc"}],pagination:{mode:"off"}}),[i,o]=d.useState({question:"",explanation:"",points:1,position:1,options:[{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1}]});d.useEffect(()=>{if(a?.data){const h=a.data.reduce((f,y)=>Math.max(f,y.position||0),0);o(f=>({...f,position:h+1}))}},[a]);const{data:l,isLoading:c}=ze({resource:"activities",id:r,meta:{select:"*, topics(*, courses(*))"}}),{mutate:u,isLoading:x}=_s();if(!r)return e.jsx(M,{children:e.jsx(S,{children:e.jsx(_,{className:"text-center py-12",children:e.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:"Brak ID aktywności"})})})});if(c||n)return e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const m=l?.data;if(!m||m.type!=="quiz")return e.jsx(M,{children:e.jsx(S,{children:e.jsx(_,{className:"text-center py-12",children:e.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:"Nieprawidłowa aktywność lub aktywność nie jest quizem"})})})});const p=()=>{if(!i.question.trim()){F.error("Pytanie jest wymagane");return}const h=i.options.filter(y=>y.text.trim());if(h.length<2){F.error("Dodaj przynajmniej 2 odpowiedzi");return}if(h.filter(y=>y.is_correct).length===0){F.error("Zaznacz przynajmniej jedną poprawną odpowiedź");return}u({resource:"questions",values:{activity_id:parseInt(r),question:i.question,explanation:i.explanation||null,points:i.points,position:i.position,options:h.map((y,j)=>({id:j+1,text:y.text,is_correct:y.is_correct}))}},{onSuccess:()=>{F.success("Pytanie zostało dodane"),t(`/questions/manage/${r}`)},onError:y=>{console.error("Błąd podczas dodawania pytania:",y);const j=y?.code||y?.statusCode,v=y?.message||y?.error?.message;j==="23505"||j===23505?v?.includes("position")?F.error("Pytanie o tej pozycji już istnieje. Zmień pozycję na inną wartość."):F.error("Wystąpił konflikt z istniejącymi danymi. Sprawdź pozycję pytania."):j==="23503"||j===23503?F.error("Nieprawidłowe powiązanie z aktywnością."):j==="22P02"||j===22002?F.error("Nieprawidłowy format danych."):v?F.error(`Błąd: ${v}`):F.error("Wystąpił nieoczekiwany błąd. Spróbuj ponownie.")}})},g=()=>{i.options.length<6&&o({...i,options:[...i.options,{text:"",is_correct:!1}]})},b=h=>{if(i.options.length>2){const f=i.options.filter((y,j)=>j!==h);o({...i,options:f})}};return e.jsxs(M,{children:[e.jsx(Xs,{}),e.jsx(R,{children:e.jsx(J,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"w-6 h-6 text-blue-500"}),"Dodaj pytanie do quizu"]}),description:e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-medium",children:m?.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[m?.topics?.courses?.title," → Temat"," ",m?.topics?.position,": ",m?.topics?.title]})]})})}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Nowe pytanie"})}),e.jsxs(_,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Treść pytania"}),e.jsx(as,{placeholder:"Wprowadź treść pytania...",value:i.question,onChange:h=>o({...i,question:h.target.value}),className:"mt-1",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Liczba punktów"}),e.jsx($,{type:"number",min:"1",value:i.points,onChange:h=>o({...i,points:parseInt(h.target.value)||1}),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Pozycja"}),e.jsx($,{type:"number",min:"1",value:i.position,onChange:h=>o({...i,position:parseInt(h.target.value)||1}),className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Odpowiedzi"}),i.options.length<6&&e.jsxs(w,{type:"button",size:"sm",variant:"outline",onClick:g,children:[e.jsx(Ne,{className:"w-3 h-3 mr-1"}),"Dodaj opcję"]})]}),e.jsx("div",{className:"space-y-2",children:i.options.map((h,f)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ve,{checked:h.is_correct,onCheckedChange:y=>{const j=[...i.options];j[f].is_correct=y,o({...i,options:j})}}),e.jsx($,{placeholder:`Odpowiedź ${f+1}`,value:h.text,onChange:y=>{const j=[...i.options];j[f].text=y.target.value,o({...i,options:j})},className:"flex-1"}),i.options.length>2&&e.jsx(w,{type:"button",variant:"ghost",size:"sm",onClick:()=>b(f),children:e.jsx(He,{className:"w-4 h-4"})})]},f))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Zaznacz checkbox przy poprawnych odpowiedziach. Możesz zaznaczyć więcej niż jedną."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Wyjaśnienie (opcjonalne)"}),e.jsx(as,{placeholder:"Wyjaśnienie poprawnej odpowiedzi...",value:i.explanation,onChange:h=>o({...i,explanation:h.target.value}),className:"mt-1",rows:3})]}),e.jsxs(R,{children:[e.jsxs(w,{variant:"outline",onClick:()=>t(`/questions/manage/${r}`),children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),"Anuluj"]}),e.jsxs(w,{onClick:p,disabled:x,children:[e.jsx(Qt,{className:"w-4 h-4 mr-2"}),x?"Zapisywanie...":"Zapisz pytanie"]})]})]})]})]})},Kx=[e.jsx(O,{path:"/questions/manage/:activityId",element:e.jsx(Bx,{})},"questions-manage"),e.jsx(O,{path:"/questions/create",element:e.jsx(Gx,{})},"questions-create")],Zx=()=>{const{create:s,edit:t,show:r}=Se(),a=Q(),{mutate:n}=ut(),{tableQuery:{data:i,isLoading:o,isError:l,refetch:c},current:u,setCurrent:x,pageSize:m,setFilters:p}=_r({sorters:{initial:[{field:"created_at",order:"desc"}]},meta:{select:"*, group_members(count), course_access(count)"}}),g=qr({isLoading:o,isError:l});if(g)return g;const b=(j,v)=>{confirm(`Czy na pewno chcesz usunąć grupę "${v}"? Ta akcja usunie również wszystkie przypisania uczniów i kursów.`)&&n({resource:"groups",id:j},{onSuccess:()=>{F.success("Grupa została usunięta"),c()},onError:()=>{F.error("Błąd podczas usuwania grupy")}})},h=(j,v)=>{v?.stopPropagation(),a(`/groups/${j}/assign-courses`)},f=(j,v)=>{v?.stopPropagation(),a(`/groups/${j}/assign-students`)},y=j=>!j||!Array.isArray(j)||j.length===0?0:j[0].count||0;return e.jsxs(M,{children:[e.jsxs(R,{children:[e.jsx(J,{title:"Grupy",description:"Zarządzaj grupami uczniów i przypisuj im kursy"}),e.jsxs(w,{onClick:()=>s("groups"),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Dodaj grupę"]})]}),e.jsx(R,{children:e.jsx($,{placeholder:"Szukaj grup...",className:"max-w-sm",onChange:j=>{p([{field:"name",operator:"contains",value:j.target.value}])}})}),i?.data?.length===0?e.jsx(S,{className:"border-dashed border-2",children:e.jsxs(_,{className:"text-center py-12",children:[e.jsx(Ie,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Brak grup"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Utwórz pierwszą grupę, aby móc przypisywać uczniów do kursów"}),e.jsxs(w,{onClick:()=>s("groups"),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Utwórz pierwszą grupę"]})]})}):e.jsx(te,{children:i?.data?.map(j=>{const v=y(j.group_members),k=y(j.course_access);return e.jsxs(S,{className:"cursor-pointer transition-all hover:shadow-lg hover:border-primary/50 relative overflow-hidden",onClick:C=>{!C.target.closest('[role="menu"]')&&!C.target.closest(".quick-action")&&r("groups",j.id)},children:[!j.is_active&&e.jsx("div",{className:"absolute inset-0 bg-muted/50 z-10 pointer-events-none"}),e.jsx(A,{children:e.jsxs(R,{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"truncate",children:j.name})]}),e.jsxs(pt,{children:[e.jsx(ht,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"sm",onClick:C=>C.stopPropagation(),className:"relative z-20",children:e.jsx(Kt,{className:"h-4 w-4"})})}),e.jsxs(Js,{align:"end",children:[e.jsxs(ne,{onClick:()=>r("groups",j.id),children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"}),"Podgląd"]}),e.jsxs(ne,{onClick:()=>t("groups",j.id),children:[e.jsx(ms,{className:"mr-2 h-4 w-4"}),"Edytuj"]}),e.jsx(ss,{}),e.jsxs(ne,{onClick:C=>f(j.id,C),className:"text-blue-600 focus:text-blue-600",children:[e.jsx(Vs,{className:"mr-2 h-4 w-4"}),"Dodaj uczniów"]}),e.jsxs(ne,{onClick:C=>h(j.id,C),className:"text-green-600 focus:text-green-600",children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Przypisz kursy"]}),e.jsx(ss,{}),e.jsxs(ne,{onClick:()=>b(j.id,j.name),className:"text-red-600 focus:text-red-600",children:[e.jsx($s,{className:"mr-2 h-4 w-4"}),"Usuń"]})]})]})]})}),e.jsx(_,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Fs,{className:"w-4 h-4"}),e.jsxs("span",{children:["Rok akademicki: ",j.academic_year]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-background rounded-md",children:e.jsx(Ie,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Uczniowie"}),e.jsx("p",{className:"text-lg font-semibold",children:v})]})]})}),e.jsx("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-background rounded-md",children:e.jsx(ge,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Kursy"}),e.jsx("p",{className:"text-lg font-semibold",children:k})]})]})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsx(H,{variant:j.is_active?"default":"secondary",className:j.is_active?"bg-green-600":"",children:j.is_active?"Aktywna":"Nieaktywna"}),e.jsxs("div",{className:"flex gap-1",children:[v===0&&e.jsx(w,{size:"sm",variant:"ghost",className:"h-8 px-2 quick-action text-blue-600 hover:text-blue-700 hover:bg-blue-50",onClick:C=>f(j.id,C),title:"Dodaj uczniów",children:e.jsx(Vs,{className:"h-4 w-4"})}),e.jsxs(w,{size:"sm",variant:"ghost",className:"h-8 px-2 quick-action text-green-600 hover:text-green-700 hover:bg-green-50",onClick:C=>h(j.id,C),title:"Przypisz kursy",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx(gs,{className:"h-3 w-3 ml-1"})]})]})]})]})})]},j.id)})}),e.jsx(Fr,{current:u,pageSize:m,total:i?.total||0,setCurrent:x,itemName:"grup"})]})},Qx=()=>{const{list:s}=Se(),{data:t}=Oe(),{refineCore:{onFinish:r},register:a,handleSubmit:n,setValue:i,watch:o,formState:{errors:l,isSubmitting:c}}=Ns({defaultValues:{name:"",vendor_id:t?.vendor_id||0,is_active:!0,academic_year:new Date().getFullYear().toString()+"/"+(new Date().getFullYear()+1).toString()}});return e.jsxs(M,{children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>s("groups"),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsx(R,{children:e.jsx(J,{title:"Dodaj grupę",description:"Utwórz nową grupę uczniów"})}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Informacje o grupie"})}),e.jsx(_,{children:e.jsxs(ns,{onSubmit:n(r),children:[e.jsx(Z,{label:"Nazwa grupy",htmlFor:"name",error:l.name?.message?.toString(),required:!0,children:e.jsx($,{id:"name",placeholder:"np. Klasa 1A",...a("name",{required:"Nazwa grupy jest wymagana",minLength:{value:2,message:"Nazwa musi mieć minimum 2 znaki"}})})}),e.jsx(Z,{label:"Rok akademicki",htmlFor:"academic_year",error:l.academic_year?.message?.toString(),required:!0,children:e.jsx($,{id:"academic_year",placeholder:"np. 2024/2025",...a("academic_year",{required:"Rok akademicki jest wymagany",pattern:{value:/^\d{4}\/\d{4}$/,message:"Format: RRRR/RRRR (np. 2024/2025)"}})})}),e.jsx(Z,{label:"Status grupy",children:e.jsxs(R,{variant:"start",children:[e.jsx(xs,{checked:o("is_active"),onCheckedChange:u=>i("is_active",u)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Grupa aktywna"})]})}),e.jsxs(os,{children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>s("groups"),children:"Anuluj"}),e.jsx(w,{type:"submit",disabled:c,children:c?"Tworzenie...":"Utwórz grupę"})]})]})})]})]})},Vx=()=>{const{list:s}=Se(),{id:t}=Me(),{data:r,isLoading:a}=ze({resource:"groups",id:t,liveMode:"off"}),{refineCore:{onFinish:n},register:i,handleSubmit:o,setValue:l,watch:c,reset:u,formState:{errors:x,isSubmitting:m}}=Ns({refineCoreProps:{resource:"groups",id:t,redirect:"list",liveMode:"off"}});return d.useEffect(()=>{r?.data&&u({name:r.data.name,academic_year:r.data.academic_year,is_active:r.data.is_active,vendor_id:r.data.vendor_id})},[r,u]),a?e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsxs(M,{children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>s("groups"),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsx(R,{children:e.jsx(J,{title:"Edytuj grupę",description:`Edycja: ${r?.data?.name}`})}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Informacje o grupie"})}),e.jsx(_,{children:e.jsxs(ns,{onSubmit:o(n),children:[e.jsx(Z,{label:"Nazwa grupy",htmlFor:"name",error:x.name?.message,required:!0,children:e.jsx($,{id:"name",placeholder:"np. Klasa 1A",...i("name",{required:"Nazwa grupy jest wymagana",minLength:{value:2,message:"Nazwa musi mieć minimum 2 znaki"}})})}),e.jsx(Z,{label:"Rok akademicki",htmlFor:"academic_year",error:x.academic_year?.message,required:!0,children:e.jsx($,{id:"academic_year",placeholder:"np. 2024/2025",...i("academic_year",{required:"Rok akademicki jest wymagany",pattern:{value:/^\d{4}\/\d{4}$/,message:"Format: RRRR/RRRR (np. 2024/2025)"}})})}),e.jsx(Z,{label:"Status grupy",children:e.jsxs(R,{variant:"start",children:[e.jsx(xs,{checked:c("is_active"),onCheckedChange:p=>l("is_active",p)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Grupa aktywna"})]})}),e.jsxs(os,{children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>s("groups"),children:"Anuluj"}),e.jsx(w,{type:"submit",disabled:m,children:m?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},Hx=()=>{const{list:s,edit:t,show:r}=Se(),{id:a}=Me(),n=Q(),i=Xi(),{data:o,isLoading:l}=ze({resource:"groups",id:a,liveMode:"off"}),{data:c,isLoading:u}=je({resource:"group_members",filters:[{field:"group_id",operator:"eq",value:a}],meta:{select:"*, users(*)"},queryOptions:{enabled:!!a},liveMode:"off"}),{data:x,isLoading:m}=je({resource:"course_access",filters:[{field:"group_id",operator:"eq",value:a}],meta:{select:"*, courses(*)"},queryOptions:{enabled:!!a},liveMode:"off"}),p=async(y,j)=>{if(confirm(`Czy na pewno chcesz odpiąć kurs "${j}" od tej grupy?`))try{const{error:v}=await se.from("course_access").delete().eq("course_id",y).eq("group_id",parseInt(a));if(v)throw v;F.success("Kurs został odpięty od grupy"),i({resource:"course_access",invalidates:["list"]})}catch(v){console.error("Error removing course:",v),F.error("Błąd podczas odpinania kursu")}},g=async(y,j)=>{if(confirm(`Czy na pewno chcesz usunąć "${j}" z tej grupy?`))try{const{error:v}=await se.from("group_members").delete().eq("user_id",y).eq("group_id",parseInt(a));if(v)throw v;F.success("Uczeń został usunięty z grupy"),i({resource:"group_members",invalidates:["list"]})}catch(v){console.error("Error removing member:",v),F.error("Błąd podczas usuwania ucznia z grupy")}};if(l||u||m)return e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const b=o?.data,h=c?.total||0,f=x?.total||0;return e.jsxs(M,{children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>s("groups"),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsxs(R,{children:[e.jsxs("div",{children:[e.jsx(J,{title:b?.name,description:`Rok akademicki: ${b?.academic_year}`}),!b?.is_active&&e.jsx(H,{variant:"secondary",className:"mt-2",children:"Grupa nieaktywna"})]}),e.jsxs(w,{onClick:()=>t("groups",b?.id??""),children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Edytuj grupę"]})]}),!b?.is_active&&e.jsxs(oe,{children:[e.jsx(qt,{className:"h-4 w-4"}),e.jsx(le,{children:"Ta grupa jest nieaktywna. Uczniowie nie mają dostępu do przypisanych kursów."})]}),e.jsxs(te,{variant:"2-2-4",children:[e.jsxs(S,{children:[e.jsx(A,{className:"pb-2",children:e.jsx(L,{className:"text-sm font-medium",children:"Status"})}),e.jsx(_,{children:e.jsx(H,{variant:b?.is_active?"default":"secondary",className:b?.is_active?"bg-green-600":"",children:b?.is_active?"Aktywna":"Nieaktywna"})})]}),e.jsxs(S,{children:[e.jsx(A,{className:"pb-2",children:e.jsx(L,{className:"text-sm font-medium",children:"Uczniowie"})}),e.jsx(_,{children:e.jsx("div",{className:"text-2xl font-bold",children:h})})]}),e.jsxs(S,{children:[e.jsx(A,{className:"pb-2",children:e.jsx(L,{className:"text-sm font-medium",children:"Kursy"})}),e.jsx(_,{children:e.jsx("div",{className:"text-2xl font-bold",children:f})})]}),e.jsxs(S,{children:[e.jsx(A,{className:"pb-2",children:e.jsx(L,{className:"text-sm font-medium",children:"Utworzono"})}),e.jsx(_,{children:e.jsx("div",{className:"text-sm",children:new Date(b?.created_at).toLocaleDateString("pl-PL")})})]})]}),e.jsxs(te,{variant:"1-2-2",children:[e.jsxs(S,{children:[e.jsx(A,{children:e.jsxs(R,{children:[e.jsx(L,{children:"Uczniowie grupy"}),e.jsxs(w,{size:"sm",onClick:()=>n(`/groups/${a}/assign-students`),children:[e.jsx(Vs,{className:"w-4 h-4 mr-2"}),"Dodaj ucznia"]})]})}),e.jsx(_,{children:c?.data?.length?e.jsx("div",{className:"space-y-2",children:c.data.map(y=>e.jsx("div",{className:"p-4 border rounded-lg hover:bg-muted/30 transition-all duration-200 group",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted/50 flex items-center justify-center flex-shrink-0",children:e.jsx(Ie,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-base leading-tight truncate pr-2",children:y.users?.full_name}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(Ds,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:y.users?.email})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(fs,{children:e.jsxs(ys,{children:[e.jsx(bs,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>r("users",y.user_id),children:e.jsx(Ja,{className:"h-4 w-4"})})}),e.jsx(ds,{children:e.jsx("p",{children:"Zobacz profil"})})]})}),e.jsx(fs,{children:e.jsxs(ys,{children:[e.jsx(bs,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-50",onClick:()=>g(y.user_id,y.users?.full_name),children:e.jsx($s,{className:"h-4 w-4 text-red-600"})})}),e.jsx(ds,{children:e.jsx("p",{children:"Usuń z grupy"})})]})})]})]})},y.user_id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Ie,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Brak uczniów w grupie"}),e.jsxs(w,{size:"sm",variant:"outline",className:"mt-4",onClick:()=>n(`/groups/${a}/assign-students`),children:[e.jsx(Vs,{className:"w-4 h-4 mr-2"}),"Dodaj pierwszego ucznia"]})]})})]}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsxs(R,{children:[e.jsx(L,{children:"Przypisane kursy"}),e.jsxs(w,{size:"sm",onClick:()=>n(`/groups/${a}/assign-courses`),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Przypisz kurs"]})]})}),e.jsx(_,{children:x?.data?.length?e.jsx("div",{className:"space-y-2",children:x.data.map(y=>e.jsx("div",{className:"p-4 border rounded-lg hover:bg-muted/30 transition-all duration-200 group",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:y.courses?.icon_emoji?e.jsx("div",{className:"h-10 w-10 rounded-lg bg-muted/50 flex items-center justify-center",children:e.jsx("span",{className:"text-xl",children:y.courses.icon_emoji})}):e.jsx("div",{className:"h-10 w-10 rounded-lg bg-muted/50 flex items-center justify-center",children:e.jsx(ge,{className:"h-5 w-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-base leading-tight truncate pr-2",children:y.courses?.title}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(Fs,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:new Date(y.assigned_at).toLocaleDateString("pl-PL")})]}),e.jsx(H,{variant:y.courses?.is_published?"default":"secondary",className:`text-xs ${y.courses?.is_published?"bg-green-100 text-green-700 hover:bg-green-100":""}`,children:y.courses?.is_published?"Opublikowany":"Szkic"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(fs,{children:e.jsxs(ys,{children:[e.jsx(bs,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>r("courses",y.course_id),children:e.jsx(Ja,{className:"h-4 w-4"})})}),e.jsx(ds,{children:e.jsx("p",{children:"Zobacz kurs"})})]})}),e.jsx(fs,{children:e.jsxs(ys,{children:[e.jsx(bs,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-red-50",onClick:()=>p(y.course_id,y.courses?.title),children:e.jsx($s,{className:"h-4 w-4 text-red-600"})})}),e.jsx(ds,{children:e.jsx("p",{children:"Odepnij kurs"})})]})})]})]})},y.course_id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ge,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Brak przypisanych kursów"}),e.jsxs(w,{size:"sm",variant:"outline",className:"mt-4",onClick:()=>n(`/groups/${a}/assign-courses`),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Przypisz pierwszy kurs"]})]})})]})]})]})},Jx=()=>{const{id:s}=Me(),t=Q(),[r,a]=d.useState([]),[n,i]=d.useState(""),[o,l]=d.useState(!1),{data:c,isLoading:u}=ze({resource:"groups",id:s}),{data:x,isLoading:m}=je({resource:"courses",pagination:{mode:"off"},meta:{select:"*, topics(count)"}}),{data:p,isLoading:g}=je({resource:"course_access",filters:[{field:"group_id",operator:"eq",value:parseInt(s)}],pagination:{mode:"off"},meta:{select:"course_id, group_id"}}),{mutate:b,isLoading:h}=_s(),f=async()=>{if(r.length===0){F.error("Wybierz przynajmniej jeden kurs");return}try{const P=r.map(B=>b({resource:"course_access",values:{course_id:B,group_id:parseInt(s)}},{onSuccess:()=>{console.log(`Course ${B} assigned successfully`)},onError:T=>{console.error("Error assigning course:",B,T)}}));await Promise.all(P),F.success(`Przypisano ${r.length} ${r.length===1?"kurs":"kursów"} do grupy`),t(`/groups/show/${s}`)}catch(P){F.error("Błąd podczas przypisywania kursów"),console.error("Error details:",P)}};if(u||m||g)return e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const y=c?.data,j=p?.data?.map(P=>P.course_id)||[];let v=x?.data?.filter(P=>!j.includes(P.id))||[];o&&(v=v.filter(P=>P.is_published));const k=v.filter(P=>P.title.toLowerCase().includes(n.toLowerCase())||P.description?.toLowerCase().includes(n.toLowerCase())),C=P=>{a(B=>B.includes(P)?B.filter(T=>T!==P):[...B,P])},z=()=>{a(k.map(P=>P.id))},N=()=>{a([])},I=v.filter(P=>P.is_published).length,q=v.length-I;return e.jsxs(M,{children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>t(`/groups/show/${s}`),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Powrót do grupy"]}),e.jsx(R,{children:e.jsx(J,{title:"Przypisz kursy",description:`Przypisywanie kursów do grupy: ${y?.name}`})}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsxs(R,{children:[e.jsxs("div",{children:[e.jsx(L,{children:"Dostępne kursy"}),v.length>0&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[I," opublikowanych, ",q," szkiców"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>l(!o),className:o?"bg-primary text-primary-foreground":"",children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Tylko opublikowane"]}),e.jsxs(w,{variant:"outline",size:"sm",onClick:z,disabled:k.length===0,children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Zaznacz wszystkie"]}),e.jsxs(w,{variant:"outline",size:"sm",onClick:N,disabled:r.length===0,children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),"Odznacz wszystkie"]})]})]})}),e.jsxs(_,{children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx(va,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx($,{placeholder:"Szukaj kursów po nazwie lub opisie...",value:n,onChange:P=>i(P.target.value),className:"pl-10"})]}),k.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:v.length===0?e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{className:"font-medium mb-1",children:"Wszystkie kursy są już przypisane"}),e.jsx("p",{className:"text-sm",children:"Ta grupa ma dostęp do wszystkich dostępnych kursów"}),e.jsx(w,{size:"sm",variant:"outline",className:"mt-4",onClick:()=>t("/courses"),children:"Przejdź do listy kursów"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Nie znaleziono kursów spełniających kryteria"})]})}):e.jsx("div",{className:"space-y-2",children:k.map(P=>{const B=P._count?.topics||0;return e.jsxs("div",{className:`
                      flex items-center space-x-3 p-3 border rounded-lg 
                      cursor-pointer transition-all
                      ${r.includes(P.id)?"border-primary bg-primary/5":"hover:bg-muted/50"}
                    `,onClick:()=>C(P.id),children:[e.jsx(Ve,{checked:r.includes(P.id),onCheckedChange:()=>C(P.id),onClick:T=>T.stopPropagation()}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[P.icon_emoji&&e.jsx("span",{className:"text-xl",children:P.icon_emoji}),e.jsx("span",{className:"font-medium",children:P.title}),e.jsx(H,{variant:P.is_published?"default":"secondary",className:"text-xs",children:P.is_published?"Opublikowany":"Szkic"})]}),P.description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:P.description}),e.jsx("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:e.jsxs("span",{children:[B," ",B===1?"temat":"tematów"]})})]}),e.jsx(fs,{children:e.jsxs(ys,{children:[e.jsx(bs,{asChild:!0,children:e.jsx(w,{size:"sm",variant:"ghost",onClick:T=>{T.stopPropagation(),t(`/courses/show/${P.id}`)},children:e.jsx(Ce,{className:"h-4 w-4"})})}),e.jsx(ds,{children:e.jsx("p",{children:"Zobacz kurs"})})]})})]},P.id)})}),r.length>0&&e.jsxs("div",{className:"mt-6 p-4 bg-muted rounded-lg",children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-3",children:["Wybrano ",r.length," kursów do przypisania"]}),e.jsxs(R,{children:[e.jsx(w,{variant:"outline",onClick:()=>t(`/groups/show/${s}`),children:"Anuluj"}),e.jsx(w,{onClick:f,disabled:h,children:h?"Przypisywanie...":"Przypisz kursy"})]})]})]})]})]})},Xx=()=>{const{id:s}=Me(),t=Q(),[r,a]=d.useState([]),[n,i]=d.useState(""),{data:o,isLoading:l}=ze({resource:"groups",id:s}),{data:c,isLoading:u}=je({resource:"users",filters:[{field:"role",operator:"eq",value:"student"}],pagination:{mode:"off"}}),{data:x,isLoading:m}=je({resource:"group_members",filters:[{field:"group_id",operator:"eq",value:parseInt(s)}],pagination:{mode:"off"},meta:{select:"user_id, group_id"}}),{mutate:p,isLoading:g}=_s(),b=async()=>{if(r.length===0){F.error("Wybierz przynajmniej jednego ucznia");return}try{const z=r.map(N=>p({resource:"group_members",values:{user_id:N,group_id:parseInt(s)}},{onSuccess:()=>{console.log(`Student ${N} assigned successfully`)},onError:I=>{console.error("Error assigning student:",N,I)}}));await Promise.all(z),F.success(`Dodano ${r.length} uczniów do grupy`),t(`/groups/show/${s}`)}catch(z){F.error("Błąd podczas dodawania uczniów"),console.error("Error details:",z)}};if(l||u||m)return e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const h=o?.data,f=x?.data?.map(z=>z.user_id)||[],y=c?.data?.filter(z=>!f.includes(z.id))||[],j=y.filter(z=>z.full_name.toLowerCase().includes(n.toLowerCase())||z.email.toLowerCase().includes(n.toLowerCase())),v=z=>{a(N=>N.includes(z)?N.filter(I=>I!==z):[...N,z])},k=()=>{a(j.map(z=>z.id))},C=()=>{a([])};return e.jsxs(M,{children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>t(`/groups/show/${s}`),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Powrót do grupy"]}),e.jsx(R,{children:e.jsx(J,{title:"Dodaj uczniów",description:`Dodawanie uczniów do grupy: ${h?.name}`})}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsxs(R,{children:[e.jsx(L,{children:"Dostępni uczniowie"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:k,disabled:j.length===0,children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Zaznacz wszystkich"]}),e.jsxs(w,{variant:"outline",size:"sm",onClick:C,disabled:r.length===0,children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),"Odznacz wszystkich"]})]})]})}),e.jsxs(_,{children:[e.jsx($,{placeholder:"Szukaj uczniów...",value:n,onChange:z=>i(z.target.value),className:"mb-4"}),j.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:y.length===0?e.jsxs(e.Fragment,{children:[e.jsx(Vs,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Wszyscy uczniowie są już w tej grupie"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Vs,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Nie znaleziono uczniów"})]})}):e.jsx("div",{className:"space-y-2",children:j.map(z=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 border rounded-lg hover:bg-muted/50 cursor-pointer",onClick:()=>v(z.id),children:[e.jsx(Ve,{checked:r.includes(z.id),onCheckedChange:()=>v(z.id),onClick:N=>N.stopPropagation()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:z.full_name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Ds,{className:"w-3 h-3"}),z.email]})]}),e.jsx(H,{variant:"secondary",className:"text-xs",children:"Uczeń"})]},z.id))}),r.length>0&&e.jsxs("div",{className:"mt-6 p-4 bg-muted rounded-lg",children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-3",children:["Wybrano ",r.length," uczniów do dodania"]}),e.jsxs(R,{children:[e.jsx(w,{variant:"outline",onClick:()=>t(`/groups/show/${s}`),children:"Anuluj"}),e.jsx(w,{onClick:b,disabled:g,children:g?"Dodawanie...":"Dodaj uczniów"})]})]})]})]})]})},Yx={name:"groups",list:"/groups",create:"/groups/create",edit:"/groups/edit/:id",show:"/groups/show/:id",meta:{label:"Grupy",icon:e.jsx(Ie,{className:"h-4 w-4"})}},ep=[e.jsx(O,{path:"/groups",element:e.jsx(Zx,{})},"groups-list"),e.jsx(O,{path:"/groups/create",element:e.jsx(Qx,{})},"groups-create"),e.jsx(O,{path:"/groups/edit/:id",element:e.jsx(Vx,{})},"groups-edit"),e.jsx(O,{path:"/groups/show/:id",element:e.jsx(Hx,{})},"groups-show"),e.jsx(O,{path:"/groups/:id/assign-courses",element:e.jsx(Jx,{})},"groups-assign-courses"),e.jsx(O,{path:"/groups/:id/assign-students",element:e.jsx(Xx,{})},"groups-assign-students")],sp=()=>{const{create:s,edit:t,show:r}=Se(),{mutate:a}=ut(),[n,i]=d.useState("all"),{tableQuery:{data:o,isLoading:l,isError:c},current:u,setCurrent:x,pageSize:m,setFilters:p}=_r({sorters:{initial:[{field:"created_at",order:"desc"}]},meta:{select:"*, user_stats(total_points, current_level)"}}),g=qr({isLoading:l,isError:c});if(g)return g;const b=(j,v)=>{confirm(`Czy na pewno chcesz usunąć użytkownika "${v}"?`)&&a({resource:"users",id:j})},h=j=>{const v=[];j&&v.push({operator:"or",value:[{field:"full_name",operator:"contains",value:j},{field:"email",operator:"contains",value:j}]}),n!=="all"&&v.push({field:"role",operator:"eq",value:n}),p(v)},f=j=>{switch(j){case"admin":return e.jsx(Tr,{className:"w-3 h-3"});case"teacher":return e.jsx(mt,{className:"w-3 h-3"});default:return e.jsx(xc,{className:"w-3 h-3"})}},y=j=>{switch(j){case"admin":return"destructive";case"teacher":return"default";default:return"secondary"}};return e.jsxs(M,{children:[e.jsxs(R,{children:[e.jsx(J,{title:"Użytkownicy",description:"Zarządzaj użytkownikami systemu"}),e.jsxs(w,{onClick:()=>s("users"),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Dodaj użytkownika"]})]}),e.jsxs(R,{className:"gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(va,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx($,{placeholder:"Szukaj po nazwie lub email...",className:"pl-10",onChange:j=>h(j.target.value)})]}),e.jsxs(xe,{value:n,onValueChange:j=>{i(j),h("")},children:[e.jsx(de,{className:"w-[180px]",children:e.jsx(pe,{placeholder:"Filtruj po roli"})}),e.jsxs(ue,{children:[e.jsx(U,{value:"all",children:"Wszystkie role"}),e.jsx(U,{value:"student",children:"Studenci"}),e.jsx(U,{value:"teacher",children:"Nauczyciele"}),e.jsx(U,{value:"admin",children:"Administratorzy"})]})]})]}),e.jsx("div",{className:"space-y-4",children:o?.data?.map(j=>e.jsx(S,{children:e.jsx(_,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-muted flex items-center justify-center",children:e.jsx(Ie,{className:"h-6 w-6 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:j.full_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:j.email})]}),e.jsxs(H,{variant:y(j.role),children:[f(j.role),e.jsx("span",{className:"ml-1 capitalize",children:j.role})]}),e.jsx(H,{variant:j.is_active?"outline":"secondary",children:j.is_active?"Aktywny":"Nieaktywny"})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[j.user_stats&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Punkty"}),e.jsx("p",{className:"font-semibold",children:j.user_stats.total_points})]}),e.jsxs(pt,{children:[e.jsx(ht,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"sm",children:e.jsx(Kt,{className:"h-4 w-4"})})}),e.jsxs(Js,{align:"end",children:[e.jsxs(ne,{onClick:()=>r("users",j.id),children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"}),"Podgląd"]}),e.jsxs(ne,{onClick:()=>t("users",j.id),children:[e.jsx(ms,{className:"mr-2 h-4 w-4"}),"Edytuj"]}),e.jsxs(ne,{onClick:()=>b(j.id,j.full_name),className:"text-red-600",children:[e.jsx($s,{className:"mr-2 h-4 w-4"}),"Usuń"]})]})]})]})]})})},j.id))}),e.jsx(Fr,{current:u,pageSize:m,total:o?.total||0,setCurrent:x,itemName:"użytkowników"})]})},tp=()=>{const{list:s}=Se(),{data:t}=Oe(),{refineCore:{onFinish:r},register:a,handleSubmit:n,setValue:i,watch:o,formState:{errors:l,isSubmitting:c}}=Ns({defaultValues:{full_name:"",email:"",vendor_id:t?.vendor_id||0,role:"student",is_active:!0}});return e.jsxs(M,{children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>s("users"),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsx(R,{children:e.jsx(J,{title:"Dodaj użytkownika",description:"Utwórz nowe konto użytkownika"})}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Dane użytkownika"})}),e.jsx(_,{children:e.jsxs(ns,{onSubmit:n(r),children:[e.jsxs(te,{variant:"1-2-2",children:[e.jsx(Z,{label:"Imię i nazwisko",htmlFor:"full_name",error:l.full_name?.message?.toString(),required:!0,children:e.jsx($,{id:"full_name",placeholder:"np. Jan Kowalski",...a("full_name",{required:"Imię i nazwisko są wymagane",minLength:{value:3,message:"Minimum 3 znaki"}})})}),e.jsx(Z,{label:"Email",htmlFor:"email",error:l.email?.message?.toString(),required:!0,children:e.jsx($,{id:"email",type:"email",placeholder:"np. jan.kowalski@example.com",...a("email",{required:"Email jest wymagany",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Nieprawidłowy format email"}})})}),e.jsx(Z,{label:"Rola",error:l.role?.message?.toString(),required:!0,children:e.jsxs(xe,{value:o("role"),onValueChange:u=>i("role",u),children:[e.jsx(de,{children:e.jsx(pe,{placeholder:"Wybierz rolę"})}),e.jsxs(ue,{children:[e.jsx(U,{value:"student",children:"Student"}),e.jsx(U,{value:"teacher",children:"Nauczyciel"}),e.jsx(U,{value:"admin",children:"Administrator"})]})]})})]}),e.jsx(Z,{label:"Status konta",children:e.jsxs(R,{variant:"start",children:[e.jsx(xs,{checked:o("is_active"),onCheckedChange:u=>i("is_active",u)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Konto aktywne (użytkownik może się zalogować)"})]})}),e.jsxs(os,{children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>s("users"),children:"Anuluj"}),e.jsx(w,{type:"submit",disabled:c,children:c?"Tworzenie...":"Utwórz użytkownika"})]})]})})]})]})},rp=()=>{const{list:s}=Se(),{id:t}=Me(),{data:r,isLoading:a}=ze({resource:"users",id:t,liveMode:"off"}),{refineCore:{onFinish:n},register:i,handleSubmit:o,setValue:l,watch:c,reset:u,formState:{errors:x,isSubmitting:m}}=Ns({refineCoreProps:{resource:"users",id:t,redirect:"list",liveMode:"off"}});return d.useEffect(()=>{r?.data&&u({full_name:r.data.full_name,email:r.data.email,role:r.data.role,is_active:r.data.is_active,vendor_id:r.data.vendor_id})},[r,u]),a?e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsxs(M,{children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>s("users"),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsx(R,{children:e.jsx(J,{title:"Edytuj użytkownika",description:`Edycja: ${r?.data?.full_name}`})}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Dane użytkownika"})}),e.jsx(_,{children:e.jsxs(ns,{onSubmit:o(n),children:[e.jsxs(te,{variant:"1-2-2",children:[e.jsx(Z,{label:"Imię i nazwisko",htmlFor:"full_name",error:x.full_name?.message,required:!0,children:e.jsx($,{id:"full_name",placeholder:"np. Jan Kowalski",...i("full_name",{required:"Imię i nazwisko są wymagane",minLength:{value:3,message:"Minimum 3 znaki"}})})}),e.jsx(Z,{label:"Email",htmlFor:"email",error:x.email?.message,required:!0,children:e.jsx($,{id:"email",type:"email",placeholder:"np. jan.kowalski@example.com",...i("email",{required:"Email jest wymagany",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Nieprawidłowy format email"}}),disabled:!0})}),e.jsx(Z,{label:"Rola",error:x.role?.message,required:!0,children:e.jsxs(xe,{value:c("role")||"student",onValueChange:p=>l("role",p),children:[e.jsx(de,{children:e.jsx(pe,{placeholder:"Wybierz rolę"})}),e.jsxs(ue,{children:[e.jsx(U,{value:"student",children:"Student"}),e.jsx(U,{value:"teacher",children:"Nauczyciel"}),e.jsx(U,{value:"admin",children:"Administrator"})]})]})})]}),e.jsx(Z,{label:"Status konta",children:e.jsxs(R,{variant:"start",children:[e.jsx(xs,{checked:c("is_active")??!0,onCheckedChange:p=>l("is_active",p)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Konto aktywne (użytkownik może się zalogować)"})]})}),e.jsxs(os,{children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>s("users"),children:"Anuluj"}),e.jsx(w,{type:"submit",disabled:m,children:m?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},ap=()=>{const{list:s,edit:t}=Se(),{id:r}=Me(),{data:a,isLoading:n}=ze({resource:"users",id:r,meta:{select:"*, user_stats(*)"}}),{data:i}=je({resource:"activity_progress",filters:[{field:"user_id",operator:"eq",value:r}]});if(n)return e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const o=a?.data,l=o?.user_stats?.[0]||{},c=u=>{switch(u){case"admin":return e.jsx(Tr,{className:"w-4 h-4"});case"teacher":return e.jsx(ge,{className:"w-4 h-4"});default:return e.jsx(Ts,{className:"w-4 h-4"})}};return e.jsxs(M,{children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>s("users"),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsxs(R,{children:[e.jsx(J,{title:o?.full_name,description:o?.email}),e.jsxs(w,{onClick:()=>t("users",o?.id??""),children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Edytuj użytkownika"]})]}),e.jsxs(te,{children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Informacje podstawowe"})}),e.jsx(_,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Imię i nazwisko"}),e.jsx("p",{className:"text-lg",children:o?.full_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Email"}),e.jsxs("p",{className:"text-lg flex items-center gap-2",children:[e.jsx(Ds,{className:"w-4 h-4"}),o?.email]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Rola"}),e.jsxs(H,{variant:"default",className:"mt-1",children:[c(o?.role),e.jsx("span",{className:"ml-1 capitalize",children:o?.role})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsx(H,{variant:o?.is_active?"outline":"secondary",className:"mt-1",children:o?.is_active?"Aktywny":"Nieaktywny"})]})]})})]}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Statystyki gamifikacji"})}),e.jsx(_,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx(qe,{className:"w-8 h-8 mx-auto mb-2 text-yellow-500"}),e.jsx("p",{className:"text-2xl font-bold",children:l.total_points||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Punkty"})]}),e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx(ws,{className:"w-8 h-8 mx-auto mb-2 text-blue-500"}),e.jsx("p",{className:"text-2xl font-bold",children:l.current_level||1}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Poziom"})]}),e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx(en,{className:"w-8 h-8 mx-auto mb-2 text-green-500"}),e.jsx("p",{className:"text-2xl font-bold",children:l.daily_streak||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Dni z rzędu"})]}),e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx(is,{className:"w-8 h-8 mx-auto mb-2 text-purple-500"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round((l.total_time_spent||0)/60)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Godzin nauki"})]})]})})]}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Postępy w nauce"})}),e.jsx(_,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Ukończone quizy"}),e.jsx("span",{className:"font-bold",children:l.quizzes_completed||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Wyniki perfekcyjne"}),e.jsx("span",{className:"font-bold",children:l.perfect_scores||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Ukończone aktywności"}),e.jsx("span",{className:"font-bold",children:i?.data?.filter(u=>u.completed_at).length||0})]})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{className:"text-lg",children:"Daty"})}),e.jsxs(_,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Utworzono"}),e.jsx("p",{className:"text-sm font-medium",children:new Date(o?.created_at).toLocaleDateString("pl-PL")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ostatnia aktywność"}),e.jsx("p",{className:"text-sm font-medium",children:l.last_active?new Date(l.last_active).toLocaleDateString("pl-PL"):"Brak aktywności"})]})]})]}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{className:"text-lg",children:"Idle Game"})}),e.jsxs(_,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Punkty/h"}),e.jsx("span",{className:"font-bold",children:l.idle_points_rate||1})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ostatnie odebranie"}),e.jsx("p",{className:"text-sm font-medium",children:l.last_idle_claim?new Date(l.last_idle_claim).toLocaleString("pl-PL"):"Nigdy"})]})]})]})]})]})]})},ip={name:"users",list:"/users",create:"/users/create",edit:"/users/edit/:id",show:"/users/show/:id",meta:{label:"Użytkownicy",icon:e.jsx(Ie,{className:"h-4 w-4"})}},np=[e.jsx(O,{path:"/users",element:e.jsx(sp,{})},"users-list"),e.jsx(O,{path:"/users/create",element:e.jsx(tp,{})},"users-create"),e.jsx(O,{path:"/users/edit/:id",element:e.jsx(rp,{})},"users-edit"),e.jsx(O,{path:"/users/show/:id",element:e.jsx(ap,{})},"users-show")],op=()=>{const{tableQuery:{data:s,isLoading:t,isError:r},current:a,setCurrent:n,pageSize:i,setFilters:o}=_r({sorters:{initial:[{field:"created_at",order:"desc"}]}}),l=qr({isLoading:t,isError:r});return l||e.jsxs(M,{children:[e.jsx(J,{title:"Organizacje",description:"Lista wszystkich organizacji w systemie"}),e.jsx(R,{children:e.jsx($,{placeholder:"Szukaj organizacji...",className:"max-w-sm",onChange:c=>{o([{operator:"or",value:[{field:"name",operator:"contains",value:c.target.value},{field:"subdomain",operator:"contains",value:c.target.value}]}])}})}),e.jsx(te,{children:s?.data?.map(c=>e.jsxs(S,{children:[e.jsx(A,{children:e.jsxs(R,{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(rn,{className:"w-5 h-5"}),c.name]}),e.jsx(H,{variant:c.is_active?"default":"secondary",children:c.is_active?"Aktywna":"Nieaktywna"})]})}),e.jsxs(_,{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(pc,{className:"w-3 h-3"}),e.jsxs("span",{children:[c.subdomain,".example.com"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Fs,{className:"w-3 h-3"}),e.jsxs("span",{children:["Utworzono: ",new Date(c.created_at).toLocaleDateString("pl-PL")]})]})]})]},c.id))}),e.jsx(Fr,{current:a,pageSize:i,total:s?.total||0,setCurrent:n,itemName:"organizacji"})]})},lp={name:"vendors",list:"/vendors",meta:{label:"Organizacje",icon:e.jsx(rn,{className:"h-4 w-4"})}},cp=[e.jsx(O,{path:"/vendors",element:e.jsx(op,{})},"vendors-list")],dp=()=>{const[s,t]=d.useState("users"),[r,a]=d.useState("month"),[n,i]=d.useState(!1),o=async()=>{i(!0);try{alert("Funkcja generowania raportów będzie dostępna wkrótce")}catch(c){console.error("Error generating report:",c)}finally{i(!1)}},l=[{id:"users",name:"Raport użytkowników",description:"Statystyki użytkowników, postępy, aktywność",icon:Ie},{id:"courses",name:"Raport kursów",description:"Popularność kursów, wskaźniki ukończenia",icon:ge},{id:"gamification",name:"Raport gamifikacji",description:"Punkty, poziomy, rankingi",icon:Lt},{id:"activity",name:"Raport aktywności",description:"Logi, czas nauki, częstotliwość",icon:Pr}];return e.jsxs(M,{children:[e.jsx(J,{title:"Raporty",description:"Generuj raporty i analizy systemu"}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Generator raportów"})}),e.jsxs(_,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Typ raportu"}),e.jsxs(xe,{value:s,onValueChange:t,children:[e.jsx(de,{children:e.jsx(pe,{})}),e.jsx(ue,{children:l.map(c=>e.jsx(U,{value:c.id,children:c.name},c.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Zakres czasowy"}),e.jsxs(xe,{value:r,onValueChange:a,children:[e.jsx(de,{children:e.jsx(pe,{})}),e.jsxs(ue,{children:[e.jsx(U,{value:"week",children:"Ostatni tydzień"}),e.jsx(U,{value:"month",children:"Ostatni miesiąc"}),e.jsx(U,{value:"quarter",children:"Ostatni kwartał"}),e.jsx(U,{value:"year",children:"Ostatni rok"}),e.jsx(U,{value:"all",children:"Wszystkie dane"})]})]})]})]}),e.jsx("div",{className:"p-4 border rounded-lg bg-muted/50",children:l.find(c=>c.id===s)&&e.jsxs("div",{className:"flex items-start gap-3",children:[(()=>{const c=l.find(u=>u.id===s).icon;return e.jsx(c,{className:"w-5 h-5 mt-0.5 text-muted-foreground"})})(),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:l.find(c=>c.id===s).name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.find(c=>c.id===s).description})]})]})}),e.jsxs(w,{onClick:o,disabled:n,className:"w-full",children:[e.jsx(hc,{className:"w-4 h-4 mr-2"}),n?"Generowanie...":"Generuj raport"]})]})]}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Ostatnie raporty"})}),e.jsx(_,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Ee,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Brak wygenerowanych raportów"}),e.jsx("p",{className:"text-sm mt-1",children:"Wygenerowane raporty będą wyświetlane tutaj"})]})})]})]})},up={name:"reports",list:"/reports",meta:{label:"Raporty",icon:e.jsx(Ee,{className:"h-4 w-4"})}},mp=[e.jsx(O,{path:"/reports",element:e.jsx(dp,{})},"reports")],yi={id:"educational-material-wizard",title:"Kreator materiałów edukacyjnych",schema:{step1:{title:"Podstawowe informacje",type:"object",properties:{subject:{type:"text",title:"Temat materiału",placeholder:"np. Wprowadzenie do programowania w Python"},targetLevel:{type:"select",title:"Poziom zaawansowania",options:[{value:"beginner",label:"Początkujący"},{value:"intermediate",label:"Średniozaawansowany"},{value:"advanced",label:"Zaawansowany"}]},ageGroup:{type:"select",title:"Grupa wiekowa",options:[{value:"7-10",label:"7-10 lat (szkoła podstawowa)"},{value:"11-14",label:"11-14 lat (klasy 4-8)"},{value:"15-18",label:"15-18 lat (szkoła średnia)"},{value:"18+",label:"18+ (dorośli)"}]}},required:["subject","targetLevel","ageGroup"]},step2:{title:"Analiza tematu",type:"object",properties:{keyTopics:{type:"tags",title:"Kluczowe zagadnienia",readOnly:!0},learningObjectives:{type:"textarea",title:"Cele nauczania",readOnly:!0},prerequisites:{type:"tags",title:"Wymagania wstępne",readOnly:!0},estimatedDuration:{type:"number",title:"Szacowany czas (min)",readOnly:!0}}},step3:{title:"Dostosowanie celów",type:"object",properties:{learningObjectives:{type:"textarea",title:"Cele nauczania (edytowalne)",placeholder:"Dostosuj cele nauczania...",rows:6},materialType:{type:"select",title:"Typ materiału",options:[{value:"lesson",label:"Lekcja z teorią"},{value:"exercise",label:"Ćwiczenia praktyczne"},{value:"mixed",label:"Teoria + ćwiczenia"}]}},required:["learningObjectives","materialType"]},step4:{title:"Podgląd materiału",type:"object",properties:{title:{type:"text",title:"Tytuł materiału",readOnly:!0},content:{type:"textarea",title:"Treść materiału",readOnly:!0},exercises:{type:"textarea",title:"Ćwiczenia",readOnly:!0},summary:{type:"textarea",title:"Podsumowanie",readOnly:!0}}},step5:{title:"Finalizacja",type:"object",properties:{courseId:{type:"select",title:"Wybierz kurs",placeholder:"Wybierz kurs..."},topicId:{type:"select",title:"Wybierz temat",placeholder:"Najpierw wybierz kurs..."},activityTitle:{type:"text",title:"Tytuł aktywności",placeholder:"np. Wprowadzenie do zmiennych"},activityType:{type:"select",title:"Typ aktywności",options:[{value:"material",label:"Materiał edukacyjny"},{value:"quiz",label:"Quiz sprawdzający"}]},content:{type:"textarea",title:"Treść materiału",placeholder:"Edytuj wygenerowaną treść...",rows:15},duration:{type:"number",title:"Czas trwania (min)",placeholder:"15"}},required:["courseId","topicId","activityTitle","activityType","content"]}}},xp={id:"analyze-topic",name:"Analiza tematu edukacyjnego",config:{endpoint:"https://diesel-power-backend.onrender.com/api/chat"},prompt:{system:"Jesteś ekspertem od edukacji i tworzenia materiałów dydaktycznych.",user:`
Przeanalizuj temat edukacyjny:
Temat: {{subject}}
Poziom: {{targetLevel}}
Grupa wiekowa: {{ageGroup}}

Wygeneruj JSON:
{
  "keyTopics": ["temat1", "temat2", "temat3"],
  "learningObjectives": "<szczegółowe cele nauczania - czego uczeń się nauczy>",
  "prerequisites": ["wymaganie1", "wymaganie2"],
  "estimatedDuration": <liczba minut>
}

Wymagania:
- KeyTopics: 3-7 kluczowych zagadnień do omówienia
- LearningObjectives: konkretne, mierzalne cele (100-200 słów)
- Prerequisites: 2-5 wymagań wstępnych (może być puste dla początkujących)
- EstimatedDuration: realistyczny czas w minutach (15-90)
    `,responseFormat:"json"},inputMapping:s=>({subject:s.subject,targetLevel:s.targetLevel,ageGroup:s.ageGroup}),outputMapping:(s,t)=>({...t,keyTopics:s.keyTopics,learningObjectives:s.learningObjectives,prerequisites:s.prerequisites,estimatedDuration:s.estimatedDuration}),validation:s=>!!(s.keyTopics&&s.learningObjectives&&s.estimatedDuration)},pp={id:"generate-material",name:"Generowanie materiału edukacyjnego",config:{endpoint:"https://diesel-power-backend.onrender.com/api/chat"},prompt:{system:"Jesteś doświadczonym nauczycielem tworzącym angażujące materiały edukacyjne.",user:`
Stwórz materiał edukacyjny:

Temat: {{subject}}
Poziom: {{targetLevel}}
Grupa wiekowa: {{ageGroup}}
Cele nauczania: {{learningObjectives}}
Typ materiału: {{materialType}}
Kluczowe zagadnienia: {{keyTopics}}

Wygeneruj JSON:
{
  "title": "<atrakcyjny tytuł materiału>",
  "content": "<treść materiału w formacie Markdown - teoria, przykłady, wyjaśnienia>",
  "exercises": "<ćwiczenia praktyczne w formacie Markdown>",
  "summary": "<podsumowanie najważniejszych punktów>"
}

Wymagania:
- Title: kreatywny i zachęcający do nauki
- Content: dostosowany do wieku, z przykładami, min. 500 słów
- Exercises: 3-5 ćwiczeń praktycznych z instrukcjami
- Summary: bullet points z najważniejszymi informacjami
- Używaj formatowania Markdown (nagłówki, listy, kod)
- Język dostosowany do grupy wiekowej
    `,responseFormat:"json"},inputMapping:s=>({subject:s.subject,targetLevel:s.targetLevel,ageGroup:s.ageGroup,learningObjectives:s.learningObjectives,materialType:s.materialType,keyTopics:Array.isArray(s.keyTopics)?s.keyTopics.join(", "):s.keyTopics}),outputMapping:(s,t)=>({...t,title:s.title,content:s.content,exercises:s.exercises,summary:s.summary}),validation:s=>!!(s.title&&s.content&&s.exercises&&s.summary)},Ge={subject:{minLength:5,errorMessage:"Temat jest wymagany (5-200 znaków)"},activityTitle:{minLength:3,maxLength:100,errorMessage:"Tytuł jest wymagany (3-100 znaków)"},content:{minLength:100,errorMessage:"Treść materiału jest wymagana (min. 100 znaków)"},duration:{min:5,max:180,errorMessage:"Czas trwania musi być między 5 a 180 minut"}},bt={steps:{1:{title:"O czym chcesz stworzyć materiał?",description:"Podaj temat, poziom zaawansowania i grupę docelową - AI pomoże stworzyć angażujący materiał edukacyjny",button:"Analizuj temat",loading:"Analizuję temat..."},2:{title:"Analiza tematu",description:"AI przeanalizowała temat i zaproponowała strukturę materiału",success:"✓ Analiza zakończona pomyślnie"},3:{title:"Dostosuj cele i typ materiału",description:"Możesz zmodyfikować cele nauczania i wybrać typ materiału do wygenerowania",button:"Generuj materiał",loading:"Generuję materiał...",loadingInfo:"⚡ AI tworzy spersonalizowany materiał edukacyjny..."},4:{title:"Podgląd wygenerowanego materiału",description:"AI przygotowała kompletny materiał edukacyjny",info:"💡 W następnym kroku wybierzesz kurs i temat, do którego dodasz materiał."},5:{title:"Zapisz materiał w kursie",description:"Wybierz kurs i temat, następnie dostosuj materiał przed zapisaniem",saveInfo:"💾 Materiał zostanie zapisany jako nowa aktywność w wybranym temacie",button:"Zapisz materiał",loading:"Zapisuję...",success:"✓ Materiał został zapisany pomyślnie! Przekierowuję do kursu..."}},dashboard:{title:"Kreator materiałów edukacyjnych",description:"Twórz angażujące materiały z pomocą AI",wizardTitle:"Kreator materiałów AI",wizardDescription:"Stwórz materiał edukacyjny w 5 prostych krokach",features:["Automatyczna analiza tematu","Dostosowanie do wieku uczniów","Generowanie celów nauczania","Tworzenie ćwiczeń praktycznych","Formatowanie Markdown","Integracja z kursami"]},errors:{subjectRequired:"Podaj temat materiału",analysisError:"Błąd analizy tematu:",generationError:"Błąd generowania materiału:",saveError:"Wystąpił błąd podczas zapisu",unexpectedError:"Wystąpił nieoczekiwany błąd",noCourses:"Nie znaleziono żadnych kursów",noTopics:"Wybierz najpierw kurs"}},Ke={dashboard:"/educational-material",step1:"/educational-material/step1",step2:"/educational-material/step2",step3:"/educational-material/step3",step4:"/educational-material/step4",step5:"/educational-material/step5",courses:"/courses"},hp=()=>{const s=Q(),{getData:t}=me(),r=t("educational-material-wizard"),{dashboard:a}=bt,n=r&&r.title;return e.jsxs(M,{children:[e.jsx(J,{title:a.title,description:a.description}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-lg border border-purple-200",children:[e.jsxs(R,{variant:"start",className:"mb-4",children:[e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(Os,{className:"w-8 h-8 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:a.wizardTitle}),e.jsx("p",{className:"text-gray-600",children:a.wizardDescription})]})]}),e.jsxs(te,{variant:"1-2-2",className:"gap-4",children:[e.jsx("div",{className:"space-y-2",children:a.features.slice(0,3).map((i,o)=>e.jsxs(R,{variant:"start",className:"text-sm text-gray-700",children:[e.jsx(Re,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),e.jsx("span",{children:i})]},o))}),e.jsx("div",{className:"space-y-2",children:a.features.slice(3).map((i,o)=>e.jsxs(R,{variant:"start",className:"text-sm text-gray-700",children:[e.jsx(Re,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),e.jsx("span",{children:i})]},o))})]}),e.jsx("div",{className:"mt-6",children:e.jsxs(w,{onClick:()=>s(Ke.step1),className:"w-full md:w-auto",size:"lg",children:[e.jsx(Vt,{className:"w-4 h-4 mr-2"}),"Stwórz nowy materiał"]})})]}),n&&e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsxs(R,{variant:"between-center",className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Ostatni materiał"}),e.jsx("span",{className:"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm",children:"Zapisany"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Tytuł materiału"}),e.jsx("p",{className:"font-medium text-gray-900",children:r.title})]}),r.subject&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Temat"}),e.jsx("p",{className:"text-gray-900",children:r.subject})]}),r.targetLevel&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Poziom"}),e.jsx("p",{className:"text-gray-900",children:r.targetLevel==="beginner"?"Początkujący":r.targetLevel==="intermediate"?"Średniozaawansowany":"Zaawansowany"})]})]}),e.jsxs(R,{variant:"start",className:"mt-6 gap-3",children:[e.jsxs(w,{variant:"outline",onClick:()=>s(Ke.step4),children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Podgląd"]}),e.jsxs(w,{variant:"outline",onClick:()=>s(Ke.step5),children:[e.jsx(Na,{className:"w-4 h-4 mr-2"}),"Edytuj"]}),e.jsxs(w,{variant:"outline",onClick:()=>s(Ke.step1),children:[e.jsx(Zt,{className:"w-4 h-4 mr-2"}),"Nowy materiał"]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Zarządzanie kursami"}),e.jsxs(te,{variant:"1-2-3",className:"gap-4",children:[e.jsxs("button",{onClick:()=>s("/courses"),className:"p-4 bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow text-left",children:[e.jsxs(R,{variant:"start",className:"mb-2",children:[e.jsx(ge,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium",children:"Kursy"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Zobacz wszystkie kursy"})]}),e.jsxs("button",{onClick:()=>s("/topics"),className:"p-4 bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow text-left",children:[e.jsxs(R,{variant:"start",className:"mb-2",children:[e.jsx(Ee,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"font-medium",children:"Tematy"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Zarządzaj tematami kursów"})]}),e.jsxs("button",{onClick:()=>s("/activities"),className:"p-4 bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow text-left",children:[e.jsxs(R,{variant:"start",className:"mb-2",children:[e.jsx(mt,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium",children:"Aktywności"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Materiały i quizy"})]})]})]})]})]})},tr=({step:s})=>{const t=Q();return e.jsxs(e.Fragment,{children:[e.jsx(w,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 hover:bg-gray-100",onClick:()=>t("/educational-material"),children:e.jsx(He,{className:"h-5 w-5"})}),e.jsxs("div",{className:"p-8 space-y-12 text-zinc-800",children:[e.jsx("h1",{className:"text-6xl font-black",children:"SMART UP"}),e.jsxs("h2",{className:"text-4xl",children:["Stwórzmy razem ",e.jsx("br",{}),e.jsx("span",{className:"font-bold",children:"angażujący materiał"})]}),e.jsxs("p",{children:["Krok ",s," z 5"]})]}),e.jsx(zs,{className:"my-8"})]})},rr=({title:s,description:t})=>e.jsxs("header",{className:"mb-8",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-2 flex items-center gap-3",children:s}),e.jsx("p",{className:"text-gray-600",children:t})]}),jp=()=>{const s=Q(),{register:t,setData:r,getData:a}=me(),n=a("educational-material-wizard"),[i,o]=d.useState(""),[l,c]=d.useState(""),[u,x]=d.useState(""),[m,p]=d.useState(""),[g,b]=d.useState(""),[h,f]=d.useState({}),[y,j]=d.useState(null),[v,k]=d.useState(!1),C=jt("educational-material-wizard","analyze-topic"),{steps:z,errors:N}=bt,{data:I,isLoading:q}=je({resource:"courses",meta:{select:"*, topics(*)"},sorters:[{field:"created_at",order:"desc"}]}),P=I?.data?.find(D=>D.id.toString()===i),B=P?.topics||[];d.useEffect(()=>(t(yi),C.registerOperation(xp),()=>{C.unregisterOperation()}),[]),d.useEffect(()=>{if(!v&&I?.data){let D="",ee="",Pe="";const ae=sessionStorage.getItem("wizardContext");if(ae)try{const Y=JSON.parse(ae);j(Y),Y.courseId&&(D=Y.courseId.toString()),Y.topicId&&(ee=Y.topicId.toString()),Y.topicTitle&&(Pe=Y.topicTitle)}catch(Y){console.error("Error parsing wizard context:",Y)}!D&&n&&(n.courseId&&(D=n.courseId.toString()),n.topicId&&(ee=n.topicId.toString()),n.subject&&(Pe=n.subject),n.targetLevel&&p(n.targetLevel),n.ageGroup&&b(n.ageGroup)),D&&o(D),ee&&c(ee),Pe&&x(Pe),k(!0)}},[I,v,n]),d.useEffect(()=>{if(l&&B.length>0){const D=B.find(ee=>ee.id.toString()===l);D&&x(D.title)}},[l,B]);const T=()=>{const D={};return i||(D.courseId="Wybierz kurs"),l||(D.topicId="Wybierz temat z kursu"),(!u.trim()||u.length<Ge.subject.minLength)&&(D.subject=Ge.subject.errorMessage),m||(D.targetLevel="Wybierz poziom zaawansowania"),g||(D.ageGroup="Wybierz grupę wiekową"),f(D),Object.keys(D).length===0},E=async()=>{if(T())try{const D={courseId:parseInt(i),topicId:parseInt(l),subject:u.trim(),targetLevel:m,ageGroup:g,courseTitle:P?.title,topicTitle:B.find(ee=>ee.id.toString()===l)?.title};r("educational-material-wizard",D),await C.executeOperation(D),s(Ke.step2)}catch(D){console.error(N.analysisError,D)}};return e.jsx(M,{children:e.jsxs("div",{className:"border rounded-lg bg-white shadow relative pb-6",children:[e.jsx(tr,{step:1}),e.jsxs("div",{className:"p-6",children:[e.jsx(rr,{title:z[1].title,description:z[1].description}),y&&e.jsxs(oe,{className:"mb-4",children:[e.jsx(Ar,{className:"h-4 w-4"}),e.jsxs(le,{children:["Tworzysz materiał dla: ",e.jsx("strong",{children:y.courseTitle}),y.topicTitle&&e.jsxs(e.Fragment,{children:[" → ",e.jsx("strong",{children:y.topicTitle})]})]})]}),C.error&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("span",{className:"text-red-800 text-sm",children:[N.analysisError," ",C.error]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(S,{className:"border-2 border-purple-200 bg-purple-50/50",children:e.jsxs(_,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ge,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"font-semibold",children:"Wybierz miejsce w kursie"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(V,{htmlFor:"courseId",children:["Kurs ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(xe,{value:i,onValueChange:D=>{o(D),c(""),x("")},disabled:C.loading||q,children:[e.jsx(de,{className:h.courseId?"border-red-300":"",children:e.jsx(pe,{placeholder:"Wybierz kurs..."})}),e.jsx(ue,{children:I?.data?.map(D=>e.jsx(U,{value:D.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[D.icon_emoji&&e.jsx("span",{children:D.icon_emoji}),e.jsx("span",{children:D.title}),!D.is_published&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"(szkic)"})]})},D.id))})]}),h.courseId&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:h.courseId})]}),e.jsxs("div",{children:[e.jsxs(V,{htmlFor:"topicId",children:["Temat ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(xe,{value:l,onValueChange:c,disabled:!i||C.loading,children:[e.jsx(de,{className:h.topicId?"border-red-300":"",children:e.jsx(pe,{placeholder:i?"Wybierz temat...":"Najpierw wybierz kurs..."})}),e.jsx(ue,{children:B.sort((D,ee)=>D.position-ee.position).map(D=>e.jsx(U,{value:D.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:[D.position,". ",D.title]}),D.is_published===!1&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"(szkic)"})]})},D.id))})]}),h.topicId&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:h.topicId})]})]})]})}),e.jsx(zs,{}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"subject",children:"Temat materiału"}),e.jsx($,{id:"subject",type:"text",value:u,onChange:D=>x(D.target.value),placeholder:yi.schema.step1.properties.subject.placeholder,disabled:C.loading,className:h.subject?"border-red-300":""}),h.subject&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:h.subject}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Możesz dostosować temat materiału lub pozostawić sugerowany"})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"targetLevel",children:"Poziom zaawansowania"}),e.jsxs(xe,{value:m,onValueChange:p,disabled:C.loading,children:[e.jsx(de,{className:h.targetLevel?"border-red-300":"",children:e.jsx(pe,{placeholder:"Wybierz poziom..."})}),e.jsxs(ue,{children:[e.jsx(U,{value:"beginner",children:"Początkujący"}),e.jsx(U,{value:"intermediate",children:"Średniozaawansowany"}),e.jsx(U,{value:"advanced",children:"Zaawansowany"})]})]}),h.targetLevel&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:h.targetLevel})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"ageGroup",children:"Grupa wiekowa"}),e.jsxs(xe,{value:g,onValueChange:b,disabled:C.loading,children:[e.jsx(de,{className:h.ageGroup?"border-red-300":"",children:e.jsx(pe,{placeholder:"Wybierz grupę wiekową..."})}),e.jsxs(ue,{children:[e.jsx(U,{value:"7-10",children:"7-10 lat (szkoła podstawowa)"}),e.jsx(U,{value:"11-14",children:"11-14 lat (klasy 4-8)"}),e.jsx(U,{value:"15-18",children:"15-18 lat (szkoła średnia)"}),e.jsx(U,{value:"18+",children:"18+ (dorośli)"})]})]}),h.ageGroup&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:h.ageGroup})]}),e.jsx("button",{onClick:E,disabled:C.loading,className:"w-full h-12 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 text-white font-medium rounded-lg flex items-center justify-center gap-2",children:C.loading?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),z[1].loading]}):z[1].button})]})]})]})})},gp=()=>{const s=Q(),{getData:t}=me(),r=t("educational-material-wizard"),{steps:a}=bt;return e.jsx(M,{children:e.jsxs("div",{className:"border rounded-lg bg-white shadow relative pb-6",children:[e.jsx(tr,{step:2}),e.jsxs("div",{className:"space-y-6 p-8",children:[e.jsx(rr,{title:a[2].title,description:a[2].description}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsx("span",{className:"text-green-800 text-sm",children:a[2].success})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Temat"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-gray-800",children:r.subject})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kluczowe zagadnienia"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.keyTopics?.map((n,i)=>e.jsx("span",{className:"px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm",children:n},i))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cele nauczania"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-gray-800 whitespace-pre-wrap",children:r.learningObjectives})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Wymagania wstępne"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.prerequisites?.length>0?r.prerequisites.map((n,i)=>e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:n},i)):e.jsx("span",{className:"text-gray-500 text-sm",children:"Brak wymagań wstępnych"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Szacowany czas"}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg text-gray-800 font-medium",children:[r.estimatedDuration," minut"]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(w,{variant:"outline",onClick:()=>s(Ke.step1),children:"Wstecz"}),e.jsx(w,{onClick:()=>s(Ke.step3),children:"Kontynuuj"})]})]})]})]})})},fp=()=>{const s=Q(),{getData:t,setData:r}=me(),a=t("educational-material-wizard"),[n,i]=d.useState(a.learningObjectives||""),[o,l]=d.useState("mixed"),c=jt("educational-material-wizard","generate-material"),{steps:u,errors:x}=bt;d.useEffect(()=>(c.registerOperation(pp),()=>{c.unregisterOperation()}),[]);const m=async()=>{if(!(!n.trim()||!o))try{const p={...a,learningObjectives:n.trim(),materialType:o};r("educational-material-wizard",p),await c.executeOperation(p),s(Ke.step4)}catch(p){console.error(x.generationError,p)}};return e.jsx(M,{children:e.jsxs("div",{className:"border rounded-lg bg-white shadow relative pb-6",children:[e.jsx(tr,{step:3}),e.jsxs("div",{className:"space-y-6 p-8",children:[e.jsx(rr,{title:u[3].title,description:u[3].description}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(V,{htmlFor:"learningObjectives",children:"Cele nauczania"}),e.jsx(as,{id:"learningObjectives",value:n,onChange:p=>i(p.target.value),placeholder:"Dostosuj cele nauczania...",rows:6,className:"mt-1"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Możesz edytować automatycznie wygenerowane cele"})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"materialType",children:"Typ materiału"}),e.jsxs(xe,{value:o,onValueChange:l,children:[e.jsx(de,{className:"mt-1",children:e.jsx(pe,{placeholder:"Wybierz typ materiału..."})}),e.jsxs(ue,{children:[e.jsx(U,{value:"lesson",children:"Lekcja z teorią"}),e.jsx(U,{value:"exercise",children:"Ćwiczenia praktyczne"}),e.jsx(U,{value:"mixed",children:"Teoria + ćwiczenia"})]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(w,{variant:"outline",onClick:()=>s(Ke.step2),children:"Wstecz"}),e.jsx(w,{onClick:m,disabled:c.loading||!n.trim(),children:c.loading?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),u[3].loading]}):u[3].button})]})]}),c.loading&&e.jsx("div",{className:"mt-6 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:e.jsx("span",{className:"text-purple-800 text-sm",children:u[3].loadingInfo})})]})]})})},yp=()=>{const s=Q(),{getData:t}=me(),r=t("educational-material-wizard"),{steps:a}=bt;return e.jsx(M,{children:e.jsxs("div",{className:"border rounded-lg bg-white shadow relative pb-6",children:[e.jsx(tr,{step:4}),e.jsxs("div",{className:"space-y-6 p-8",children:[e.jsx(rr,{title:e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-8 h-8 text-zinc-500"}),e.jsx("span",{children:a[4].title})]}),description:a[4].description}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tytuł materiału"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-gray-800 font-medium",children:r.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Treść materiału"}),e.jsx("div",{className:"p-4 bg-gray-50 rounded-lg max-h-96 overflow-y-auto",children:e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx(fr,{children:r.content})})})]}),r.exercises&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ćwiczenia"}),e.jsx("div",{className:"p-4 bg-gray-50 rounded-lg max-h-64 overflow-y-auto",children:e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx(fr,{children:r.exercises})})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Podsumowanie"}),e.jsx("div",{className:"p-4 bg-gray-50 rounded-lg",children:e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx(fr,{children:r.summary})})})]})]}),e.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:e.jsx("p",{className:"text-purple-800 text-sm",children:a[4].info})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(w,{variant:"outline",onClick:()=>s(Ke.step3),children:"Wstecz"}),e.jsx(w,{onClick:()=>s(Ke.step5),children:"Zapisz w kursie"})]})]})]})})},bp=()=>{const s=Q(),{getData:t,setData:r}=me(),{mutate:a}=_s(),n=t("educational-material-wizard"),[i,o]=d.useState(n.title||""),[l,c]=d.useState(n.content+(n.exercises?`

## Ćwiczenia

${n.exercises}`:"")+(n.summary?`

## Podsumowanie

${n.summary}`:"")),[u,x]=d.useState(n.estimatedDuration||30),[m,p]=d.useState({}),[g,b]=d.useState(!1),[h,f]=d.useState(!1),{steps:y,errors:j}=bt,{data:v}=je({resource:"activities",filters:[{field:"topic_id",operator:"eq",value:n.topicId}],sorters:[{field:"position",order:"desc"}],pagination:{pageSize:1},queryOptions:{enabled:!!n.topicId}}),k=v?.data?.[0]?.position?v.data[0].position+1:1,C=()=>{const N={};return(!i.trim()||i.length<Ge.activityTitle.minLength)&&(N.activityTitle=Ge.activityTitle.errorMessage),(!l.trim()||l.length<Ge.content.minLength)&&(N.content=Ge.content.errorMessage),(!u||u<Ge.duration.min||u>Ge.duration.max)&&(N.duration=Ge.duration.errorMessage),p(N),Object.keys(N).length===0},z=async()=>{if(C()){b(!0);try{a({resource:"activities",values:{topic_id:n.topicId,type:"material",title:i.trim(),content:l.trim(),position:k,duration_min:u,is_published:!1}},{onSuccess:N=>{r("educational-material-wizard",{...n,activityTitle:i.trim(),content:l.trim(),activityId:N.data.id,saved:!0}),b(!1),f(!0);const I=sessionStorage.getItem("returnUrl");setTimeout(()=>{sessionStorage.removeItem("wizardContext"),I?(sessionStorage.removeItem("returnUrl"),s(I)):s(`${Ke.courses}/show/${n.courseId}?expanded=${n.topicId}`)},2e3)},onError:N=>{b(!1),console.error(j.saveError,N),alert(j.saveError)}})}catch(N){b(!1),console.error(j.unexpectedError,N),alert(j.unexpectedError)}}};return e.jsx(M,{children:e.jsxs("div",{className:"border rounded-lg bg-white shadow relative",children:[e.jsx(tr,{step:5}),e.jsxs("div",{className:"p-8",children:[e.jsx(rr,{title:e.jsxs(e.Fragment,{children:[e.jsx(Ee,{className:"w-8 h-8 text-purple-500"}),e.jsx("span",{children:y[5].title})]}),description:y[5].description}),h&&e.jsx(oe,{className:"mb-6 bg-green-50 border-green-200",children:e.jsx(le,{className:"text-green-800",children:y[5].success})}),e.jsxs("form",{className:"space-y-6",onSubmit:N=>{N.preventDefault(),z()},children:[e.jsx(S,{className:"bg-muted/50",children:e.jsx(_,{className:"pt-6",children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Kurs:"})," ",n.courseTitle]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Temat:"})," ",n.topicTitle]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Pozycja:"})," ",k]})]})})}),e.jsxs("div",{children:[e.jsxs(V,{htmlFor:"activityTitle",children:["Tytuł aktywności ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx($,{id:"activityTitle",type:"text",value:i,onChange:N=>o(N.target.value),placeholder:"np. Wprowadzenie do zmiennych",maxLength:Ge.activityTitle.maxLength,className:m.activityTitle?"border-red-300":""}),m.activityTitle&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:m.activityTitle})]}),e.jsxs("div",{children:[e.jsxs(V,{htmlFor:"duration",children:["Czas trwania (min) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx($,{id:"duration",type:"number",value:u,onChange:N=>x(parseInt(N.target.value)||0),min:Ge.duration.min,max:Ge.duration.max,className:m.duration?"border-red-300":""}),m.duration&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:m.duration})]}),e.jsxs("div",{children:[e.jsxs(V,{htmlFor:"content",children:["Treść materiału ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(as,{id:"content",value:l,onChange:N=>c(N.target.value),placeholder:"Treść materiału w formacie Markdown...",rows:15,className:`font-mono text-sm ${m.content?"border-red-300":""}`}),m.content&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:m.content}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[l.length," znaków (minimum ",Ge.content.minLength,")"]})]}),e.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:e.jsx("p",{className:"text-purple-800 text-sm",children:y[5].saveInfo})}),e.jsx(zs,{}),e.jsxs("footer",{className:"flex justify-between gap-4",children:[e.jsxs(w,{type:"button",variant:"outline",onClick:()=>s(Ke.step4),disabled:g,className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Wstecz"]}),e.jsx(w,{type:"submit",disabled:g||h,className:"flex items-center gap-2 min-w-[160px]",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),y[5].loading]}):e.jsxs(e.Fragment,{children:[e.jsx(Qt,{className:"w-4 h-4"}),y[5].button]})})]})]})]})]})})},wp=[e.jsx(O,{path:"/educational-material",element:e.jsx(hp,{})},"material-dashboard"),e.jsx(O,{path:"/educational-material/step1",element:e.jsx(jp,{})},"material-step1"),e.jsx(O,{path:"/educational-material/step2",element:e.jsx(gp,{})},"material-step2"),e.jsx(O,{path:"/educational-material/step3",element:e.jsx(fp,{})},"material-step3"),e.jsx(O,{path:"/educational-material/step4",element:e.jsx(yp,{})},"material-step4"),e.jsx(O,{path:"/educational-material/step5",element:e.jsx(bp,{})},"material-step5")],vp={name:"educational-materials",list:"/educational-material",create:"/educational-material/step1",meta:{canDelete:!1,label:"Kreator materiałów",icon:e.jsx(Lr,{className:"h-4 w-4"})}},bi={id:"quiz-wizard",title:"Kreator quizów",schema:{step1:{title:"Podstawowe informacje o quizie",type:"object",properties:{topic:{type:"text",title:"Temat quizu",placeholder:"np. Podstawy programowania w Python"},difficulty:{type:"select",title:"Poziom trudności",options:[{value:"easy",label:"Łatwy"},{value:"medium",label:"Średni"},{value:"hard",label:"Trudny"}]},questionsCount:{type:"number",title:"Liczba pytań",placeholder:"10",min:5,max:30},questionTypes:{type:"multiselect",title:"Typy pytań",options:[{value:"single",label:"Jednokrotny wybór"},{value:"multiple",label:"Wielokrotny wybór"},{value:"truefalse",label:"Prawda/Fałsz"}]}},required:["topic","difficulty","questionsCount"]},step2:{title:"Analiza tematu",type:"object",properties:{keyTopics:{type:"tags",title:"Kluczowe zagadnienia",readOnly:!0},learningObjectives:{type:"textarea",title:"Cele sprawdzające",readOnly:!0},suggestedTime:{type:"number",title:"Sugerowany czas (min)",readOnly:!0},passingScore:{type:"number",title:"Próg zaliczenia (%)",readOnly:!0}}},step3:{title:"Parametry quizu",type:"object",properties:{quizTitle:{type:"text",title:"Tytuł quizu",placeholder:"np. Test wiedzy - Zmienne i typy danych"},passingScore:{type:"number",title:"Próg zaliczenia (%)",placeholder:"70",min:50,max:100},timeLimit:{type:"number",title:"Limit czasu (min)",placeholder:"Pozostaw puste dla braku limitu",min:5,max:180},maxAttempts:{type:"number",title:"Maksymalna liczba podejść",placeholder:"Pozostaw puste dla nieograniczonej liczby",min:1,max:10},shuffleQuestions:{type:"checkbox",title:"Losowa kolejność pytań"},showExplanations:{type:"checkbox",title:"Pokazuj wyjaśnienia po odpowiedzi"}},required:["quizTitle","passingScore"]},step4:{title:"Podgląd wygenerowanych pytań",type:"object",properties:{questions:{type:"array",title:"Lista pytań",readOnly:!0}}},step5:{title:"Finalizacja i zapis",type:"object",properties:{courseId:{type:"select",title:"Wybierz kurs",placeholder:"Wybierz kurs..."},topicId:{type:"select",title:"Wybierz temat",placeholder:"Najpierw wybierz kurs..."},finalTitle:{type:"text",title:"Ostateczny tytuł",placeholder:"Tytuł quizu"},questions:{type:"array",title:"Pytania do edycji"}},required:["courseId","topicId","finalTitle"]}}},Np={id:"analyze-quiz-topic",name:"Analiza tematu quizu",config:{endpoint:"https://diesel-power-backend.onrender.com/api/chat"},prompt:{system:"Jesteś ekspertem od tworzenia testów i quizów edukacyjnych.",user:`
Przeanalizuj temat dla quizu:
Temat: {{topic}}
Poziom trudności: {{difficulty}}
Liczba pytań: {{questionsCount}}

Wygeneruj JSON:
{
  "keyTopics": ["zagadnienie1", "zagadnienie2", "zagadnienie3"],
  "learningObjectives": "<cele sprawdzające - co quiz ma zweryfikować>",
  "suggestedTime": <liczba minut>,
  "passingScore": <próg zaliczenia w %>
}

Wymagania:
- KeyTopics: 5-10 kluczowych zagadnień do sprawdzenia
- LearningObjectives: konkretne umiejętności do weryfikacji (50-150 słów)
- SuggestedTime: 1-3 minuty na pytanie
- PassingScore: 60-80% w zależności od trudności
    `,responseFormat:"json"},inputMapping:s=>({topic:s.topic,difficulty:s.difficulty,questionsCount:s.questionsCount}),outputMapping:(s,t)=>({...t,keyTopics:s.keyTopics,learningObjectives:s.learningObjectives,suggestedTime:s.suggestedTime,passingScore:s.passingScore}),validation:s=>!!(s.keyTopics&&s.learningObjectives&&s.suggestedTime&&s.passingScore)},zp={id:"generate-quiz-questions",name:"Generowanie pytań quizowych",config:{endpoint:"https://diesel-power-backend.onrender.com/api/chat"},prompt:{system:"Jesteś ekspertem od tworzenia pytań testowych. Tworzysz rzetelne, dobrze sformułowane pytania sprawdzające wiedzę.",user:`
Stwórz pytania quizowe:

Temat: {{topic}}
Poziom trudności: {{difficulty}}
Liczba pytań: {{questionsCount}}
Typy pytań: {{questionTypes}}
Kluczowe zagadnienia: {{keyTopics}}
Cele: {{learningObjectives}}

Wygeneruj JSON z tablicą pytań:
{
  "quizTitle": "<tytuł quizu>",
  "questions": [
    {
      "question": "<treść pytania>",
      "type": "single|multiple|truefalse",
      "options": [
        {"text": "<treść opcji>", "is_correct": true/false},
        {"text": "<treść opcji>", "is_correct": true/false}
      ],
      "explanation": "<wyjaśnienie poprawnej odpowiedzi>",
      "points": <liczba punktów 1-5>
    }
  ]
}

Wymagania:
- Pytania jasne i jednoznaczne
- 4 opcje dla single/multiple, 2 dla true/false
- Dokładnie jedna poprawna dla single, 1-3 dla multiple
- Wyjaśnienia edukacyjne (30-100 słów)
- Punkty: łatwe=1-2, średnie=2-3, trudne=3-5
- Różnorodność typów pytań
- Pokrycie wszystkich kluczowych zagadnień
    `,responseFormat:"json"},inputMapping:s=>({topic:s.topic,difficulty:s.difficulty,questionsCount:s.questionsCount,questionTypes:Array.isArray(s.questionTypes)?s.questionTypes.join(", "):s.questionTypes||"single, multiple, truefalse",keyTopics:Array.isArray(s.keyTopics)?s.keyTopics.join(", "):s.keyTopics,learningObjectives:s.learningObjectives}),outputMapping:(s,t)=>({...t,quizTitle:s.quizTitle,questions:s.questions}),validation:s=>!!(s.quizTitle&&s.questions&&Array.isArray(s.questions)&&s.questions.length>0)},ie={topic:{minLength:5,errorMessage:"Temat jest wymagany (5-200 znaków)"},quizTitle:{minLength:5,maxLength:100,errorMessage:"Tytuł jest wymagany (5-100 znaków)"},questionsCount:{min:5,max:30,errorMessage:"Liczba pytań musi być między 5 a 30"},passingScore:{min:50,max:100,errorMessage:"Próg zaliczenia musi być między 50% a 100%"},timeLimit:{min:5,max:180,errorMessage:"Limit czasu musi być między 5 a 180 minut"},maxAttempts:{min:1,max:10,errorMessage:"Liczba podejść musi być między 1 a 10"}},wt={steps:{1:{title:"Jaki quiz chcesz stworzyć?",description:"Podaj temat, poziom trudności i liczbę pytań - AI wygeneruje profesjonalny quiz",button:"Analizuj temat",loading:"Analizuję temat..."},2:{title:"Analiza tematu quizu",description:"AI przeanalizowała temat i zaproponowała parametry quizu",success:"✓ Analiza zakończona pomyślnie"},3:{title:"Skonfiguruj parametry quizu",description:"Dostosuj ustawienia quizu według swoich potrzeb",button:"Generuj pytania",loading:"Generuję pytania...",loadingInfo:"⚡ AI tworzy zestaw pytań dostosowanych do tematu..."},4:{title:"Podgląd wygenerowanych pytań",description:"AI przygotowała kompletny zestaw pytań",info:"💡 W następnym kroku będziesz mógł edytować pytania i wybrać kurs."},5:{title:"Zapisz quiz w kursie",description:"Wybierz kurs i temat, sprawdź pytania przed zapisaniem",saveInfo:"💾 Quiz zostanie zapisany jako nowa aktywność z wygenerowanymi pytaniami",button:"Zapisz quiz",loading:"Zapisuję...",success:"✓ Quiz został zapisany pomyślnie! Przekierowuję do zarządzania pytaniami..."}},dashboard:{title:"Kreator quizów",description:"Twórz profesjonalne testy sprawdzające z pomocą AI",wizardTitle:"Kreator quizów AI",wizardDescription:"Stwórz quiz w 5 prostych krokach",features:["Automatyczna analiza tematu","Generowanie różnych typów pytań","Dostosowanie poziomu trudności","Inteligentne wyjaśnienia odpowiedzi","Konfiguracja parametrów quizu","Edycja i dostosowanie pytań"]},errors:{topicRequired:"Podaj temat quizu",analysisError:"Błąd analizy tematu:",generationError:"Błąd generowania pytań:",saveError:"Wystąpił błąd podczas zapisu",unexpectedError:"Wystąpił nieoczekiwany błąd",noCourses:"Nie znaleziono żadnych kursów",noTopics:"Wybierz najpierw kurs",noQuestions:"Brak pytań do zapisania"}},Ze={dashboard:"/quiz-wizard",step1:"/quiz-wizard/step1",step2:"/quiz-wizard/step2",step3:"/quiz-wizard/step3",step4:"/quiz-wizard/step4",step5:"/quiz-wizard/step5",questions:"/questions/manage"},kp=()=>{const s=Q(),{getData:t}=me(),r=t("quiz-wizard"),{dashboard:a}=wt,n=r&&r.quizTitle;return e.jsxs(M,{children:[e.jsx(J,{title:a.title,description:a.description}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-cyan-50 p-6 rounded-lg border border-blue-200",children:[e.jsxs(R,{variant:"start",className:"mb-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(Qs,{className:"w-8 h-8 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:a.wizardTitle}),e.jsx("p",{className:"text-gray-600",children:a.wizardDescription})]})]}),e.jsxs(te,{variant:"1-2-2",className:"gap-4",children:[e.jsx("div",{className:"space-y-2",children:a.features.slice(0,3).map((i,o)=>e.jsxs(R,{variant:"start",className:"text-sm text-gray-700",children:[e.jsx(Re,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),e.jsx("span",{children:i})]},o))}),e.jsx("div",{className:"space-y-2",children:a.features.slice(3).map((i,o)=>e.jsxs(R,{variant:"start",className:"text-sm text-gray-700",children:[e.jsx(Re,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),e.jsx("span",{children:i})]},o))})]}),e.jsx("div",{className:"mt-6",children:e.jsxs(w,{onClick:()=>s(Ze.step1),className:"w-full md:w-auto",size:"lg",children:[e.jsx(Vt,{className:"w-4 h-4 mr-2"}),"Stwórz nowy quiz"]})})]}),n&&e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsxs(R,{variant:"between-center",className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Ostatni quiz"}),e.jsx("span",{className:"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm",children:"Zapisany"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Tytuł quizu"}),e.jsx("p",{className:"font-medium text-gray-900",children:r.quizTitle})]}),r.topic&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Temat"}),e.jsx("p",{className:"text-gray-900",children:r.topic})]}),r.questions&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Liczba pytań"}),e.jsxs("p",{className:"text-gray-900",children:[r.questions.length," pytań"]})]})]}),e.jsxs(R,{variant:"start",className:"mt-6 gap-3",children:[e.jsxs(w,{variant:"outline",onClick:()=>s(Ze.step4),children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Podgląd"]}),e.jsxs(w,{variant:"outline",onClick:()=>s(Ze.step5),children:[e.jsx(Na,{className:"w-4 h-4 mr-2"}),"Edytuj"]}),e.jsxs(w,{variant:"outline",onClick:()=>s(Ze.step1),children:[e.jsx(Zt,{className:"w-4 h-4 mr-2"}),"Nowy quiz"]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Zarządzanie quizami"}),e.jsxs(te,{variant:"1-2-3",className:"gap-4",children:[e.jsxs("button",{onClick:()=>s("/activities"),className:"p-4 bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow text-left",children:[e.jsxs(R,{variant:"start",className:"mb-2",children:[e.jsx(rs,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium",children:"Aktywności"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Wszystkie quizy i materiały"})]}),e.jsxs("button",{onClick:()=>s("/questions"),className:"p-4 bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow text-left",children:[e.jsxs(R,{variant:"start",className:"mb-2",children:[e.jsx(Ks,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"font-medium",children:"Pytania"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Zarządzaj pytaniami"})]}),e.jsxs("button",{onClick:()=>s("/reports"),className:"p-4 bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow text-left",children:[e.jsxs(R,{variant:"start",className:"mb-2",children:[e.jsx(qe,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium",children:"Wyniki"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Statystyki quizów"})]})]})]})]})]})},ar=({step:s})=>{const t=Q();return e.jsxs(e.Fragment,{children:[e.jsx(w,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 hover:bg-gray-100",onClick:()=>t("/quiz-wizard"),children:e.jsx(He,{className:"h-5 w-5"})}),e.jsxs("div",{className:"p-8 space-y-12 text-zinc-800",children:[e.jsx("h1",{className:"text-6xl font-black",children:"QUIZWISE."}),e.jsxs("h2",{className:"text-4xl",children:["Twórzmy razem ",e.jsx("br",{}),e.jsx("span",{className:"font-bold",children:"sprawdzian wiedzy"})]}),e.jsxs("p",{children:["Krok ",s," z 5"]})]}),e.jsx(zs,{className:"my-8"})]})},ir=({title:s,description:t})=>e.jsxs("header",{className:"mb-8",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-2 flex items-center gap-3",children:s}),e.jsx("p",{className:"text-gray-600",children:t})]}),Cp=()=>{const s=Q(),{register:t,setData:r}=me(),[a,n]=d.useState(""),[i,o]=d.useState(""),[l,c]=d.useState(""),[u,x]=d.useState(""),[m,p]=d.useState(10),[g,b]=d.useState(["single","multiple"]),[h,f]=d.useState({}),[y,j]=d.useState(null),v=jt("quiz-wizard","analyze-quiz-topic"),{steps:k,errors:C}=wt,{data:z,isLoading:N}=je({resource:"courses",filters:[{field:"is_published",operator:"eq",value:!0}],meta:{select:"*, topics(*)"},sorters:[{field:"created_at",order:"desc"}]}),I=z?.data?.find(E=>E.id.toString()===a),q=I?.topics||[];d.useEffect(()=>{t(bi),v.registerOperation(Np);const E=sessionStorage.getItem("wizardContext");if(E){const D=JSON.parse(E);j(D),D.courseId&&n(D.courseId.toString()),D.topicId&&o(D.topicId.toString()),D.topicTitle&&c(D.topicTitle)}return()=>{v.unregisterOperation()}},[]),d.useEffect(()=>{if(i&&q.length>0){const E=q.find(D=>D.id.toString()===i);E&&!l&&c(E.title)}},[i,q]);const P=()=>{const E={};return a||(E.courseId="Wybierz kurs"),i||(E.topicId="Wybierz temat z kursu"),(!l.trim()||l.length<ie.topic.minLength)&&(E.topic=ie.topic.errorMessage),u||(E.difficulty="Wybierz poziom trudności"),(!m||m<ie.questionsCount.min||m>ie.questionsCount.max)&&(E.questionsCount=ie.questionsCount.errorMessage),g.length===0&&(E.questionTypes="Wybierz przynajmniej jeden typ pytań"),f(E),Object.keys(E).length===0},B=async()=>{if(P())try{const E={courseId:parseInt(a),topicId:parseInt(i),topic:l.trim(),difficulty:u,questionsCount:m,questionTypes:g,courseTitle:I?.title,topicTitle:q.find(D=>D.id.toString()===i)?.title};r("quiz-wizard",E),await v.executeOperation(E),s(Ze.step2)}catch(E){console.error(C.analysisError,E)}},T=E=>{b(D=>D.includes(E)?D.filter(ee=>ee!==E):[...D,E])};return e.jsx(M,{children:e.jsxs("div",{className:"border rounded-lg bg-white shadow relative pb-6",children:[e.jsx(ar,{step:1}),e.jsxs("div",{className:"p-6",children:[e.jsx(ir,{title:k[1].title,description:k[1].description}),y&&e.jsxs(oe,{className:"mb-4",children:[e.jsx(Ar,{className:"h-4 w-4"}),e.jsxs(le,{children:["Tworzysz quiz dla: ",e.jsx("strong",{children:y.courseTitle}),y.topicTitle&&e.jsxs(e.Fragment,{children:[" → ",e.jsx("strong",{children:y.topicTitle})]})]})]}),v.error&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("span",{className:"text-red-800 text-sm",children:[C.analysisError," ",v.error]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(S,{className:"border-2 border-blue-200 bg-blue-50/50",children:e.jsxs(_,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ge,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-semibold",children:"Wybierz miejsce w kursie"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(V,{htmlFor:"courseId",children:["Kurs ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(xe,{value:a,onValueChange:E=>{n(E),o("")},disabled:v.loading||N||!!y?.courseId,children:[e.jsx(de,{className:h.courseId?"border-red-300":"",children:e.jsx(pe,{placeholder:"Wybierz kurs..."})}),e.jsx(ue,{children:z?.data?.map(E=>e.jsx(U,{value:E.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[E.icon_emoji&&e.jsx("span",{children:E.icon_emoji}),E.title]})},E.id))})]}),h.courseId&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:h.courseId})]}),e.jsxs("div",{children:[e.jsxs(V,{htmlFor:"topicId",children:["Temat ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(xe,{value:i,onValueChange:o,disabled:!a||v.loading||!!y?.topicId,children:[e.jsx(de,{className:h.topicId?"border-red-300":"",children:e.jsx(pe,{placeholder:a?"Wybierz temat...":"Najpierw wybierz kurs..."})}),e.jsx(ue,{children:q.sort((E,D)=>E.position-D.position).map(E=>e.jsxs(U,{value:E.id.toString(),children:[E.position,". ",E.title]},E.id))})]}),h.topicId&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:h.topicId})]})]})]})}),e.jsx(zs,{}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"topic",children:"Temat quizu"}),e.jsx($,{id:"topic",type:"text",value:l,onChange:E=>c(E.target.value),placeholder:bi.schema.step1.properties.topic.placeholder,disabled:v.loading,className:h.topic?"border-red-300":""}),h.topic&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:h.topic}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Możesz dostosować temat quizu lub pozostawić sugerowany"})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"difficulty",children:"Poziom trudności"}),e.jsxs(xe,{value:u,onValueChange:x,disabled:v.loading,children:[e.jsx(de,{className:h.difficulty?"border-red-300":"",children:e.jsx(pe,{placeholder:"Wybierz poziom..."})}),e.jsxs(ue,{children:[e.jsx(U,{value:"easy",children:"Łatwy"}),e.jsx(U,{value:"medium",children:"Średni"}),e.jsx(U,{value:"hard",children:"Trudny"})]})]}),h.difficulty&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:h.difficulty})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"questionsCount",children:"Liczba pytań"}),e.jsx($,{id:"questionsCount",type:"number",value:m,onChange:E=>p(parseInt(E.target.value)||0),min:ie.questionsCount.min,max:ie.questionsCount.max,disabled:v.loading,className:h.questionsCount?"border-red-300":""}),h.questionsCount&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:h.questionsCount})]}),e.jsxs("div",{children:[e.jsx(V,{children:"Typy pytań"}),e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ve,{id:"single",checked:g.includes("single"),onCheckedChange:()=>T("single"),disabled:v.loading}),e.jsx("label",{htmlFor:"single",className:"text-sm cursor-pointer",children:"Jednokrotny wybór"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ve,{id:"multiple",checked:g.includes("multiple"),onCheckedChange:()=>T("multiple"),disabled:v.loading}),e.jsx("label",{htmlFor:"multiple",className:"text-sm cursor-pointer",children:"Wielokrotny wybór"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ve,{id:"truefalse",checked:g.includes("truefalse"),onCheckedChange:()=>T("truefalse"),disabled:v.loading}),e.jsx("label",{htmlFor:"truefalse",className:"text-sm cursor-pointer",children:"Prawda/Fałsz"})]})]}),h.questionTypes&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:h.questionTypes})]}),e.jsx("button",{onClick:B,disabled:v.loading,className:"w-full h-12 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-medium rounded-lg flex items-center justify-center gap-2",children:v.loading?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),k[1].loading]}):k[1].button})]})]})]})})},Sp=()=>{const s=Q(),{getData:t}=me(),r=t("quiz-wizard"),{steps:a}=wt,n=o=>{switch(o){case"easy":return"Łatwy";case"medium":return"Średni";case"hard":return"Trudny";default:return o}},i=o=>{switch(o){case"single":return"Jednokrotny wybór";case"multiple":return"Wielokrotny wybór";case"truefalse":return"Prawda/Fałsz";default:return o}};return e.jsx(M,{children:e.jsxs("div",{className:"border rounded-lg bg-white shadow relative pb-6",children:[e.jsx(ar,{step:2}),e.jsxs("div",{className:"space-y-6 p-8",children:[e.jsx(ir,{title:a[2].title,description:a[2].description}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsx("span",{className:"text-green-800 text-sm",children:a[2].success})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Temat"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-gray-800",children:r.topic})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Poziom trudności"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-gray-800 font-medium",children:n(r.difficulty)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Liczba pytań"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-gray-800 font-medium",children:r.questionsCount})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Typy pytań"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:r.questionTypes?.map(o=>e.jsxs("span",{className:"text-sm text-gray-800",children:[i(o),r.questionTypes.indexOf(o)<r.questionTypes.length-1&&", "]},o))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kluczowe zagadnienia"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.keyTopics?.map((o,l)=>e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:o},l))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cele sprawdzające"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-gray-800 whitespace-pre-wrap",children:r.learningObjectives})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sugerowany czas"}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg text-gray-800 font-medium",children:[r.suggestedTime," minut"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sugerowany próg zaliczenia"}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg text-gray-800 font-medium",children:[r.passingScore,"%"]})]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(w,{variant:"outline",onClick:()=>s(Ze.step1),children:"Wstecz"}),e.jsx(w,{onClick:()=>s(Ze.step3),children:"Kontynuuj"})]})]})]})]})})},_p=()=>{const s=Q(),{getData:t,setData:r}=me(),a=t("quiz-wizard"),[n,i]=d.useState(a.quizTitle||""),[o,l]=d.useState(a.passingScore||70),[c,u]=d.useState(a.timeLimit||""),[x,m]=d.useState(a.maxAttempts||""),[p,g]=d.useState(!1),[b,h]=d.useState(!0),[f,y]=d.useState({}),j=jt("quiz-wizard","generate-quiz-questions"),{steps:v,errors:k}=wt;d.useEffect(()=>(j.registerOperation(zp),()=>{j.unregisterOperation()}),[]);const C=()=>{const N={};return(!n.trim()||n.length<ie.quizTitle.minLength)&&(N.quizTitle=ie.quizTitle.errorMessage),(!o||o<ie.passingScore.min||o>ie.passingScore.max)&&(N.passingScore=ie.passingScore.errorMessage),c&&(parseInt(c)<ie.timeLimit.min||parseInt(c)>ie.timeLimit.max)&&(N.timeLimit=ie.timeLimit.errorMessage),x&&(parseInt(x)<ie.maxAttempts.min||parseInt(x)>ie.maxAttempts.max)&&(N.maxAttempts=ie.maxAttempts.errorMessage),y(N),Object.keys(N).length===0},z=async()=>{if(C())try{const N={...a,quizTitle:n.trim(),passingScore:o,timeLimit:c?parseInt(c):null,maxAttempts:x?parseInt(x):null,shuffleQuestions:p,showExplanations:b};r("quiz-wizard",N),await j.executeOperation(N),s(Ze.step4)}catch(N){console.error(k.generationError,N)}};return e.jsx(M,{children:e.jsxs("div",{className:"border rounded-lg bg-white shadow relative pb-6",children:[e.jsx(ar,{step:3}),e.jsxs("div",{className:"space-y-6 p-8",children:[e.jsx(ir,{title:v[3].title,description:v[3].description}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs(V,{htmlFor:"quizTitle",children:["Tytuł quizu ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx($,{id:"quizTitle",value:n,onChange:N=>i(N.target.value),placeholder:"np. Test wiedzy - Zmienne i typy danych",className:`mt-1 ${f.quizTitle?"border-red-300":""}`}),f.quizTitle&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:f.quizTitle})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(V,{htmlFor:"passingScore",children:["Próg zaliczenia (%) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx($,{id:"passingScore",type:"number",value:o,onChange:N=>l(parseInt(N.target.value)||0),min:ie.passingScore.min,max:ie.passingScore.max,className:`mt-1 ${f.passingScore?"border-red-300":""}`}),f.passingScore&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:f.passingScore})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"timeLimit",children:"Limit czasu (min)"}),e.jsx($,{id:"timeLimit",type:"number",value:c,onChange:N=>u(N.target.value),placeholder:"Pozostaw puste dla braku limitu",min:ie.timeLimit.min,max:ie.timeLimit.max,className:`mt-1 ${f.timeLimit?"border-red-300":""}`}),f.timeLimit&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:f.timeLimit})]})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"maxAttempts",children:"Maksymalna liczba podejść"}),e.jsx($,{id:"maxAttempts",type:"number",value:x,onChange:N=>m(N.target.value),placeholder:"Pozostaw puste dla nieograniczonej liczby",min:ie.maxAttempts.min,max:ie.maxAttempts.max,className:`mt-1 ${f.maxAttempts?"border-red-300":""}`}),f.maxAttempts&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:f.maxAttempts})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ve,{id:"shuffleQuestions",checked:p,onCheckedChange:N=>g(N)}),e.jsx("label",{htmlFor:"shuffleQuestions",className:"text-sm cursor-pointer",children:"Losowa kolejność pytań"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ve,{id:"showExplanations",checked:b,onCheckedChange:N=>h(N)}),e.jsx("label",{htmlFor:"showExplanations",className:"text-sm cursor-pointer",children:"Pokazuj wyjaśnienia po odpowiedzi"})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(w,{variant:"outline",onClick:()=>s(Ze.step2),children:"Wstecz"}),e.jsx(w,{onClick:z,disabled:j.loading,children:j.loading?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),v[3].loading]}):v[3].button})]})]}),j.loading&&e.jsx("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsx("span",{className:"text-blue-800 text-sm",children:v[3].loadingInfo})})]})]})})},Tp=()=>{const s=Q(),{getData:t}=me(),r=t("quiz-wizard"),{steps:a}=wt,n=o=>{switch(o){case"single":return"Jednokrotny wybór";case"multiple":return"Wielokrotny wybór";case"truefalse":return"Prawda/Fałsz";default:return o}},i=o=>{switch(o){case"single":return"default";case"multiple":return"secondary";case"truefalse":return"outline";default:return"default"}};return e.jsx(M,{children:e.jsxs("div",{className:"border rounded-lg bg-white shadow relative pb-6",children:[e.jsx(ar,{step:4}),e.jsxs("div",{className:"space-y-6 p-8",children:[e.jsx(ir,{title:e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-8 h-8 text-zinc-500"}),e.jsx("span",{children:a[4].title})]}),description:a[4].description}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:r.quizTitle}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Liczba pytań:"}),e.jsx("span",{className:"ml-2 font-medium",children:r.questions?.length||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Próg zaliczenia:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[r.passingScore,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Limit czasu:"}),e.jsx("span",{className:"ml-2 font-medium",children:r.timeLimit?`${r.timeLimit} min`:"Brak"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Max. podejść:"}),e.jsx("span",{className:"ml-2 font-medium",children:r.maxAttempts||"Bez limitu"})]})]})]}),e.jsx("div",{className:"space-y-4",children:r.questions?.map((o,l)=>e.jsxs("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("h5",{className:"font-medium",children:["Pytanie ",l+1]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(H,{variant:i(o.type),children:n(o.type)}),e.jsxs(H,{variant:"outline",children:[o.points," pkt"]})]})]}),e.jsx("p",{className:"text-gray-700",children:o.question})]}),e.jsx("div",{className:"space-y-2 mb-3",children:o.options?.map((c,u)=>e.jsxs("div",{className:`flex items-center gap-2 p-2 rounded ${c.is_correct?"bg-green-50 border border-green-200":"bg-gray-50"}`,children:[c.is_correct?e.jsx(Re,{className:"w-4 h-4 text-green-600 flex-shrink-0"}):e.jsx(He,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:c.is_correct?"font-medium":"",children:c.text})]},u))}),o.explanation&&e.jsx("div",{className:"bg-blue-50 p-3 rounded",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Wyjaśnienie:"})," ",o.explanation]})})]},l))})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsx("p",{className:"text-blue-800 text-sm",children:a[4].info})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(w,{variant:"outline",onClick:()=>s(Ze.step3),children:"Wstecz"}),e.jsx(w,{onClick:()=>s(Ze.step5),children:"Zapisz w kursie"})]})]})]})})},Dp=()=>{const s=Q(),{getData:t,setData:r}=me(),{mutate:a}=_s(),{mutate:n}=_s(),i=t("quiz-wizard"),[o,l]=d.useState(""),[c,u]=d.useState(""),[x,m]=d.useState(i.quizTitle||""),[p,g]=d.useState({}),[b,h]=d.useState(!1),[f,y]=d.useState(!1),{steps:j,errors:v}=wt,{data:k}=je({resource:"courses",meta:{select:"id, title, is_published"},filters:[{field:"is_published",operator:"eq",value:!0}]}),{data:C}=je({resource:"topics",filters:[{field:"course_id",operator:"eq",value:o}],sorters:[{field:"position",order:"asc"}],queryOptions:{enabled:!!o}}),{data:z}=je({resource:"activities",filters:[{field:"topic_id",operator:"eq",value:c}],sorters:[{field:"position",order:"desc"}],pagination:{pageSize:1},queryOptions:{enabled:!!c}}),N=z?.data?.[0]?.position?z.data[0].position+1:1,I=()=>{const T={};return o||(T.courseId="Wybierz kurs"),c||(T.topicId="Wybierz temat"),(!x.trim()||x.length<ie.quizTitle.minLength)&&(T.finalTitle=ie.quizTitle.errorMessage),(!i.questions||i.questions.length===0)&&(T.questions=v.noQuestions),g(T),Object.keys(T).length===0},q=async()=>{if(I()){h(!0),y(!1);try{a({resource:"activities",values:{topic_id:parseInt(c),type:"quiz",title:x.trim(),position:N,duration_min:i.suggestedTime||i.timeLimit||30,is_published:!1,passing_score:i.passingScore,time_limit:i.timeLimit||null,max_attempts:i.maxAttempts||null}},{onSuccess:async T=>{const E=T.data.id;try{for(let D=0;D<i.questions.length;D++){const ee=i.questions[D];await new Promise((Pe,ae)=>{n({resource:"questions",values:{activity_id:E,question:ee.question,explanation:ee.explanation,points:ee.points,position:D+1,options:ee.options.map((Y,G)=>({id:G+1,text:Y.text,is_correct:Y.is_correct}))}},{onSuccess:Pe,onError:ae})})}r("quiz-wizard",{...i,finalTitle:x.trim(),courseId:o,topicId:c,activityId:E,saved:!0}),h(!1),y(!0),setTimeout(()=>{s(`${Ze.questions}/${E}`)},2e3)}catch(D){h(!1),y(!1),console.error("Błąd podczas zapisywania pytań:",D),F.error("Wystąpił błąd podczas zapisywania pytań. Spróbuj ponownie.")}},onError:T=>{h(!1),y(!1),console.error(v.saveError,T),F.error(v.saveError)}})}catch(T){h(!1),y(!1),console.error(v.unexpectedError,T),F.error(v.unexpectedError)}}},P=T=>T.id!==void 0&&T.title!==void 0,B=T=>T.id!==void 0&&T.title!==void 0&&T.position!==void 0;return e.jsx(M,{children:e.jsxs("div",{className:"border rounded-lg bg-white shadow relative",children:[e.jsx(ar,{step:5}),e.jsxs("div",{className:"p-8",children:[e.jsx(ir,{title:e.jsxs(e.Fragment,{children:[e.jsx(rs,{className:"w-8 h-8 text-blue-500"}),e.jsx("span",{children:j[5].title})]}),description:j[5].description}),f&&e.jsx(oe,{className:"mb-6 bg-green-50 border-green-200",children:e.jsx(le,{className:"text-green-800",children:j[5].success})}),e.jsxs("form",{className:"space-y-6",onSubmit:T=>{T.preventDefault(),q()},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(V,{htmlFor:"courseId",children:["Kurs ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(xe,{value:o,onValueChange:T=>{l(T),u("")},children:[e.jsx(de,{className:p.courseId?"border-red-300":"",children:e.jsx(pe,{placeholder:"Wybierz kurs..."})}),e.jsx(ue,{children:k?.data?.map(T=>P(T)?e.jsx(U,{value:T.id.toString(),children:T.title},T.id):null)})]}),p.courseId&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:p.courseId})]}),e.jsxs("div",{children:[e.jsxs(V,{htmlFor:"topicId",children:["Temat ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(xe,{value:c,onValueChange:u,disabled:!o,children:[e.jsx(de,{className:p.topicId?"border-red-300":"",children:e.jsx(pe,{placeholder:o?"Wybierz temat...":"Najpierw wybierz kurs..."})}),e.jsx(ue,{children:C?.data?.map(T=>B(T)?e.jsxs(U,{value:T.id.toString(),children:[T.position,". ",T.title]},T.id):null)})]}),p.topicId&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:p.topicId})]})]}),e.jsxs("div",{children:[e.jsxs(V,{htmlFor:"finalTitle",children:["Tytuł quizu ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx($,{id:"finalTitle",type:"text",value:x,onChange:T=>m(T.target.value),placeholder:"Tytuł quizu",maxLength:ie.quizTitle.maxLength,className:p.finalTitle?"border-red-300":""}),p.finalTitle&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:p.finalTitle})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Podsumowanie quizu"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Liczba pytań:"}),e.jsx("span",{className:"ml-2 font-medium",children:i.questions?.length||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Próg zaliczenia:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[i.passingScore,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Limit czasu:"}),e.jsx("span",{className:"ml-2 font-medium",children:i.timeLimit?`${i.timeLimit} min`:"Brak"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Łączna liczba punktów:"}),e.jsx("span",{className:"ml-2 font-medium",children:i.questions?.reduce((T,E)=>T+E.points,0)||0})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-3",children:["Pytania (",i.questions?.length||0,")"]}),e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2 border rounded-lg p-3",children:i.questions?.map((T,E)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsxs("span",{className:"text-sm truncate flex-1",children:[E+1,". ",T.question]}),e.jsxs("span",{className:"text-sm font-medium ml-2",children:[T.points," pkt"]})]},E))})]}),e.jsxs(oe,{className:"bg-yellow-50 border-yellow-200",children:[e.jsx(qt,{className:"h-4 w-4 text-yellow-800"}),e.jsx(le,{className:"text-yellow-800",children:"Po zapisaniu będziesz mógł edytować pytania w panelu zarządzania quizem"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsx("p",{className:"text-blue-800 text-sm",children:j[5].saveInfo})}),e.jsx(zs,{}),e.jsxs("footer",{className:"flex justify-between gap-4",children:[e.jsxs(w,{type:"button",variant:"outline",onClick:()=>s(Ze.step4),disabled:b,className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Wstecz"]}),e.jsx(w,{type:"submit",disabled:b||f,className:"flex items-center gap-2 min-w-[160px]",children:b?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),j[5].loading]}):e.jsxs(e.Fragment,{children:[e.jsx(Qt,{className:"w-4 h-4"}),j[5].button]})})]})]})]})]})})},Ip=[e.jsx(O,{path:"/quiz-wizard",element:e.jsx(kp,{})},"quiz-dashboard"),e.jsx(O,{path:"/quiz-wizard/step1",element:e.jsx(Cp,{})},"quiz-step1"),e.jsx(O,{path:"/quiz-wizard/step2",element:e.jsx(Sp,{})},"quiz-step2"),e.jsx(O,{path:"/quiz-wizard/step3",element:e.jsx(_p,{})},"quiz-step3"),e.jsx(O,{path:"/quiz-wizard/step4",element:e.jsx(Tp,{})},"quiz-step4"),e.jsx(O,{path:"/quiz-wizard/step5",element:e.jsx(Dp,{})},"quiz-step5")],Pp={name:"quiz-wizard",list:"/quiz-wizard",create:"/quiz-wizard/step1",meta:{canDelete:!1,label:"Kreator quizów",icon:e.jsx(Lr,{className:"h-4 w-4"})}},Rp={id:"course-structure-wizard",title:"Kreator struktury kursu",schema:{step1:{title:"Podstawowe informacje o kursie",type:"object",properties:{courseType:{type:"select",title:"Typ kursu",options:[{value:"matura",label:"Kurs maturalny"},{value:"academic",label:"Kurs akademicki"},{value:"professional",label:"Kurs zawodowy"},{value:"hobby",label:"Kurs hobbystyczny"},{value:"certification",label:"Kurs certyfikacyjny"}]},subject:{type:"text",title:"Przedmiot/Dziedzina",placeholder:"np. Matematyka, Programowanie Python, Język angielski"},level:{type:"select",title:"Poziom kursu",options:[{value:"basic",label:"Podstawowy"},{value:"extended",label:"Rozszerzony"},{value:"beginner",label:"Początkujący"},{value:"intermediate",label:"Średniozaawansowany"},{value:"advanced",label:"Zaawansowany"}]},duration:{type:"select",title:"Planowany czas trwania",options:[{value:"1month",label:"1 miesiąc"},{value:"3months",label:"3 miesiące"},{value:"6months",label:"6 miesięcy"},{value:"1year",label:"1 rok"},{value:"2years",label:"2 lata"}]}},required:["courseType","subject","level","duration"]},step2:{title:"Analiza wymagań",type:"object",properties:{courseTitle:{type:"text",title:"Proponowany tytuł kursu",readOnly:!0},description:{type:"textarea",title:"Opis kursu",readOnly:!0},objectives:{type:"tags",title:"Cele kursu",readOnly:!0},targetAudience:{type:"text",title:"Grupa docelowa",readOnly:!0},prerequisites:{type:"tags",title:"Wymagania wstępne",readOnly:!0},estimatedHours:{type:"number",title:"Szacowana liczba godzin",readOnly:!0},topicsCount:{type:"number",title:"Liczba głównych tematów",readOnly:!0}}},step3:{title:"Dostosowanie struktury",type:"object",properties:{courseTitle:{type:"text",title:"Tytuł kursu",placeholder:"np. Matematyka - Przygotowanie do matury"},description:{type:"textarea",title:"Opis kursu",rows:4},topicsPerWeek:{type:"number",title:"Liczba tematów na tydzień",min:1,max:7},includeExercises:{type:"checkbox",title:"Dodaj ćwiczenia do każdego tematu"},includeQuizzes:{type:"checkbox",title:"Dodaj quizy sprawdzające"},quizFrequency:{type:"select",title:"Częstotliwość quizów",options:[{value:"after_each",label:"Po każdym temacie"},{value:"weekly",label:"Co tydzień"},{value:"biweekly",label:"Co dwa tygodnie"},{value:"monthly",label:"Co miesiąc"},{value:"chapter_end",label:"Na koniec działu"}]}},required:["courseTitle","description","topicsPerWeek"]},step4:{title:"Podgląd struktury",type:"object",properties:{structure:{type:"array",title:"Struktura kursu",readOnly:!0}}},step5:{title:"Tworzenie kursu",type:"object",properties:{courseName:{type:"text",title:"Ostateczna nazwa kursu"},iconEmoji:{type:"text",title:"Emoji ikona",placeholder:"np. 📚 📐 🎓"},isPublished:{type:"checkbox",title:"Opublikuj od razu"}},required:["courseName"]}}},Ep={id:"analyze-course-requirements",name:"Analiza wymagań kursu",config:{endpoint:"https://diesel-power-backend.onrender.com/api/chat"},prompt:{system:"Jesteś ekspertem od projektowania kursów edukacyjnych i programów nauczania.",user:`
Przeanalizuj wymagania dla kursu:
Typ: {{courseType}}
Przedmiot: {{subject}}
Poziom: {{level}}
Czas trwania: {{duration}}

Wygeneruj JSON:
{
  "courseTitle": "<tytuł kursu odpowiedni do typu i poziomu>",
  "description": "<szczegółowy opis kursu 100-200 słów>",
  "objectives": ["cel1", "cel2", "cel3", "cel4", "cel5"],
  "targetAudience": "<opis grupy docelowej>",
  "prerequisites": ["wymaganie1", "wymaganie2"],
  "estimatedHours": <liczba godzin>,
  "topicsCount": <liczba głównych tematów>
}

Wymagania:
- Dla kursów maturalnych: zgodność z podstawą programową
- CourseTitle: profesjonalny i opisowy
- Description: zawiera zakres materiału i metodykę
- Objectives: 5-8 konkretnych, mierzalnych celów
- Prerequisites: realistyczne wymagania (może być pusta tablica)
- EstimatedHours: realistyczna liczba godzin
- TopicsCount: odpowiednia liczba tematów do czasu trwania
    `,responseFormat:"json"},inputMapping:s=>({courseType:s.courseType,subject:s.subject,level:s.level,duration:s.duration}),outputMapping:(s,t)=>({...t,courseTitle:s.courseTitle,description:s.description,objectives:s.objectives,targetAudience:s.targetAudience,prerequisites:s.prerequisites,estimatedHours:s.estimatedHours,topicsCount:s.topicsCount}),validation:s=>!!(s.courseTitle&&s.description&&s.objectives&&s.topicsCount)},Mp={id:"generate-course-structure",name:"Generowanie struktury kursu",config:{endpoint:"https://diesel-power-backend.onrender.com/api/chat"},prompt:{system:"Jesteś ekspertem od tworzenia szczegółowych programów nauczania. Tworzysz logiczną, progresywną strukturę kursu.",user:`
Stwórz szczegółową strukturę kursu:

Tytuł: {{courseTitle}}
Opis: {{description}}
Przedmiot: {{subject}}
Poziom: {{level}}
Typ: {{courseType}}
Cele: {{objectives}}
Liczba tematów: {{topicsCount}}
Tematy na tydzień: {{topicsPerWeek}}
Ćwiczenia: {{includeExercises}}
Quizy: {{includeQuizzes}}
Częstotliwość quizów: {{quizFrequency}}

Wygeneruj JSON ze strukturą:
{
  "structure": [
    {
      "weekNumber": 1,
      "topics": [
        {
          "title": "<tytuł tematu>",
          "description": "<opis tematu>",
          "objectives": ["cel1", "cel2"],
          "activities": [
            {
              "type": "material",
              "title": "<tytuł materiału>",
              "duration": <czas w minutach>
            },
            {
              "type": "quiz",
              "title": "<tytuł quizu>",
              "questionsCount": <liczba pytań>
            }
          ],
          "keywords": ["słowo1", "słowo2"]
        }
      ]
    }
  ],
  "summary": {
    "totalWeeks": <liczba>,
    "totalTopics": <liczba>,
    "totalActivities": <liczba>,
    "totalQuizzes": <liczba>
  }
}

Wymagania:
- Logiczna progresja trudności
- Dla kursów maturalnych: zgodność z wymaganiami egzaminacyjnymi
- Każdy temat ma jasno określone cele
- Realistyczne czasy trwania (30-90 min na materiał)
- Quizy dostosowane do poziomu (5-15 pytań)
- Równomierne rozłożenie materiału
    `,responseFormat:"json"},inputMapping:s=>({courseTitle:s.courseTitle,description:s.description,subject:s.subject,level:s.level,courseType:s.courseType,objectives:Array.isArray(s.objectives)?s.objectives.join(", "):s.objectives,topicsCount:s.topicsCount,topicsPerWeek:s.topicsPerWeek,includeExercises:s.includeExercises?"tak":"nie",includeQuizzes:s.includeQuizzes?"tak":"nie",quizFrequency:s.quizFrequency||"chapter_end"}),outputMapping:(s,t)=>({...t,structure:s.structure,summary:s.summary}),validation:s=>!!(s.structure&&Array.isArray(s.structure)&&s.structure.length>0)},Xe={subject:{minLength:3,errorMessage:"Przedmiot jest wymagany (3-100 znaków)"},courseTitle:{minLength:5,errorMessage:"Tytuł jest wymagany (5-200 znaków)"},description:{minLength:50,errorMessage:"Opis jest wymagany (50-1000 znaków)"},topicsPerWeek:{min:1,max:7,errorMessage:"Liczba tematów na tydzień musi być między 1 a 7"}},vt={steps:{1:{title:"Jaki kurs chcesz stworzyć?",description:"Określ typ, przedmiot i poziom - AI stworzy kompletną strukturę kursu",button:"Analizuj wymagania",loading:"Analizuję wymagania..."},2:{title:"Analiza wymagań kursu",description:"AI przeanalizowała wymagania i zaproponowała parametry kursu",success:"✓ Analiza zakończona pomyślnie"},3:{title:"Dostosuj strukturę kursu",description:"Określ tempo nauki i dodatkowe elementy kursu",button:"Generuj strukturę",loading:"Generuję strukturę...",loadingInfo:"⚡ AI tworzy szczegółowy plan kursu z podziałem na tygodnie..."},4:{title:"Podgląd struktury kursu",description:"AI przygotowała kompletną strukturę z harmonogramem",info:"💡 Po zapisaniu będziesz mógł dodawać materiały do utworzonych tematów."},5:{title:"Tworzenie kursu",description:"Ostatnie poprawki przed utworzeniem kursu",saveInfo:"💾 Zostanie utworzony kurs z pełną strukturą tematów. Materiały i quizy możesz dodać później.",button:"Utwórz kurs",loading:"Tworzę kurs...",success:"✓ Kurs został utworzony pomyślnie! Przekierowuję..."}},dashboard:{title:"Generator struktury kursu",description:"Twórz kompletne kursy z pomocą AI",wizardTitle:"Generator kursów AI",wizardDescription:"Stwórz pełną strukturę kursu w 5 krokach",features:["Automatyczna analiza wymagań","Generowanie harmonogramu","Podział na tygodnie i tematy","Sugestie materiałów i quizów","Zgodność z podstawą programową","Progresja poziomu trudności"]},errors:{subjectRequired:"Podaj przedmiot kursu",analysisError:"Błąd analizy wymagań:",generationError:"Błąd generowania struktury:",saveError:"Wystąpił błąd podczas tworzenia kursu",unexpectedError:"Wystąpił nieoczekiwany błąd"}},Qe={dashboard:"/course-structure",step1:"/course-structure/step1",step2:"/course-structure/step2",step3:"/course-structure/step3",step4:"/course-structure/step4",step5:"/course-structure/step5",courses:"/courses"},wi={matura:{defaultTopics:["Wprowadzenie i powtórka","Podstawowe zagadnienia","Zagadnienia rozszerzone","Zadania typu maturalnego","Próbne egzaminy","Powtórka przedegzaminacyjna"],defaultQuizFrequency:"weekly",includeExercises:!0,includeQuizzes:!0},academic:{defaultQuizFrequency:"biweekly",includeExercises:!0,includeQuizzes:!0},professional:{defaultQuizFrequency:"chapter_end",includeExercises:!0,includeQuizzes:!0},hobby:{defaultQuizFrequency:"monthly",includeExercises:!0,includeQuizzes:!1},certification:{defaultQuizFrequency:"after_each",includeExercises:!0,includeQuizzes:!0}},Lp=()=>{const s=Q(),{getData:t}=me(),r=t("course-structure-wizard"),{dashboard:a}=vt,n=r&&r.courseTitle;return e.jsxs(M,{children:[e.jsx(J,{title:a.title,description:a.description}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-blue-50 p-6 rounded-lg border border-indigo-200",children:[e.jsxs(R,{variant:"start",className:"mb-4",children:[e.jsx("div",{className:"p-3 bg-indigo-100 rounded-lg",children:e.jsx(Gs,{className:"w-8 h-8 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:a.wizardTitle}),e.jsx("p",{className:"text-gray-600",children:a.wizardDescription})]})]}),e.jsxs(te,{variant:"1-2-2",className:"gap-4",children:[e.jsx("div",{className:"space-y-2",children:a.features.slice(0,3).map((i,o)=>e.jsxs(R,{variant:"start",className:"text-sm text-gray-700",children:[e.jsx(Re,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),e.jsx("span",{children:i})]},o))}),e.jsx("div",{className:"space-y-2",children:a.features.slice(3).map((i,o)=>e.jsxs(R,{variant:"start",className:"text-sm text-gray-700",children:[e.jsx(Re,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),e.jsx("span",{children:i})]},o))})]}),e.jsx("div",{className:"mt-6",children:e.jsxs(w,{onClick:()=>s(Qe.step1),className:"w-full md:w-auto",size:"lg",children:[e.jsx(Vt,{className:"w-4 h-4 mr-2"}),"Stwórz strukturę kursu"]})})]}),n&&e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsxs(R,{variant:"between-center",className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Ostatnia struktura"}),e.jsx("span",{className:"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm",children:"Wygenerowana"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Tytuł kursu"}),e.jsx("p",{className:"font-medium text-gray-900",children:r.courseTitle})]}),r.subject&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Przedmiot"}),e.jsx("p",{className:"text-gray-900",children:r.subject})]}),r.summary&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Liczba tygodni"}),e.jsx("p",{className:"text-gray-900 font-medium",children:r.summary.totalWeeks})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Liczba tematów"}),e.jsx("p",{className:"text-gray-900 font-medium",children:r.summary.totalTopics})]})]})]}),e.jsxs(R,{variant:"start",className:"mt-6 gap-3",children:[e.jsxs(w,{variant:"outline",onClick:()=>s(Qe.step4),children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Podgląd"]}),e.jsxs(w,{variant:"outline",onClick:()=>s(Qe.step3),children:[e.jsx(Na,{className:"w-4 h-4 mr-2"}),"Edytuj"]}),e.jsxs(w,{variant:"outline",onClick:()=>s(Qe.step1),children:[e.jsx(Zt,{className:"w-4 h-4 mr-2"}),"Nowa struktura"]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Zarządzanie kursami"}),e.jsxs(te,{variant:"1-2-3",className:"gap-4",children:[e.jsxs("button",{onClick:()=>s("/courses"),className:"p-4 bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow text-left",children:[e.jsxs(R,{variant:"start",className:"mb-2",children:[e.jsx(ge,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium",children:"Kursy"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Zobacz wszystkie kursy"})]}),e.jsxs("button",{onClick:()=>s("/educational-material"),className:"p-4 bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow text-left",children:[e.jsxs(R,{variant:"start",className:"mb-2",children:[e.jsx(mt,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"font-medium",children:"Materiały"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Kreator materiałów"})]}),e.jsxs("button",{onClick:()=>s("/quiz-wizard"),className:"p-4 bg-white rounded-lg border border-gray-200 hover:shadow-md transition-shadow text-left",children:[e.jsxs(R,{variant:"start",className:"mb-2",children:[e.jsx(Fs,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium",children:"Quizy"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Kreator quizów"})]})]})]})]})]})},nr=({step:s})=>{const t=Q();return e.jsxs(e.Fragment,{children:[e.jsx(w,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 hover:bg-gray-100",onClick:()=>t("/course-structure"),children:e.jsx(He,{className:"h-5 w-5"})}),e.jsxs("div",{className:"p-8 space-y-12 text-zinc-800",children:[e.jsx("h1",{className:"text-6xl font-black",children:"COURSEFORGE"}),e.jsxs("h2",{className:"text-4xl",children:["Zaprojektujmy ",e.jsx("br",{}),e.jsx("span",{className:"font-bold",children:"strukturę kursu"})]}),e.jsxs("p",{children:["Krok ",s," z 5"]})]}),e.jsx(zs,{className:"my-8"})]})},or=({title:s,description:t})=>e.jsxs("header",{className:"mb-8",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-2 flex items-center gap-3",children:s}),e.jsx("p",{className:"text-gray-600",children:t})]}),Ap=()=>{const s=Q(),{register:t,setData:r}=me(),[a,n]=d.useState(""),[i,o]=d.useState(""),[l,c]=d.useState(""),[u,x]=d.useState(""),[m,p]=d.useState({}),g=jt("course-structure-wizard","analyze-course-requirements"),{steps:b,errors:h}=vt;d.useEffect(()=>(t(Rp),g.registerOperation(Ep),()=>{g.unregisterOperation()}),[]);const f=()=>{const j={};return a||(j.courseType="Wybierz typ kursu"),(!i.trim()||i.length<Xe.subject.minLength)&&(j.subject=Xe.subject.errorMessage),l||(j.level="Wybierz poziom kursu"),u||(j.duration="Wybierz czas trwania"),p(j),Object.keys(j).length===0},y=async()=>{if(f())try{const j={courseType:a,subject:i.trim(),level:l,duration:u};r("course-structure-wizard",j),await g.executeOperation(j),s(Qe.step2)}catch(j){console.error(h.analysisError,j)}};return e.jsx(M,{children:e.jsxs("div",{className:"border rounded-lg bg-white shadow relative pb-6",children:[e.jsx(nr,{step:1}),e.jsxs("div",{className:"p-6",children:[e.jsx(or,{title:b[1].title,description:b[1].description}),g.error&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("span",{className:"text-red-800 text-sm",children:[h.analysisError," ",g.error]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(V,{htmlFor:"courseType",children:"Typ kursu"}),e.jsxs(xe,{value:a,onValueChange:n,disabled:g.loading,children:[e.jsx(de,{className:m.courseType?"border-red-300":"",children:e.jsx(pe,{placeholder:"Wybierz typ kursu..."})}),e.jsxs(ue,{children:[e.jsx(U,{value:"matura",children:"Kurs maturalny"}),e.jsx(U,{value:"academic",children:"Kurs akademicki"}),e.jsx(U,{value:"professional",children:"Kurs zawodowy"}),e.jsx(U,{value:"hobby",children:"Kurs hobbystyczny"}),e.jsx(U,{value:"certification",children:"Kurs certyfikacyjny"})]})]}),m.courseType&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:m.courseType})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"subject",children:"Przedmiot/Dziedzina"}),e.jsx($,{id:"subject",type:"text",value:i,onChange:j=>o(j.target.value),placeholder:"np. Matematyka, Programowanie Python, Język angielski",disabled:g.loading,className:m.subject?"border-red-300":""}),m.subject&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:m.subject})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"level",children:"Poziom kursu"}),e.jsxs(xe,{value:l,onValueChange:c,disabled:g.loading,children:[e.jsx(de,{className:m.level?"border-red-300":"",children:e.jsx(pe,{placeholder:"Wybierz poziom..."})}),e.jsx(ue,{children:a==="matura"?e.jsxs(e.Fragment,{children:[e.jsx(U,{value:"basic",children:"Podstawowy"}),e.jsx(U,{value:"extended",children:"Rozszerzony"})]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{value:"beginner",children:"Początkujący"}),e.jsx(U,{value:"intermediate",children:"Średniozaawansowany"}),e.jsx(U,{value:"advanced",children:"Zaawansowany"})]})})]}),m.level&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:m.level})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"duration",children:"Planowany czas trwania"}),e.jsxs(xe,{value:u,onValueChange:x,disabled:g.loading,children:[e.jsx(de,{className:m.duration?"border-red-300":"",children:e.jsx(pe,{placeholder:"Wybierz czas trwania..."})}),e.jsxs(ue,{children:[e.jsx(U,{value:"1month",children:"1 miesiąc"}),e.jsx(U,{value:"3months",children:"3 miesiące"}),e.jsx(U,{value:"6months",children:"6 miesięcy"}),e.jsx(U,{value:"1year",children:"1 rok"}),e.jsx(U,{value:"2years",children:"2 lata"})]})]}),m.duration&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:m.duration})]}),e.jsx("button",{onClick:y,disabled:g.loading,className:"w-full h-12 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400 text-white font-medium rounded-lg flex items-center justify-center gap-2",children:g.loading?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),b[1].loading]}):b[1].button})]})]})]})})},qp=()=>{const s=Q(),{getData:t}=me(),r=t("course-structure-wizard"),{steps:a}=vt;return e.jsx(M,{children:e.jsxs("div",{className:"border rounded-lg bg-white shadow relative pb-6",children:[e.jsx(nr,{step:2}),e.jsxs("div",{className:"space-y-6 p-8",children:[e.jsx(or,{title:a[2].title,description:a[2].description}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsx("span",{className:"text-green-800 text-sm",children:a[2].success})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Proponowany tytuł"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-gray-800 font-medium",children:r.courseTitle})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Opis kursu"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-gray-800 whitespace-pre-wrap",children:r.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cele kursu"}),e.jsx("div",{className:"space-y-2",children:r.objectives?.map((n,i)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("span",{className:"text-indigo-600 font-medium",children:[i+1,"."]}),e.jsx("span",{className:"text-gray-800",children:n})]},i))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Grupa docelowa"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-gray-800",children:r.targetAudience})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Wymagania wstępne"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:r.prerequisites?.length>0?e.jsx("ul",{className:"list-disc list-inside space-y-1",children:r.prerequisites.map((n,i)=>e.jsx("li",{className:"text-gray-800 text-sm",children:n},i))}):e.jsx("span",{className:"text-gray-500 text-sm",children:"Brak wymagań wstępnych"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Szacowana liczba godzin"}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg text-gray-800 font-medium",children:[r.estimatedHours," godzin"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Liczba głównych tematów"}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg text-gray-800 font-medium",children:[r.topicsCount," tematów"]})]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(w,{variant:"outline",onClick:()=>s(Qe.step1),children:"Wstecz"}),e.jsx(w,{onClick:()=>s(Qe.step3),children:"Kontynuuj"})]})]})]})]})})},Op=()=>{const s=Q(),{getData:t,setData:r}=me(),a=t("course-structure-wizard"),[n,i]=d.useState(a.courseTitle||""),[o,l]=d.useState(a.description||""),[c,u]=d.useState(2),[x,m]=d.useState(!0),[p,g]=d.useState(!0),[b,h]=d.useState("weekly"),[f,y]=d.useState({}),j=jt("course-structure-wizard","generate-course-structure"),{steps:v,errors:k}=vt;d.useEffect(()=>{if(j.registerOperation(Mp),a.courseType&&a.courseType in wi){const N=a.courseType,I=wi[N];m(I.includeExercises),g(I.includeQuizzes),h(I.defaultQuizFrequency)}return()=>{j.unregisterOperation()}},[]);const C=()=>{const N={};return(!n.trim()||n.length<Xe.courseTitle.minLength)&&(N.courseTitle=Xe.courseTitle.errorMessage),(!o.trim()||o.length<Xe.description.minLength)&&(N.description=Xe.description.errorMessage),(!c||c<Xe.topicsPerWeek.min||c>Xe.topicsPerWeek.max)&&(N.topicsPerWeek=Xe.topicsPerWeek.errorMessage),y(N),Object.keys(N).length===0},z=async()=>{if(C())try{const N={...a,courseTitle:n.trim(),description:o.trim(),topicsPerWeek:c,includeExercises:x,includeQuizzes:p,quizFrequency:b};r("course-structure-wizard",N),await j.executeOperation(N),s(Qe.step4)}catch(N){console.error(k.generationError,N)}};return e.jsx(M,{children:e.jsxs("div",{className:"border rounded-lg bg-white shadow relative pb-6",children:[e.jsx(nr,{step:3}),e.jsxs("div",{className:"space-y-6 p-8",children:[e.jsx(or,{title:v[3].title,description:v[3].description}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs(V,{htmlFor:"courseTitle",children:["Tytuł kursu ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx($,{id:"courseTitle",value:n,onChange:N=>i(N.target.value),placeholder:"np. Matematyka - Przygotowanie do matury",className:`mt-1 ${f.courseTitle?"border-red-300":""}`}),f.courseTitle&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:f.courseTitle})]}),e.jsxs("div",{children:[e.jsxs(V,{htmlFor:"description",children:["Opis kursu ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(as,{id:"description",value:o,onChange:N=>l(N.target.value),placeholder:"Szczegółowy opis kursu...",rows:4,className:`mt-1 ${f.description?"border-red-300":""}`}),f.description&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:f.description}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[o.length," / ",Xe.description.minLength," ","znaków minimum"]})]}),e.jsxs("div",{children:[e.jsxs(V,{htmlFor:"topicsPerWeek",children:["Liczba tematów na tydzień"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx($,{id:"topicsPerWeek",type:"number",value:c,onChange:N=>u(parseInt(N.target.value)||0),min:Xe.topicsPerWeek.min,max:Xe.topicsPerWeek.max,className:`mt-1 ${f.topicsPerWeek?"border-red-300":""}`}),f.topicsPerWeek&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:f.topicsPerWeek}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Określa tempo realizacji kursu"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ve,{id:"includeExercises",checked:x,onCheckedChange:N=>m(N)}),e.jsx("label",{htmlFor:"includeExercises",className:"text-sm cursor-pointer",children:"Dodaj ćwiczenia do każdego tematu"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ve,{id:"includeQuizzes",checked:p,onCheckedChange:N=>g(N)}),e.jsx("label",{htmlFor:"includeQuizzes",className:"text-sm cursor-pointer",children:"Dodaj quizy sprawdzające"})]}),p&&e.jsxs("div",{className:"ml-6",children:[e.jsx(V,{htmlFor:"quizFrequency",children:"Częstotliwość quizów"}),e.jsxs(xe,{value:b,onValueChange:h,children:[e.jsx(de,{className:"mt-1",children:e.jsx(pe,{})}),e.jsxs(ue,{children:[e.jsx(U,{value:"after_each",children:"Po każdym temacie"}),e.jsx(U,{value:"weekly",children:"Co tydzień"}),e.jsx(U,{value:"biweekly",children:"Co dwa tygodnie"}),e.jsx(U,{value:"monthly",children:"Co miesiąc"}),e.jsx(U,{value:"chapter_end",children:"Na koniec działu"})]})]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(w,{variant:"outline",onClick:()=>s(Qe.step2),children:"Wstecz"}),e.jsx(w,{onClick:z,disabled:j.loading,children:j.loading?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),v[3].loading]}):v[3].button})]})]}),j.loading&&e.jsx("div",{className:"mt-6 p-4 bg-indigo-50 border border-indigo-200 rounded-lg",children:e.jsx("span",{className:"text-indigo-800 text-sm",children:v[3].loadingInfo})})]})]})})},$p=()=>{const s=Q(),{getData:t}=me(),r=t("course-structure-wizard"),{steps:a}=vt,n=i=>{switch(i){case"material":return e.jsx(Ee,{className:"w-4 h-4"});case"quiz":return e.jsx(rs,{className:"w-4 h-4"});default:return e.jsx(ge,{className:"w-4 h-4"})}};return e.jsx(M,{children:e.jsxs("div",{className:"border rounded-lg bg-white shadow relative pb-6",children:[e.jsx(nr,{step:4}),e.jsxs("div",{className:"space-y-6 p-8",children:[e.jsx(or,{title:e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-8 h-8 text-zinc-500"}),e.jsx("span",{children:a[4].title})]}),description:a[4].description}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-3",children:r.courseTitle}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:r.description}),r.summary&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:r.summary.totalWeeks}),e.jsx("div",{className:"text-gray-600",children:"tygodni"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:r.summary.totalTopics}),e.jsx("div",{className:"text-gray-600",children:"tematów"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:r.summary.totalActivities}),e.jsx("div",{className:"text-gray-600",children:"aktywności"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.summary.totalQuizzes}),e.jsx("div",{className:"text-gray-600",children:"quizów"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-lg",children:"Struktura kursu"}),r.structure?.map((i,o)=>e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-indigo-50 px-4 py-3 flex items-center gap-2",children:[e.jsx(Fs,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("h5",{className:"font-medium",children:["Tydzień ",i.weekNumber]}),e.jsxs(H,{variant:"secondary",className:"ml-auto",children:[i.topics.length," ",i.topics.length===1?"temat":"tematów"]})]}),e.jsx("div",{className:"p-4 space-y-3",children:i.topics.map((l,c)=>e.jsxs("div",{className:"border-l-4 border-indigo-200 pl-4",children:[e.jsx("h6",{className:"font-medium text-gray-900",children:l.title}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:l.description}),l.objectives&&l.objectives.length>0&&e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700",children:"Cele:"}),e.jsx("ul",{className:"text-xs text-gray-600 list-disc list-inside",children:l.objectives.map((u,x)=>e.jsx("li",{children:u},x))})]}),l.activities&&l.activities.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:l.activities.map((u,x)=>e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-gray-100 rounded text-xs",children:[n(u.type),e.jsx("span",{children:u.title}),u.duration&&e.jsxs("span",{className:"text-gray-500",children:["(",u.duration," min)"]})]},x))}),l.keywords&&l.keywords.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:l.keywords.map((u,x)=>e.jsx(H,{variant:"outline",className:"text-xs",children:u},x))})]},c))})]},o))]})]}),e.jsx("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg p-4",children:e.jsx("p",{className:"text-indigo-800 text-sm",children:a[4].info})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(w,{variant:"outline",onClick:()=>s(Qe.step3),children:"Wstecz"}),e.jsx(w,{onClick:()=>s(Qe.step5),children:"Utwórz kurs"})]})]})]})})},Fp=()=>{const s=Q(),{getData:t,setData:r}=me(),{mutate:a}=_s(),{mutate:n}=_s(),{data:i}=Oe(),o=t("course-structure-wizard"),[l,c]=d.useState(o.courseTitle||""),[u,x]=d.useState("📚"),[m,p]=d.useState(!1),[g,b]=d.useState(!1),[h,f]=d.useState(!1),{steps:y,errors:j}=vt,v=async()=>{if(!l.trim()){F.error("Nazwa kursu jest wymagana");return}if(!i?.vendor_id){F.error("Brak informacji o vendor_id. Skontaktuj się z administratorem.");return}b(!0),f(!1);try{a({resource:"courses",values:{vendor_id:i.vendor_id,title:l.trim(),description:o.description,icon_emoji:u,is_published:m}},{onSuccess:async C=>{const z=C.data.id;let N=1;try{for(const I of o.structure)for(const q of I.topics)await new Promise((P,B)=>{n({resource:"topics",values:{course_id:z,title:q.title,position:N++,is_published:!1}},{onSuccess:P,onError:B})});r("course-structure-wizard",{...o,courseName:l.trim(),courseId:z,saved:!0}),b(!1),f(!0),setTimeout(()=>{s(`${Qe.courses}/show/${z}`)},2e3)}catch(I){b(!1),console.error("Błąd podczas tworzenia tematów:",I),F.error("Wystąpił błąd podczas tworzenia struktury kursu")}},onError:C=>{b(!1),console.error(j.saveError,C),C?.code==="42501"?F.error("Brak uprawnień do tworzenia kursów. Sprawdź swoje uprawnienia."):C?.code==="23505"?F.error("Kurs o takiej nazwie już istnieje."):F.error(j.saveError)}})}catch(C){b(!1),console.error(j.unexpectedError,C),F.error(j.unexpectedError)}},k=()=>{switch(o.courseType){case"matura":return"🎓";case"academic":return"🏛️";case"professional":return"💼";case"hobby":return"🎨";case"certification":return"📜";default:return"📚"}};return W.useEffect(()=>{x(k())},[o.courseType]),e.jsx(M,{children:e.jsxs("div",{className:"border rounded-lg bg-white shadow relative",children:[e.jsx(nr,{step:5}),e.jsxs("div",{className:"p-8",children:[e.jsx(or,{title:e.jsxs(e.Fragment,{children:[e.jsx(Gs,{className:"w-8 h-8 text-indigo-500"}),e.jsx("span",{children:y[5].title})]}),description:y[5].description}),h&&e.jsx(oe,{className:"mb-6 bg-green-50 border-green-200",children:e.jsx(le,{className:"text-green-800",children:y[5].success})}),e.jsxs("form",{className:"space-y-6",onSubmit:C=>{C.preventDefault(),v()},children:[e.jsxs("div",{children:[e.jsxs(V,{htmlFor:"courseName",children:["Nazwa kursu ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx($,{id:"courseName",type:"text",value:l,onChange:C=>c(C.target.value),placeholder:"np. Matematyka - Kurs maturalny poziom rozszerzony",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"iconEmoji",children:"Emoji ikona"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx($,{id:"iconEmoji",type:"text",value:u,onChange:C=>x(C.target.value),placeholder:"np. 📚 📐 🎓",className:"flex-1",maxLength:5}),e.jsx("div",{className:"flex gap-1",children:["📚","🎓","📐","🏛️","💼","🎨","📜","🚀"].map(C=>e.jsx(w,{type:"button",variant:"outline",size:"sm",onClick:()=>x(C),className:"w-10 h-10",children:C},C))})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Wybierz emoji z listy lub wpisz własne"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ve,{id:"isPublished",checked:m,onCheckedChange:C=>p(C)}),e.jsx("label",{htmlFor:"isPublished",className:"text-sm cursor-pointer",children:"Opublikuj kurs od razu (uczniowie będą mogli go zobaczyć)"})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Co zostanie utworzone:"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-700",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-600",children:"✓"}),e.jsxs("span",{children:['Kurs "',l||o.courseTitle,'" z pełnym opisem']})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-600",children:"✓"}),e.jsxs("span",{children:[o.summary?.totalTopics||0," tematów rozłożonych na ",o.summary?.totalWeeks||0," tygodni"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-600",children:"✓"}),e.jsx("span",{children:"Struktura gotowa do wypełnienia materiałami i quizami"})]})]})]}),e.jsx("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg p-4",children:e.jsx("p",{className:"text-indigo-800 text-sm",children:y[5].saveInfo})}),e.jsx(zs,{}),e.jsxs("footer",{className:"flex justify-between gap-4",children:[e.jsxs(w,{type:"button",variant:"outline",onClick:()=>s(Qe.step4),disabled:g,className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Wstecz"]}),e.jsx(w,{type:"submit",disabled:g||h,className:"flex items-center gap-2 min-w-[160px]",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),y[5].loading]}):e.jsxs(e.Fragment,{children:[e.jsx(Qt,{className:"w-4 h-4"}),y[5].button]})})]})]})]})]})})},Wp=[e.jsx(O,{path:"/course-structure",element:e.jsx(Lp,{})},"course-dashboard"),e.jsx(O,{path:"/course-structure/step1",element:e.jsx(Ap,{})},"course-step1"),e.jsx(O,{path:"/course-structure/step2",element:e.jsx(qp,{})},"course-step2"),e.jsx(O,{path:"/course-structure/step3",element:e.jsx(Op,{})},"course-step3"),e.jsx(O,{path:"/course-structure/step4",element:e.jsx($p,{})},"course-step4"),e.jsx(O,{path:"/course-structure/step5",element:e.jsx(Fp,{})},"course-step5")],Up={name:"course-structure",list:"/course-structure",create:"/course-structure/step1",meta:{canDelete:!1,label:"Generator kursów",icon:e.jsx(Lr,{className:"h-4 w-4"})}},Ys=d.forwardRef(({className:s,value:t,...r},a)=>e.jsx(Qi,{ref:a,className:K("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",s),...r,children:e.jsx(Rl,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));Ys.displayName=Qi.displayName;const gr=({icon:s,label:t,value:r,color:a="blue",trend:n,subtitle:i})=>{const o={blue:"from-blue-500 to-blue-600",purple:"from-purple-500 to-purple-600",pink:"from-pink-500 to-pink-600",green:"from-green-500 to-green-600",yellow:"from-yellow-500 to-yellow-600",orange:"from-orange-500 to-orange-600"};return e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-gray-200 to-gray-300 rounded-2xl blur-xl opacity-0 group-hover:opacity-20 transition-opacity"}),e.jsx(S,{className:"relative hover:shadow-lg transition-all duration-300",children:e.jsxs(_,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-xl bg-gradient-to-br ${o[a]} shadow-lg`,children:e.jsx(s,{className:"w-6 h-6 text-white"})}),n&&e.jsxs("div",{className:`flex items-center gap-1 text-sm ${n>0?"text-green-600":"text-red-600"}`,children:[n>0?e.jsx(jc,{className:"w-4 h-4"}):e.jsx(gc,{className:"w-4 h-4"}),e.jsxs("span",{children:[Math.abs(n),"%"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:r}),e.jsx("p",{className:"text-sm font-medium text-gray-600 mt-1",children:t}),i&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:i})]})]})})]})},Ao=({course:s,onClick:t})=>e.jsxs(S,{className:"cursor-pointer hover:shadow-lg transition-all duration-300 overflow-hidden group",onClick:t,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-600/5 to-pink-600/5 opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs(_,{className:"p-6 relative",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-4xl",children:s.emoji}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg line-clamp-1",children:s.title}),s.lastActivity&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(is,{className:"w-3 h-3"}),s.lastActivity]})]})]}),s.progress>0&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-green-600",children:[e.jsx(Pr,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.progress,"%"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Postęp"}),e.jsxs("span",{className:"font-medium",children:[s.progress,"%"]})]}),e.jsx(Ys,{value:s.progress,className:"h-2"})]})]})]}),qo=({activity:s,onStart:t})=>{const r=()=>s.type==="quiz"?Qs:ge,a=()=>s.type==="quiz"?"Quiz":"Materiał",n=()=>s.type==="quiz"?"bg-purple-500":"bg-blue-500",i=r();return e.jsx(S,{className:`transition-all duration-200 hover:shadow-md ${s.completed?"bg-gray-50/50":""}`,children:e.jsx(_,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${n()} bg-opacity-10`,children:e.jsx(i,{className:`w-6 h-6 ${n().replace("bg-","text-")}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[e.jsx("h3",{className:"font-medium truncate",children:s.title}),s.completed&&e.jsx(Mr,{className:"w-5 h-5 text-green-500 flex-shrink-0"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsx(H,{variant:"secondary",className:"text-xs",children:a()}),s.duration&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(is,{className:"w-3 h-3"}),e.jsxs("span",{children:[s.duration," min"]})]}),s.points&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(qe,{className:"w-3 h-3"}),e.jsxs("span",{children:[s.points," pkt"]})]}),s.score!==null&&s.score!==void 0&&e.jsxs(H,{variant:s.score>=80?"default":"secondary",className:"text-xs",children:[s.score,"%"]})]}),s.courseTitle&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:s.courseEmoji||"📚"}),e.jsx("span",{children:s.courseTitle})]})]}),e.jsx(w,{size:"sm",variant:s.completed?"ghost":"default",onClick:o=>{o.stopPropagation(),t()},className:"flex-shrink-0",children:s.completed?e.jsxs(e.Fragment,{children:["Powtórz",e.jsx(Zs,{className:"w-4 h-4 ml-1"})]}):e.jsxs(e.Fragment,{children:["Rozpocznij",e.jsx(Zs,{className:"w-4 h-4 ml-1"})]})})]})})})},Bp=()=>{const s=Q(),{data:t}=Oe(),{stats:r,isLoading:a,refetch:n}=$r(),{data:i,isLoading:o}=Ht("get_my_courses"),{data:l}=fn("activity_progress",{select:`
      *,
      activities!inner(
        id,
        title,
        type,
        topics!inner(
          id,
          title,
          courses!inner(
            id,
            title,
            icon_emoji
          )
        )
      )
    `,filters:t?.id?[{field:"user_id",operator:"eq",value:t.id}]:[],sorts:[{field:"started_at",order:"desc"}],limit:5,enabled:!!t?.id}),c=async()=>{try{const{data:p,error:g}=await se.rpc("claim_daily_rewards");if(g)throw g;p&&(F.success(`Odebrano ${p.total_earned} punktów!`,{description:p.daily_points>0?`Seria ${p.streak} dni!`:"Punkty idle zebrane"}),n())}catch(p){console.error("Error claiming rewards:",p),F.error("Nie można odebrać nagród")}},u=r.level>0?(r.points-(r.level-1)*(r.level-1)*100)/(r.level*r.level*100-(r.level-1)*(r.level-1)*100)*100:0;if(a||o)return e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const x=i||[],m=l||[];return e.jsx(M,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(R,{children:[e.jsx(J,{title:`Witaj, ${t?.full_name||"Uczniu"}! 👋`,description:"Kontynuuj swoją przygodę z nauką"}),e.jsxs(w,{onClick:c,variant:"outline",className:"gap-2",children:[e.jsx(fc,{className:"w-4 h-4"}),"Odbierz nagrody"]})]}),e.jsxs(te,{variant:"2-2-4",children:[e.jsx(gr,{icon:qe,label:"Poziom",value:r.level,color:"yellow",subtitle:`${r.points}/${r.next_level_points} pkt`}),e.jsx(gr,{icon:Ir,label:"Seria dni",value:r.streak,color:"orange",trend:r.streak>7?15:0}),e.jsx(gr,{icon:ws,label:"Ukończone quizy",value:r.quizzes_completed,color:"green"}),e.jsx(gr,{icon:is,label:"Czas nauki",value:`${Math.floor(r.total_time/60)}h`,color:"purple"})]}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsxs(R,{children:[e.jsx(L,{children:"Postęp poziomu"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Poziom ",r.level," → ",r.level+1]})]})}),e.jsxs(_,{className:"space-y-2",children:[e.jsx(Ys,{value:u,className:"h-3"}),e.jsxs(R,{children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[r.points," punktów"]}),e.jsxs("span",{className:"text-sm font-medium",children:[r.next_level_points-r.points," punktów do następnego poziomu"]})]})]})]}),x.length>0&&e.jsxs("div",{children:[e.jsxs(R,{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Twoje kursy"}),e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>s("/student/courses"),children:"Zobacz wszystkie"})]}),e.jsx(te,{children:x.slice(0,3).map(p=>e.jsx(Ao,{course:{id:p.course_id,title:p.title,emoji:p.icon_emoji||"📚",progress:p.progress_percent||0,lastActivity:p.last_activity?new Date(p.last_activity).toLocaleDateString("pl-PL"):null},onClick:()=>s(`/student/courses/${p.course_id}`)},p.course_id))})]}),m.length>0&&e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Ostatnie aktywności"})}),e.jsx(_,{className:"space-y-3",children:m.map(p=>e.jsx(qo,{activity:{id:p.activity_id,title:p.activities?.title||"Bez tytułu",type:p.activities?.type||"material",completed:!!p.completed_at,score:p.score,courseTitle:p.activities?.topics?.courses?.title,courseEmoji:p.activities?.topics?.courses?.icon_emoji},onStart:()=>{const g=p.activities?.topics?.courses?.id,b=p.activity_id;g&&b&&(p.activities?.type==="quiz"?s(`/student/courses/${g}/quiz/${b}`):s(`/student/courses/${g}/lesson/${b}`))}},p.activity_id))})]})]})})},Gp=()=>{const s=Q(),[t,r]=W.useState(""),{data:a,isLoading:n}=Ht("get_my_courses"),i=W.useMemo(()=>!a||!t?a||[]:a.filter(o=>o.title.toLowerCase().includes(t.toLowerCase())),[a,t]);return n?e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsx(M,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(J,{title:"Moje kursy",description:"Wybierz kurs i kontynuuj naukę"}),e.jsxs("div",{className:"relative",children:[e.jsx(va,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx($,{placeholder:"Szukaj kursów...",className:"pl-10",value:t,onChange:o=>r(o.target.value)})]}),e.jsx(te,{children:i.map(o=>e.jsx(Ao,{course:{id:o.course_id,title:o.title,emoji:o.icon_emoji||"📚",progress:o.progress_percent||0,lastActivity:o.last_activity?new Date(o.last_activity).toLocaleDateString("pl-PL"):null},onClick:()=>s(`/student/courses/${o.course_id}`)},o.course_id))}),(!i||i.length===0)&&e.jsx(S,{children:e.jsxs(_,{className:"text-center py-12",children:[e.jsx(ge,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-gray-500",children:t?"Nie znaleziono kursów":"Nie masz jeszcze żadnych kursów"})]})})]})})},Kp=()=>{const{courseId:s}=Me(),t=Q(),{data:r,isLoading:a}=Ht("get_course_structure",{p_course_id:parseInt(s)},{enabled:!!s}),{data:n}=fn("courses",{filters:[{field:"id",operator:"eq",value:parseInt(s)}],enabled:!!s}),i=W.useMemo(()=>{if(!r)return[];const c=r.reduce((u,x)=>{const m=`${x.topic_id}-${x.topic_title}`;return u[m]||(u[m]={id:x.topic_id,title:x.topic_title,position:x.topic_position,activities:[]}),x.activity_id&&u[m].activities.push({id:x.activity_id,title:x.activity_title,type:x.activity_type,position:x.activity_position,completed:x.is_completed,score:x.score}),u},{});return Object.values(c).sort((u,x)=>u.position-x.position)},[r]),o=W.useMemo(()=>{const c=i.flatMap(m=>m.activities),u=c.filter(m=>m.completed).length,x=c.length;return{totalActivities:x,completedActivities:u,progress:x>0?Math.round(u/x*100):0,topics:i.length}},[i]);if(a)return e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const l=n?.[0];return e.jsx(M,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(w,{variant:"ghost",size:"sm",onClick:()=>t("/student/courses"),className:"gap-2",children:[e.jsx(Rr,{className:"w-4 h-4"}),"Powrót do kursów"]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-600 to-pink-600 rounded-2xl p-8 text-white",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-5xl",children:l?.icon_emoji||"📚"}),e.jsx("h1",{className:"text-3xl font-bold",children:l?.title})]}),e.jsx("p",{className:"text-white/80 max-w-2xl",children:l?.description})]}),e.jsxs(H,{className:"bg-white/20 text-white border-white/30",children:[o.progress,"% ukończone"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6 mt-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white/60",children:"Postęp"}),e.jsxs("p",{className:"text-2xl font-bold",children:[o.completedActivities,"/",o.totalActivities]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white/60",children:"Tematy"}),e.jsx("p",{className:"text-2xl font-bold",children:o.topics})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white/60",children:"Czas trwania"}),e.jsxs("p",{className:"text-2xl font-bold",children:["~",Math.ceil(o.totalActivities*15/60),"h"]})]})]}),e.jsx(Ys,{value:o.progress,className:"mt-6 h-3 bg-white/20"})]}),e.jsx("div",{className:"space-y-6",children:i.map(c=>{const u=c.activities.filter(m=>m.completed).length,x=u===c.activities.length;return e.jsxs(S,{children:[e.jsx(A,{children:e.jsxs(R,{children:[e.jsxs("div",{children:[e.jsxs(L,{className:"text-xl",children:["Temat ",c.position,": ",c.title]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[u,"/",c.activities.length," aktywności ukończonych"]})]}),x&&e.jsxs(H,{variant:"secondary",className:"gap-1",children:[e.jsx(Mr,{className:"w-3 h-3"}),"Ukończony"]})]})}),e.jsx(_,{className:"space-y-3",children:c.activities.map(m=>e.jsx(qo,{activity:{id:m.id,title:m.title,type:m.type,completed:m.completed,score:m.score,points:m.type==="quiz"?20:10},onStart:()=>{m.type==="quiz"?t(`/student/courses/${s}/quiz/${m.id}`):t(`/student/courses/${s}/lesson/${m.id}`)}},m.id))})]},c.id)})})]})})},Zp=()=>{const{courseId:s,lessonId:t}=Me(),r=Q(),[a,n]=W.useState(!1),{data:i,isLoading:o}=ze({resource:"activities",id:t,meta:{select:"*, topics(title, course_id, courses(title, icon_emoji))"}}),l=async()=>{n(!0);try{const{data:u,error:x}=await se.rpc("complete_material",{p_activity_id:parseInt(t)});if(x)throw x;u&&(F.success("Lekcja ukończona!",{description:"Zdobyłeś punkty za ukończenie materiału"}),r(`/student/courses/${s}`))}catch(u){console.error("Complete error:",u),F.error("Nie udało się ukończyć lekcji",{description:u.message})}finally{n(!1)}};if(o)return e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const c=i?.data;return e.jsx(M,{children:e.jsxs("div",{className:"space-y-6 max-w-4xl mx-auto",children:[e.jsxs(w,{variant:"ghost",size:"sm",onClick:()=>r(`/student/courses/${s}`),className:"gap-2",children:[e.jsx(Rr,{className:"w-4 h-4"}),"Powrót do kursu"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:c?.topics?.courses?.icon_emoji||"📚"}),e.jsx("span",{children:c?.topics?.courses?.title}),e.jsx("span",{children:"/"}),e.jsx("span",{children:c?.topics?.title})]}),e.jsx("h1",{className:"text-3xl font-bold",children:c?.title}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{variant:"secondary",children:"Materiał"}),c?.duration_min&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(is,{className:"w-3 h-3"}),e.jsxs("span",{children:[c?.duration_min," min"]})]})]})]}),e.jsx(S,{children:e.jsx(_,{className:"prose prose-lg max-w-none p-8",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:c?.content||""}})})}),e.jsx(S,{children:e.jsx(_,{className:"p-6",children:e.jsxs(R,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Ukończyłeś tę lekcję?"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Kliknij przycisk, aby zaznaczyć jako ukończone i otrzymać punkty"})]}),e.jsxs(w,{onClick:l,disabled:a,className:"gap-2",children:[e.jsx(Mr,{className:"w-4 h-4"}),a?"Zapisywanie...":"Oznacz jako ukończone"]})]})})})]})})},Oo=d.forwardRef(({className:s,...t},r)=>e.jsx(Vi,{className:K("grid gap-2",s),...t,ref:r}));Oo.displayName=Vi.displayName;const $o=d.forwardRef(({className:s,...t},r)=>e.jsx(Hi,{ref:r,className:K("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(El,{className:"flex items-center justify-center",children:e.jsx(sn,{className:"h-3.5 w-3.5 fill-primary"})})}));$o.displayName=Hi.displayName;const Qp=()=>{const{courseId:s,quizId:t}=Me(),r=Q(),[a,n]=W.useState(0),[i,o]=W.useState({}),[l,c]=W.useState(null),[u,x]=W.useState(!1),[m,p]=W.useState([]),[g,b]=W.useState(!0),{data:h,isLoading:f}=ze({resource:"activities",id:t,meta:{select:"*, topics(title, course_id, courses(title, icon_emoji))"}});W.useEffect(()=>{(async()=>{if(t)try{const{error:N}=await se.rpc("start_activity",{p_activity_id:parseInt(t)});N&&(console.error("Error starting quiz:",N),F.error("Nie udało się rozpocząć quizu",{icon:e.jsx(ur,{size:24})})),b(!0);const{data:I,error:q}=await se.rpc("get_quiz_questions",{p_activity_id:parseInt(t)});if(q)console.error("Error fetching questions:",q),F.error("Nie udało się pobrać pytań",{icon:e.jsx(ur,{size:24})});else{const P=typeof I=="string"?JSON.parse(I):I;console.log("Questions data:",P),P&&P.length>0&&console.log("First question options:",P[0].options),p(Array.isArray(P)?P:[])}}catch(N){console.error("Quiz init error:",N),F.error("Błąd podczas ładowania quizu",{icon:e.jsx(ur,{size:24})})}finally{b(!1)}})()},[t]),W.useEffect(()=>{h?.data?.time_limit&&l===null&&c(h.data.time_limit*60)},[h]),W.useEffect(()=>{if(l!==null&&l>0){const z=setTimeout(()=>c(l-1),1e3);return()=>clearTimeout(z)}else l===0&&v()},[l]);const y=h?.data,j=(z,N)=>{o(I=>({...I,[z]:N}))},v=async()=>{x(!0);try{const z=Object.entries(i).map(([q,P])=>({question_id:parseInt(q),option_id:P}));console.log("Submitting answers:",z);const{data:N,error:I}=await se.rpc("finish_quiz",{p_activity_id:parseInt(t),p_answers:z});if(I)throw I;if(N){const{score:q,passed:P,points_earned:B}=N;P?F.success(`Quiz zaliczony! Wynik: ${q}%`,{description:`Zdobyłeś ${B} punktów!`,icon:e.jsx(Is,{size:24})}):F.warning(`Quiz niezaliczony. Wynik: ${q}%`,{description:`Wymagane minimum ${y?.passing_score||70}% do zaliczenia. Spróbuj ponownie!`,icon:e.jsx(xt,{size:24})}),r(`/student/courses/${s}?refresh=true`)}}catch(z){console.error("Submit error:",z),F.error("Nie udało się przesłać odpowiedzi",{description:z.message,icon:e.jsx(ur,{size:24})})}finally{x(!1)}};if(f||g)return e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const k=m[a],C=m.length>0?(a+1)/m.length*100:0;return e.jsx(M,{children:e.jsxs("div",{className:"space-y-6 max-w-4xl mx-auto",children:[e.jsxs(R,{children:[e.jsxs(w,{variant:"ghost",size:"sm",onClick:()=>r(`/student/courses/${s}`),className:"gap-2",children:[e.jsx(Rr,{className:"w-4 h-4"}),"Powrót do kursu"]}),l!==null&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(is,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium",children:[Math.floor(l/60),":",String(l%60).padStart(2,"0")]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold",children:y?.title}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{variant:"default",children:"Quiz"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Pytanie ",a+1," z ",m.length]})]})]}),e.jsx(Ys,{value:C,className:"h-2"}),k&&m.length>0?e.jsxs(S,{children:[e.jsx(A,{children:e.jsxs(R,{children:[e.jsx(L,{className:"text-xl",children:k.question}),e.jsxs(H,{variant:"secondary",children:[k.points," pkt"]})]})}),e.jsxs(_,{className:"space-y-4",children:[e.jsx(Oo,{value:String(i[k.id]||""),onValueChange:z=>j(k.id,parseInt(z)),children:k.options&&Array.isArray(k.options)&&k.options.map(z=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($o,{value:String(z.id),id:`radio-${k.id}-${z.id}`}),e.jsx(V,{htmlFor:`radio-${k.id}-${z.id}`,className:"flex-1 cursor-pointer py-2",children:z.text})]},`option-${k.id}-${z.id}`))}),!i[k.id]&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-amber-600",children:[e.jsx(qt,{className:"w-4 h-4"}),e.jsx("span",{children:"Wybierz odpowiedź"})]})]})]}):m.length===0&&!g?e.jsx(S,{children:e.jsxs(_,{className:"text-center py-12",children:[e.jsx(qt,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-gray-500",children:"Nie znaleziono pytań dla tego quizu"})]})}):null,e.jsxs(R,{children:[e.jsx(w,{variant:"outline",onClick:()=>n(Math.max(0,a-1)),disabled:a===0,children:"Poprzednie"}),e.jsx("div",{className:"flex gap-2",children:m.map((z,N)=>e.jsx("button",{onClick:()=>n(N),className:`w-10 h-10 rounded-lg border-2 transition-all ${N===a?"border-primary bg-primary text-white":i[z.id]?"border-green-500 bg-green-50":"border-gray-300"}`,children:N+1},`nav-${z.id}-${N}`))}),a<m.length-1?e.jsx(w,{onClick:()=>n(a+1),disabled:!i[k?.id],children:"Następne"}):e.jsx(w,{onClick:v,disabled:u||Object.keys(i).length<m.length,variant:"default",children:u?"Przesyłanie...":"Zakończ quiz"})]})]})})},Vp={"⚡":za,"🚀":Vt,"🧠":Qs,"☕":bc,"📚":yc},Hp=()=>{const{stats:s,refetch:t}=$r(),{data:r,isLoading:a,refetch:n}=Ht("get_idle_upgrades"),i=async l=>{try{const{data:c,error:u}=await se.rpc("buy_idle_upgrade",{p_upgrade_id:l});if(u)throw u;c&&(F.success("Ulepszenie zakupione!",{description:`Nowy poziom: ${c.new_level}`}),t(),n())}catch(c){F.error("Nie udało się kupić ulepszenia",{description:c.message||"Niewystarczająca ilość punktów"})}},o=r||[];return a?e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsx(M,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(J,{title:"Gamifikacja",description:"Ulepsz swoje możliwości zdobywania punktów"}),e.jsxs(S,{className:"bg-gradient-to-br from-purple-600 to-pink-600 text-white",children:[e.jsx(A,{children:e.jsx(L,{className:"text-2xl",children:"Idle Game"})}),e.jsx(_,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-80",children:"Punkty na godzinę"}),e.jsx("p",{className:"text-4xl font-bold",children:s.idle_rate})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-80",children:"Twoje punkty"}),e.jsx("p",{className:"text-4xl font-bold",children:s.points})]})]})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Ulepszenia"}),e.jsx(te,{children:o.map(l=>{const c=s.points>=l.next_cost,u=Vp[l.icon]||At;return e.jsxs(S,{className:"relative overflow-hidden",children:[e.jsx(A,{children:e.jsxs(R,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-purple-500 to-pink-500",children:e.jsx(u,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx(L,{className:"text-lg",children:l.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["+",l.bonus_per_level," pkt/h za poziom"]})]})]}),e.jsxs(H,{variant:"secondary",children:["Lvl ",l.current_level]})]})}),e.jsx(_,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Aktualny bonus"}),e.jsxs("span",{className:"font-bold text-green-600",children:["+",l.total_bonus," pkt/h"]})]}),e.jsxs(w,{className:"w-full",onClick:()=>i(l.id),disabled:!c,variant:c?"default":"secondary",children:[e.jsx(At,{className:"w-4 h-4 mr-2"}),"Ulepsz (",l.next_cost," pkt)"]})]})})]},l.id)})})]})]})})},Jp=()=>{const{data:s}=Oe(),[t,r]=W.useState("all"),{data:a,isLoading:n,refetch:i}=Ht("get_leaderboard",{p_limit:20,p_filter:t});W.useEffect(()=>{i()},[t]);const o=u=>{switch(u){case 1:return e.jsx(qe,{className:"w-5 h-5 text-yellow-500"});case 2:return e.jsx(wc,{className:"w-5 h-5 text-gray-400"});case 3:return e.jsx(Lt,{className:"w-5 h-5 text-orange-600"});default:return e.jsxs("span",{className:"text-sm font-bold text-gray-500",children:["#",u]})}},l=u=>{switch(u){case 1:return"bg-yellow-50 border-yellow-200";case 2:return"bg-gray-50 border-gray-200";case 3:return"bg-orange-50 border-orange-200";default:return""}};if(n)return e.jsx(M,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const c=a||[];return e.jsx(M,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(J,{title:"Ranking",description:"Zobacz jak wypadasz na tle innych uczniów"}),e.jsxs(sd,{value:t,onValueChange:u=>r(u),children:[e.jsxs(dn,{className:"grid w-full grid-cols-3",children:[e.jsx(yr,{value:"all",children:"Wszyscy"}),e.jsx(yr,{value:"students",children:"Uczniowie"}),e.jsx(yr,{value:"teachers",children:"Nauczyciele"})]}),e.jsx(un,{value:t,className:"mt-6",children:e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Top 20"})}),e.jsx(_,{className:"space-y-2",children:c.map(u=>{const x=u.user_id===s?.id;return e.jsxs("div",{className:`flex items-center gap-4 p-4 rounded-xl transition-all ${x?"bg-purple-50 border-2 border-purple-200":`border ${l(u.rank)} hover:bg-gray-50`}`,children:[e.jsx("div",{className:"w-10 flex justify-center",children:o(u.rank)}),e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center text-white font-bold",children:u.full_name.charAt(0)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-semibold",children:[u.full_name,x&&e.jsx(H,{className:"ml-2",variant:"secondary",children:"Ty"})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Poziom ",u.level," • Seria ",u.streak," dni"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-lg",children:u.points}),e.jsx("p",{className:"text-xs text-gray-500",children:"punktów"})]})]},u.user_id)})})]})})]})]})})},Tt=[{id:1,icon:Ir,title:"Pierwszy Krok",description:"Ukończ pierwszą lekcję",unlocked:!0,rarity:"common",unlockedAt:"2024-01-15",progress:100},{id:2,icon:an,title:"Perfekcjonista",description:"Zdobądź 100% w 10 quizach",unlocked:!0,rarity:"rare",unlockedAt:"2024-02-20",progress:100},{id:3,icon:za,title:"Błyskawica",description:"Ukończ 5 lekcji w jeden dzień",unlocked:!1,rarity:"epic",progress:60},{id:4,icon:qe,title:"Mistrz",description:"Osiągnij poziom 50",unlocked:!1,rarity:"legendary",progress:24},{id:5,icon:ws,title:"Snajper",description:"Odpowiedz poprawnie na 100 pytań z rzędu",unlocked:!1,rarity:"epic",progress:45},{id:6,icon:Vt,title:"Rakieta",description:"Ukończ kurs w mniej niż tydzień",unlocked:!1,rarity:"rare",progress:0}],vi={common:{gradient:"from-gray-400 to-gray-500",bgColor:"bg-gray-50",borderColor:"border-gray-200",label:"Pospolite"},rare:{gradient:"from-blue-400 to-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200",label:"Rzadkie"},epic:{gradient:"from-purple-400 to-purple-600",bgColor:"bg-purple-50",borderColor:"border-purple-200",label:"Epiczne"},legendary:{gradient:"from-yellow-400 to-orange-500",bgColor:"bg-orange-50",borderColor:"border-orange-200",label:"Legendarne"}},Xp=()=>{const s=Tt.filter(r=>r.unlocked).length,t=Tt.length;return e.jsx(M,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(J,{title:"Osiągnięcia",description:`Odblokowano ${s} z ${t} osiągnięć`}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Postęp osiągnięć"})}),e.jsx(_,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ys,{value:s/t*100,className:"h-3"}),e.jsx("div",{className:"grid grid-cols-4 gap-4 text-center",children:Object.entries(vi).map(([r,a])=>{const n=Tt.filter(o=>o.rarity===r&&o.unlocked).length,i=Tt.filter(o=>o.rarity===r).length;return e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[n,"/",i]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.label})]},r)})})]})})]}),e.jsx(te,{variant:"1-2-3",children:Tt.map(r=>{const a=vi[r.rarity],n=r.icon;return e.jsxs(S,{className:`relative overflow-hidden ${r.unlocked?"":"opacity-75"} border-2 ${a.borderColor}`,children:[e.jsx("div",{className:`absolute inset-0 ${a.bgColor} opacity-20`}),e.jsx(_,{className:"relative p-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[e.jsx("div",{className:`w-20 h-20 rounded-full bg-gradient-to-br ${r.unlocked?a.gradient:"from-gray-300 to-gray-400"} flex items-center justify-center shadow-lg`,children:e.jsx(n,{className:"w-10 h-10 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:r.title}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:r.description})]}),r.unlocked?e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Odblokowano ",new Date(r.unlockedAt).toLocaleDateString("pl-PL")]}):e.jsxs("div",{className:"w-full space-y-2",children:[e.jsx(Ys,{value:r.progress,className:"h-2"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.progress,"% ukończone"]})]}),e.jsx(H,{variant:r.unlocked?"default":"secondary",children:a.label})]})})]},r.id)})})]})})},Yp=()=>{const{data:s}=Oe(),{stats:t}=$r();return e.jsx(M,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(J,{title:"Mój profil",description:"Zarządzaj swoim kontem i zobacz swoje statystyki"}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Informacje osobiste"})}),e.jsx(_,{children:e.jsxs("div",{className:"flex items-start gap-6",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center text-white text-3xl font-bold",children:s?.full_name?.charAt(0)||"U"}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:s?.full_name}),e.jsx(H,{variant:"secondary",className:"mt-1",children:"Uczeń"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ds,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{children:s?.email})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Fs,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:["Dołączył: ",new Date(s?.created_at||Date.now()).toLocaleDateString("pl-PL")]})]})]})]}),e.jsx(w,{variant:"outline",children:"Edytuj profil"})]})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Moje osiągnięcia"}),e.jsxs(te,{variant:"2-2-4",children:[e.jsx(S,{children:e.jsx(_,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-yellow-500 to-yellow-600",children:e.jsx(qe,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:t.points}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Punktów zdobytych"})]})]})})}),e.jsx(S,{children:e.jsx(_,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-purple-500 to-purple-600",children:e.jsx(ws,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:t.quizzes_completed}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ukończonych quizów"})]})]})})}),e.jsx(S,{children:e.jsx(_,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-green-500 to-green-600",children:e.jsx(ws,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:t.perfect_scores}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Perfekcyjnych wyników"})]})]})})}),e.jsx(S,{children:e.jsx(_,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-orange-500 to-orange-600",children:e.jsx(Ir,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[t.streak," dni"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Najdłuższa seria"})]})]})})}),e.jsx(S,{children:e.jsx(_,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600",children:e.jsx(is,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[Math.floor(t.total_time/60),"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Czasu nauki"})]})]})})}),e.jsx(S,{children:e.jsx(_,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-pink-500 to-pink-600",children:e.jsx(Ts,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:["Poziom ",t.level]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aktualny poziom"})]})]})})})]})]}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(L,{children:"Ustawienia konta"})}),e.jsxs(_,{className:"space-y-4",children:[e.jsx(w,{variant:"outline",className:"w-full justify-start",children:"Zmień hasło"}),e.jsx(w,{variant:"outline",className:"w-full justify-start",children:"Ustawienia powiadomień"}),e.jsx(w,{variant:"outline",className:"w-full justify-start text-red-600 hover:text-red-700",children:"Usuń konto"})]})]})]})})},eh=[e.jsx(O,{path:"/student/dashboard",element:e.jsx(Bp,{})},"student-dashboard"),e.jsx(O,{path:"/student/courses",element:e.jsx(Gp,{})},"student-courses"),e.jsx(O,{path:"/student/courses/:courseId",element:e.jsx(Kp,{})},"student-course-detail"),e.jsx(O,{path:"/student/courses/:courseId/lesson/:lessonId",element:e.jsx(Zp,{})},"student-lesson"),e.jsx(O,{path:"/student/courses/:courseId/quiz/:quizId",element:e.jsx(Qp,{})},"student-quiz"),e.jsx(O,{path:"/student/gamification",element:e.jsx(Hp,{})},"student-gamification"),e.jsx(O,{path:"/student/leaderboard",element:e.jsx(Jp,{})},"student-leaderboard"),e.jsx(O,{path:"/student/achievements",element:e.jsx(Xp,{})},"student-achievements"),e.jsx(O,{path:"/student/profile",element:e.jsx(Yp,{})},"student-profile")],ts=({children:s})=>e.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center p-4 relative overflow-hidden",children:[e.jsx("div",{className:"h-96 fixed top-0 w-full -rotate-1 scale-125",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-400/0 via-pink-300/15 to-purple-500/10"})}),e.jsx("div",{className:"absolute top-20 -left-32 w-64 h-64 bg-gradient-to-br from-purple-300/20 to-pink-300/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-20 -right-32 w-96 h-96 bg-gradient-to-tl from-purple-400/15 to-pink-400/15 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-full h-64 bg-gradient-to-b from-pink-200/10 to-transparent"}),e.jsx("div",{className:"w-full max-w-lg space-y-3 relative z-10",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-300/5 to-pink-300/5 rounded-lg blur-md"}),e.jsx("div",{className:"relative bg-background/80 backdrop-blur-sm rounded-lg shadow-xl shadow-purple-200/20 border border-purple-200/20 p-8",children:s})]})})]}),sh=()=>{const{mutate:s,isLoading:t}=Ul(),[r,a]=W.useState(""),[n,i]=W.useState(""),[o,l]=W.useState(null),c=W.useCallback(()=>{if(console.log("🚀 Login attempt:",{email:r}),!r.trim()||!n.trim()){l("Wypełnij wszystkie pola");return}l(null),s({email:r.trim(),password:n},{onSuccess:x=>{console.log("✅ Login success:",x)},onError:x=>{console.error("❌ Login error:",x);let m="Błąd logowania";x?.message&&(x.message.includes("Invalid login credentials")?m="Nieprawidłowe dane logowania":x.message.includes("Email not confirmed")?m="Potwierdź email przed zalogowaniem":m=x.message),l(m)}})},[r,n,s]),u=W.useCallback(x=>{x.preventDefault(),c()},[c]);return{email:r,password:n,setEmail:a,setPassword:i,isLoading:t,error:o,login:c,handleSubmit:u}},th=()=>{const[s]=Gt(),{email:t,password:r,setEmail:a,setPassword:n,isLoading:i,error:o,handleSubmit:l}=sh(),{data:c,isLoading:u}=Bl(),{data:x,isLoading:m}=Oe(),p=s.get("verified")==="true",g=s.get("passwordChanged")==="true",b=t.trim().length>0&&r.length>0,h=j=>j.includes("nie zostało potwierdzone")?"warning":"destructive",f=j=>j.includes("nie zostało potwierdzone")?Ar:xt,y=j=>{if(o){if(j==="email"&&o.toLowerCase().includes("email"))return"Sprawdź poprawność adresu email";if(j==="password"&&o.toLowerCase().includes("hasło"))return"Sprawdź poprawność hasła"}};if(u||m)return e.jsx(ts,{children:e.jsx(S,{children:e.jsx(_,{className:"flex items-center justify-center py-12",children:e.jsx(Hs,{className:"h-8 w-8 animate-spin"})})})});if(c&&x){const j=x.role?`/${x.role}`:"/profiles";return e.jsx(ct,{to:j,replace:!0})}return e.jsx(ts,{children:e.jsxs(S,{children:[e.jsxs(A,{className:"space-y-1",children:[e.jsx(L,{className:"text-2xl text-center",children:"Zaloguj się"}),e.jsx(Ws,{className:"text-center",children:"Wprowadź swoje dane aby się zalogować"})]}),e.jsxs(_,{children:[p&&e.jsxs(oe,{className:"mb-4 border-green-200 bg-green-50",children:[e.jsx(Is,{className:"h-4 w-4 text-green-600"}),e.jsxs(le,{className:"text-green-800",children:[e.jsx("strong",{children:"Email potwierdzony!"})," Możesz się teraz zalogować."]})]}),g&&e.jsxs(oe,{className:"mb-4 border-green-200 bg-green-50",children:[e.jsx(Is,{className:"h-4 w-4 text-green-600"}),e.jsxs(le,{className:"text-green-800",children:[e.jsx("strong",{children:"Hasło zmienione!"})," Możesz się zalogować używając nowego hasła."]})]}),e.jsxs(ns,{onSubmit:l,children:[e.jsx(Z,{label:e.jsxs("span",{className:"flex items-center",children:[e.jsx(Ds,{className:"mr-2 h-4 w-4"}),"Email"]}),htmlFor:"email",error:y("email"),required:!0,children:e.jsx($,{id:"email",type:"email",placeholder:"przykład@email.com",value:t,onChange:j=>a(j.target.value),disabled:i,className:y("email")?"border-red-500":""})}),e.jsx(Z,{label:e.jsxs("span",{className:"flex items-center",children:[e.jsx(vc,{className:"mr-2 h-4 w-4"}),"Hasło"]}),htmlFor:"password",error:y("password"),required:!0,children:e.jsx($,{id:"password",type:"password",placeholder:"Wprowadź hasło",value:r,onChange:j=>n(j.target.value),disabled:i,className:y("password")?"border-red-500":""})}),o&&e.jsxs(oe,{variant:h(o),children:[W.createElement(f(o),{className:"h-4 w-4"}),e.jsxs(le,{children:[e.jsx("strong",{children:"Błąd logowania:"})," ",o,o.includes("nie zostało potwierdzone")&&e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsxs("p",{children:["💡 ",e.jsx("strong",{children:"Co robić:"})]}),e.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-1",children:[e.jsx("li",{children:"Sprawdź swoją skrzynkę email (także spam)"}),e.jsx("li",{children:"Kliknij link aktywacyjny w emailu"}),e.jsxs("li",{children:["Jeśli nie otrzymałeś emaila, możesz"," ",e.jsx(It,{to:"/resend-confirmation",className:"underline",children:"wysłać ponownie"})]})]})]}),o.includes("Nieprawidłowe dane")&&e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsxs("p",{children:["💡 ",e.jsx("strong",{children:"Sprawdź:"})]}),e.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-1",children:[e.jsx("li",{children:"Czy email jest wpisany poprawnie"}),e.jsx("li",{children:"Czy hasło jest poprawne (uwaga na wielkość liter)"}),e.jsx("li",{children:"Czy masz już założone konto"})]})]})]})]}),e.jsx(os,{className:"!border-0 !pt-0 justify-center",children:e.jsxs(w,{type:"submit",className:"w-full",disabled:i||!b,children:[i&&e.jsx(Hs,{className:"mr-2 h-4 w-4 animate-spin"}),i?"Logowanie...":"Zaloguj się"]})})]}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsx("div",{className:"text-center text-sm",children:e.jsx(It,{to:"/register/step1",className:"text-blue-600 hover:text-blue-500 transition-colors",children:"Nie masz konta? Zarejestruj się"})}),e.jsx("div",{className:"text-center text-sm",children:e.jsx(It,{to:"/forgot-password",className:"text-blue-600 hover:text-blue-500 transition-colors",children:"Zapomniałeś hasła?"})}),e.jsx("div",{className:"border-t pt-4 mt-4",children:e.jsxs("div",{className:"text-center text-xs text-gray-500",children:[e.jsx("p",{children:"Problemy z logowaniem?"}),e.jsx(It,{to:"/contact",className:"text-blue-600 hover:text-blue-500 transition-colors",children:"Skontaktuj się z pomocą techniczną"})]})})]})]})]})})},rh=()=>{const{mutate:s,isLoading:t,error:r}=Gl(),[a,n]=W.useState(1),[i,o]=W.useState(""),[l,c]=W.useState(""),[u,x]=W.useState(""),[m,p]=W.useState(""),[g,b]=W.useState(""),h=[{value:"beneficiary",label:"Beneficiary",description:"Użytkownik końcowy systemu",icon:Ts},{value:"auditor",label:"Auditor",description:"Audytor z uprawnieniami kontrolnymi",icon:Tr}],f=k=>{if(k.preventDefault(),b(""),l!==u){b("Hasła nie są identyczne");return}if(l.length<6){b("Hasło musi mieć co najmniej 6 znaków");return}n(2)},y=()=>{if(!m){b("Wybierz rolę");return}s({email:i,password:l,role:m})},j=k=>{p(k),b("")},v=()=>{n(1),b("")};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"max-w-md w-full space-y-8",children:a===1?e.jsxs(S,{children:[e.jsxs(A,{className:"space-y-1",children:[e.jsx(L,{className:"text-2xl text-center",children:"Zarejestruj się"}),e.jsx(Ws,{className:"text-center",children:"Krok 1/2: Podaj swoje dane"})]}),e.jsxs(_,{children:[e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"email",children:"Email"}),e.jsx($,{id:"email",type:"email",placeholder:"przykład@email.com",value:i,onChange:k=>o(k.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"password",children:"Hasło"}),e.jsx($,{id:"password",type:"password",placeholder:"Minimum 6 znaków",value:l,onChange:k=>c(k.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"confirmPassword",children:"Potwierdź hasło"}),e.jsx($,{id:"confirmPassword",type:"password",placeholder:"Powtórz hasło",value:u,onChange:k=>x(k.target.value),required:!0})]}),g&&e.jsx(oe,{variant:"destructive",children:e.jsx(le,{children:g})}),e.jsx(w,{type:"submit",className:"w-full",children:"Dalej"})]}),e.jsx("div",{className:"mt-4 text-center text-sm",children:e.jsx("a",{href:"/login",className:"text-blue-600 hover:text-blue-500",children:"Masz już konto? Zaloguj się"})})]})]}):e.jsxs(S,{children:[e.jsxs(A,{className:"space-y-1",children:[e.jsx(L,{className:"text-2xl text-center",children:"Wybierz rolę"}),e.jsx(Ws,{className:"text-center",children:"Krok 2/2: Jaka jest Twoja rola w systemie?"})]}),e.jsxs(_,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:h.map(k=>{const C=k.icon;return e.jsx("div",{onClick:()=>j(k.value),className:`p-4 border-2 rounded-lg cursor-pointer transition-all hover:bg-gray-50 ${m===k.value?"border-blue-500 bg-blue-50":"border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(C,{className:`h-6 w-6 mt-1 ${m===k.value?"text-blue-600":"text-gray-400"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-medium ${m===k.value?"text-blue-900":"text-gray-900"}`,children:k.label}),e.jsx("p",{className:`text-sm ${m===k.value?"text-blue-700":"text-gray-500"}`,children:k.description})]})]})},k.value)})}),g&&e.jsx(oe,{variant:"destructive",children:e.jsx(le,{children:g})}),r&&e.jsx(oe,{variant:"destructive",children:e.jsx(le,{children:r?.message||"Błąd rejestracji"})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(w,{variant:"outline",onClick:v,className:"flex-1",disabled:t,children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),"Wstecz"]}),e.jsxs(w,{onClick:y,className:"flex-1",disabled:t||!m,children:[t&&e.jsx(Hs,{className:"mr-2 h-4 w-4 animate-spin"}),"Zarejestruj się"]})]})]})]})})})},ah=()=>{const{mutate:s,isLoading:t,error:r,isSuccess:a}=Kl(),[n,i]=W.useState(""),o=l=>{l.preventDefault(),s({email:n})};return a?e.jsx(ts,{children:e.jsxs(S,{children:[e.jsxs(A,{className:"space-y-1",children:[e.jsxs(L,{className:"text-2xl text-center flex items-center justify-center gap-2",children:[e.jsx(Is,{className:"h-6 w-6 text-green-500"}),"Email wysłany"]}),e.jsx(Ws,{className:"text-center",children:"Sprawdź swoją skrzynkę odbiorczą"})]}),e.jsxs(_,{children:[e.jsx(oe,{children:e.jsxs(le,{children:["Wysłaliśmy link do resetowania hasła na adres ",e.jsx("strong",{children:n}),". Sprawdź swoją skrzynkę odbiorczą i kliknij w link, aby zresetować hasło."]})}),e.jsx("div",{className:"text-center",children:e.jsx("a",{href:"/login",className:"text-blue-600 hover:text-blue-500",children:"Powrót do logowania"})})]})]})}):e.jsx(ts,{children:e.jsxs(S,{children:[e.jsxs(A,{className:"space-y-1",children:[e.jsx(L,{className:"text-2xl text-center",children:"Resetuj hasło"}),e.jsx(Ws,{className:"text-center",children:"Wprowadź swój email, aby otrzymać link do resetowania hasła"})]}),e.jsxs(_,{children:[e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"email",children:"Email"}),e.jsx($,{id:"email",type:"email",placeholder:"przykład@email.com",value:n,onChange:l=>i(l.target.value),required:!0})]}),r&&e.jsx(oe,{variant:"destructive",children:e.jsx(le,{children:r.message||"Błąd podczas wysyłania emaila"})}),e.jsxs(w,{type:"submit",className:"w-full",disabled:t,children:[t&&e.jsx(Hs,{className:"mr-2 h-4 w-4 animate-spin"}),"Wyślij link resetujący"]})]}),e.jsx("div",{className:"mt-4 text-center text-sm",children:e.jsx("a",{href:"/login",className:"text-blue-600 hover:text-blue-500",children:"Powrót do logowania"})})]})]})})},ih=()=>{const s=Q(),{mutate:t,isLoading:r,error:a}=Zl(),[n,i]=W.useState(""),[o,l]=W.useState(""),[c,u]=W.useState(""),[x,m]=W.useState(!0),[p,g]=W.useState(!0),[b,h]=W.useState(!1);W.useEffect(()=>{(async()=>{try{const{data:j}=await se.auth.getSession(),k=new URLSearchParams(window.location.hash.substring(1)).get("type");!j.session&&k!=="recovery"?(console.log("No valid recovery session found"),m(!1),setTimeout(()=>{s("/forgot-password")},3e3)):(console.log("Valid session found"),m(!0))}catch(j){console.error("Session check error:",j),m(!1)}finally{g(!1)}})()},[s]);const f=async y=>{if(y.preventDefault(),u(""),n!==o){u("Hasła nie są identyczne");return}if(n.length<6){u("Hasło musi mieć co najmniej 6 znaków");return}if(n.length>72){u("Hasło nie może być dłuższe niż 72 znaki");return}t({password:n},{onSuccess:()=>{h(!0),setTimeout(()=>{s("/login?passwordChanged=true")},3e3)},onError:j=>{console.error("Password update error:",j),u(j?.message||"Błąd aktualizacji hasła")}})};return p?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Hs,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Weryfikacja sesji..."})]})}):x?b?e.jsx(ts,{children:e.jsxs(S,{className:"border-green-200",children:[e.jsx(A,{children:e.jsxs(L,{className:"text-2xl text-center flex items-center justify-center gap-2",children:[e.jsx(Is,{className:"h-6 w-6 text-green-600"}),"Hasło zmienione!"]})}),e.jsx(_,{children:e.jsxs(oe,{className:"border-green-200 bg-green-50",children:[e.jsx(Is,{className:"h-4 w-4 text-green-600"}),e.jsx(le,{className:"text-green-800",children:"Twoje hasło zostało pomyślnie zmienione. Za chwilę zostaniesz przekierowany do strony logowania..."})]})})]})}):e.jsx(ts,{children:e.jsxs(S,{children:[e.jsxs(A,{className:"space-y-1",children:[e.jsxs(L,{className:"text-2xl text-center flex items-center justify-center gap-2",children:[e.jsx(Nc,{className:"h-6 w-6"}),"Nowe hasło"]}),e.jsx(Ws,{className:"text-center",children:"Wprowadź nowe hasło dla swojego konta"})]}),e.jsxs(_,{children:[e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"password",children:"Nowe hasło"}),e.jsx($,{id:"password",type:"password",placeholder:"Minimum 6 znaków",value:n,onChange:y=>i(y.target.value),disabled:r,required:!0,autoFocus:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"confirmPassword",children:"Potwierdź nowe hasło"}),e.jsx($,{id:"confirmPassword",type:"password",placeholder:"Powtórz nowe hasło",value:o,onChange:y=>l(y.target.value),disabled:r,required:!0})]}),e.jsxs(oe,{children:[e.jsx(Ar,{className:"h-4 w-4"}),e.jsxs(le,{children:[e.jsx("strong",{children:"Wymagania hasła:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 text-sm",children:[e.jsx("li",{children:"Minimum 6 znaków"}),e.jsx("li",{children:"Maksimum 72 znaki"}),e.jsx("li",{children:"Zalecane użycie liter, cyfr i znaków specjalnych"})]})]})]}),(a||c)&&e.jsxs(oe,{variant:"destructive",children:[e.jsx(xt,{className:"h-4 w-4"}),e.jsx(le,{children:c||a?.message||"Błąd aktualizacji hasła"})]}),e.jsxs(w,{type:"submit",className:"w-full",disabled:r,children:[r&&e.jsx(Hs,{className:"mr-2 h-4 w-4 animate-spin"}),r?"Aktualizowanie...":"Zaktualizuj hasło"]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Pamiętasz hasło?"," ",e.jsx("a",{href:"/login",className:"text-blue-600 hover:text-blue-500",children:"Wróć do logowania"})]})})]})]})}):e.jsx(ts,{children:e.jsx(S,{className:"border-red-200",children:e.jsx(_,{className:"pt-6",children:e.jsxs(oe,{variant:"destructive",children:[e.jsx(xt,{className:"h-4 w-4"}),e.jsxs(le,{children:[e.jsx("strong",{children:"Nieprawidłowa lub wygasła sesja."}),e.jsx("br",{}),"Link do resetowania hasła mógł wygasnąć. Za chwilę zostaniesz przekierowany do strony resetowania hasła..."]})]})})})})},Fo=({schemaPath:s,onSubmit:t,submitLabel:r="Dalej",className:a=""})=>{const{getSchemaFragment:n,setData:i,getData:o}=me(),[l]=s.split("."),[c,u]=W.useState(""),[x,m]=W.useState({}),p=n(s),g=o(l);if(!p)return e.jsx(oe,{variant:"destructive",children:e.jsxs(le,{children:["Nie znaleziono schematu dla ścieżki: ",s]})});const b=y=>{y.preventDefault(),u(""),m({});const j={};if(p.required)for(const v of p.required)g[v]||(j[v]="To pole jest wymagane");if(Object.keys(j).length>0){m(j);return}if(p.validation){const v=p.validation(g);if(v){u(v);return}}t(g)},h=(y,j)=>{i(l,{...g,[y]:j}),x[y]&&m(v=>{const k={...v};return delete k[y],k})},f=(y,j)=>{const v=g[y]||"",k=p.required?.includes(y),C=x[y];switch(j.type){case"text":case"email":case"password":return e.jsx(Z,{label:j.title||y,htmlFor:y,error:C,required:k,children:e.jsx($,{id:y,type:j.type,value:v,placeholder:j.placeholder,onChange:z=>h(y,z.target.value),className:C?"border-red-500":""})},y);case"select":return e.jsx(Z,{label:j.title||y,htmlFor:y,error:C,required:k,children:e.jsxs(xe,{value:v,onValueChange:z=>h(y,z),children:[e.jsx(de,{className:C?"border-red-500":"",children:e.jsx(pe,{placeholder:j.placeholder||"Wybierz opcję"})}),e.jsx(ue,{children:j.options?.map(z=>e.jsx(U,{value:z.value,children:z.label},z.value))})]})},y);default:return null}};return e.jsxs(S,{className:a,children:[e.jsx(A,{children:e.jsx(L,{children:p.title})}),e.jsx(_,{children:e.jsxs(ns,{onSubmit:b,children:[e.jsxs(te,{variant:"1-1-1",children:[p.properties&&Object.entries(p.properties).map(([y,j])=>f(y,j)),c&&e.jsx(oe,{variant:"destructive",className:"mt-4",children:e.jsx(le,{children:c})})]}),e.jsx(os,{className:"mt-6 pt-6",children:e.jsx(w,{type:"submit",className:"w-full sm:w-auto",children:r})})]})})]})},nh=()=>{const s=Q(),{register:t}=me();d.useEffect(()=>{t({id:"registration",title:"Proces rejestracji",schema:{step1:{title:"Dane podstawowe",type:"object",properties:{email:{type:"email",title:"Email",placeholder:"przykład@email.com"},name:{type:"text",title:"Imię i nazwisko",placeholder:"Jan Kowalski"}},required:["email","name"],validation:a=>a.name&&a.name.trim().length<3?"Imię i nazwisko musi mieć co najmniej 3 znaki":a.name&&!a.name.includes(" ")?"Podaj zarówno imię jak i nazwisko":null},step2:{title:"Hasło",type:"object",properties:{password:{type:"password",title:"Hasło",placeholder:"Minimum 6 znaków"},confirmPassword:{type:"password",title:"Potwierdź hasło",placeholder:"Powtórz hasło"}},required:["password","confirmPassword"],validation:a=>a.password&&a.password.length<6?"Hasło musi mieć co najmniej 6 znaków":a.password!==a.confirmPassword?"Hasła nie są identyczne":null},step3:{title:"Podsumowanie",type:"object",properties:{}}}})},[t]);const r=a=>{console.log("RegisterStep1 - Otrzymane dane z formularza:",a),s("/register/step2")};return e.jsxs(ts,{children:[e.jsxs("div",{className:"flex items-start gap-5 ",children:[e.jsx(Vs,{className:"mt-2 bg-white rounded-full p-2 w-12 h-12"}),e.jsx(J,{title:"Rejestracja",description:"1 z 3 Podaj podstawowe informacje"})]}),e.jsx(Fo,{schemaPath:"registration.step1",onSubmit:r,submitLabel:"Dalej"}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx(It,{to:"/login",className:"text-blue-600 hover:text-blue-500 text-sm",children:"Masz już konto? Zaloguj się"})})]})},oh=()=>{const s=Q(),{setData:t}=me(),r=n=>{t("registration",n),s("/register/step3")},a=()=>{s("/register/step1")};return e.jsxs(ts,{children:[e.jsxs("div",{className:"flex items-start gap-5 ",children:[e.jsx(zc,{className:"mt-2 bg-white rounded-full p-2 w-12 h-12"}),e.jsx(J,{title:"Rejestracja",description:"2 z 3 Ustaw hasło do konta"})]}),e.jsx(Fo,{schemaPath:"registration.step2",onSubmit:r,submitLabel:"Dalej"}),e.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[e.jsxs(w,{variant:"outline",onClick:a,className:"flex items-center",children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),"Wstecz"]}),e.jsx("a",{href:"/login",className:"text-blue-600 hover:text-blue-500 text-sm",children:"Masz już konto? Zaloguj się"})]})]})},lh=()=>{const s=Q(),{getData:t,setData:r}=me(),[a,n]=W.useState(!1),[i,o]=W.useState(!1),[l,c]=W.useState(null),u=t("registration"),x=W.useCallback(async()=>{if(!ia.register){c("Funkcja rejestracji nie jest dostępna");return}if(!u?.email||!u?.password){c("Brak wymaganych danych. Rozpocznij proces rejestracji od początku.");return}n(!0),c(null);try{console.log("📝 Attempting registration with:",{email:u.email,name:u.name});const p=await ia.register({email:u.email,password:u.password,name:u.name});if(console.log("📝 Registration result:",p),p.success)o(!0),r("registration",{...u,registrationComplete:!0,registrationDate:new Date().toISOString(),user:p.user}),setTimeout(()=>{s("/register/step4")},1500);else{const g=p.error?.message||"Rejestracja nie powiodła się";console.error("❌ Registration failed:",g),c(g)}}catch(p){console.error("❌ Registration error:",p);const g=p?.message||"Wystąpił nieoczekiwany błąd";c(g)}finally{n(!1)}},[u,r,s]),m=W.useCallback(()=>{s("/register/step2")},[s]);return{isLoading:a,isSuccess:i,error:l,register:x,goBack:m,processData:u}},ch=()=>{const s=Q(),{isLoading:t,isSuccess:r,error:a,register:n,goBack:i,processData:o}=lh();return!o||!o.email?e.jsxs(ts,{children:[e.jsx(J,{title:"Rejestracja",description:"Błąd - brak danych"}),e.jsxs(oe,{variant:"destructive",children:[e.jsx(xt,{className:"h-4 w-4"}),e.jsx(le,{children:"Brak danych rejestracji. Rozpocznij proces od początku."})]}),e.jsx(w,{onClick:()=>s("/register/step1"),className:"mt-4",children:"Wróć do kroku 1"})]}):e.jsxs(ts,{children:[e.jsxs("div",{className:"flex items-start gap-5 ",children:[e.jsx(kc,{className:"mt-2 bg-white rounded-full p-2 w-12 h-12"}),e.jsx(J,{title:"Rejestracja",description:"3 z 4 Potwierdzenie danych"})]}),r&&e.jsxs(oe,{className:"mb-4 border-green-200 bg-green-50",children:[e.jsx(Re,{className:"h-4 w-4 text-green-600"}),e.jsxs(le,{className:"text-green-800",children:[e.jsx("strong",{children:"Rejestracja udana!"})," Za chwilę zostaniesz przekierowany..."]})]}),a&&!r&&e.jsxs(oe,{variant:"destructive",className:"mb-4",children:[e.jsx(xt,{className:"h-4 w-4"}),e.jsxs(le,{children:[e.jsx("strong",{children:"Rejestracja nieudana:"})," ",a]})]}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsxs(L,{className:"flex items-center",children:[e.jsx(Re,{className:"mr-2 h-5 w-5 text-blue-600"}),"Podsumowanie"]})}),e.jsxs(_,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-blue-800 font-medium",children:"Co się stanie:"}),e.jsxs("ul",{className:"text-sm text-blue-700 mt-2 space-y-1",children:[e.jsx("li",{children:"• Konto zostanie utworzone"}),e.jsx("li",{children:"• Otrzymasz email z potwierdzeniem"}),e.jsx("li",{children:"• Po aktywacji będziesz mógł się zalogować"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(Ds,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Email"}),e.jsx("p",{className:"text-sm text-gray-600",children:o.email})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(Ts,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Imię i nazwisko"}),e.jsx("p",{className:"text-sm text-gray-600",children:o.name})]})]})]}),a&&!r&&e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-sm text-red-800 font-medium",children:"Wskazówki w przypadku problemów:"}),e.jsxs("ul",{className:"text-sm text-red-700 mt-2 space-y-1",children:[e.jsx("li",{children:"• Sprawdź czy email ma prawidłowy format"}),e.jsx("li",{children:"• Upewnij się że hasło spełnia wymagania (6-72 znaków)"}),e.jsx("li",{children:"• Jeśli masz już konto, przejdź do logowania"}),e.jsx("li",{children:"• W przypadku dalszych problemów skontaktuj się z pomocą"})]})]})]})]}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsxs(w,{variant:"outline",onClick:i,disabled:t||r,children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),"Wstecz"]}),e.jsxs(w,{onClick:n,disabled:t||r,children:[t&&e.jsx(Hs,{className:"mr-2 h-4 w-4 animate-spin"}),t?"Rejestruję...":r?"Udane!":a?"Spróbuj ponownie":"Zarejestruj się"]})]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("a",{href:"/login",className:"text-blue-600 hover:text-blue-500 text-sm",children:"Masz już konto? Zaloguj się"})})]})},dh=()=>{const s=Q(),{getData:t,unregister:r}=me(),[a,n]=W.useState(!1),[i,o]=W.useState(!1),l=t("registration"),c=l?.email||"user@example.com",u=l?.name||"Użytkownik";W.useEffect(()=>{const p=setTimeout(()=>{r("registration","data")},3e4);return()=>clearTimeout(p)},[r]);const x=async()=>{n(!0);try{await new Promise(p=>setTimeout(p,2e3)),o(!0),setTimeout(()=>o(!1),3e3)}catch(p){console.error("Błąd wysyłania maila:",p)}finally{n(!1)}},m=()=>{r("registration","data"),s("/login")};return e.jsxs(ts,{children:[e.jsx(J,{title:"Rejestracja zakończona!",description:"4 z 4 Sprawdź swoją skrzynkę mailową"}),e.jsxs(S,{className:"border-green-200 bg-green-50",children:[e.jsx(A,{children:e.jsxs(L,{className:"flex items-center text-green-800",children:[e.jsx(Is,{className:"mr-2 h-6 w-6 text-green-600"}),"Konto zostało utworzone!"]})}),e.jsx(_,{className:"space-y-4",children:e.jsxs("div",{className:"text-green-700",children:[e.jsx("p",{className:"font-medium",children:"Gratulacje! Twoje konto zostało pomyślnie utworzone."}),e.jsxs("p",{className:"text-sm mt-1",children:["Wysłaliśmy email z potwierdzeniem na adres ",e.jsx("strong",{children:c})]})]})})]}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsxs(L,{className:"flex items-center",children:[e.jsx(Ts,{className:"mr-2 h-5 w-5"}),"Podsumowanie konta"]})}),e.jsxs(_,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(Ds,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Adres email"}),e.jsx("p",{className:"text-sm text-gray-600",children:c})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(Ts,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Imię i nazwisko"}),e.jsx("p",{className:"text-sm text-gray-600",children:u})]})]})]})]}),e.jsxs(S,{className:"border-blue-200",children:[e.jsx(A,{children:e.jsxs(L,{className:"flex items-center text-blue-800",children:[e.jsx(Ds,{className:"mr-2 h-5 w-5 text-blue-600"}),"Co dalej?"]})}),e.jsxs(_,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center text-xs font-bold",children:"1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Sprawdź swoją skrzynkę mailową"}),e.jsxs("p",{className:"text-gray-600",children:["Email potwierdzający został wysłany na adres ",e.jsx("strong",{children:c})]})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center text-xs font-bold",children:"2"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Kliknij link w emailu"}),e.jsx("p",{className:"text-gray-600",children:"Aktywuj swoje konto klikając w link potwierdzający"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center text-xs font-bold",children:"3"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Zaloguj się do systemu"}),e.jsx("p",{className:"text-gray-600",children:"Po aktywacji możesz się zalogować używając swojego emailu i hasła"})]})]})]}),e.jsxs(oe,{children:[e.jsx(is,{className:"h-4 w-4"}),e.jsxs(le,{children:[e.jsx("strong",{children:"Ważne:"})," Email może dotrzeć w ciągu kilku minut. Sprawdź także folder SPAM/Niechciane."]})]})]})]}),e.jsx(S,{children:e.jsx(_,{className:"pt-6",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Nie otrzymałeś emaila?"}),i&&e.jsxs(oe,{className:"border-green-200 bg-green-50",children:[e.jsx(Is,{className:"h-4 w-4 text-green-600"}),e.jsx(le,{className:"text-green-800",children:"Email został wysłany ponownie!"})]}),e.jsxs(w,{variant:"outline",onClick:x,disabled:a,className:"w-full sm:w-auto",children:[a&&e.jsx(Zt,{className:"mr-2 h-4 w-4 animate-spin"}),a?"Wysyłanie...":"Wyślij email ponownie"]})]})})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs(w,{onClick:m,className:"w-full",size:"lg",children:["Przejdź do logowania",e.jsx(gs,{className:"ml-2 h-4 w-4"})]}),e.jsx("div",{className:"text-center",children:e.jsx("a",{href:"/help",className:"text-blue-600 hover:text-blue-500 text-sm",children:"Potrzebujesz pomocy? Skontaktuj się z nami"})})]})]})},uh=[e.jsx(O,{path:"/login",element:e.jsx(th,{})},"auth-login"),e.jsx(O,{path:"/register",element:e.jsx(rh,{})},"auth-register"),e.jsx(O,{path:"/forgot-password",element:e.jsx(ah,{})},"auth-forgot-password"),e.jsx(O,{path:"/update-password",element:e.jsx(ih,{})},"auth-update-password"),e.jsx(O,{path:"/register/step1",element:e.jsx(nh,{})},"auth-register-1"),e.jsx(O,{path:"/register/step2",element:e.jsx(oh,{})},"auth-register-2"),e.jsx(O,{path:"/register/step3",element:e.jsx(ch,{})},"auth-register-3"),e.jsx(O,{path:"/register/step4",element:e.jsx(dh,{})},"auth-register-4")],mh=()=>{const s=Q(),[t,r]=d.useState(0),[a,n]=d.useState("");d.useEffect(()=>{const o=()=>r(window.scrollY);return window.addEventListener("scroll",o),()=>window.removeEventListener("scroll",o)},[]);const i=[{name:"Sty",value:65},{name:"Lut",value:72},{name:"Mar",value:78},{name:"Kwi",value:85},{name:"Maj",value:88},{name:"Cze",value:94}];return e.jsxs("div",{className:"min-h-screen bg-white text-foreground",children:[e.jsx("nav",{className:"fixed top-0 w-full z-50 bg-white/80 backdrop-blur-xl border-b border-gray-100",children:e.jsx("div",{className:"container mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-pink-600 to-purple-700 rounded-xl flex items-center justify-center",children:e.jsx(qe,{className:"w-5 h-5 text-white"})}),e.jsx("span",{className:"text-xl font-bold",children:"Smart Up"})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-8",children:[e.jsx("a",{href:"#funkcje",className:"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Funkcje"}),e.jsx("a",{href:"#kursy",className:"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Kursy"}),e.jsx("a",{href:"#firma",className:"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Dla firm"}),e.jsx("a",{href:"#cennik",className:"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Cennik"}),e.jsx(w,{className:"bg-gray-900 hover:bg-gray-800 text-white text-sm px-6",onClick:()=>s("/login"),children:"Rozpocznij"})]})]})})}),e.jsx("section",{className:"pt-32 pb-20 overflow-hidden",children:e.jsx("div",{className:"container mx-auto px-6",children:e.jsxs("div",{className:"grid lg:grid-cols-12 gap-8 items-center",children:[e.jsxs("div",{className:"lg:col-span-5",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-purple-50 rounded-full mb-8",children:[e.jsx(za,{className:"w-4 h-4 text-purple-700"}),e.jsx("span",{className:"text-sm font-medium text-purple-700",children:"Gamifikacja w edukacji"})]}),e.jsxs("h1",{className:"text-5xl md:text-6xl font-bold leading-tight mb-6",children:["Nauka, która",e.jsx("span",{className:"block text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-700",children:"motywuje"})]}),e.jsx("p",{className:"text-lg text-gray-600 mb-8 leading-relaxed",children:"Przekształć edukację w angażującą przygodę. System poziomów, punktów i nagród sprawia, że nauka staje się uzależniająca."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-12",children:[e.jsxs(w,{size:"lg",className:"bg-gray-900 hover:bg-gray-800 text-white px-8",onClick:()=>s("/login"),children:["Zacznij za darmo",e.jsx(gs,{className:"ml-2 h-4 w-4"})]}),e.jsx(w,{size:"lg",variant:"outline",className:"border-gray-300",children:"Zobacz demo"})]}),e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:"15k+"}),e.jsx("div",{className:"text-sm text-gray-500",children:"aktywnych uczniów"})]}),e.jsx("div",{className:"w-px h-12 bg-gray-200"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:"92%"}),e.jsx("div",{className:"text-sm text-gray-500",children:"ukończalność"})]}),e.jsx("div",{className:"w-px h-12 bg-gray-200"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:"4.9"}),e.jsx("div",{className:"text-sm text-gray-500",children:"ocena"})]})]})]}),e.jsx("div",{className:"lg:col-span-7",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -inset-4 bg-gradient-to-r from-pink-600/5 to-purple-700/5 rounded-3xl blur-2xl"}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-pink-600 to-purple-700 rounded-lg flex items-center justify-center",children:e.jsx(qe,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:"font-semibold",children:"Dashboard ucznia"})]}),e.jsx(H,{className:"bg-green-50 text-green-700 border-green-200",children:"Online"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-pink-50 to-pink-100 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(At,{className:"w-5 h-5 text-pink-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"+125"})]}),e.jsx("div",{className:"text-2xl font-bold",children:"1,842"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Punkty XP"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ws,{className:"w-5 h-5 text-purple-700"}),e.jsx("span",{className:"text-xs text-gray-500",children:"75%"})]}),e.jsx("div",{className:"text-2xl font-bold",children:"Lvl 12"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Poziom"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-teal-50 to-teal-100 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Lt,{className:"w-5 h-5 text-teal-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"New!"})]}),e.jsx("div",{className:"text-2xl font-bold",children:"24"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Odznaki"})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-sm font-medium",children:"Postęp nauki"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ostatnie 6 miesięcy"})]}),e.jsx(Cc,{width:"100%",height:120,children:e.jsxs(Sc,{data:i,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorProgress",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#db2777",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#db2777",stopOpacity:0})]})}),e.jsx(_c,{type:"monotone",dataKey:"value",stroke:"#db2777",strokeWidth:2,fill:"url(#colorProgress)"}),e.jsx(Tc,{dataKey:"name",axisLine:!1,tickLine:!1,tick:{fontSize:11}}),e.jsx(Dc,{hide:!0})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Aktywne kursy"}),e.jsx("a",{href:"#",className:"text-purple-700 hover:underline",children:"Zobacz wszystkie"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-pink-600 to-purple-700 rounded-lg flex items-center justify-center",children:e.jsx(aa,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:"JavaScript: Gra w kodowanie"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Rozdział 4 z 12"})]})]}),e.jsx(Zs,{className:"w-4 h-4 text-gray-400"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-teal-500 to-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(Xa,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:"Analiza danych: Quest"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Rozdział 7 z 10"})]})]}),e.jsx(Zs,{className:"w-4 h-4 text-gray-400"})]})]})]})]})]})]})})]})})}),e.jsx("section",{id:"funkcje",className:"py-20 bg-gray-50",children:e.jsxs("div",{className:"container mx-auto px-6",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsxs("h2",{className:"text-4xl font-bold mb-4",children:["Funkcje, które"," ",e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-700",children:"angażują"})]}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"System zaprojektowany, aby uczynić naukę uzależniającą jak najlepsza gra"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-pink-600/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-pink-600 to-purple-700 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(qe,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"System poziomów"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"99 poziomów do zdobycia. Każdy poziom odblokowuje nowe możliwości i nagrody."}),e.jsxs("div",{className:"flex items-center text-sm text-pink-600 font-medium",children:["Dowiedz się więcej",e.jsx(gs,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-700/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-purple-700 to-teal-500 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(At,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Idle Points"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Zdobywaj punkty nawet gdy nie uczysz się aktywnie. System pasywnego rozwoju."}),e.jsxs("div",{className:"flex items-center text-sm text-purple-700 font-medium",children:["Dowiedz się więcej",e.jsx(gs,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-teal-500/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-teal-500 to-blue-600 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(ws,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Wyzwania"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Codzienne i tygodniowe wyzwania z dodatkowymi nagrodami za ukończenie."}),e.jsxs("div",{className:"flex items-center text-sm text-teal-600 font-medium",children:["Dowiedz się więcej",e.jsx(gs,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-500/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-orange-500 to-yellow-500 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(Ie,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Rankingi"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Rywalizuj z innymi uczniami. Rankingi globalne, lokalne i grupowe."}),e.jsxs("div",{className:"flex items-center text-sm text-orange-600 font-medium",children:["Dowiedz się więcej",e.jsx(gs,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-700/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-purple-700 to-pink-600 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(Lt,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Odznaki"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Kolekcjonuj unikalne odznaki za osiągnięcia i kamienie milowe."}),e.jsxs("div",{className:"flex items-center text-sm text-purple-700 font-medium",children:["Dowiedz się więcej",e.jsx(gs,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-teal-500/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-teal-500 to-purple-700 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(Xa,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Analityka"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Szczegółowe statystyki postępów i personalizowane rekomendacje."}),e.jsxs("div",{className:"flex items-center text-sm text-teal-600 font-medium",children:["Dowiedz się więcej",e.jsx(gs,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]})]})]})}),e.jsx("section",{className:"py-20 bg-white",children:e.jsxs("div",{className:"container mx-auto px-6",children:[e.jsxs("div",{className:"max-w-3xl mx-auto text-center mb-16",children:[e.jsxs("h2",{className:"text-4xl font-bold mb-4",children:["Jak to"," ",e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-700",children:"działa"})]}),e.jsx("p",{className:"text-lg text-gray-600",children:"Cztery proste kroki do rozpoczęcia nauki z gamifikacją"})]}),e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 top-0 bottom-0 w-0.5 bg-gray-200"}),e.jsx("div",{className:"space-y-12",children:[{number:"01",title:"Stwórz profil",description:"Wybierz swoją rolę i spersonalizuj doświadczenie nauki",icon:Ie,color:"from-pink-600 to-purple-700"},{number:"02",title:"Wybierz kursy",description:"Przeglądaj bibliotekę kursów i wybierz te, które Cię interesują",icon:mt,color:"from-purple-700 to-teal-500"},{number:"03",title:"Ucz się i graj",description:"Rozwiązuj quizy, zdobywaj punkty i awansuj na kolejne poziomy",icon:aa,color:"from-teal-500 to-blue-600"},{number:"04",title:"Śledź postępy",description:"Monitoruj swoje osiągnięcia i rywalizuj z innymi",icon:Pr,color:"from-orange-500 to-yellow-500"}].map((o,l)=>e.jsx("div",{className:"relative",children:e.jsxs("div",{className:`flex items-center ${l%2===0?"flex-row":"flex-row-reverse"}`,children:[e.jsxs("div",{className:`w-5/12 ${l%2===0?"text-right pr-8":"text-left pl-8"}`,children:[e.jsxs("div",{className:`inline-flex items-center gap-4 mb-2 ${l%2===0?"flex-row-reverse":""}`,children:[e.jsx("h3",{className:"text-2xl font-bold",children:o.title}),e.jsx("span",{className:"text-4xl font-bold text-gray-200",children:o.number})]}),e.jsx("p",{className:"text-gray-600 text-lg",children:o.description})]}),e.jsx("div",{className:"w-2/12 flex justify-center",children:e.jsx("div",{className:`relative z-10 w-16 h-16 bg-gradient-to-br ${o.color} rounded-2xl flex items-center justify-center shadow-lg`,children:e.jsx(o.icon,{className:"w-8 h-8 text-white"})})}),e.jsx("div",{className:"w-5/12"})]})},l))})]})})]})}),e.jsx("section",{className:"py-20 bg-gradient-to-br from-gray-900 to-gray-800",children:e.jsx("div",{className:"container mx-auto px-6",children:e.jsx("div",{className:"grid md:grid-cols-4 gap-8",children:[{value:"15k+",label:"Aktywnych uczniów",icon:Ie},{value:"200+",label:"Kursów",icon:mt},{value:"92%",label:"Ukończalność",icon:ws},{value:"4.9/5",label:"Ocena",icon:an}].map((o,l)=>e.jsxs("div",{className:"text-center",children:[e.jsx(o.icon,{className:"w-8 h-8 mx-auto mb-4 text-white/60"}),e.jsx("div",{className:"text-4xl font-bold text-white mb-2",children:o.value}),e.jsx("div",{className:"text-sm text-white/60",children:o.label})]},l))})})}),e.jsx("section",{className:"py-20 bg-white",children:e.jsx("div",{className:"container mx-auto px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsxs("h2",{className:"text-4xl font-bold mb-6",children:["Gotowy na naukę, która"," ",e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-700",children:"wciąga"}),"?"]}),e.jsx("p",{className:"text-lg text-gray-600 mb-8 max-w-2xl mx-auto",children:"Dołącz do tysięcy uczniów, którzy odkryli radość z nauki dzięki gamifikacji. Pierwsze 30 dni gratis."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center mb-8",children:[e.jsx($,{type:"email",placeholder:"twoj@email.pl",value:a,onChange:o=>n(o.target.value),className:"max-w-xs h-12"}),e.jsxs(w,{size:"lg",className:"bg-gradient-to-r from-pink-600 to-purple-700 hover:opacity-90 text-white px-8 h-12",onClick:()=>s("/login"),children:["Rozpocznij za darmo",e.jsx(gs,{className:"ml-2 h-4 w-4"})]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Bez karty kredytowej • Anuluj w każdej chwili • Pełny dostęp"})]})})}),e.jsx("footer",{className:"bg-gray-900 text-white py-12",children:e.jsx("div",{className:"container mx-auto px-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-white/10 rounded-lg flex items-center justify-center",children:e.jsx(qe,{className:"w-4 h-4"})}),e.jsx("span",{className:"text-lg font-bold",children:"Smart Up"})]}),e.jsx("div",{className:"text-sm text-white/60",children:"© 2025 Smart Up. Wszystkie prawa zastrzeżone."})]})})})]})},ra=()=>{const{data:s}=Oe();return s?.role==="student"?e.jsx(ct,{to:"/student/dashboard",replace:!0}):e.jsx(ct,{to:"/dashboard/overview",replace:!0})};function xh(){return e.jsx(Al,{children:e.jsxs(Ql,{dataProvider:tc(se),liveProvider:sc(se),authProvider:ia,routerProvider:Vl,resources:[hd,Ix,Mx,Wx,Yx,ip,lp,up,Up,vp,Pp],options:{syncWithLocation:!0,warnWhenUnsavedChanges:!0,useNewQueryKeys:!0,liveMode:"auto"},children:[e.jsxs(ql,{children:[e.jsx(O,{path:"/",element:e.jsx(mh,{})}),...uh,e.jsxs(O,{element:e.jsx(Ha,{fallback:e.jsx(Jl,{to:"/login"}),children:e.jsx(dd,{children:e.jsx(Ol,{})})},"protected-layout"),children:[e.jsx(O,{path:"/admin",element:e.jsx(ra,{})}),e.jsx(O,{path:"/teacher",element:e.jsx(ra,{})}),e.jsx(O,{path:"/student",element:e.jsx(ct,{to:"/student/dashboard",replace:!0})}),e.jsx(O,{path:"/dashboard",element:e.jsx(ct,{to:"/dashboard/overview",replace:!0})}),...jd,...Px,...Lx,...Ux,...Kx,...Wp,...wp,...Ip,...ep,...np,...cp,...mp,...eh,e.jsx(O,{path:"*",element:e.jsx(Hl,{})})]}),e.jsx(O,{path:"*",element:e.jsx(Ha,{fallback:e.jsx(ct,{to:"/login",replace:!0}),children:e.jsx(ra,{})},"catch-all-redirect")})]}),e.jsx(Xl,{}),e.jsx(Yl,{})]})})}const ph=document.getElementById("root"),hh=Pc.createRoot(ph);hh.render(e.jsxs(W.StrictMode,{children:[e.jsx(xh,{}),e.jsx(Fl,{position:"top-right",richColors:!0,closeButton:!0,duration:4e3,toastOptions:{style:{width:"500px",fontSize:"20px"},className:"sonner-toast"}})]}));
