var Er=Object.defineProperty;var $r=(s,a,t)=>a in s?Er(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t;var Ns=(s,a,t)=>$r(s,typeof a!="symbol"?a+"":a,t);import{j as e,R as Dt,I as Lt,F as It,S as lt,a as Et,P as Ar,C as $t,b as At,V as Tr,c as Or,d as Tt,e as qr,T as Ot,f as Ur,g as qt,h as Ut,i as Fr,k as Ft,l as Br,L as Bt,m as Wt,n as Wr,o as Gr,p as Gt,q as Kr,r as Zr,s as Kt,t as Zt,u as Vt,v as Qt,w as Vr,x as Ht,y as Qr,z as Ze,A as Jt,B as ct,D as Te,E as G,G as Hr,H as Jr,J as Yr,K as Yt,M as Xr,N as Xt,O as ea,Q as sa,U as Is,W as ei,X as si,Y as ti,Z as ai,_ as ri,$ as ii,a0 as ni,a1 as oi,a2 as li,a3 as ci,a4 as di,a5 as mi,a6 as ta,a7 as ui,a8 as xi,a9 as hi,aa as kt,ab as aa,ac as pi,ad as ra,ae as ia,af as ji}from"./radix-ui-CWktHBVM.js";import{l as gi,a as p,n as fi,R as A,d as na,e as W,o as E,u as ie,p as hs,N as Ye,L as ns,B as wi,q as yi,O as vi}from"./react-vendor-SRHEfJrM.js";import{c as bi,t as $,M as Ni,T as ki}from"./utils-6GaIMJK4.js";import{n as me,M as oa,d as zi,e as ee,f as Xe,I as Es,i as X,$ as te,X as $s,j as _i,A as Ci,H as Si,w as Pi,k as Ri,l as Mi,m as Di,o as Li,D as Ii,p as Ei,E as zt,t as $i,_ as Ai,u as Ti}from"./refine-core-DcQOK7KF.js";import{c as Oi,C as Ne,b as qi,I as Ui}from"./refine-ui-C5yl_nsT.js";import{t as Fi,c as Bi,U as Ce,M as Ie,G as Rs,a as Wi,S as As,b as Ts,C as dt,d as Gi,e as Ee,f as mt,X as Se,L as la,T as ce,H as Ki,B as de,g as st,A as ls,h as Zi,i as cs,F as Os,j as Vi,k as ae,l as ca,m as we,n as qs,o as Qi,p as Us,q as Be,r as da,P as re,E as ps,s as ds,u as ke,v as $e,w as ge,x as se,y as ma,z as Fe,D as Fs,I as ze,J as Pe,K as Hi,R as ua,N as Re,O as tt,Q as xa,V as ut,W as Ms,Y as ha,Z as Ji,_ as pa,$ as Yi,a0 as Xi,a1 as en,a2 as sn,a3 as ja,a4 as tn,a5 as es,a6 as ks,a7 as an,a8 as rn,a9 as ga,aa as xt,ab as nn,ac as fa,ad as We,ae as on,af as wa,ag as ln,ah as cn,ai as dn,aj as _e,ak as _t}from"./ui-utils-C8AN1WSC.js";import{R as mn,A as un,a as xn,X as hn,Y as pn}from"./tables-RtBE5bgL.js";import"./forms-C0YMKGHR.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();var zs={},Ct;function jn(){if(Ct)return zs;Ct=1;var s=gi();return zs.createRoot=s.createRoot,zs.hydrateRoot=s.hydrateRoot,zs}var gn=jn();const fn="https://hqsyimochfcfqahcuprn.supabase.co",wn="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhxc3lpbW9jaGZjZnFhaGN1cHJuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4NjU4NTYsImV4cCI6MjA2OTQ0MTg1Nn0.KutvVrkDKuVyvrYQosU3SI6QrrMnWqDCSZ2E3fhCteI",B=Oi(fn,wn,{db:{schema:"public"},auth:{persistSession:!0}}),D=(...s)=>Fi(Bi(s));class Xs extends Error{constructor(t,r,i,n){super(t);Ns(this,"code");Ns(this,"statusCode");Ns(this,"details");this.name="AuthError",this.code=r,this.statusCode=i||400,this.details=n}}const _s={user_already_exists:"Konto z tym adresem email już istnieje.",password_too_short:"Hasło musi mieć co najmniej 6 znaków.",password_too_long:"Hasło nie może być dłuższe niż 72 znaki.",invalid_email:"Nieprawidłowy format adresu email.",over_email_send_rate_limit:"Za szybko! Poczekaj 2 sekundy przed ponowną próbą.",registration_failed:"Rejestracja nie powiodła się.",invalid_credentials:"Nieprawidłowy email lub hasło.",email_not_confirmed:"Potwierdź swój adres email przed zalogowaniem.",user_not_found:"Nie znaleziono użytkownika.",reset_password_rate_limit:"Zbyt wiele prób. Spróbuj ponownie za chwilę.",invalid_recovery_token:"Link do resetowania hasła wygasł lub jest nieprawidłowy.",update_failed:"Aktualizacja nie powiodła się.",session_expired:"Sesja wygasła. Zaloguj się ponownie.",oauth_error:"Błąd podczas logowania przez zewnętrznego dostawcę.",oauth_cancelled:"Logowanie zostało anulowane.",unknown_error:"Wystąpił nieoczekiwany błąd. Spróbuj ponownie.",network_error:"Błąd połączenia. Sprawdź swoje połączenie internetowe."},oe=s=>{if(!s)return new Xs(_s.unknown_error,"unknown_error");if(s instanceof Xs)return s;const a=s.message||s.error_description||"",t=s.code||s.error||"";let r="unknown_error",i=_s.unknown_error,n=400;if(t)switch(t){case"user_already_exists":case"user_already_registered":r="user_already_exists",n=409;break;case"weak_password":r="password_too_short",n=422;break;case"invalid_email":r="invalid_email",n=422;break;case"over_email_send_rate_limit":r="over_email_send_rate_limit",n=429;break;case"invalid_credentials":r="invalid_credentials",n=401;break;case"email_not_confirmed":r="email_not_confirmed",n=403;break;case"session_not_found":r="session_expired",n=401;break}return r==="unknown_error"&&(a.includes("User already registered")||a.includes("already exists")?(r="user_already_exists",n=409):a.includes("Password should be at least")?(r="password_too_short",n=422):a.includes("Password cannot be longer than 72")?(r="password_too_long",n=422):a.includes("Invalid email")?(r="invalid_email",n=422):a.includes("over_email_send_rate_limit")?(r="over_email_send_rate_limit",n=429):a.includes("Invalid login credentials")?(r="invalid_credentials",n=401):a.includes("Email not confirmed")?(r="email_not_confirmed",n=403):a.includes("Network request failed")&&(r="network_error",n=503)),i=_s[r]||a||_s.unknown_error,new Xs(i,r,n,{originalError:a,originalCode:t})};let Ue=null,rs=0;const St=6e4,at={login:async({email:s,password:a})=>{try{const{data:t,error:r}=await B.auth.signInWithPassword({email:s,password:a});return r?{success:!1,error:oe(r)}:(Ue=null,rs=0,{success:!0,redirectTo:"/dashboard/overview"})}catch(t){return{success:!1,error:oe(t)}}},logout:async()=>{try{const{error:s}=await B.auth.signOut();return Ue=null,rs=0,s?{success:!1,error:oe(s)}:{success:!0,redirectTo:"/login"}}catch(s){return{success:!1,error:oe(s)}}},check:async()=>{try{const{data:s}=await B.auth.getSession();return s?.session?{authenticated:!0}:{authenticated:!1,redirectTo:"/login"}}catch{return{authenticated:!1,redirectTo:"/login"}}},getIdentity:async()=>{try{const s=Date.now();if(Ue&&s-rs<St)return Ue;const{data:{session:a}}=await B.auth.getSession();if(!a)return null;const{data:t,error:r}=await B.from("users").select("*").eq("id",a.user.id).single();if(r||!t)return console.error("Error fetching user data:",r),{id:a.user.id,email:a.user.email||"",full_name:a.user.user_metadata?.full_name||"User",vendor_id:1,role:"student"};const i={id:t.id,email:t.email,full_name:t.full_name,vendor_id:t.vendor_id,role:t.role,is_active:t.is_active,created_at:t.created_at};return Ue=i,rs=s,i}catch(s){return console.error("Error in getIdentity:",s),null}},register:async({email:s,password:a,name:t})=>{try{if(console.log("🚀 Starting registration:",{email:s,name:t}),!s||!a)return{success:!1,error:oe({message:"Email i hasło są wymagane",code:"validation_error"})};if(a.length<6)return{success:!1,error:oe({message:"Password should be at least 6 characters",code:"weak_password"})};if(a.length>72)return{success:!1,error:oe({message:"Password cannot be longer than 72 characters",code:"password_too_long"})};const{data:r,error:i}=await B.auth.signUp({email:s.trim(),password:a,options:{data:{full_name:t||s.split("@")[0],role:"student"},emailRedirectTo:`${window.location.origin}/login?verified=true`}});return i?(console.error("❌ Registration error:",i),{success:!1,error:oe(i)}):r.user?(console.log("✅ Registration successful:",r.user.id),{success:!0,successNotification:{message:"Rejestracja udana! Sprawdź swoją skrzynkę email.",description:"Wysłaliśmy link aktywacyjny na podany adres email."}}):{success:!1,error:oe({message:"Rejestracja nie powiodła się - brak danych użytkownika",code:"registration_failed"})}}catch(r){return console.error("❌ Unexpected registration error:",r),{success:!1,error:oe(r)}}},forgotPassword:async({email:s})=>{try{const{error:a}=await B.auth.resetPasswordForEmail(s,{redirectTo:`${window.location.origin}/update-password`});return a?{success:!1,error:oe(a)}:{success:!0,successNotification:{message:"Email wysłany!",description:"Sprawdź swoją skrzynkę odbiorczą"}}}catch(a){return{success:!1,error:oe(a)}}},updatePassword:async({password:s})=>{try{const{error:a}=await B.auth.updateUser({password:s});return a?{success:!1,error:oe(a)}:{success:!0,redirectTo:"/login?passwordChanged=true"}}catch(a){return{success:!1,error:oe(a)}}},getPermissions:async()=>{try{const s=Date.now();if(Ue&&s-rs<St)return Ue.role;const{data:{session:a}}=await B.auth.getSession();if(!a)return null;const{data:t,error:r}=await B.from("users").select("role").eq("id",a.user.id).single();return r||!t?(console.error("Error fetching user permissions:",r),"student"):t.role}catch{return null}},onError:async s=>(console.error("Auth error:",s),s?.statusCode===401?{redirectTo:"/login",logout:!0,error:s}:{error:s})},Bs=({isLoading:s,isError:a,loadingText:t="Loading...",errorMsg:r="Error loading data"})=>s?e.jsx("div",{className:"p-6 text-gray-600 animate-reverse-pulse",children:t}):a?e.jsx("div",{className:"p-6 text-red-500",children:r}):null;function yn(s,a){let t;try{t=s()}catch{return}return{getItem:i=>{var n;const o=c=>c===null?null:JSON.parse(c,void 0),l=(n=t.getItem(i))!=null?n:null;return l instanceof Promise?l.then(o):o(l)},setItem:(i,n)=>t.setItem(i,JSON.stringify(n,void 0)),removeItem:i=>t.removeItem(i)}}const rt=s=>a=>{try{const t=s(a);return t instanceof Promise?t:{then(r){return rt(r)(t)},catch(r){return this}}}catch(t){return{then(r){return this},catch(r){return rt(r)(t)}}}},vn=(s,a)=>(t,r,i)=>{let n={storage:yn(()=>localStorage),partialize:j=>j,version:0,merge:(j,k)=>({...k,...j}),...a},o=!1;const l=new Set,c=new Set;let u=n.storage;if(!u)return s((...j)=>{console.warn(`[zustand persist middleware] Unable to update item '${n.name}', the given storage is currently unavailable.`),t(...j)},r,i);const x=()=>{const j=n.partialize({...r()});return u.setItem(n.name,{state:j,version:n.version})},d=i.setState;i.setState=(j,k)=>{d(j,k),x()};const m=s((...j)=>{t(...j),x()},r,i);i.getInitialState=()=>m;let h;const g=()=>{var j,k;if(!u)return;o=!1,l.forEach(w=>{var M;return w((M=r())!=null?M:m)});const y=((k=n.onRehydrateStorage)==null?void 0:k.call(n,(j=r())!=null?j:m))||void 0;return rt(u.getItem.bind(u))(n.name).then(w=>{if(w)if(typeof w.version=="number"&&w.version!==n.version){if(n.migrate){const M=n.migrate(w.state,w.version);return M instanceof Promise?M.then(P=>[!0,P]):[!0,M]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,w.state];return[!1,void 0]}).then(w=>{var M;const[P,Q]=w;if(h=n.merge(Q,(M=r())!=null?M:m),t(h,!0),P)return x()}).then(()=>{y?.(h,void 0),h=r(),o=!0,c.forEach(w=>w(h))}).catch(w=>{y?.(void 0,w)})};return i.persist={setOptions:j=>{n={...n,...j},j.storage&&(u=j.storage)},clearStorage:()=>{u?.removeItem(n.name)},getOptions:()=>n,rehydrate:()=>g(),hasHydrated:()=>o,onHydrate:j=>(l.add(j),()=>{l.delete(j)}),onFinishHydration:j=>(c.add(j),()=>{c.delete(j)})},n.skipHydration||g(),h||m},bn=vn;class Nn{static async call(a,t,r={}){const n={message:this.interpolateTemplate(t.user,r),...t.system&&{system:t.system},...a.model&&{model:a.model}},o=await fetch(a.endpoint,{method:"POST",headers:{"Content-Type":"application/json",...a.apiKey&&{Authorization:`Bearer ${a.apiKey}`}},body:JSON.stringify(n)});if(!o.ok)throw new Error(`LLM API Error: ${o.status} ${o.statusText}`);const l=await o.json();let c=l.response||l.data||l.text||"";return t.responseFormat==="json"?(c=this.cleanJsonResponse(c),JSON.parse(c)):c}static interpolateTemplate(a,t){return a.replace(/\{\{(\w+)\}\}/g,(r,i)=>t[i]!==void 0?String(t[i]):r)}static cleanJsonResponse(a){return a.replace(/```(?:json)?\s*([\s\S]*?)\s*```/,"$1").trim()}}const js=bi()(bn((s,a)=>({processes:{},formData:{},llmOperations:{},registeredLLMOperations:{},register:t=>s(r=>({processes:{...r.processes,[t.id]:t}})),unregister:(t,r="all")=>s(i=>{switch(r){case"all":{const{[t]:n,...o}=i.processes,{[t]:l,...c}=i.formData,u=Object.keys(i.llmOperations).filter(d=>!d.startsWith(`${t}-`)).reduce((d,m)=>(d[m]=i.llmOperations[m],d),{}),x=Object.keys(i.registeredLLMOperations).filter(d=>!d.startsWith(`${t}-`)).reduce((d,m)=>(d[m]=i.registeredLLMOperations[m],d),{});return{processes:o,formData:c,llmOperations:u,registeredLLMOperations:x}}case"data":{const{[t]:n,...o}=i.formData;return{...i,formData:o}}default:return i}}),get:t=>a().processes[t]||null,getSchemaFragment:t=>{const[r,...i]=t.split("."),n=a().processes[r];if(!n)return null;let o=n.schema;for(const l of i)o=o?.[l];return o},setData:(t,r)=>s(i=>({formData:{...i.formData,[t]:{...i.formData[t],...r}}})),getData:t=>a().formData[t]||{},reset:t=>s(r=>({formData:{...r.formData,[t]:{}}})),registerLLMOperation:(t,r)=>s(i=>({registeredLLMOperations:{...i.registeredLLMOperations,[`${t}-${r.id}`]:r}})),unregisterLLMOperation:(t,r)=>s(i=>{const{[`${t}-${r}`]:n,...o}=i.registeredLLMOperations;return{registeredLLMOperations:o}}),executeLLMOperation:async(t,r,i={})=>{const n=`${t}-${r}`,o=a().registeredLLMOperations[n];if(!o)throw new Error(`LLM Operation not found: ${n}`);try{a().setLLMOperationState(t,r,{loading:!0,error:null});const l=a().getData(t),c={...l,...i},u=o.inputMapping?o.inputMapping(c):c,x=await Nn.call(o.config,o.prompt,u);if(o.validation&&!o.validation(x))throw new Error("LLM result failed validation");let d=x;return o.outputMapping&&(d=o.outputMapping(x,l),a().setData(t,d)),a().setLLMOperationState(t,r,{loading:!1,error:null,result:x}),x}catch(l){throw a().setLLMOperationState(t,r,{loading:!1,error:l.message||"Unknown error",result:null}),l}},setLLMOperationState:(t,r,i)=>s(n=>({llmOperations:{...n.llmOperations,[`${t}-${r}`]:i}})),getLLMOperationState:(t,r)=>a().llmOperations[`${t}-${r}`]||{loading:!1,error:null},clearLLMOperation:(t,r)=>s(i=>{const{[`${t}-${r}`]:n,...o}=i.llmOperations;return{llmOperations:o}})}),{name:"form-schema-store",version:2,partialize:s=>({processes:s.processes,formData:s.formData})})),it=p.forwardRef(({className:s,...a},t)=>e.jsx(Dt,{ref:t,className:D("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...a}));it.displayName=Dt.displayName;const kn=p.forwardRef(({className:s,...a},t)=>e.jsx(Lt,{ref:t,className:D("aspect-square h-full w-full object-cover",s),...a}));kn.displayName=Lt.displayName;const nt=p.forwardRef(({className:s,...a},t)=>e.jsx(It,{ref:t,className:D("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...a}));nt.displayName=It.displayName;function Cs({className:s,...a}){return e.jsx("div",{className:D("animate-pulse rounded-md bg-primary/10",s),...a})}const zn=({className:s="",showRole:a=!0,showEmail:t=!0,compact:r=!1})=>{const{data:i,isLoading:n,error:o}=me(),l=m=>{switch(m){case"admin":return e.jsx(As,{className:"h-3 w-3"});case"teacher":return e.jsx(Wi,{className:"h-3 w-3"});case"student":return e.jsx(Rs,{className:"h-3 w-3"});default:return e.jsx(Ce,{className:"h-3 w-3"})}},c=m=>{switch(m){case"admin":return"Administrator";case"teacher":return"Nauczyciel";case"student":return"Uczeń";default:return"Użytkownik"}},u=m=>{switch(m){case"admin":return"text-purple-600 bg-purple-50";case"teacher":return"text-blue-600 bg-blue-50";case"student":return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}};if(n)return e.jsxs("div",{className:`flex items-center space-x-3 p-3 ${s}`,children:[e.jsx(Cs,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(Cs,{className:"h-4 w-28"}),e.jsx(Cs,{className:"h-3 w-20"}),a&&e.jsx(Cs,{className:"h-3 w-16"})]})]});if(o||!i)return e.jsxs("div",{className:`flex items-center space-x-3 p-3 text-muted-foreground ${s}`,children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(Ce,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium text-gray-500",children:"Nie zalogowano"}),e.jsx("div",{className:"text-xs opacity-70",children:"Brak danych użytkownika"})]})]});const d=(m=>{if(!m)return"U";const h=m.trim().split(" ");return h.length>=2?`${h[0][0]}${h[h.length-1][0]}`.toUpperCase():m.slice(0,2).toUpperCase()})(i.full_name||i.email);return r?e.jsxs("div",{className:`flex items-center space-x-2 p-2 ${s}`,children:[e.jsx(it,{className:"h-8 w-8",children:e.jsx(nt,{className:"bg-gradient-to-br from-purple-500 to-pink-500 text-white text-xs",children:d})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"font-medium text-sm truncate",children:i.full_name})})]}):e.jsxs("div",{className:`flex items-center space-x-3 px-4 pt-4 rounded-lg bg-white/50 backdrop-blur-sm border border-purple-100/20 ${s}`,children:[e.jsx(it,{className:"h-12 w-12 ring-2 ring-purple-100 ring-offset-2",children:e.jsx(nt,{className:"bg-gradient-to-br from-purple-500 to-pink-500 text-white font-medium",children:d})}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-1",children:[e.jsx("div",{className:"font-semibold text-gray-900 truncate",title:i.full_name,children:i.full_name}),t&&i.email&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500",children:[e.jsx(Ie,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate",title:i.email,children:i.email})]}),a&&i.role&&e.jsx("div",{className:"inline-flex items-center gap-1.5",children:e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full text-xs font-medium ${u(i.role)}`,children:[l(i.role),c(i.role)]})})]})]})},_n=Ts("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),H=p.forwardRef(({className:s,variant:a,...t},r)=>e.jsx("div",{ref:r,role:"alert",className:D(_n({variant:a}),s),...t}));H.displayName="Alert";const Cn=p.forwardRef(({className:s,...a},t)=>e.jsx("h5",{ref:t,className:D("mb-1 font-medium leading-none tracking-tight",s),...a}));Cn.displayName="AlertTitle";const J=p.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:D("text-sm [&_p]:leading-relaxed",s),...a}));J.displayName="AlertDescription";const Sn=Ts("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function O({className:s,variant:a,asChild:t=!1,...r}){const i=t?lt:"span";return e.jsx(i,{"data-slot":"badge",className:D(Sn({variant:a}),s),...r})}const Pn=p.forwardRef(({...s},a)=>e.jsx("nav",{ref:a,"aria-label":"breadcrumb",...s}));Pn.displayName="Breadcrumb";const Rn=p.forwardRef(({className:s,...a},t)=>e.jsx("ol",{ref:t,className:D("flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",s),...a}));Rn.displayName="BreadcrumbList";const Mn=p.forwardRef(({className:s,...a},t)=>e.jsx("li",{ref:t,className:D("inline-flex items-center gap-1.5",s),...a}));Mn.displayName="BreadcrumbItem";const Dn=p.forwardRef(({asChild:s,className:a,...t},r)=>{const i=s?lt:"a";return e.jsx(i,{ref:r,className:D("transition-colors hover:text-foreground",a),...t})});Dn.displayName="BreadcrumbLink";const Ln=p.forwardRef(({className:s,...a},t)=>e.jsx("span",{ref:t,role:"link","aria-disabled":"true","aria-current":"page",className:D("font-normal text-foreground",s),...a}));Ln.displayName="BreadcrumbPage";const In=Ts("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),f=p.forwardRef(({className:s,variant:a,size:t,asChild:r=!1,...i},n)=>{const o=r?lt:"button";return e.jsx(o,{className:D(In({variant:a,size:t,className:s})),ref:n,...i})});f.displayName="Button";const v=p.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:D("rounded-xl border bg-card text-card-foreground shadow flex flex-col overflow-hidden",s),...a}));v.displayName="Card";const _=p.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:D("flex flex-col space-y-1.5 p-6 pb-3 bg-pink-200/25",s),...a}));_.displayName="CardHeader";const z=p.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:D("text-lg font-semibold leading-tight tracking-tight pt-3",s),...a}));z.displayName="CardTitle";const Ae=p.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:D("text-sm text-muted-foreground",s),...a}));Ae.displayName="CardDescription";const b=p.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:D("p-3 lg:p-6 pt-3 space-y-3 flex-1 bg-background",s),...a}));b.displayName="CardContent";const En=p.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:D("flex items-center justify-between p-6 pt-0",s),...a}));En.displayName="CardFooter";const $n=Ts("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ye=p.forwardRef(({className:s,...a},t)=>e.jsx(Et,{ref:t,className:D($n(),s),...a}));ye.displayName=Et.displayName;p.createContext({});p.createContext({});const I=p.forwardRef(({className:s,type:a,...t},r)=>e.jsx("input",{type:a,className:D("flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:r,...t}));I.displayName="Input";const An=p.forwardRef(({className:s,align:a="center",sideOffset:t=4,...r},i)=>e.jsx(Ar,{children:e.jsx($t,{ref:i,align:a,sideOffset:t,className:D("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",s),...r})}));An.displayName=$t.displayName;const ya=p.forwardRef(({className:s,children:a,...t},r)=>e.jsxs(At,{ref:r,className:D("relative overflow-hidden",s),...t,children:[e.jsx(Tr,{className:"h-full w-full rounded-[inherit]",children:a}),e.jsx(va,{}),e.jsx(Or,{})]}));ya.displayName=At.displayName;const va=p.forwardRef(({className:s,orientation:a="vertical",...t},r)=>e.jsx(Tt,{ref:r,orientation:a,className:D("flex touch-none select-none transition-colors",a==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",a==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...t,children:e.jsx(qr,{className:"relative flex-1 rounded-full bg-border"})}));va.displayName=Tt.displayName;const Me=Kr,De=Zr,ve=p.forwardRef(({className:s,children:a,...t},r)=>e.jsxs(Ot,{ref:r,className:D("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-background px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...t,children:[a,e.jsx(Ur,{asChild:!0,children:e.jsx(dt,{className:"h-4 w-4 opacity-50"})})]}));ve.displayName=Ot.displayName;const ba=p.forwardRef(({className:s,...a},t)=>e.jsx(qt,{ref:t,className:D("flex cursor-default items-center justify-center py-1",s),...a,children:e.jsx(Gi,{className:"h-4 w-4"})}));ba.displayName=qt.displayName;const Na=p.forwardRef(({className:s,...a},t)=>e.jsx(Ut,{ref:t,className:D("flex cursor-default items-center justify-center py-1",s),...a,children:e.jsx(dt,{className:"h-4 w-4"})}));Na.displayName=Ut.displayName;const be=p.forwardRef(({className:s,children:a,position:t="popper",...r},i)=>e.jsx(Fr,{children:e.jsxs(Ft,{ref:i,className:D("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:t,...r,children:[e.jsx(ba,{}),e.jsx(Br,{className:D("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),e.jsx(Na,{})]})}));be.displayName=Ft.displayName;const Tn=p.forwardRef(({className:s,...a},t)=>e.jsx(Bt,{ref:t,className:D("px-2 py-1.5 text-sm font-semibold",s),...a}));Tn.displayName=Bt.displayName;const V=p.forwardRef(({className:s,children:a,...t},r)=>e.jsxs(Wt,{ref:r,className:D("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...t,children:[e.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Wr,{children:e.jsx(Ee,{className:"h-4 w-4"})})}),e.jsx(Gr,{children:a})]}));V.displayName=Wt.displayName;const On=p.forwardRef(({className:s,...a},t)=>e.jsx(Gt,{ref:t,className:D("-mx-1 my-1 h-px bg-muted",s),...a}));On.displayName=Gt.displayName;const ka=p.forwardRef(({className:s,orientation:a="horizontal",decorative:t=!0,...r},i)=>e.jsx(Kt,{ref:i,decorative:t,orientation:a,className:D("shrink-0 bg-border",a==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",s),...r}));ka.displayName=Kt.displayName;const Le=p.forwardRef(({className:s,...a},t)=>e.jsx("textarea",{className:D("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...a}));Le.displayName="Textarea";const qn=Vr,za=p.forwardRef(({className:s,...a},t)=>e.jsx(Zt,{ref:t,className:D("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",s),...a}));za.displayName=Zt.displayName;const Ps=p.forwardRef(({className:s,...a},t)=>e.jsx(Vt,{ref:t,className:D("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",s),...a}));Ps.displayName=Vt.displayName;const _a=p.forwardRef(({className:s,...a},t)=>e.jsx(Qt,{ref:t,className:D("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...a}));_a.displayName=Qt.displayName;const gs=p.forwardRef(({className:s,...a},t)=>e.jsx(Ht,{ref:t,className:D("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...a,children:e.jsx(Qr,{className:D("flex items-center justify-center text-current"),children:e.jsx(Ee,{className:"h-4 w-4"})})}));gs.displayName=Ht.displayName;var Ws="Switch",[Un,Uc]=ct(Ws),[Fn,Bn]=Un(Ws),Ca=p.forwardRef((s,a)=>{const{__scopeSwitch:t,name:r,checked:i,defaultChecked:n,required:o,disabled:l,value:c="on",onCheckedChange:u,form:x,...d}=s,[m,h]=p.useState(null),g=Ze(a,M=>h(M)),j=p.useRef(!1),k=m?x||!!m.closest("form"):!0,[y,w]=Jt({prop:i,defaultProp:n??!1,onChange:u,caller:Ws});return e.jsxs(Fn,{scope:t,checked:y,disabled:l,children:[e.jsx(Te.button,{type:"button",role:"switch","aria-checked":y,"aria-required":o,"data-state":Ma(y),"data-disabled":l?"":void 0,disabled:l,value:c,...d,ref:g,onClick:G(s.onClick,M=>{w(P=>!P),k&&(j.current=M.isPropagationStopped(),j.current||M.stopPropagation())})}),k&&e.jsx(Ra,{control:m,bubbles:!j.current,name:r,value:c,checked:y,required:o,disabled:l,form:x,style:{transform:"translateX(-100%)"}})]})});Ca.displayName=Ws;var Sa="SwitchThumb",Pa=p.forwardRef((s,a)=>{const{__scopeSwitch:t,...r}=s,i=Bn(Sa,t);return e.jsx(Te.span,{"data-state":Ma(i.checked),"data-disabled":i.disabled?"":void 0,...r,ref:a})});Pa.displayName=Sa;var Wn="SwitchBubbleInput",Ra=p.forwardRef(({__scopeSwitch:s,control:a,checked:t,bubbles:r=!0,...i},n)=>{const o=p.useRef(null),l=Ze(o,n),c=Hr(t),u=Jr(a);return p.useEffect(()=>{const x=o.current;if(!x)return;const d=window.HTMLInputElement.prototype,h=Object.getOwnPropertyDescriptor(d,"checked").set;if(c!==t&&h){const g=new Event("click",{bubbles:r});h.call(x,t),x.dispatchEvent(g)}},[c,t,r]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:t,...i,tabIndex:-1,ref:l,style:{...i.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Ra.displayName=Wn;function Ma(s){return s?"checked":"unchecked"}var Da=Ca,Gn=Pa;const fe=p.forwardRef(({className:s,...a},t)=>e.jsx(Da,{className:D("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...a,ref:t,children:e.jsx(Gn,{className:D("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));fe.displayName=Da.displayName;const Kn=p.forwardRef(({className:s,sideOffset:a=4,...t},r)=>e.jsx(Yr,{children:e.jsx(Yt,{ref:r,sideOffset:a,className:D("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",s),...t})}));Kn.displayName=Yt.displayName;const Zn=({onClose:s})=>{const{mutate:a}=oa(),{menuItems:t}=zi(),{data:r}=me(),i=()=>{s&&s()},n=r?.role,o=t.filter(l=>l.meta?.roles?l.meta.roles.includes(n):!0);return e.jsxs("div",{className:"flex h-full w-64 flex-col border-r bg-background",children:[e.jsxs("div",{className:"flex h-16 items-center justify-between border-b px-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(mt,{className:"h-6 w-6 mr-2"}),e.jsx("span",{className:"font-semibold",children:"Smart Up"})]}),s&&e.jsx(f,{variant:"ghost",size:"sm",onClick:s,className:"lg:hidden",children:e.jsx(Se,{className:"h-4 w-4"})})]}),e.jsx(ya,{className:"flex-1 px-3 py-4",children:e.jsx("nav",{className:"space-y-2",children:o.map(l=>e.jsxs(fi,{to:l.route??"/",onClick:i,className:({isActive:c})=>D("flex items-center rounded-md px-3 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground",c?"bg-accent text-accent-foreground":"text-muted-foreground"),children:[l.icon&&e.jsx("span",{className:"mr-3 flex items-center",children:(A.isValidElement(l.icon),l.icon)}),l.label]},l.key))})}),e.jsx(ka,{}),e.jsx(zn,{className:"border-b"}),e.jsx("div",{className:"p-4",children:e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>{a(),s&&s()},className:"w-full justify-start",children:[e.jsx(la,{className:"mr-2 h-4 w-4"}),"Logout"]})})]})},Vn=({onClose:s})=>{const a=na(),t=W(),{data:r}=me(),{mutate:i}=oa(),n=[{id:"dashboard",path:"/student/dashboard",label:"Dashboard",icon:Ki},{id:"courses",path:"/student/courses",label:"Kursy",icon:de},{id:"gamification",path:"/student/gamification",label:"Gamifikacja",icon:st},{id:"leaderboard",path:"/student/leaderboard",label:"Ranking",icon:ce},{id:"achievements",path:"/student/achievements",label:"Osiągnięcia",icon:ls},{id:"profile",path:"/student/profile",label:"Profil",icon:Ce}],o=c=>a.pathname.startsWith(c),l=c=>{t(c),s?.()};return e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-pink-600 to-purple-700 rounded-xl flex items-center justify-center",children:e.jsx(ce,{className:"w-5 h-5 text-white"})}),e.jsx("span",{className:"text-xl font-bold",children:"Smart Up"})]}),s&&e.jsx(f,{variant:"ghost",size:"icon",onClick:s,className:"lg:hidden",children:e.jsx(Se,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center text-white font-bold",children:r?.full_name?.charAt(0)||"U"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:r?.full_name}),e.jsx("p",{className:"text-xs text-gray-500",children:"Uczeń"})]})]})}),e.jsx("nav",{className:"flex-1 p-4 space-y-1",children:n.map(c=>e.jsxs("button",{onClick:()=>l(c.path),className:D("w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all",o(c.path)?"bg-purple-50 text-purple-700 font-medium":"text-gray-600 hover:bg-gray-50"),children:[e.jsx(c.icon,{className:"w-5 h-5"}),e.jsx("span",{children:c.label})]},c.id))}),e.jsxs("div",{className:"p-4 border-t space-y-1",children:[e.jsxs("button",{onClick:()=>l("/student/settings"),className:"w-full flex items-center gap-3 px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg transition-all",children:[e.jsx(Zi,{className:"w-5 h-5"}),e.jsx("span",{children:"Ustawienia"})]}),e.jsxs("button",{onClick:()=>i(),className:"w-full flex items-center gap-3 px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg transition-all",children:[e.jsx(la,{className:"w-5 h-5"}),e.jsx("span",{children:"Wyloguj"})]})]})]})},Gs=()=>{const[s,a]=p.useState({points:0,level:1,streak:0,idle_rate:1,next_level_points:200,quizzes_completed:0,perfect_scores:0,total_time:0,rank:0}),[t,r]=p.useState(!0),i=p.useCallback(async()=>{try{r(!0);const{data:n,error:o}=await B.rpc("get_my_stats");if(o)throw o;n&&a({points:n.points||0,level:n.level||1,streak:n.streak||0,idle_rate:n.idle_rate||1,next_level_points:n.next_level_points||200,quizzes_completed:n.quizzes_completed||0,perfect_scores:n.perfect_scores||0,total_time:n.total_time||0,rank:n.rank||0})}catch(n){console.error("Error fetching stats:",n)}finally{r(!1)}},[]);return p.useEffect(()=>{i()},[i]),{stats:s,setStats:a,isLoading:t,refetch:i}},fs=(s,a,t)=>{const[r,i]=p.useState(null),[n,o]=p.useState(!0),[l,c]=p.useState(null),u=p.useCallback(async()=>{if(t?.enabled!==!1)try{o(!0),c(null);const{data:x,error:d}=await B.rpc(s,a);if(d)throw d;i(x),t?.onSuccess?.(x)}catch(x){c(x),t?.onError?.(x)}finally{o(!1)}},[s,JSON.stringify(a),t?.enabled]);return p.useEffect(()=>{u()},[u]),{data:r,isLoading:n,error:l,refetch:u}},La=(s,a)=>{const[t,r]=p.useState([]),[i,n]=p.useState(!0),[o,l]=p.useState(null),c=p.useCallback(async()=>{if(a?.enabled!==!1)try{n(!0),l(null);let u=B.from(s).select(a?.select||"*");a?.filters?.forEach(m=>{switch(m.operator){case"eq":u=u.eq(m.field,m.value);break;case"in":u=u.in(m.field,m.value);break;case"contains":u=u.ilike(m.field,`%${m.value}%`);break}}),a?.sorts?.forEach(m=>{u=u.order(m.field,{ascending:m.order==="asc"})}),a?.limit&&(u=u.limit(a.limit));const{data:x,error:d}=await u;if(d)throw d;r(x||[])}catch(u){l(u)}finally{n(!1)}},[s,JSON.stringify(a)]);return p.useEffect(()=>{c()},[c]),{data:t,isLoading:i,error:o,refetch:c}},Qn=({onMenuClick:s})=>{const{stats:a}=Gs();return e.jsx("div",{className:"sticky top-0 z-30 border-b border-purple-200/20 bg-background/80 backdrop-blur-md",children:e.jsxs("div",{className:"flex h-16 items-center justify-between px-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(f,{variant:"ghost",size:"sm",onClick:s,className:"lg:hidden hover:bg-purple-100/20 hover:text-purple-700",children:e.jsx(mt,{className:"h-6 w-6"})}),e.jsx("span",{className:"font-semibold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent lg:hidden",children:"Smart Up"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-purple-50 px-3 py-1.5 rounded-full",children:[e.jsx(cs,{className:"w-4 h-4 text-purple-700"}),e.jsx("span",{className:"font-bold text-purple-700 text-sm",children:a.points})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-orange-50 px-3 py-1.5 rounded-full",children:[e.jsx(Os,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"font-bold text-orange-600 text-sm",children:a.streak})]}),e.jsxs(f,{variant:"ghost",size:"icon",className:"relative",children:[e.jsx(Vi,{className:"w-5 h-5"}),e.jsx("span",{className:"absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"})]})]})]})})},R=({children:s})=>e.jsx("div",{className:"p-2 md:p-12 space-y-6 max-w-7xl mx-auto",children:s}),Hn=({children:s})=>{const[a,t]=p.useState(!1),{data:r}=me(),i=r?.role==="student",n=()=>{t(!a)};return e.jsx("div",{className:"min-h-screen bg-stone-200 relative overflow-x-hidden",children:e.jsxs("div",{className:"flex relative",children:[a&&e.jsx("div",{className:"fixed inset-0 z-40 bg-purple-900/20 backdrop-blur-sm lg:hidden",onClick:()=>t(!1)}),e.jsx("aside",{className:`
            h-screen w-64 transform transition-transform duration-300 ease-in-out
            fixed left-0 top-0 z-50
            ${a?"translate-x-0":"-translate-x-full"}
            lg:translate-x-0
            bg-background/95 backdrop-blur-md border-r border-purple-200/20
          `,children:i?e.jsx(Vn,{onClose:()=>t(!1)}):e.jsx(Zn,{onClose:()=>t(!1)})}),e.jsxs("main",{className:"flex-1 lg:ml-64 min-w-0 relative z-10",children:[i?e.jsx(Qn,{onMenuClick:n}):e.jsxs("div",{className:"sticky top-0 z-30 flex h-16 items-center border-b border-purple-200/20 bg-background/80 backdrop-blur-md px-4 lg:hidden",children:[e.jsx(f,{variant:"ghost",size:"sm",onClick:n,className:"mr-2 hover:bg-purple-100/20 hover:text-purple-700",children:e.jsx(mt,{className:"h-6 w-6"})}),e.jsx("span",{className:"font-semibold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Smart Up"})]}),s]})]})})},Jn={"between-center":"flex justify-between items-center gap-2",center:"flex justify-center items-center gap-2",start:"flex justify-start items-center gap-2",end:"flex justify-end items-center gap-2"},S=({children:s,variant:a="between-center",className:t=""})=>{const r=Jn[a],i=t?`${r} ${t}`:r;return e.jsx("div",{className:i,children:s})},Yn={"1-2-3":"grid gap-6 md:grid-cols-2 lg:grid-cols-3","1-2-2":"grid gap-6 md:grid-cols-2","1-1-1":"grid gap-6","2-2-4":"grid gap-6 grid-cols-2 lg:grid-cols-4"},K=({children:s,variant:a="1-2-3",className:t=""})=>{const r=Yn[a],i=t?`${r} ${t}`:r;return e.jsx("div",{className:i,children:s})},Xn={card:{wrap:"space-y-0",title:"font-medium",description:"text-muted-foreground"},lg:{wrap:"space-y-0",title:"text-3xl font-bold tracking-tight",description:"text-muted-foreground"},md:{wrap:"space-y-0",title:"font-medium",description:"text-muted-foreground"},sm:{wrap:"space-y-1",title:"font-medium text-sm text-muted-foreground mb-1",description:"text-sm"}},U=({title:s,description:a,variant:t="lg"})=>{const r=Xn[t],i=()=>{switch(t){case"lg":return e.jsx("h1",{className:r.title,children:s});case"md":return e.jsx("h2",{className:r.title,children:s});case"sm":return e.jsx("h3",{className:r.title,children:s});default:return e.jsx("h1",{className:r.title,children:s})}};return t==="card"?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"text-lg font-semibold leading-tight flex items-center gap-2",children:s}),e.jsx(Ae,{className:"text-sm text-muted-foreground mt-2",children:a})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:r.wrap,children:[i(),e.jsx("p",{className:`prose ${r.description}`,children:a})]})})},eo=()=>{const{data:s,isLoading:a}=me(),[t,r]=p.useState(null),[i,n]=p.useState(!0);return p.useEffect(()=>{if(a||!s?.vendor_id){n(!1);return}let o=!0;return(async()=>{try{const[c,u,x,d,m]=await Promise.all([B.from("users").select("*",{count:"exact",head:!0}).eq("vendor_id",s.vendor_id),B.from("courses").select("*",{count:"exact"}).eq("vendor_id",s.vendor_id),B.from("activities").select("*, topics!inner(course_id, courses!inner(vendor_id))",{count:"exact"}).eq("topics.courses.vendor_id",s.vendor_id),B.from("activity_progress").select("score, completed_at").not("completed_at","is",null),B.from("user_stats").select("total_points")]);if(!o)return;const h=d.data?.length?d.data.reduce((j,k)=>j+(k.score||0),0)/d.data.length:0,g=m.data?.reduce((j,k)=>j+k.total_points,0)||0;r({totalUsers:c.count||0,activeUsers:c.count||0,totalCourses:u.count||0,publishedCourses:u.data?.filter(j=>j.is_published).length||0,totalActivities:x.count||0,completedActivities:d.data?.length||0,averageScore:Math.round(h),totalPoints:g})}catch(c){console.error("Error fetching dashboard stats:",c)}finally{o&&n(!1)}})(),()=>{o=!1}},[s?.vendor_id,a]),i||a?e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):s?e.jsxs(R,{children:[e.jsx(U,{title:"Dashboard",description:"Przegląd statystyk systemu e-learning"}),e.jsxs(K,{variant:"1-2-2",children:[e.jsxs(v,{children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(z,{className:"text-sm font-medium",children:"Użytkownicy"}),e.jsx(ae,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t?.totalUsers||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t?.activeUsers||0," aktywnych"]})]})]}),e.jsxs(v,{children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(z,{className:"text-sm font-medium",children:"Kursy"}),e.jsx(de,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t?.totalCourses||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t?.publishedCourses||0," opublikowanych"]})]})]}),e.jsxs(v,{children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(z,{className:"text-sm font-medium",children:"Aktywności"}),e.jsx(ca,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t?.totalActivities||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t?.completedActivities||0," ukończonych"]})]})]}),e.jsxs(v,{children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(z,{className:"text-sm font-medium",children:"Średni wynik"}),e.jsx(we,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[t?.averageScore||0,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"z wszystkich quizów"})]})]})]}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Aktywność w ostatnich 7 dniach"})}),e.jsx(b,{children:e.jsxs("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:[e.jsx(qs,{className:"h-8 w-8 mr-2"}),"Wykres aktywności (do implementacji)"]})})]}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Top 5 użytkowników"})}),e.jsx(b,{children:e.jsx("div",{className:"space-y-4",children:[1,2,3,4,5].map(o=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{className:`h-5 w-5 ${o<=3?"text-yellow-500":"text-muted-foreground"}`}),e.jsxs("span",{children:["Użytkownik ",o]})]}),e.jsxs("span",{className:"font-semibold",children:[1e3-o*100," pkt"]})]},o))})})]})]}):e.jsx(R,{children:e.jsx("div",{className:"text-center text-muted-foreground",children:"Nie można załadować danych użytkownika"})})},so={name:"dashboard",list:"/dashboard/overview",meta:{label:"Dashboard",icon:e.jsx(Qi,{className:"h-4 w-4"})}},to=[e.jsx(E,{path:"/dashboard/overview",element:e.jsx(eo,{})},"dashboard")],Ks=({current:s,pageSize:a,total:t,setCurrent:r,setPageSize:i,itemName:n="elementów",pageSizeOptions:o=[10,20,50]})=>{const l=Math.ceil(t/a),c=(s-1)*a+1,u=Math.min(s*a,t),x=s>1,d=s<l,m=()=>{const h=[];if(l<=5)for(let j=1;j<=l;j++)h.push(j);else{h.push(1),s>3&&h.push("...");const j=Math.max(2,s-1),k=Math.min(l-1,s+1);for(let y=j;y<=k;y++)h.push(y);s<l-2&&h.push("..."),h.push(l)}return h};return t===0?null:e.jsxs(S,{className:"mt-6",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Pokazuje ",c,"-",u," z ",t," ",n]}),e.jsxs(S,{className:"gap-2",children:[i&&e.jsxs(Me,{value:a.toString(),onValueChange:h=>{i(parseInt(h)),r(1)},children:[e.jsx(ve,{className:"w-[100px]",children:e.jsx(De,{})}),e.jsx(be,{children:o.map(h=>e.jsxs(V,{value:h.toString(),children:[h," / str."]},h))})]}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>r(s-1),disabled:!x,children:e.jsx(Us,{className:"w-4 h-4"})}),e.jsx("div",{className:"hidden sm:flex gap-1",children:m().map((h,g)=>h==="..."?e.jsx("span",{className:"px-3 py-1 text-sm text-muted-foreground",children:"..."},`ellipsis-${g}`):e.jsx(f,{variant:s===h?"default":"outline",size:"sm",onClick:()=>r(h),className:"min-w-[40px]",children:h},h))}),e.jsxs("div",{className:"flex sm:hidden items-center px-3 text-sm",children:[s," / ",l]}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>r(s+1),disabled:!d,children:e.jsx(Be,{className:"w-4 h-4"})})]})]})};var ot=["Enter"," "],ao=["ArrowDown","PageUp","Home"],Ia=["ArrowUp","PageDown","End"],ro=[...ao,...Ia],io={ltr:[...ot,"ArrowRight"],rtl:[...ot,"ArrowLeft"]},no={ltr:["ArrowLeft"],rtl:["ArrowRight"]},ws="Menu",[ms,oo,lo]=Xr(ws),[Ve,Ea]=ct(ws,[lo,Xt,ea]),Zs=Xt(),$a=ea(),[co,Qe]=Ve(ws),[mo,ys]=Ve(ws),Aa=s=>{const{__scopeMenu:a,open:t=!1,children:r,dir:i,onOpenChange:n,modal:o=!0}=s,l=Zs(a),[c,u]=p.useState(null),x=p.useRef(!1),d=ta(n),m=ui(i);return p.useEffect(()=>{const h=()=>{x.current=!0,document.addEventListener("pointerdown",g,{capture:!0,once:!0}),document.addEventListener("pointermove",g,{capture:!0,once:!0})},g=()=>x.current=!1;return document.addEventListener("keydown",h,{capture:!0}),()=>{document.removeEventListener("keydown",h,{capture:!0}),document.removeEventListener("pointerdown",g,{capture:!0}),document.removeEventListener("pointermove",g,{capture:!0})}},[]),e.jsx(xi,{...l,children:e.jsx(co,{scope:a,open:t,onOpenChange:d,content:c,onContentChange:u,children:e.jsx(mo,{scope:a,onClose:p.useCallback(()=>d(!1),[d]),isUsingKeyboardRef:x,dir:m,modal:o,children:r})})})};Aa.displayName=ws;var uo="MenuAnchor",ht=p.forwardRef((s,a)=>{const{__scopeMenu:t,...r}=s,i=Zs(t);return e.jsx(si,{...i,...r,ref:a})});ht.displayName=uo;var pt="MenuPortal",[xo,Ta]=Ve(pt,{forceMount:void 0}),Oa=s=>{const{__scopeMenu:a,forceMount:t,children:r,container:i}=s,n=Qe(pt,a);return e.jsx(xo,{scope:a,forceMount:t,children:e.jsx(Is,{present:t||n.open,children:e.jsx(ei,{asChild:!0,container:i,children:r})})})};Oa.displayName=pt;var ue="MenuContent",[ho,jt]=Ve(ue),qa=p.forwardRef((s,a)=>{const t=Ta(ue,s.__scopeMenu),{forceMount:r=t.forceMount,...i}=s,n=Qe(ue,s.__scopeMenu),o=ys(ue,s.__scopeMenu);return e.jsx(ms.Provider,{scope:s.__scopeMenu,children:e.jsx(Is,{present:r||n.open,children:e.jsx(ms.Slot,{scope:s.__scopeMenu,children:o.modal?e.jsx(po,{...i,ref:a}):e.jsx(jo,{...i,ref:a})})})})}),po=p.forwardRef((s,a)=>{const t=Qe(ue,s.__scopeMenu),r=p.useRef(null),i=Ze(a,r);return p.useEffect(()=>{const n=r.current;if(n)return di(n)},[]),e.jsx(gt,{...s,ref:i,trapFocus:t.open,disableOutsidePointerEvents:t.open,disableOutsideScroll:!0,onFocusOutside:G(s.onFocusOutside,n=>n.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>t.onOpenChange(!1)})}),jo=p.forwardRef((s,a)=>{const t=Qe(ue,s.__scopeMenu);return e.jsx(gt,{...s,ref:a,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>t.onOpenChange(!1)})}),go=ii("MenuContent.ScrollLock"),gt=p.forwardRef((s,a)=>{const{__scopeMenu:t,loop:r=!1,trapFocus:i,onOpenAutoFocus:n,onCloseAutoFocus:o,disableOutsidePointerEvents:l,onEntryFocus:c,onEscapeKeyDown:u,onPointerDownOutside:x,onFocusOutside:d,onInteractOutside:m,onDismiss:h,disableOutsideScroll:g,...j}=s,k=Qe(ue,t),y=ys(ue,t),w=Zs(t),M=$a(t),P=oo(t),[Q,N]=p.useState(null),C=p.useRef(null),q=Ze(a,C,k.onContentChange),F=p.useRef(0),Z=p.useRef(""),je=p.useRef(0),Oe=p.useRef(null),vt=p.useRef("right"),Hs=p.useRef(0),Dr=g?ri:p.Fragment,Lr=g?{as:go,allowPinchZoom:!0}:void 0,Ir=T=>{const Je=Z.current+T,qe=P().filter(le=>!le.disabled),ts=document.activeElement,Js=qe.find(le=>le.ref.current===ts)?.textValue,Ys=qe.map(le=>le.textValue),bt=Po(Ys,Je,Js),as=qe.find(le=>le.textValue===bt)?.ref.current;(function le(Nt){Z.current=Nt,window.clearTimeout(F.current),Nt!==""&&(F.current=window.setTimeout(()=>le(""),1e3))})(Je),as&&setTimeout(()=>as.focus())};p.useEffect(()=>()=>window.clearTimeout(F.current),[]),ai();const He=p.useCallback(T=>vt.current===Oe.current?.side&&Mo(T,Oe.current?.area),[]);return e.jsx(ho,{scope:t,searchRef:Z,onItemEnter:p.useCallback(T=>{He(T)&&T.preventDefault()},[He]),onItemLeave:p.useCallback(T=>{He(T)||(C.current?.focus(),N(null))},[He]),onTriggerLeave:p.useCallback(T=>{He(T)&&T.preventDefault()},[He]),pointerGraceTimerRef:je,onPointerGraceIntentChange:p.useCallback(T=>{Oe.current=T},[]),children:e.jsx(Dr,{...Lr,children:e.jsx(ni,{asChild:!0,trapped:i,onMountAutoFocus:G(n,T=>{T.preventDefault(),C.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:e.jsx(oi,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:u,onPointerDownOutside:x,onFocusOutside:d,onInteractOutside:m,onDismiss:h,children:e.jsx(li,{asChild:!0,...M,dir:y.dir,orientation:"vertical",loop:r,currentTabStopId:Q,onCurrentTabStopIdChange:N,onEntryFocus:G(c,T=>{y.isUsingKeyboardRef.current||T.preventDefault()}),preventScrollOnEntryFocus:!0,children:e.jsx(ci,{role:"menu","aria-orientation":"vertical","data-state":tr(k.open),"data-radix-menu-content":"",dir:y.dir,...w,...j,ref:q,style:{outline:"none",...j.style},onKeyDown:G(j.onKeyDown,T=>{const qe=T.target.closest("[data-radix-menu-content]")===T.currentTarget,ts=T.ctrlKey||T.altKey||T.metaKey,Js=T.key.length===1;qe&&(T.key==="Tab"&&T.preventDefault(),!ts&&Js&&Ir(T.key));const Ys=C.current;if(T.target!==Ys||!ro.includes(T.key))return;T.preventDefault();const as=P().filter(le=>!le.disabled).map(le=>le.ref.current);Ia.includes(T.key)&&as.reverse(),Co(as)}),onBlur:G(s.onBlur,T=>{T.currentTarget.contains(T.target)||(window.clearTimeout(F.current),Z.current="")}),onPointerMove:G(s.onPointerMove,us(T=>{const Je=T.target,qe=Hs.current!==T.clientX;if(T.currentTarget.contains(Je)&&qe){const ts=T.clientX>Hs.current?"right":"left";vt.current=ts,Hs.current=T.clientX}}))})})})})})})});qa.displayName=ue;var fo="MenuGroup",ft=p.forwardRef((s,a)=>{const{__scopeMenu:t,...r}=s;return e.jsx(Te.div,{role:"group",...r,ref:a})});ft.displayName=fo;var wo="MenuLabel",Ua=p.forwardRef((s,a)=>{const{__scopeMenu:t,...r}=s;return e.jsx(Te.div,{...r,ref:a})});Ua.displayName=wo;var Ds="MenuItem",Pt="menu.itemSelect",Vs=p.forwardRef((s,a)=>{const{disabled:t=!1,onSelect:r,...i}=s,n=p.useRef(null),o=ys(Ds,s.__scopeMenu),l=jt(Ds,s.__scopeMenu),c=Ze(a,n),u=p.useRef(!1),x=()=>{const d=n.current;if(!t&&d){const m=new CustomEvent(Pt,{bubbles:!0,cancelable:!0});d.addEventListener(Pt,h=>r?.(h),{once:!0}),mi(d,m),m.defaultPrevented?u.current=!1:o.onClose()}};return e.jsx(Fa,{...i,ref:c,disabled:t,onClick:G(s.onClick,x),onPointerDown:d=>{s.onPointerDown?.(d),u.current=!0},onPointerUp:G(s.onPointerUp,d=>{u.current||d.currentTarget?.click()}),onKeyDown:G(s.onKeyDown,d=>{const m=l.searchRef.current!=="";t||m&&d.key===" "||ot.includes(d.key)&&(d.currentTarget.click(),d.preventDefault())})})});Vs.displayName=Ds;var Fa=p.forwardRef((s,a)=>{const{__scopeMenu:t,disabled:r=!1,textValue:i,...n}=s,o=jt(Ds,t),l=$a(t),c=p.useRef(null),u=Ze(a,c),[x,d]=p.useState(!1),[m,h]=p.useState("");return p.useEffect(()=>{const g=c.current;g&&h((g.textContent??"").trim())},[n.children]),e.jsx(ms.ItemSlot,{scope:t,disabled:r,textValue:i??m,children:e.jsx(ti,{asChild:!0,...l,focusable:!r,children:e.jsx(Te.div,{role:"menuitem","data-highlighted":x?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...n,ref:u,onPointerMove:G(s.onPointerMove,us(g=>{r?o.onItemLeave(g):(o.onItemEnter(g),g.defaultPrevented||g.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:G(s.onPointerLeave,us(g=>o.onItemLeave(g))),onFocus:G(s.onFocus,()=>d(!0)),onBlur:G(s.onBlur,()=>d(!1))})})})}),yo="MenuCheckboxItem",Ba=p.forwardRef((s,a)=>{const{checked:t=!1,onCheckedChange:r,...i}=s;return e.jsx(Va,{scope:s.__scopeMenu,checked:t,children:e.jsx(Vs,{role:"menuitemcheckbox","aria-checked":Ls(t)?"mixed":t,...i,ref:a,"data-state":yt(t),onSelect:G(i.onSelect,()=>r?.(Ls(t)?!0:!t),{checkForDefaultPrevented:!1})})})});Ba.displayName=yo;var Wa="MenuRadioGroup",[vo,bo]=Ve(Wa,{value:void 0,onValueChange:()=>{}}),Ga=p.forwardRef((s,a)=>{const{value:t,onValueChange:r,...i}=s,n=ta(r);return e.jsx(vo,{scope:s.__scopeMenu,value:t,onValueChange:n,children:e.jsx(ft,{...i,ref:a})})});Ga.displayName=Wa;var Ka="MenuRadioItem",Za=p.forwardRef((s,a)=>{const{value:t,...r}=s,i=bo(Ka,s.__scopeMenu),n=t===i.value;return e.jsx(Va,{scope:s.__scopeMenu,checked:n,children:e.jsx(Vs,{role:"menuitemradio","aria-checked":n,...r,ref:a,"data-state":yt(n),onSelect:G(r.onSelect,()=>i.onValueChange?.(t),{checkForDefaultPrevented:!1})})})});Za.displayName=Ka;var wt="MenuItemIndicator",[Va,No]=Ve(wt,{checked:!1}),Qa=p.forwardRef((s,a)=>{const{__scopeMenu:t,forceMount:r,...i}=s,n=No(wt,t);return e.jsx(Is,{present:r||Ls(n.checked)||n.checked===!0,children:e.jsx(Te.span,{...i,ref:a,"data-state":yt(n.checked)})})});Qa.displayName=wt;var ko="MenuSeparator",Ha=p.forwardRef((s,a)=>{const{__scopeMenu:t,...r}=s;return e.jsx(Te.div,{role:"separator","aria-orientation":"horizontal",...r,ref:a})});Ha.displayName=ko;var zo="MenuArrow",Ja=p.forwardRef((s,a)=>{const{__scopeMenu:t,...r}=s,i=Zs(t);return e.jsx(hi,{...i,...r,ref:a})});Ja.displayName=zo;var _o="MenuSub",[Fc,Ya]=Ve(_o),os="MenuSubTrigger",Xa=p.forwardRef((s,a)=>{const t=Qe(os,s.__scopeMenu),r=ys(os,s.__scopeMenu),i=Ya(os,s.__scopeMenu),n=jt(os,s.__scopeMenu),o=p.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:c}=n,u={__scopeMenu:s.__scopeMenu},x=p.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return p.useEffect(()=>x,[x]),p.useEffect(()=>{const d=l.current;return()=>{window.clearTimeout(d),c(null)}},[l,c]),e.jsx(ht,{asChild:!0,...u,children:e.jsx(Fa,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":t.open,"aria-controls":i.contentId,"data-state":tr(t.open),...s,ref:sa(a,i.onTriggerChange),onClick:d=>{s.onClick?.(d),!(s.disabled||d.defaultPrevented)&&(d.currentTarget.focus(),t.open||t.onOpenChange(!0))},onPointerMove:G(s.onPointerMove,us(d=>{n.onItemEnter(d),!d.defaultPrevented&&!s.disabled&&!t.open&&!o.current&&(n.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{t.onOpenChange(!0),x()},100))})),onPointerLeave:G(s.onPointerLeave,us(d=>{x();const m=t.content?.getBoundingClientRect();if(m){const h=t.content?.dataset.side,g=h==="right",j=g?-5:5,k=m[g?"left":"right"],y=m[g?"right":"left"];n.onPointerGraceIntentChange({area:[{x:d.clientX+j,y:d.clientY},{x:k,y:m.top},{x:y,y:m.top},{x:y,y:m.bottom},{x:k,y:m.bottom}],side:h}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>n.onPointerGraceIntentChange(null),300)}else{if(n.onTriggerLeave(d),d.defaultPrevented)return;n.onPointerGraceIntentChange(null)}})),onKeyDown:G(s.onKeyDown,d=>{const m=n.searchRef.current!=="";s.disabled||m&&d.key===" "||io[r.dir].includes(d.key)&&(t.onOpenChange(!0),t.content?.focus(),d.preventDefault())})})})});Xa.displayName=os;var er="MenuSubContent",sr=p.forwardRef((s,a)=>{const t=Ta(ue,s.__scopeMenu),{forceMount:r=t.forceMount,...i}=s,n=Qe(ue,s.__scopeMenu),o=ys(ue,s.__scopeMenu),l=Ya(er,s.__scopeMenu),c=p.useRef(null),u=Ze(a,c);return e.jsx(ms.Provider,{scope:s.__scopeMenu,children:e.jsx(Is,{present:r||n.open,children:e.jsx(ms.Slot,{scope:s.__scopeMenu,children:e.jsx(gt,{id:l.contentId,"aria-labelledby":l.triggerId,...i,ref:u,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:x=>{o.isUsingKeyboardRef.current&&c.current?.focus(),x.preventDefault()},onCloseAutoFocus:x=>x.preventDefault(),onFocusOutside:G(s.onFocusOutside,x=>{x.target!==l.trigger&&n.onOpenChange(!1)}),onEscapeKeyDown:G(s.onEscapeKeyDown,x=>{o.onClose(),x.preventDefault()}),onKeyDown:G(s.onKeyDown,x=>{const d=x.currentTarget.contains(x.target),m=no[o.dir].includes(x.key);d&&m&&(n.onOpenChange(!1),l.trigger?.focus(),x.preventDefault())})})})})})});sr.displayName=er;function tr(s){return s?"open":"closed"}function Ls(s){return s==="indeterminate"}function yt(s){return Ls(s)?"indeterminate":s?"checked":"unchecked"}function Co(s){const a=document.activeElement;for(const t of s)if(t===a||(t.focus(),document.activeElement!==a))return}function So(s,a){return s.map((t,r)=>s[(a+r)%s.length])}function Po(s,a,t){const i=a.length>1&&Array.from(a).every(u=>u===a[0])?a[0]:a,n=t?s.indexOf(t):-1;let o=So(s,Math.max(n,0));i.length===1&&(o=o.filter(u=>u!==t));const c=o.find(u=>u.toLowerCase().startsWith(i.toLowerCase()));return c!==t?c:void 0}function Ro(s,a){const{x:t,y:r}=s;let i=!1;for(let n=0,o=a.length-1;n<a.length;o=n++){const l=a[n],c=a[o],u=l.x,x=l.y,d=c.x,m=c.y;x>r!=m>r&&t<(d-u)*(r-x)/(m-x)+u&&(i=!i)}return i}function Mo(s,a){if(!a)return!1;const t={x:s.clientX,y:s.clientY};return Ro(t,a)}function us(s){return a=>a.pointerType==="mouse"?s(a):void 0}var Do=Aa,Lo=ht,Io=Oa,Eo=qa,$o=ft,Ao=Ua,To=Vs,Oo=Ba,qo=Ga,Uo=Za,Fo=Qa,Bo=Ha,Wo=Ja,Go=Xa,Ko=sr,Qs="DropdownMenu",[Zo,Bc]=ct(Qs,[Ea]),ne=Ea(),[Vo,ar]=Zo(Qs),rr=s=>{const{__scopeDropdownMenu:a,children:t,dir:r,open:i,defaultOpen:n,onOpenChange:o,modal:l=!0}=s,c=ne(a),u=p.useRef(null),[x,d]=Jt({prop:i,defaultProp:n??!1,onChange:o,caller:Qs});return e.jsx(Vo,{scope:a,triggerId:kt(),triggerRef:u,contentId:kt(),open:x,onOpenChange:d,onOpenToggle:p.useCallback(()=>d(m=>!m),[d]),modal:l,children:e.jsx(Do,{...c,open:x,onOpenChange:d,dir:r,modal:l,children:t})})};rr.displayName=Qs;var ir="DropdownMenuTrigger",nr=p.forwardRef((s,a)=>{const{__scopeDropdownMenu:t,disabled:r=!1,...i}=s,n=ar(ir,t),o=ne(t);return e.jsx(Lo,{asChild:!0,...o,children:e.jsx(Te.button,{type:"button",id:n.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":n.open?n.contentId:void 0,"data-state":n.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...i,ref:sa(a,n.triggerRef),onPointerDown:G(s.onPointerDown,l=>{!r&&l.button===0&&l.ctrlKey===!1&&(n.onOpenToggle(),n.open||l.preventDefault())}),onKeyDown:G(s.onKeyDown,l=>{r||(["Enter"," "].includes(l.key)&&n.onOpenToggle(),l.key==="ArrowDown"&&n.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(l.key)&&l.preventDefault())})})})});nr.displayName=ir;var Qo="DropdownMenuPortal",or=s=>{const{__scopeDropdownMenu:a,...t}=s,r=ne(a);return e.jsx(Io,{...r,...t})};or.displayName=Qo;var lr="DropdownMenuContent",cr=p.forwardRef((s,a)=>{const{__scopeDropdownMenu:t,...r}=s,i=ar(lr,t),n=ne(t),o=p.useRef(!1);return e.jsx(Eo,{id:i.contentId,"aria-labelledby":i.triggerId,...n,...r,ref:a,onCloseAutoFocus:G(s.onCloseAutoFocus,l=>{o.current||i.triggerRef.current?.focus(),o.current=!1,l.preventDefault()}),onInteractOutside:G(s.onInteractOutside,l=>{const c=l.detail.originalEvent,u=c.button===0&&c.ctrlKey===!0,x=c.button===2||u;(!i.modal||x)&&(o.current=!0)}),style:{...s.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});cr.displayName=lr;var Ho="DropdownMenuGroup",Jo=p.forwardRef((s,a)=>{const{__scopeDropdownMenu:t,...r}=s,i=ne(t);return e.jsx($o,{...i,...r,ref:a})});Jo.displayName=Ho;var Yo="DropdownMenuLabel",dr=p.forwardRef((s,a)=>{const{__scopeDropdownMenu:t,...r}=s,i=ne(t);return e.jsx(Ao,{...i,...r,ref:a})});dr.displayName=Yo;var Xo="DropdownMenuItem",mr=p.forwardRef((s,a)=>{const{__scopeDropdownMenu:t,...r}=s,i=ne(t);return e.jsx(To,{...i,...r,ref:a})});mr.displayName=Xo;var el="DropdownMenuCheckboxItem",ur=p.forwardRef((s,a)=>{const{__scopeDropdownMenu:t,...r}=s,i=ne(t);return e.jsx(Oo,{...i,...r,ref:a})});ur.displayName=el;var sl="DropdownMenuRadioGroup",tl=p.forwardRef((s,a)=>{const{__scopeDropdownMenu:t,...r}=s,i=ne(t);return e.jsx(qo,{...i,...r,ref:a})});tl.displayName=sl;var al="DropdownMenuRadioItem",xr=p.forwardRef((s,a)=>{const{__scopeDropdownMenu:t,...r}=s,i=ne(t);return e.jsx(Uo,{...i,...r,ref:a})});xr.displayName=al;var rl="DropdownMenuItemIndicator",hr=p.forwardRef((s,a)=>{const{__scopeDropdownMenu:t,...r}=s,i=ne(t);return e.jsx(Fo,{...i,...r,ref:a})});hr.displayName=rl;var il="DropdownMenuSeparator",pr=p.forwardRef((s,a)=>{const{__scopeDropdownMenu:t,...r}=s,i=ne(t);return e.jsx(Bo,{...i,...r,ref:a})});pr.displayName=il;var nl="DropdownMenuArrow",ol=p.forwardRef((s,a)=>{const{__scopeDropdownMenu:t,...r}=s,i=ne(t);return e.jsx(Wo,{...i,...r,ref:a})});ol.displayName=nl;var ll="DropdownMenuSubTrigger",jr=p.forwardRef((s,a)=>{const{__scopeDropdownMenu:t,...r}=s,i=ne(t);return e.jsx(Go,{...i,...r,ref:a})});jr.displayName=ll;var cl="DropdownMenuSubContent",gr=p.forwardRef((s,a)=>{const{__scopeDropdownMenu:t,...r}=s,i=ne(t);return e.jsx(Ko,{...i,...r,ref:a,style:{...s.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});gr.displayName=cl;var dl=rr,ml=nr,ul=or,fr=cr,wr=dr,yr=mr,vr=ur,br=xr,Nr=hr,kr=pr,zr=jr,_r=gr;const vs=dl,bs=ml,xl=p.forwardRef(({className:s,inset:a,children:t,...r},i)=>e.jsxs(zr,{ref:i,className:D("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",a&&"pl-8",s),...r,children:[t,e.jsx(Be,{className:"ml-auto"})]}));xl.displayName=zr.displayName;const hl=p.forwardRef(({className:s,...a},t)=>e.jsx(_r,{ref:t,className:D("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",s),...a}));hl.displayName=_r.displayName;const ss=p.forwardRef(({className:s,sideOffset:a=4,...t},r)=>e.jsx(ul,{children:e.jsx(fr,{ref:r,sideOffset:a,className:D("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",s),...t})}));ss.displayName=fr.displayName;const Y=p.forwardRef(({className:s,inset:a,...t},r)=>e.jsx(yr,{ref:r,className:D("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",a&&"pl-8",s),...t}));Y.displayName=yr.displayName;const pl=p.forwardRef(({className:s,children:a,checked:t,...r},i)=>e.jsxs(vr,{ref:i,className:D("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:t,...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Nr,{children:e.jsx(Ee,{className:"h-4 w-4"})})}),a]}));pl.displayName=vr.displayName;const jl=p.forwardRef(({className:s,children:a,...t},r)=>e.jsxs(br,{ref:r,className:D("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Nr,{children:e.jsx(da,{className:"h-2 w-2 fill-current"})})}),a]}));jl.displayName=br.displayName;const gl=p.forwardRef(({className:s,inset:a,...t},r)=>e.jsx(wr,{ref:r,className:D("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",s),...t}));gl.displayName=wr.displayName;const xs=p.forwardRef(({className:s,...a},t)=>e.jsx(kr,{ref:t,className:D("-mx-1 my-1 h-px bg-muted",s),...a}));xs.displayName=kr.displayName;const fl=()=>{const{create:s,edit:a,show:t}=ee(),{mutate:r}=Xe(),{tableQuery:{data:i,isLoading:n,isError:o},current:l,setCurrent:c,pageSize:u,setFilters:x}=Es({sorters:{initial:[{field:"created_at",order:"desc"}]},meta:{select:"*, topics(count), course_access(count)"}}),d=Bs({isLoading:n,isError:o});if(d)return d;const m=(h,g)=>{confirm(`Czy na pewno chcesz usunąć kurs "${g}"?`)&&r({resource:"courses",id:h})};return e.jsxs(R,{children:[e.jsxs(S,{children:[e.jsx(U,{title:"Kursy",description:"Zarządzaj kursami w systemie"}),e.jsxs(f,{onClick:()=>s("courses"),children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Dodaj kurs"]})]}),e.jsx(S,{children:e.jsx(I,{placeholder:"Szukaj kursów...",className:"max-w-sm",onChange:h=>{x([{field:"title",operator:"contains",value:h.target.value}])}})}),e.jsx(K,{children:i?.data?.map(h=>e.jsxs(v,{className:"relative cursor-pointer transition-shadow hover:shadow-lg",onClick:g=>{g.target.closest('[role="menu"]')||t("courses",h.id)},children:[e.jsx(_,{children:e.jsxs(S,{children:[e.jsxs(z,{className:"flex items-center gap-2",children:[h.icon_emoji&&e.jsx("span",{className:"text-2xl",children:h.icon_emoji}),!h.icon_emoji&&e.jsx(de,{className:"w-5 h-5"}),e.jsx("span",{className:"truncate",children:h.title})]}),e.jsxs(vs,{children:[e.jsx(bs,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"sm",onClick:g=>g.stopPropagation(),children:e.jsx(ps,{className:"h-4 w-4"})})}),e.jsxs(ss,{align:"end",children:[e.jsxs(Y,{onClick:()=>t("courses",h.id),children:[e.jsx(ds,{className:"mr-2 h-4 w-4"}),"Podgląd"]}),e.jsxs(Y,{onClick:()=>a("courses",h.id),children:[e.jsx(ke,{className:"mr-2 h-4 w-4"}),"Edytuj"]}),e.jsxs(Y,{onClick:()=>m(h.id,h.title),className:"text-red-600",children:[e.jsx($e,{className:"mr-2 h-4 w-4"}),"Usuń"]})]})]})]})}),e.jsxs(b,{children:[h.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:h.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-2",children:e.jsx(O,{variant:h.is_published?"default":"secondary",children:h.is_published?"Opublikowany":"Szkic"})}),e.jsxs("div",{className:"flex gap-3 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ge,{className:"w-3 h-3"}),h._count?.topics||0]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"w-3 h-3"}),h._count?.course_access||0]})]})]})]})]},h.id))}),e.jsx(Ks,{current:l,pageSize:u,total:i?.total||0,setCurrent:c,itemName:"kursów"})]})},he=({children:s,onSubmit:a,className:t="",...r})=>{const i="space-y-6",n=t?`${i} ${t}`:i;return e.jsx("form",{onSubmit:a,className:n,...r,children:s})},L=({children:s,label:a,htmlFor:t,error:r,required:i=!1,className:n="",hint:o})=>{const l="space-y-2",c=n?`${l} ${n}`:l,u=()=>a?typeof a=="string"?e.jsxs(ye,{htmlFor:t,children:[a,i&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}):e.jsxs(ye,{htmlFor:t,className:"flex items-center",children:[a,i&&e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}):null,x=p.isValidElement(s)?p.cloneElement(s,{className:`${s.props.className||""} ${r?"border-red-500 ring-1 ring-red-500":""}`.trim()}):s;return e.jsxs("div",{className:c,children:[u(),x,o&&!r&&e.jsx("p",{className:"text-sm text-muted-foreground",children:o}),r&&e.jsx("p",{className:"text-sm text-red-500",children:r})]})},pe=({children:s,className:a=""})=>{const t="flex justify-end items-center gap-4 pt-6 border-t",r=a?`${t} ${a}`:t;return e.jsx("div",{className:r,children:s})},wl=["📚","🎓","💡","🚀","⭐","🏆","🎯","📖","✏️","🧮"],yl=()=>{const{list:s}=ee(),{data:a}=me(),[t,r]=p.useState(!1),{refineCore:{onFinish:i},register:n,handleSubmit:o,setValue:l,watch:c,formState:{errors:u,isSubmitting:x}}=Ne({defaultValues:{title:"",description:"",vendor_id:a?.vendor_id||0,is_published:!1,icon_emoji:"📚"}}),d=c("icon_emoji");return e.jsxs(R,{children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>s("courses"),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsx(S,{children:e.jsx(U,{title:"Dodaj kurs",description:"Utwórz nowy kurs w systemie"})}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Informacje o kursie"})}),e.jsx(b,{children:e.jsxs(he,{onSubmit:o(i),children:[e.jsxs(K,{variant:"1-2-2",children:[e.jsx(L,{label:"Tytuł kursu",htmlFor:"title",error:u.title?.message?.toString(),required:!0,children:e.jsx(I,{id:"title",placeholder:"np. Podstawy programowania",...n("title",{required:"Tytuł kursu jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),e.jsx(L,{label:"Ikona kursu",htmlFor:"icon_emoji",children:e.jsxs("div",{className:"relative",children:[e.jsxs(f,{type:"button",variant:"outline",className:"w-full justify-start",onClick:()=>r(!t),children:[e.jsx("span",{className:"text-2xl mr-2",children:d||"📚"}),"Wybierz ikonę"]}),t&&e.jsx("div",{className:"absolute top-full mt-2 p-2 bg-white border rounded-lg shadow-lg z-10",children:e.jsx("div",{className:"grid grid-cols-5 gap-2",children:wl.map(m=>e.jsx("button",{type:"button",className:"p-2 hover:bg-gray-100 rounded text-2xl",onClick:()=>{l("icon_emoji",m),r(!1)},children:m},m))})})]})})]}),e.jsx(L,{label:"Opis kursu",htmlFor:"description",error:u.description?.message?.toString(),children:e.jsx(Le,{id:"description",placeholder:"Opisz czego uczniowie nauczą się na tym kursie...",rows:4,...n("description")})}),e.jsx(L,{label:"Status publikacji",children:e.jsxs(S,{variant:"start",children:[e.jsx(fe,{checked:c("is_published")||!1,onCheckedChange:m=>l("is_published",m)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Opublikuj kurs od razu (możesz to zmienić później)"})]})}),e.jsxs(pe,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>s("courses"),children:"Anuluj"}),e.jsx(f,{type:"submit",disabled:x,children:x?"Tworzenie...":"Utwórz kurs"})]})]})})]})]})},vl=["📚","🎓","💡","🚀","⭐","🏆","🎯","📖","✏️","🧮"],bl=()=>{const{list:s}=ee(),{id:a}=ie(),[t,r]=p.useState(!1),{data:i,isLoading:n}=X({resource:"courses",id:a,liveMode:"off"}),{refineCore:{onFinish:o},register:l,handleSubmit:c,setValue:u,watch:x,formState:{errors:d,isSubmitting:m}}=Ne({refineCoreProps:{resource:"courses",id:a,liveMode:"off"}}),h=x("icon_emoji");return n?e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsxs(R,{children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>s("courses"),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsx(S,{children:e.jsx(U,{title:"Edytuj kurs",description:`Edycja kursu: ${i?.data?.title}`})}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Informacje o kursie"})}),e.jsx(b,{children:e.jsxs(he,{onSubmit:c(o),children:[e.jsxs(K,{variant:"1-2-2",children:[e.jsx(L,{label:"Tytuł kursu",htmlFor:"title",error:d.title?.message,required:!0,children:e.jsx(I,{id:"title",placeholder:"np. Podstawy programowania",...l("title",{required:"Tytuł kursu jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),e.jsx(L,{label:"Ikona kursu",htmlFor:"icon_emoji",children:e.jsxs("div",{className:"relative",children:[e.jsxs(f,{type:"button",variant:"outline",className:"w-full justify-start",onClick:()=>r(!t),children:[e.jsx("span",{className:"text-2xl mr-2",children:h||"📚"}),"Wybierz ikonę"]}),t&&e.jsx("div",{className:"absolute top-full mt-2 p-2 bg-white border rounded-lg shadow-lg z-10",children:e.jsx("div",{className:"grid grid-cols-5 gap-2",children:vl.map(g=>e.jsx("button",{type:"button",className:"p-2 hover:bg-gray-100 rounded text-2xl",onClick:()=>{u("icon_emoji",g),r(!1)},children:g},g))})})]})})]}),e.jsx(L,{label:"Opis kursu",htmlFor:"description",error:d.description?.message,children:e.jsx(Le,{id:"description",placeholder:"Opisz czego uczniowie nauczą się na tym kursie...",rows:4,...l("description")})}),e.jsx(L,{label:"Status publikacji",children:e.jsxs(S,{variant:"start",children:[e.jsx(fe,{checked:x("is_published")||!1,onCheckedChange:g=>u("is_published",g)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Kurs jest opublikowany i widoczny dla uczniów"})]})}),e.jsxs(pe,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>s("courses"),children:"Anuluj"}),e.jsx(f,{type:"submit",disabled:m,children:m?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},Nl=({topic:s,isExpanded:a,onToggle:t,onDelete:r,onEdit:i,children:n,activitiesCount:o})=>{const l=W(),c=u=>{const x=window.location.pathname+window.location.search;sessionStorage.setItem("returnUrl",x),l(u)};return e.jsxs("div",{className:`border-2 rounded-lg overflow-hidden group ${a?"shadow-lg border-primary":"border-border hover:border-primary/50"}`,children:[e.jsx("div",{className:`p-4 ${a?"bg-primary text-primary-foreground":"bg-background hover:bg-muted"}`,children:e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("button",{onClick:t,className:`p-1 rounded ${a?"text-primary-foreground hover:bg-primary-foreground/20":"hover:bg-muted"}`,"aria-label":a?"Zwiń temat":"Rozwiń temat",children:a?e.jsx(dt,{className:"w-5 h-5"}):e.jsx(Be,{className:"w-5 h-5"})}),e.jsx("div",{className:"cursor-move",children:e.jsx(ma,{className:`w-4 h-4 ${a?"text-primary-foreground/70":"text-muted-foreground"}`})}),e.jsxs("div",{className:"flex-1 cursor-pointer group",onClick:t,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h4",{className:`font-semibold text-base ${a?"text-primary-foreground":"group-hover:text-primary"}`,children:["Temat ",s.position,": ",s.title]}),e.jsx(O,{variant:s.is_published?a?"secondary":"default":"outline",className:a?"bg-primary-foreground/20 text-primary-foreground border-primary-foreground/30":"",children:s.is_published?"Opublikowany":"Szkic"})]}),e.jsx("div",{className:"flex items-center gap-4 mt-1",children:e.jsxs("span",{className:`text-sm flex items-center gap-1 ${a?"text-primary-foreground/80":"text-muted-foreground"}`,children:[e.jsx(ge,{className:"w-3 h-3"}),o," ",o===1?"aktywność":"aktywności"]})})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(f,{size:"sm",variant:a?"secondary":"ghost",onClick:()=>c(`/activities/create?topic_id=${s.id}`),title:"Dodaj aktywność",className:`h-8 w-8 p-0 ${a?"bg-primary-foreground/20 hover:bg-primary-foreground/30 text-primary-foreground":""}`,children:e.jsx(re,{className:"h-4 w-4"})}),e.jsxs(vs,{children:[e.jsx(bs,{asChild:!0,children:e.jsx(f,{variant:a?"secondary":"ghost",size:"sm",className:`h-8 w-8 p-0 ${a?"bg-primary-foreground/20 hover:bg-primary-foreground/30 text-primary-foreground":""}`,children:e.jsx(ps,{className:"h-4 w-4"})})}),e.jsxs(ss,{align:"end",children:[e.jsxs(Y,{onClick:()=>i("topics",s.id),children:[e.jsx(ke,{className:"mr-2 h-4 w-4"}),"Edytuj temat"]}),e.jsx(xs,{}),e.jsxs(Y,{onClick:()=>c(`/activities/create?topic_id=${s.id}`),children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Dodaj aktywność"]}),e.jsx(xs,{}),e.jsxs(Y,{onClick:()=>r(s.id,s.title),className:"text-red-600 focus:text-red-600",children:[e.jsx($e,{className:"mr-2 h-4 w-4"}),"Usuń temat"]})]})]})]})]})}),a&&e.jsx("div",{className:"p-4 bg-muted/20 border-t-2 border-primary",children:e.jsx("div",{className:"space-y-2",children:n})})]})},kl=({activity:s,topicPosition:a,onDelete:t,onEdit:r})=>{const i=W(),n=()=>s.type==="quiz"?e.jsx("div",{className:"p-2 bg-blue-600 rounded-lg",children:e.jsx(Pe,{className:"w-5 h-5 text-white"})}):e.jsx("div",{className:"p-2 bg-green-600 rounded-lg",children:e.jsx(ge,{className:"w-5 h-5 text-white"})}),o=()=>s.type==="quiz"?"Quiz":"Materiał";return e.jsxs("div",{className:"group flex items-center gap-4 p-4 bg-white border-2 rounded-lg hover:border-primary/50 transition-all duration-200",children:[e.jsx("div",{className:"cursor-move opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(ma,{className:"w-4 h-4 text-muted-foreground"})}),n(),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("h5",{className:"font-semibold text-sm text-foreground",children:[a,".",s.position," ",s.title]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{variant:s.type==="quiz"?"default":"secondary",className:"text-xs font-medium",children:o()}),s.type==="quiz"&&s._count?.questions!==void 0&&e.jsxs(O,{variant:"outline",className:"text-xs font-medium border-2",children:[e.jsx(Fe,{className:"w-3 h-3 mr-1"}),s._count.questions," ",s._count.questions===1?"pytanie":"pytań"]}),e.jsx(O,{variant:s.is_published?"default":"outline",className:`text-xs font-medium ${s.is_published?"bg-green-600 hover:bg-green-700":"border-2"}`,children:s.is_published?e.jsxs(e.Fragment,{children:[e.jsx(Fs,{className:"w-3 h-3 mr-1"}),"Opublikowany"]}):"Szkic"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:[s.duration_min&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ze,{className:"w-3 h-3"}),e.jsxs("span",{children:[s.duration_min," min"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"w-3 h-3"}),e.jsx("span",{children:"0 ukończeń"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[s.type==="quiz"&&e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>i(`/questions/manage/${s.id}`),title:"Zarządzaj pytaniami",className:"h-8 w-8 p-0",children:e.jsx(Fe,{className:"h-4 w-4"})}),e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>i(`/activities/show/${s.id}`),title:"Podgląd",className:"h-8 w-8 p-0",children:e.jsx(ds,{className:"h-4 w-4"})}),e.jsxs(vs,{children:[e.jsx(bs,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(ps,{className:"h-4 w-4"})})}),e.jsxs(ss,{align:"end",children:[e.jsxs(Y,{onClick:()=>i(`/activities/show/${s.id}`),children:[e.jsx(ds,{className:"mr-2 h-4 w-4"}),"Podgląd"]}),e.jsxs(Y,{onClick:()=>r("activities",s.id),children:[e.jsx(ke,{className:"mr-2 h-4 w-4"}),"Edytuj"]}),s.type==="quiz"&&e.jsxs(e.Fragment,{children:[e.jsx(xs,{}),e.jsxs(Y,{onClick:()=>i(`/questions/manage/${s.id}`),className:"text-blue-600 focus:text-blue-600",children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"}),"Zarządzaj pytaniami"]}),e.jsxs(Y,{onClick:()=>i(`/questions/create?activity_id=${s.id}`),className:"text-blue-600 focus:text-blue-600",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Dodaj pytanie"]})]}),e.jsx(xs,{}),e.jsxs(Y,{onClick:()=>t(s.id,s.title),className:"text-red-600 focus:text-red-600",children:[e.jsx($e,{className:"mr-2 h-4 w-4"}),"Usuń"]})]})]})]})]})},zl=()=>{const{list:s,edit:a}=ee(),{id:t}=ie(),r=W(),[i,n]=hs(),o=i.get("expanded"),{mutate:l}=Xe(),{mutate:c}=Xe(),{data:u,isLoading:x}=X({resource:"courses",id:t}),{data:d,isLoading:m,refetch:h}=te({resource:"topics",filters:[{field:"course_id",operator:"eq",value:t}],sorters:[{field:"position",order:"asc"}],meta:{select:"*, activities(count)"}}),{data:g,refetch:j}=te({resource:"activities",filters:[{field:"topic_id",operator:"in",value:d?.data?.map(C=>C.id)||[]}],sorters:[{field:"position",order:"asc"}],meta:{select:"*, questions(count)"},queryOptions:{enabled:!!d?.data?.length}}),{data:k}=te({resource:"course_access",filters:[{field:"course_id",operator:"eq",value:t}]});if(x)return e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const y=u?.data,w=C=>{o===C.toString()?(i.delete("expanded"),n(i)):n({expanded:C.toString()})},M=(C,q)=>{confirm(`Czy na pewno chcesz usunąć temat "${q}" wraz ze wszystkimi aktywnościami?`)&&l({resource:"topics",id:C},{onSuccess:()=>{$.success("Temat został usunięty"),h(),j(),o===C.toString()&&(i.delete("expanded"),n(i))}})},P=(C,q)=>{confirm(`Czy na pewno chcesz usunąć aktywność "${q}"?`)&&c({resource:"activities",id:C},{onSuccess:()=>{$.success("Aktywność została usunięta"),j(),h()}})},Q=C=>g?.data?.filter(q=>q.topic_id===C)||[],N=C=>{const q=`${window.location.pathname}${window.location.search}`,F=encodeURIComponent(q);r(`${C}${C.includes("?")?"&":"?"}returnUrl=${F}`)};return e.jsxs(R,{children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>s("courses"),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsxs(S,{children:[e.jsx(U,{title:e.jsxs("div",{className:"flex items-center gap-3",children:[y?.icon_emoji&&e.jsx("span",{className:"text-4xl",children:y.icon_emoji}),y?.title]}),description:y?.description}),e.jsxs(f,{onClick:()=>a("courses",y?.id??0),children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Edytuj kurs"]})]}),e.jsxs(K,{variant:"2-2-4",children:[e.jsxs(v,{children:[e.jsx(_,{className:"pb-2",children:e.jsx(z,{className:"text-sm font-medium",children:"Status"})}),e.jsx(b,{children:e.jsx(O,{variant:y?.is_published?"default":"secondary",children:y?.is_published?"Opublikowany":"Szkic"})})]}),e.jsxs(v,{children:[e.jsx(_,{className:"pb-2",children:e.jsx(z,{className:"text-sm font-medium",children:"Tematy"})}),e.jsx(b,{children:e.jsx("div",{className:"text-2xl font-bold",children:d?.total||0})})]}),e.jsxs(v,{children:[e.jsx(_,{className:"pb-2",children:e.jsx(z,{className:"text-sm font-medium",children:"Aktywności"})}),e.jsx(b,{children:e.jsx("div",{className:"text-2xl font-bold",children:g?.total||0})})]}),e.jsxs(v,{children:[e.jsx(_,{className:"pb-2",children:e.jsx(z,{className:"text-sm font-medium",children:"Uczestników"})}),e.jsx(b,{children:e.jsx("div",{className:"text-2xl font-bold",children:k?.total||0})})]})]}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsxs(S,{children:[e.jsx(z,{children:"Struktura kursu"}),e.jsxs(f,{size:"sm",onClick:()=>N(`/topics/create?course_id=${t}`),children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Dodaj temat"]})]})}),e.jsx(b,{children:m?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})}):d?.data?.length?e.jsx("div",{className:"space-y-4",children:d.data.map(C=>{const q=Q(C.id),F=o===C.id.toString();return e.jsx(Nl,{topic:C,isExpanded:F,onToggle:()=>w(C.id),onDelete:M,onEdit:(Z,je)=>N(`/${Z}/edit/${je}`),activitiesCount:q.length,children:q.length>0?q.map(Z=>e.jsx(kl,{activity:Z,topicPosition:C.position,onDelete:P,onEdit:(je,Oe)=>N(`/${je}/edit/${Oe}`)},Z.id)):e.jsxs("div",{className:"text-center py-6 text-muted-foreground",children:[e.jsx("p",{children:"Brak aktywności w tym temacie"}),e.jsxs(f,{size:"sm",className:"mt-2",onClick:()=>N(`/activities/create?topic_id=${C.id}`),children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Dodaj pierwszą aktywność"]})]})},C.id)})}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ge,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Brak tematów w tym kursie"}),e.jsxs(f,{className:"mt-4",onClick:()=>N(`/topics/create?course_id=${t}`),children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Dodaj pierwszy temat"]})]})})]}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Grupy z dostępem"})}),e.jsx(b,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ae,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Lista grup (do implementacji)"})]})})]})]})},_l={name:"courses",list:"/courses",create:"/courses/create",edit:"/courses/edit/:id",show:"/courses/show/:id",meta:{label:"Kursy",icon:e.jsx(de,{className:"h-4 w-4"})}},Cl=[e.jsx(E,{path:"/courses",element:e.jsx(fl,{})},"courses-list"),e.jsx(E,{path:"/courses/create",element:e.jsx(yl,{})},"courses-create"),e.jsx(E,{path:"/courses/edit/:id",element:e.jsx(bl,{})},"courses-edit"),e.jsx(E,{path:"/courses/show/:id",element:e.jsx(zl,{})},"courses-show")],Sl=()=>{const{show:s}=ee(),a=W(),[t]=hs(),r=t.get("course_id"),{data:i}=X({resource:"courses",id:r,queryOptions:{enabled:!!r}}),{data:n,isLoading:o}=te({resource:"topics",filters:[{field:"course_id",operator:"eq",value:r}],sorters:[{field:"position",order:"desc"}],pagination:{pageSize:1},queryOptions:{enabled:!!r}}),{refineCore:{onFinish:l},register:c,handleSubmit:u,setValue:x,watch:d,formState:{errors:m,isSubmitting:h}}=Ne({defaultValues:{course_id:r?parseInt(r):void 0,is_published:!1,position:1},refineCoreProps:{successNotification:()=>({message:"Temat został utworzony",type:"success"}),redirect:!1,onMutationSuccess:()=>{r?s("courses",r):a("/courses")}}});p.useEffect(()=>{if(!o&&n&&n.data.length>0){const j=n.data[0].position+1;x("position",j)}},[n,o,x]);const g=()=>{r?s("courses",r):a("/courses")};return e.jsxs(R,{children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:g,children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Powrót do kursu"]}),e.jsx(S,{children:e.jsx(U,{title:"Dodaj temat",description:i?.data?`Do kursu: ${i.data.title}`:"Utwórz nowy temat"})}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Informacje o temacie"})}),e.jsx(b,{children:e.jsxs(he,{onSubmit:u(l),children:[e.jsx("input",{type:"hidden",...c("course_id")}),e.jsx(L,{label:"Tytuł tematu",htmlFor:"title",error:m.title?.message,required:!0,children:e.jsx(I,{id:"title",placeholder:"np. Wprowadzenie do zmiennych",...c("title",{required:"Tytuł tematu jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),e.jsx(L,{label:"Pozycja",htmlFor:"position",error:m.position?.message,required:!0,children:e.jsx(I,{id:"position",type:"number",min:"1",disabled:!0,className:"bg-muted",...c("position",{required:"Pozycja jest wymagana",min:{value:1,message:"Pozycja musi być większa od 0"},valueAsNumber:!0})})}),e.jsx(L,{label:"Status publikacji",children:e.jsxs(S,{variant:"start",children:[e.jsx(fe,{checked:d("is_published")||!1,onCheckedChange:j=>x("is_published",j)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Opublikuj temat od razu"})]})}),e.jsxs(pe,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:g,children:"Anuluj"}),e.jsx(f,{type:"submit",disabled:h||!r,children:h?"Tworzenie...":"Utwórz temat"})]})]})})]})]})},Ge=({variant:s="outline",size:a="sm",children:t="Powrót do kursu"})=>{const r=W(),i=na(),n=()=>{const l=new URLSearchParams(i.search).get("returnUrl");r(l?decodeURIComponent(l):-1)};return e.jsxs(f,{variant:s,size:a,onClick:n,children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),t]})},Pl=()=>{const{show:s}=ee(),{id:a}=ie(),t=W(),{data:r,isLoading:i}=X({resource:"topics",id:a,liveMode:"off"}),n=r?.data,o=n?.course_id,{refineCore:{onFinish:l},register:c,handleSubmit:u,setValue:x,watch:d,formState:{errors:m,isSubmitting:h}}=Ne({refineCoreProps:{resource:"topics",id:a,liveMode:"off",successNotification:()=>({message:"Temat został zaktualizowany",type:"success"}),redirect:!1,onMutationSuccess:()=>{const j=sessionStorage.getItem("returnUrl");j?(sessionStorage.removeItem("returnUrl"),t(j)):o&&t(`/courses/show/${o}?expanded=${a}`)}}}),g=()=>{const j=sessionStorage.getItem("returnUrl");j?(sessionStorage.removeItem("returnUrl"),t(j)):o?t(`/courses/show/${o}?expanded=${a}`):s("courses","")};return i?e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsxs(R,{children:[e.jsx(Ge,{}),e.jsx(S,{children:e.jsx(U,{title:"Edytuj temat",description:`Edycja: ${n?.title}`})}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Informacje o temacie"})}),e.jsx(b,{children:e.jsxs(he,{onSubmit:u(l),children:[e.jsx(L,{label:"Tytuł tematu",htmlFor:"title",error:m.title?.message,required:!0,children:e.jsx(I,{id:"title",placeholder:"np. Wprowadzenie do zmiennych",...c("title",{required:"Tytuł tematu jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),e.jsx(L,{label:"Pozycja",htmlFor:"position",error:m.position?.message,required:!0,children:e.jsx(I,{id:"position",type:"number",min:"1",...c("position",{required:"Pozycja jest wymagana",min:{value:1,message:"Pozycja musi być większa od 0"},valueAsNumber:!0})})}),e.jsx(L,{label:"Status publikacji",children:e.jsxs(S,{variant:"start",children:[e.jsx(fe,{checked:d("is_published")||!1,onCheckedChange:j=>x("is_published",j)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Temat jest opublikowany"})]})}),e.jsxs(pe,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:g,children:"Anuluj"}),e.jsx(f,{type:"submit",disabled:h,children:h?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},Rl={name:"topics",create:"/topics/create",edit:"/topics/edit/:id",meta:{label:"Tematy",icon:e.jsx(ge,{className:"h-4 w-4"})}},Ml=[e.jsx(E,{path:"/topics/create",element:e.jsx(Sl,{})},"topics-create"),e.jsx(E,{path:"/topics/edit/:id",element:e.jsx(Pl,{})},"topics-edit")],Dl=()=>{const{show:s}=ee(),a=W(),[t]=hs(),r=t.get("topic_id"),{data:i}=X({resource:"topics",id:r,meta:{select:"*, courses(*)"},queryOptions:{enabled:!!r}}),{data:n,isLoading:o}=te({resource:"activities",filters:[{field:"topic_id",operator:"eq",value:r}],sorters:[{field:"position",order:"desc"}],pagination:{pageSize:1},queryOptions:{enabled:!!r}}),{refineCore:{onFinish:l},register:c,handleSubmit:u,setValue:x,watch:d,formState:{errors:m,isSubmitting:h}}=Ne({defaultValues:{topic_id:r?parseInt(r):void 0,type:"material",is_published:!1,position:1,passing_score:70},refineCoreProps:{successNotification:!1,redirect:!1,onMutationSuccess:k=>{const y=i?.data?.course_id,w=k.data.type;if($.success("Aktywność została utworzona"),w==="quiz")$.info("Dodaj pytania do quizu"),a(`/questions/manage/${k.data.id}`);else{const M=sessionStorage.getItem("returnUrl");M?(sessionStorage.removeItem("returnUrl"),a(M)):a(y?`/courses/show/${y}?expanded=${r}`:"/courses")}}}}),g=d("type");p.useEffect(()=>{if(!o&&n&&n.data.length>0){const k=n.data[0].position+1;x("position",k)}},[n,o,x]);const j=()=>{const k=sessionStorage.getItem("returnUrl");k?(sessionStorage.removeItem("returnUrl"),a(k)):i?.data?.course_id?a(`/courses/show/${i.data.course_id}?expanded=${r}`):a("/courses")};return i?.data?.course_id,r?e.jsxs(R,{children:[e.jsx(Ge,{}),e.jsx(S,{children:e.jsx(U,{title:"Dodaj aktywność",description:i?.data?e.jsxs("div",{children:[e.jsx("div",{className:"text-lg",children:i.data.courses?.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Temat ",i.data.position,": ",i.data.title]})]}):"Utwórz nowy materiał lub quiz"})}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Informacje o aktywności"})}),e.jsx(b,{children:e.jsxs(he,{onSubmit:u(l),children:[e.jsx("input",{type:"hidden",...c("topic_id")}),e.jsxs(K,{variant:"1-2-2",children:[e.jsx(L,{label:"Typ aktywności",error:m.type?.message,required:!0,children:e.jsxs(Me,{value:g,onValueChange:k=>x("type",k),children:[e.jsx(ve,{children:e.jsx(De,{placeholder:"Wybierz typ"})}),e.jsxs(be,{children:[e.jsx(V,{value:"material",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4"}),"Materiał"]})}),e.jsx(V,{value:"quiz",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),"Quiz"]})})]})]})}),e.jsx(L,{label:"Tytuł",htmlFor:"title",error:m.title?.message,required:!0,children:e.jsx(I,{id:"title",placeholder:g==="quiz"?"np. Test wiedzy z rozdziału":"np. Wprowadzenie do tematu",...c("title",{required:"Tytuł jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),e.jsx(L,{label:"Pozycja w temacie",htmlFor:"position",error:m.position?.message,required:!0,children:e.jsx(I,{id:"position",type:"number",min:"1",disabled:!0,className:"bg-muted",...c("position",{required:"Pozycja jest wymagana",min:{value:1,message:"Pozycja musi być większa od 0"},valueAsNumber:!0})})}),e.jsx(L,{label:"Czas trwania (min)",htmlFor:"duration_min",hint:"Szacowany czas potrzebny na ukończenie",children:e.jsx(I,{id:"duration_min",type:"number",min:"1",placeholder:"np. 15",...c("duration_min",{min:{value:1,message:"Czas musi być większy od 0"},valueAsNumber:!0})})})]}),g==="material"&&e.jsx(L,{label:"Treść materiału",htmlFor:"content",error:m.content?.message,required:!0,hint:"Możesz używać formatowania Markdown",children:e.jsx(Le,{id:"content",placeholder:"Wprowadź treść materiału edukacyjnego...",rows:10,...c("content",{required:g==="material"?"Treść jest wymagana dla materiału":!1})})}),g==="quiz"&&e.jsxs(e.Fragment,{children:[e.jsxs(K,{variant:"1-1-1",children:[e.jsx(L,{label:"Próg zaliczenia (%)",htmlFor:"passing_score",error:m.passing_score?.message,hint:"Minimalny wynik do zaliczenia",children:e.jsx(I,{id:"passing_score",type:"number",min:"0",max:"100",...c("passing_score",{min:{value:0,message:"Wartość minimalna to 0"},max:{value:100,message:"Wartość maksymalna to 100"},valueAsNumber:!0})})}),e.jsx(L,{label:"Limit czasu (min)",htmlFor:"time_limit",hint:"Pozostaw puste dla braku limitu",children:e.jsx(I,{id:"time_limit",type:"number",min:"1",placeholder:"Brak limitu",...c("time_limit",{min:{value:1,message:"Limit musi być większy od 0"},valueAsNumber:!0})})}),e.jsx(L,{label:"Maksymalna liczba prób",htmlFor:"max_attempts",hint:"Pozostaw puste dla nieograniczonej liczby",children:e.jsx(I,{id:"max_attempts",type:"number",min:"1",placeholder:"Bez limitu",...c("max_attempts",{min:{value:1,message:"Minimum 1 próba"},valueAsNumber:!0})})})]}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{className:"text-blue-700 dark:text-blue-300",children:"💡 Wskazówka:"})," ",e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Po utworzeniu quizu zostaniesz przekierowany do ekranu dodawania pytań."})]})})]}),e.jsx(L,{label:"Status publikacji",children:e.jsxs(S,{variant:"start",children:[e.jsx(fe,{checked:d("is_published")||!1,onCheckedChange:k=>x("is_published",k)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Opublikuj aktywność od razu (uczniowie będą mogli ją zobaczyć)"})]})}),e.jsxs(pe,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:j,disabled:h,children:"Anuluj"}),e.jsx(f,{type:"submit",disabled:h||!r,children:h?"Tworzenie...":g==="quiz"?"Utwórz i dodaj pytania":"Utwórz aktywność"})]})]})})]})]}):e.jsx(R,{children:e.jsx(v,{children:e.jsxs(b,{className:"text-center py-12",children:[e.jsx("p",{className:"text-lg font-medium text-muted-foreground mb-4",children:"Nie wybrano tematu"}),e.jsx(f,{onClick:()=>a("/courses"),children:"Przejdź do kursów"})]})})})},Ll=()=>{const{list:s}=ee(),{id:a}=ie(),t=W(),{data:r,isLoading:i}=X({resource:"activities",id:a,liveMode:"off",meta:{select:"*, topics(*, courses(*))"}}),{data:n}=X({resource:"questions",id:a,meta:{select:"count",filter:`activity_id.eq.${a}`},queryOptions:{enabled:!!a&&r?.data?.type==="quiz"}}),{refineCore:{onFinish:o,formLoading:l},register:c,handleSubmit:u,setValue:x,watch:d,reset:m,formState:{errors:h,isSubmitting:g}}=Ne({refineCoreProps:{resource:"activities",id:a,liveMode:"off",redirect:!1,successNotification:!1,onMutationSuccess:()=>{const F=r?.data?.topics?.course_id,Z=r?.data?.topic_id;$.success("Aktywność została zaktualizowana");const je=sessionStorage.getItem("returnUrl");je?(sessionStorage.removeItem("returnUrl"),t(je)):F?t(`/courses/show/${F}?expanded=${Z}`):s("activities")},onMutationError:F=>{console.error("Błąd podczas aktualizacji:",F),F?.code==="PGRST204"?$.error("Błąd konfiguracji - skontaktuj się z administratorem"):F?.code==="23505"?$.error("Aktywność o tej pozycji już istnieje w tym temacie"):F?.code==="23503"?$.error("Nieprawidłowe powiązanie z tematem"):F?.message?$.error(`Błąd: ${F.message}`):$.error("Wystąpił nieoczekiwany błąd. Spróbuj ponownie.")}}});p.useEffect(()=>{if(r?.data){const{topics:F,_count:Z,questions:je,...Oe}=r.data;m(Oe)}},[r,m]);const j=d("type")||r?.data?.type||"material";if(i||l)return e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const k=r?.data,y=k?.topics,w=y?.courses,M=w?.id,P=k?.topic_id,Q=()=>{const F=sessionStorage.getItem("returnUrl");F?(sessionStorage.removeItem("returnUrl"),t(F)):M?t(`/courses/show/${M}?expanded=${P}`):s("activities")},N=()=>j==="quiz"?e.jsx(Pe,{className:"w-6 h-6 text-blue-500"}):e.jsx(ge,{className:"w-6 h-6 text-green-500"}),C=()=>{const F=window.location.pathname+window.location.search;sessionStorage.setItem("returnUrl",F),t(`/questions/manage/${k?.id}`)},q=n?.data?.[0]?.count||0;return e.jsxs(R,{children:[e.jsx(Ge,{}),e.jsxs(S,{children:[e.jsx(U,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[N(),"Edytuj aktywność"]}),description:e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-medium",children:k?.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[w?.title," → Temat ",y?.position,": ",y?.title]})]})}),j==="quiz"&&e.jsxs(f,{onClick:C,variant:"outline",children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Zarządzaj pytaniami (",q,")"]})]}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Informacje o aktywności"})}),e.jsx(b,{children:e.jsxs(he,{onSubmit:u(o),children:[e.jsxs(K,{variant:"1-2-2",children:[e.jsxs(L,{label:"Typ aktywności",error:h.type?.message,required:!0,children:[e.jsxs(Me,{value:j,disabled:!0,children:[e.jsx(ve,{className:"bg-muted",children:e.jsx(De,{placeholder:"Wybierz typ"})}),e.jsxs(be,{children:[e.jsx(V,{value:"material",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4"}),"Materiał"]})}),e.jsx(V,{value:"quiz",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),"Quiz"]})})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Typ aktywności nie może być zmieniony"})]}),e.jsx(L,{label:"Tytuł",htmlFor:"title",error:h.title?.message,required:!0,children:e.jsx(I,{id:"title",placeholder:j==="quiz"?"np. Test wiedzy":"np. Wprowadzenie",...c("title",{required:"Tytuł jest wymagany",minLength:{value:3,message:"Tytuł musi mieć minimum 3 znaki"}})})}),e.jsx(L,{label:"Pozycja w temacie",htmlFor:"position",error:h.position?.message,required:!0,children:e.jsx(I,{id:"position",type:"number",min:"1",...c("position",{required:"Pozycja jest wymagana",min:{value:1,message:"Pozycja musi być większa od 0"},valueAsNumber:!0})})}),e.jsx(L,{label:"Czas trwania (min)",htmlFor:"duration_min",hint:"Szacowany czas potrzebny na ukończenie",children:e.jsx(I,{id:"duration_min",type:"number",min:"1",placeholder:"np. 15",...c("duration_min",{min:{value:1,message:"Czas musi być większy od 0"},valueAsNumber:!0})})})]}),j==="material"&&e.jsx(L,{label:"Treść materiału",htmlFor:"content",error:h.content?.message,required:!0,hint:"Możesz używać formatowania Markdown",children:e.jsx(Le,{id:"content",placeholder:"Wprowadź treść materiału...",rows:10,...c("content",{required:j==="material"?"Treść jest wymagana dla materiału":!1})})}),j==="quiz"&&e.jsxs(e.Fragment,{children:[e.jsxs(K,{variant:"1-1-1",children:[e.jsx(L,{label:"Próg zaliczenia (%)",htmlFor:"passing_score",error:h.passing_score?.message,hint:"Minimalny wynik do zaliczenia",children:e.jsx(I,{id:"passing_score",type:"number",min:"0",max:"100",...c("passing_score",{min:{value:0,message:"Wartość minimalna to 0"},max:{value:100,message:"Wartość maksymalna to 100"},valueAsNumber:!0})})}),e.jsx(L,{label:"Limit czasu (min)",htmlFor:"time_limit",hint:"Pozostaw puste dla braku limitu",children:e.jsx(I,{id:"time_limit",type:"number",min:"1",placeholder:"Brak limitu",...c("time_limit",{min:{value:1,message:"Limit musi być większy od 0"},valueAsNumber:!0})})}),e.jsx(L,{label:"Maksymalna liczba prób",htmlFor:"max_attempts",hint:"Pozostaw puste dla nieograniczonej liczby",children:e.jsx(I,{id:"max_attempts",type:"number",min:"1",placeholder:"Bez limitu",...c("max_attempts",{min:{value:1,message:"Minimum 1 próba"},valueAsNumber:!0})})})]}),q>0&&e.jsx(v,{className:"mt-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800",children:e.jsx(b,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:["Ten quiz zawiera ",q," ",q===1?"pytanie":"pytań"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Możesz zarządzać pytaniami klikając przycisk powyżej"})]}),e.jsx(O,{variant:"outline",className:"text-lg px-3 py-1",children:q})]})})})]}),e.jsx(L,{label:"Status publikacji",children:e.jsxs(S,{variant:"start",children:[e.jsx(fe,{checked:d("is_published")||!1,onCheckedChange:F=>x("is_published",F)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Aktywność jest opublikowana (uczniowie mogą ją zobaczyć)"})]})}),e.jsxs(pe,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:Q,disabled:g,children:"Anuluj"}),e.jsx(f,{type:"submit",disabled:g,children:g?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},Il=()=>{const{edit:s}=ee(),{id:a}=ie(),t=W(),{data:r,isLoading:i}=X({resource:"activities",id:a,meta:{select:"*, topics(*, courses(*)), questions:questions(count)"}}),{data:n,isLoading:o}=te({resource:"questions",filters:[{field:"activity_id",operator:"eq",value:parseInt(a)}],sorters:[{field:"position",order:"asc"}],queryOptions:{enabled:r?.data?.type==="quiz"&&!!a}});if(i)return e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const l=r?.data,c=l?.topics,u=c?.courses,x=l?.questions?.[0]?.count||l?._count?.questions||0,d=()=>{const g=window.location.pathname+window.location.search;sessionStorage.setItem("returnUrl",g),s("activities",l?.id??"")},m=g=>{const j=window.location.pathname+window.location.search;sessionStorage.setItem("returnUrl",j),t(g)},h=()=>l?.type==="quiz"?e.jsx(Pe,{className:"w-6 h-6 text-blue-500"}):e.jsx(ge,{className:"w-6 h-6 text-green-500"});return e.jsxs(R,{children:[e.jsx(Ge,{}),e.jsxs(S,{children:[e.jsx(U,{title:e.jsxs("div",{className:"flex items-center gap-3",children:[h(),l?.title]}),description:e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[u?.title," → Temat ",c?.position,": ",c?.title]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(O,{variant:l?.type==="quiz"?"default":"outline",children:l?.type==="quiz"?"Quiz":"Materiał"}),e.jsx(O,{variant:l?.is_published?"default":"secondary",children:l?.is_published?"Opublikowany":"Szkic"})]})]})}),e.jsxs("div",{className:"flex gap-2",children:[l?.type==="quiz"&&e.jsxs(f,{variant:"outline",onClick:()=>m(`/questions/manage/${l.id}`),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Pytania (",x,")"]}),e.jsxs(f,{onClick:d,children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Edytuj"]})]})]}),e.jsxs(K,{variant:"2-2-4",children:[e.jsxs(v,{children:[e.jsx(_,{className:"pb-2",children:e.jsxs(z,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4"}),"Czas trwania"]})}),e.jsx(b,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[l?.duration_min||"-"," min"]})})]}),l?.type==="quiz"&&e.jsxs(e.Fragment,{children:[e.jsxs(v,{children:[e.jsx(_,{className:"pb-2",children:e.jsxs(z,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4"}),"Próg zaliczenia"]})}),e.jsx(b,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[l?.passing_score||70,"%"]})})]}),e.jsxs(v,{children:[e.jsx(_,{className:"pb-2",children:e.jsxs(z,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Hi,{className:"w-4 h-4"}),"Limit czasu"]})}),e.jsx(b,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[l?.time_limit||"Brak",l?.time_limit&&" min"]})})]}),e.jsxs(v,{children:[e.jsx(_,{className:"pb-2",children:e.jsxs(z,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ua,{className:"w-4 h-4"}),"Liczba prób"]})}),e.jsx(b,{children:e.jsx("div",{className:"text-2xl font-bold",children:l?.max_attempts||"Bez limitu"})})]})]})]}),l?.type==="material"&&l?.content&&e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Treść materiału"})}),e.jsx(b,{children:e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",children:e.jsx(Ni,{children:l.content})})})]}),l?.type==="quiz"&&e.jsxs(e.Fragment,{children:[e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Informacje o quizie"})}),e.jsx(b,{children:e.jsx("div",{className:"space-y-4",children:x===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Pe,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground/50"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground mb-4",children:"Ten quiz nie ma jeszcze pytań"}),e.jsxs(f,{onClick:()=>m(`/questions/manage/${l.id}`),children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Dodaj pytania"]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Liczba pytań"}),e.jsx("p",{className:"text-2xl font-bold",children:x})]}),e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Wymagany wynik"}),e.jsxs("p",{className:"text-2xl font-bold",children:[l.passing_score||70,"%"]})]}),e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Limit czasu"}),e.jsx("p",{className:"text-2xl font-bold",children:l.time_limit?`${l.time_limit} min`:"Brak"})]})]}),e.jsxs(f,{className:"w-full",onClick:()=>m(`/questions/manage/${l.id}`),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Zarządzaj pytaniami"]})]})})})]}),x>0&&e.jsxs(v,{children:[e.jsx(_,{children:e.jsxs(z,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Pytania w quizie"}),e.jsxs(O,{variant:"outline",children:[n?.data?.length||0," pytań"]})]})}),e.jsx(b,{children:o?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})}):e.jsx("div",{className:"space-y-3",children:n?.data?.map((g,j)=>e.jsx("div",{className:"p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-sm font-medium",children:j+1}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[g.type==="single_choice"&&e.jsxs(O,{variant:"outline",className:"text-xs",children:[e.jsx(Re,{className:"w-3 h-3 mr-1"}),"Jednokrotny wybór"]}),g.type==="multiple_choice"&&e.jsxs(O,{variant:"outline",className:"text-xs",children:[e.jsx(Fe,{className:"w-3 h-3 mr-1"}),"Wielokrotny wybór"]}),g.type==="true_false"&&e.jsxs(O,{variant:"outline",className:"text-xs",children:[e.jsx(tt,{className:"w-3 h-3 mr-1"}),"Prawda/Fałsz"]}),e.jsxs(O,{variant:"secondary",className:"text-xs",children:[g.points," pkt"]})]}),e.jsx("p",{className:"font-medium",children:g.content}),g.explanation&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[e.jsx("span",{className:"font-medium",children:"Wyjaśnienie:"})," ",g.explanation]})]})]})},g.id))})})]})]}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Szczegóły"})}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Pozycja w temacie:"}),e.jsx("span",{className:"font-medium",children:l?.position})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Status:"}),e.jsx(O,{variant:l?.is_published?"default":"secondary",children:l?.is_published?"Opublikowany":"Szkic"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Utworzono:"}),e.jsx("span",{children:new Date(l?.created_at).toLocaleDateString("pl-PL")})]}),l?.updated_at&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Ostatnia aktualizacja:"}),e.jsx("span",{children:new Date(l.updated_at).toLocaleDateString("pl-PL")})]})]})})]})]})},El={name:"activities",create:"/activities/create",edit:"/activities/edit/:id",show:"/activities/show/:id",meta:{label:"Aktywności",parent:"topics"}},$l=[e.jsx(E,{path:"/activities/create",element:e.jsx(Dl,{})},"activities-create"),e.jsx(E,{path:"/activities/edit/:id",element:e.jsx(Ll,{})},"activities-edit"),e.jsx(E,{path:"/activities/show/:id",element:e.jsx(Il,{})},"activities-show")],Al=()=>{const{activityId:s}=ie();W();const[a,t]=p.useState(null),[r,i]=p.useState(!1),{data:n,isLoading:o}=X({resource:"activities",id:s,meta:{select:"*, topics(*, courses(*))"}}),{data:l,isLoading:c,refetch:u}=te({resource:"questions",filters:[{field:"activity_id",operator:"eq",value:parseInt(s)}],sorters:[{field:"position",order:"asc"}],pagination:{mode:"off"}}),{mutate:x}=$s(),{mutate:d}=_i(),{mutate:m}=Xe();if(o||c)return e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const h=n?.data,g=l?.data||[];return e.jsxs(R,{children:[e.jsx(Ge,{}),e.jsxs(S,{children:[e.jsx(U,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-6 h-6 text-blue-500"}),"Pytania quizu"]}),description:e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-medium",children:h?.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[h?.topics?.courses?.title," → Temat"," ",h?.topics?.position,": ",h?.topics?.title]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(O,{variant:"outline",className:"text-base px-3 py-1",children:[g.length," ",g.length===1?"pytanie":"pytań"]}),e.jsxs(f,{onClick:()=>i(!0),disabled:r,children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Dodaj pytanie"]})]})]}),e.jsx(v,{className:"bg-muted/50",children:e.jsx(b,{className:"pt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Próg zaliczenia:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[h?.passing_score||70,"%"]})]}),h?.time_limit&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Limit czasu:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[h.time_limit," min"]})]}),h?.max_attempts&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Max. prób:"}),e.jsx("span",{className:"ml-2 font-medium",children:h.max_attempts})]})]})})}),r&&e.jsx(Rt,{activityId:parseInt(s),position:g.length+1,onSave:j=>{x({resource:"questions",values:j},{onSuccess:()=>{$.success("Pytanie zostało dodane"),i(!1),u()}})},onCancel:()=>i(!1)}),e.jsx("div",{className:"space-y-4",children:g.map(j=>e.jsx("div",{children:a===j.id?e.jsx(Rt,{question:j,activityId:parseInt(s),position:j.position,onSave:k=>{d({resource:"questions",id:j.id,values:k},{onSuccess:()=>{$.success("Pytanie zostało zaktualizowane"),t(null),u()}})},onCancel:()=>t(null)}):e.jsxs(v,{children:[e.jsx(_,{children:e.jsxs(S,{children:[e.jsxs(z,{className:"text-base",children:[e.jsxs("span",{className:"text-muted-foreground mr-2",children:["#",j.position]}),j.question]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(O,{variant:"outline",children:[j.points," pkt"]}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>t(j.id),children:e.jsx(ke,{className:"w-3 h-3"})}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>{confirm("Czy na pewno chcesz usunąć to pytanie?")&&m({resource:"questions",id:j.id},{onSuccess:()=>{$.success("Pytanie zostało usunięte"),u()}})},children:e.jsx($e,{className:"w-3 h-3 text-red-600"})})]})]})}),e.jsxs(b,{children:[e.jsx("div",{className:"space-y-2",children:j.options.map((k,y)=>e.jsxs("div",{className:`flex items-center gap-2 p-2 rounded ${k.is_correct?"bg-green-50 dark:bg-green-950/30 border border-green-200 dark:border-green-800":""}`,children:[k.is_correct?e.jsx(Ee,{className:"w-4 h-4 text-green-600"}):e.jsx(Se,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:k.is_correct?"font-medium":"",children:k.text})]},k.id||y))}),j.explanation&&e.jsxs("div",{className:"mt-4 p-3 bg-muted rounded",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Wyjaśnienie:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:j.explanation})]})]})]})},j.id))}),g.length===0&&!r&&e.jsx(v,{children:e.jsxs(b,{className:"text-center py-12",children:[e.jsx(Pe,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground/50"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground mb-4",children:"Quiz nie ma jeszcze żadnych pytań"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Dodaj pierwsze pytanie, aby uczniowie mogli rozwiązać quiz"}),e.jsxs(f,{onClick:()=>i(!0),children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Dodaj pierwsze pytanie"]})]})}),g.length>0&&e.jsxs("div",{className:"flex justify-between items-center pt-6 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Łącznie punktów: ",g.reduce((j,k)=>j+k.points,0)]}),e.jsx(Ge,{variant:"outline",children:"Zakończ edycję"})]})]})},Rt=({question:s,activityId:a,position:t,onSave:r,onCancel:i})=>{const[n,o]=p.useState({question:s?.question||"",explanation:s?.explanation||"",points:s?.points||1,position:t,options:s?.options||[{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1}]}),l=()=>{if(!n.question.trim()){$.error("Pytanie jest wymagane");return}const x=n.options.filter(m=>m.text.trim());if(x.length<2){$.error("Dodaj przynajmniej 2 odpowiedzi");return}if(x.filter(m=>m.is_correct).length===0){$.error("Zaznacz przynajmniej jedną poprawną odpowiedź");return}r({activity_id:a,question:n.question,explanation:n.explanation||null,points:n.points,position:n.position,options:x.map((m,h)=>({...m,position:h+1}))})},c=()=>{n.options.length<6&&o({...n,options:[...n.options,{text:"",is_correct:!1}]})},u=x=>{if(n.options.length>2){const d=n.options.filter((m,h)=>h!==x);o({...n,options:d})}};return e.jsxs(v,{className:"border-primary",children:[e.jsx(_,{children:e.jsx(z,{children:s?"Edytuj pytanie":"Nowe pytanie"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Treść pytania"}),e.jsx(Le,{placeholder:"Wprowadź treść pytania...",value:n.question,onChange:x=>o({...n,question:x.target.value}),className:"mt-1",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Liczba punktów"}),e.jsx(I,{type:"number",min:"1",value:n.points,onChange:x=>o({...n,points:parseInt(x.target.value)||1}),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Pozycja"}),e.jsx(I,{type:"number",min:"1",value:n.position,onChange:x=>o({...n,position:parseInt(x.target.value)||1}),className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Odpowiedzi"}),n.options.length<6&&e.jsxs(f,{type:"button",size:"sm",variant:"outline",onClick:c,children:[e.jsx(re,{className:"w-3 h-3 mr-1"}),"Dodaj opcję"]})]}),e.jsx("div",{className:"space-y-2",children:n.options.map((x,d)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(gs,{checked:x.is_correct,onCheckedChange:m=>{const h=[...n.options];h[d].is_correct=m,o({...n,options:h})}}),e.jsx(I,{placeholder:`Odpowiedź ${d+1}`,value:x.text,onChange:m=>{const h=[...n.options];h[d].text=m.target.value,o({...n,options:h})},className:"flex-1"}),n.options.length>2&&e.jsx(f,{type:"button",variant:"ghost",size:"sm",onClick:()=>u(d),children:e.jsx(Se,{className:"w-4 h-4"})})]},d))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Zaznacz checkbox przy poprawnych odpowiedziach. Możesz zaznaczyć więcej niż jedną."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Wyjaśnienie (opcjonalne)"}),e.jsx(Le,{placeholder:"Wyjaśnienie poprawnej odpowiedzi...",value:n.explanation,onChange:x=>o({...n,explanation:x.target.value}),className:"mt-1",rows:3})]}),e.jsxs(S,{children:[e.jsxs(f,{variant:"outline",onClick:i,children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Anuluj"]}),e.jsxs(f,{onClick:l,children:[e.jsx(xa,{className:"w-4 h-4 mr-2"}),"Zapisz pytanie"]})]})]})]})},Tl=()=>{const[s]=hs(),a=W(),t=s.get("activity_id"),{data:r,isLoading:i}=te({resource:"questions",filters:[{field:"activity_id",operator:"eq",value:parseInt(t)}],sorters:[{field:"position",order:"desc"}],pagination:{mode:"off"}}),[n,o]=p.useState({question:"",explanation:"",points:1,position:1,options:[{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1}]});p.useEffect(()=>{if(r?.data){const j=r.data.reduce((k,y)=>Math.max(k,y.position||0),0);o(k=>({...k,position:j+1}))}},[r]);const{data:l,isLoading:c}=X({resource:"activities",id:t,meta:{select:"*, topics(*, courses(*))"}}),{mutate:u,isLoading:x}=$s();if(!t)return e.jsx(R,{children:e.jsx(v,{children:e.jsx(b,{className:"text-center py-12",children:e.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:"Brak ID aktywności"})})})});if(c||i)return e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const d=l?.data;if(!d||d.type!=="quiz")return e.jsx(R,{children:e.jsx(v,{children:e.jsx(b,{className:"text-center py-12",children:e.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:"Nieprawidłowa aktywność lub aktywność nie jest quizem"})})})});const m=()=>{if(!n.question.trim()){$.error("Pytanie jest wymagane");return}const j=n.options.filter(y=>y.text.trim());if(j.length<2){$.error("Dodaj przynajmniej 2 odpowiedzi");return}if(j.filter(y=>y.is_correct).length===0){$.error("Zaznacz przynajmniej jedną poprawną odpowiedź");return}u({resource:"questions",values:{activity_id:parseInt(t),question:n.question,explanation:n.explanation||null,points:n.points,position:n.position,options:j.map((y,w)=>({id:w+1,text:y.text,is_correct:y.is_correct}))}},{onSuccess:()=>{$.success("Pytanie zostało dodane"),a(`/questions/manage/${t}`)},onError:y=>{console.error("Błąd podczas dodawania pytania:",y);const w=y?.code||y?.statusCode,M=y?.message||y?.error?.message;w==="23505"||w===23505?M?.includes("position")?$.error("Pytanie o tej pozycji już istnieje. Zmień pozycję na inną wartość."):$.error("Wystąpił konflikt z istniejącymi danymi. Sprawdź pozycję pytania."):w==="23503"||w===23503?$.error("Nieprawidłowe powiązanie z aktywnością."):w==="22P02"||w===22002?$.error("Nieprawidłowy format danych."):M?$.error(`Błąd: ${M}`):$.error("Wystąpił nieoczekiwany błąd. Spróbuj ponownie.")}})},h=()=>{n.options.length<6&&o({...n,options:[...n.options,{text:"",is_correct:!1}]})},g=j=>{if(n.options.length>2){const k=n.options.filter((y,w)=>w!==j);o({...n,options:k})}};return e.jsxs(R,{children:[e.jsx(Ge,{}),e.jsx(S,{children:e.jsx(U,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-6 h-6 text-blue-500"}),"Dodaj pytanie do quizu"]}),description:e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-medium",children:d?.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[d?.topics?.courses?.title," → Temat"," ",d?.topics?.position,": ",d?.topics?.title]})]})})}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Nowe pytanie"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Treść pytania"}),e.jsx(Le,{placeholder:"Wprowadź treść pytania...",value:n.question,onChange:j=>o({...n,question:j.target.value}),className:"mt-1",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Liczba punktów"}),e.jsx(I,{type:"number",min:"1",value:n.points,onChange:j=>o({...n,points:parseInt(j.target.value)||1}),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Pozycja"}),e.jsx(I,{type:"number",min:"1",value:n.position,onChange:j=>o({...n,position:parseInt(j.target.value)||1}),className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Odpowiedzi"}),n.options.length<6&&e.jsxs(f,{type:"button",size:"sm",variant:"outline",onClick:h,children:[e.jsx(re,{className:"w-3 h-3 mr-1"}),"Dodaj opcję"]})]}),e.jsx("div",{className:"space-y-2",children:n.options.map((j,k)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(gs,{checked:j.is_correct,onCheckedChange:y=>{const w=[...n.options];w[k].is_correct=y,o({...n,options:w})}}),e.jsx(I,{placeholder:`Odpowiedź ${k+1}`,value:j.text,onChange:y=>{const w=[...n.options];w[k].text=y.target.value,o({...n,options:w})},className:"flex-1"}),n.options.length>2&&e.jsx(f,{type:"button",variant:"ghost",size:"sm",onClick:()=>g(k),children:e.jsx(Se,{className:"w-4 h-4"})})]},k))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Zaznacz checkbox przy poprawnych odpowiedziach. Możesz zaznaczyć więcej niż jedną."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Wyjaśnienie (opcjonalne)"}),e.jsx(Le,{placeholder:"Wyjaśnienie poprawnej odpowiedzi...",value:n.explanation,onChange:j=>o({...n,explanation:j.target.value}),className:"mt-1",rows:3})]}),e.jsxs(S,{children:[e.jsxs(f,{variant:"outline",onClick:()=>a(`/questions/manage/${t}`),children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Anuluj"]}),e.jsxs(f,{onClick:m,disabled:x,children:[e.jsx(xa,{className:"w-4 h-4 mr-2"}),x?"Zapisywanie...":"Zapisz pytanie"]})]})]})]})]})},Ol=[e.jsx(E,{path:"/questions/manage/:activityId",element:e.jsx(Al,{})},"questions-manage"),e.jsx(E,{path:"/questions/create",element:e.jsx(Tl,{})},"questions-create")],ql=()=>{const{create:s,edit:a,show:t}=ee(),{mutate:r}=Xe(),{tableQuery:{data:i,isLoading:n,isError:o},current:l,setCurrent:c,pageSize:u,setFilters:x}=Es({sorters:{initial:[{field:"created_at",order:"desc"}]},meta:{select:"*, group_members:group_members(count), course_access:course_access(count)"}}),d=Bs({isLoading:n,isError:o});if(d)return d;const m=(h,g)=>{confirm(`Czy na pewno chcesz usunąć grupę "${g}"?`)&&r({resource:"groups",id:h})};return e.jsxs(R,{children:[e.jsxs(S,{children:[e.jsx(U,{title:"Grupy",description:"Zarządzaj grupami uczniów"}),e.jsxs(f,{onClick:()=>s("groups"),children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Dodaj grupę"]})]}),e.jsx(S,{children:e.jsx(I,{placeholder:"Szukaj grup...",className:"max-w-sm",onChange:h=>{x([{field:"name",operator:"contains",value:h.target.value}])}})}),e.jsx(K,{children:i?.data?.map(h=>e.jsxs(v,{className:"cursor-pointer transition-shadow hover:shadow-lg",onClick:g=>{g.target.closest('[role="menu"]')||t("groups",h.id)},children:[e.jsx(_,{children:e.jsxs(S,{children:[e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),h.name]}),e.jsxs(vs,{children:[e.jsx(bs,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"sm",onClick:g=>g.stopPropagation(),children:e.jsx(ps,{className:"h-4 w-4"})})}),e.jsxs(ss,{align:"end",children:[e.jsxs(Y,{onClick:()=>t("groups",h.id),children:[e.jsx(ds,{className:"mr-2 h-4 w-4"}),"Podgląd"]}),e.jsxs(Y,{onClick:()=>a("groups",h.id),children:[e.jsx(ke,{className:"mr-2 h-4 w-4"}),"Edytuj"]}),e.jsxs(Y,{onClick:()=>m(h.id,h.name),className:"text-red-600",children:[e.jsx($e,{className:"mr-2 h-4 w-4"}),"Usuń"]})]})]})]})}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ut,{className:"w-4 h-4"}),e.jsxs("span",{children:["Rok akademicki: ",h.academic_year]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-background rounded-md",children:e.jsx(ae,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Uczniowie"}),e.jsx("p",{className:"text-lg font-semibold",children:h.group_members?.[0]?.count||h._count?.group_members||0})]})]})}),e.jsx("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-background rounded-md",children:e.jsx(de,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Kursy"}),e.jsx("p",{className:"text-lg font-semibold",children:h.course_access?.[0]?.count||h._count?.course_access||0})]})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(O,{variant:h.is_active?"default":"secondary",children:h.is_active?"Aktywna":"Nieaktywna"})})]})})]},h.id))}),e.jsx(Ks,{current:l,pageSize:u,total:i?.total||0,setCurrent:c,itemName:"grup"})]})},Ul=()=>{const{list:s}=ee(),{data:a}=me(),{refineCore:{onFinish:t},register:r,handleSubmit:i,setValue:n,watch:o,formState:{errors:l,isSubmitting:c}}=Ne({defaultValues:{name:"",vendor_id:a?.vendor_id||0,is_active:!0,academic_year:new Date().getFullYear().toString()+"/"+(new Date().getFullYear()+1).toString()}});return e.jsxs(R,{children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>s("groups"),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsx(S,{children:e.jsx(U,{title:"Dodaj grupę",description:"Utwórz nową grupę uczniów"})}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Informacje o grupie"})}),e.jsx(b,{children:e.jsxs(he,{onSubmit:i(t),children:[e.jsx(L,{label:"Nazwa grupy",htmlFor:"name",error:l.name?.message?.toString(),required:!0,children:e.jsx(I,{id:"name",placeholder:"np. Klasa 1A",...r("name",{required:"Nazwa grupy jest wymagana",minLength:{value:2,message:"Nazwa musi mieć minimum 2 znaki"}})})}),e.jsx(L,{label:"Rok akademicki",htmlFor:"academic_year",error:l.academic_year?.message?.toString(),required:!0,children:e.jsx(I,{id:"academic_year",placeholder:"np. 2024/2025",...r("academic_year",{required:"Rok akademicki jest wymagany",pattern:{value:/^\d{4}\/\d{4}$/,message:"Format: RRRR/RRRR (np. 2024/2025)"}})})}),e.jsx(L,{label:"Status grupy",children:e.jsxs(S,{variant:"start",children:[e.jsx(fe,{checked:o("is_active"),onCheckedChange:u=>n("is_active",u)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Grupa aktywna"})]})}),e.jsxs(pe,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>s("groups"),children:"Anuluj"}),e.jsx(f,{type:"submit",disabled:c,children:c?"Tworzenie...":"Utwórz grupę"})]})]})})]})]})},Fl=()=>{const{list:s}=ee(),{id:a}=ie(),{data:t,isLoading:r}=X({resource:"groups",id:a,liveMode:"off"}),{refineCore:{onFinish:i},register:n,handleSubmit:o,setValue:l,watch:c,reset:u,formState:{errors:x,isSubmitting:d}}=Ne({refineCoreProps:{resource:"groups",id:a,redirect:"list",liveMode:"off"}});return p.useEffect(()=>{t?.data&&u({name:t.data.name,academic_year:t.data.academic_year,is_active:t.data.is_active,vendor_id:t.data.vendor_id})},[t,u]),r?e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsxs(R,{children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>s("groups"),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsx(S,{children:e.jsx(U,{title:"Edytuj grupę",description:`Edycja: ${t?.data?.name}`})}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Informacje o grupie"})}),e.jsx(b,{children:e.jsxs(he,{onSubmit:o(i),children:[e.jsx(L,{label:"Nazwa grupy",htmlFor:"name",error:x.name?.message,required:!0,children:e.jsx(I,{id:"name",placeholder:"np. Klasa 1A",...n("name",{required:"Nazwa grupy jest wymagana",minLength:{value:2,message:"Nazwa musi mieć minimum 2 znaki"}})})}),e.jsx(L,{label:"Rok akademicki",htmlFor:"academic_year",error:x.academic_year?.message,required:!0,children:e.jsx(I,{id:"academic_year",placeholder:"np. 2024/2025",...n("academic_year",{required:"Rok akademicki jest wymagany",pattern:{value:/^\d{4}\/\d{4}$/,message:"Format: RRRR/RRRR (np. 2024/2025)"}})})}),e.jsx(L,{label:"Status grupy",children:e.jsxs(S,{variant:"start",children:[e.jsx(fe,{checked:c("is_active"),onCheckedChange:m=>l("is_active",m)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Grupa aktywna"})]})}),e.jsxs(pe,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>s("groups"),children:"Anuluj"}),e.jsx(f,{type:"submit",disabled:d,children:d?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},Bl=()=>{const{list:s,edit:a}=ee(),{id:t}=ie(),r=W(),i=Ci(),{data:n,isLoading:o}=X({resource:"groups",id:t,liveMode:"off"}),{data:l}=te({resource:"group_members",filters:[{field:"group_id",operator:"eq",value:t}],meta:{select:"*, users(*)"},queryOptions:{enabled:!!t},liveMode:"off"}),{data:c}=te({resource:"course_access",filters:[{field:"group_id",operator:"eq",value:t}],meta:{select:"*, courses(*)"},queryOptions:{enabled:!!t},liveMode:"off"}),u=async(m,h)=>{if(confirm(`Czy na pewno chcesz odpiąć kurs "${h}" od tej grupy?`))try{const{error:g}=await B.from("course_access").delete().eq("course_id",m).eq("group_id",parseInt(t));if(g)throw g;$.success("Kurs został odpięty od grupy"),i({resource:"course_access",invalidates:["list"]})}catch(g){console.error("Error removing course:",g),$.error("Błąd podczas odpinania kursu")}},x=async(m,h)=>{if(confirm(`Czy na pewno chcesz usunąć "${h}" z tej grupy?`))try{const{error:g}=await B.from("group_members").delete().eq("user_id",m).eq("group_id",parseInt(t));if(g)throw g;$.success("Uczeń został usunięty z grupy"),i({resource:"group_members",invalidates:["list"]})}catch(g){console.error("Error removing member:",g),$.error("Błąd podczas usuwania ucznia z grupy")}};if(o)return e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const d=n?.data;return e.jsxs(R,{children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>s("groups"),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsxs(S,{children:[e.jsx(U,{title:d?.name,description:`Rok akademicki: ${d?.academic_year}`}),e.jsxs(f,{onClick:()=>a("groups",d?.id??""),children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Edytuj grupę"]})]}),e.jsxs(K,{variant:"2-2-4",children:[e.jsxs(v,{children:[e.jsx(_,{className:"pb-2",children:e.jsx(z,{className:"text-sm font-medium",children:"Status"})}),e.jsx(b,{children:e.jsx(O,{variant:d?.is_active?"default":"secondary",children:d?.is_active?"Aktywna":"Nieaktywna"})})]}),e.jsxs(v,{children:[e.jsx(_,{className:"pb-2",children:e.jsx(z,{className:"text-sm font-medium",children:"Uczniowie"})}),e.jsx(b,{children:e.jsx("div",{className:"text-2xl font-bold",children:l?.total||0})})]}),e.jsxs(v,{children:[e.jsx(_,{className:"pb-2",children:e.jsx(z,{className:"text-sm font-medium",children:"Kursy"})}),e.jsx(b,{children:e.jsx("div",{className:"text-2xl font-bold",children:c?.total||0})})]}),e.jsxs(v,{children:[e.jsx(_,{className:"pb-2",children:e.jsx(z,{className:"text-sm font-medium",children:"Utworzono"})}),e.jsx(b,{children:e.jsx("div",{className:"text-sm",children:new Date(d?.created_at).toLocaleDateString("pl-PL")})})]})]}),e.jsxs(K,{variant:"1-2-2",children:[e.jsxs(v,{children:[e.jsx(_,{children:e.jsxs(S,{children:[e.jsx(z,{children:"Uczniowie grupy"}),e.jsxs(f,{size:"sm",onClick:()=>r(`/groups/${t}/assign-students`),children:[e.jsx(Ms,{className:"w-4 h-4 mr-2"}),"Dodaj ucznia"]})]})}),e.jsx(b,{children:l?.data?.length?e.jsx("div",{className:"space-y-2",children:l.data.map(m=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted flex items-center justify-center",children:e.jsx(ae,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:m.users?.full_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m.users?.email})]})]}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>x(m.user_id,m.users?.full_name),children:e.jsx($e,{className:"h-4 w-4 text-red-600"})})]},m.user_id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ae,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Brak uczniów w grupie"})]})})]}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsxs(S,{children:[e.jsx(z,{children:"Przypisane kursy"}),e.jsxs(f,{size:"sm",onClick:()=>r(`/groups/${t}/assign-courses`),children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Przypisz kurs"]})]})}),e.jsx(b,{children:c?.data?.length?e.jsx("div",{className:"space-y-2",children:c.data.map(m=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[m.courses?.icon_emoji?e.jsx("span",{className:"text-2xl",children:m.courses.icon_emoji}):e.jsx(de,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:m.courses?.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Przypisano:"," ",new Date(m.assigned_at).toLocaleDateString("pl-PL")]})]})]}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>u(m.course_id,m.courses?.title),children:e.jsx($e,{className:"h-4 w-4 text-red-600"})})]},m.course_id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(de,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Brak przypisanych kursów"})]})})]})]})]})},Wl=()=>{const{id:s}=ie(),a=W(),[t,r]=p.useState([]),[i,n]=p.useState(""),{data:o,isLoading:l}=X({resource:"groups",id:s}),{data:c,isLoading:u}=te({resource:"courses",pagination:{mode:"off"}}),{data:x,isLoading:d}=te({resource:"course_access",filters:[{field:"group_id",operator:"eq",value:parseInt(s)}],pagination:{mode:"off"},meta:{select:"course_id, group_id"}}),{mutate:m,isLoading:h}=$s(),g=async()=>{if(t.length===0){$.error("Wybierz przynajmniej jeden kurs");return}try{const N=t.map(C=>m({resource:"course_access",values:{course_id:C,group_id:parseInt(s)}},{onSuccess:()=>{console.log(`Course ${C} assigned successfully`)},onError:q=>{console.error("Error assigning course:",C,q)}}));await Promise.all(N),$.success(`Przypisano ${t.length} kursów do grupy`),a(`/groups/show/${s}`)}catch(N){$.error("Błąd podczas przypisywania kursów"),console.error("Error details:",N)}};if(l||u||d)return e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const j=o?.data,k=x?.data?.map(N=>N.course_id)||[],y=c?.data?.filter(N=>!k.includes(N.id))||[],w=y.filter(N=>N.title.toLowerCase().includes(i.toLowerCase())),M=N=>{r(C=>C.includes(N)?C.filter(q=>q!==N):[...C,N])},P=()=>{r(w.map(N=>N.id))},Q=()=>{r([])};return e.jsxs(R,{children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>a(`/groups/show/${s}`),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Powrót do grupy"]}),e.jsx(S,{children:e.jsx(U,{title:"Przypisz kursy",description:`Przypisywanie kursów do grupy: ${j?.name}`})}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsxs(S,{children:[e.jsx(z,{children:"Dostępne kursy"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:P,disabled:w.length===0,children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Zaznacz wszystkie"]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:Q,disabled:t.length===0,children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Odznacz wszystkie"]})]})]})}),e.jsxs(b,{children:[e.jsx(I,{placeholder:"Szukaj kursów...",value:i,onChange:N=>n(N.target.value),className:"mb-4"}),w.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:y.length===0?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Wszystkie kursy są już przypisane do tej grupy"})]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Nie znaleziono kursów"})]})}):e.jsx("div",{className:"space-y-2",children:w.map(N=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 border rounded-lg hover:bg-muted/50 cursor-pointer",onClick:()=>M(N.id),children:[e.jsx(gs,{checked:t.includes(N.id),onCheckedChange:()=>M(N.id),onClick:C=>C.stopPropagation()}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[N.icon_emoji&&e.jsx("span",{className:"text-xl",children:N.icon_emoji}),e.jsx("span",{className:"font-medium",children:N.title})]}),N.description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:N.description})]})]},N.id))}),t.length>0&&e.jsxs("div",{className:"mt-6 p-4 bg-muted rounded-lg",children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-3",children:["Wybrano ",t.length," kursów do przypisania"]}),e.jsxs(S,{children:[e.jsx(f,{variant:"outline",onClick:()=>a(`/groups/show/${s}`),children:"Anuluj"}),e.jsx(f,{onClick:g,disabled:h,children:h?"Przypisywanie...":"Przypisz kursy"})]})]})]})]})]})},Gl=()=>{const{id:s}=ie(),a=W(),[t,r]=p.useState([]),[i,n]=p.useState(""),{data:o,isLoading:l}=X({resource:"groups",id:s}),{data:c,isLoading:u}=te({resource:"users",filters:[{field:"role",operator:"eq",value:"student"}],pagination:{mode:"off"}}),{data:x,isLoading:d}=te({resource:"group_members",filters:[{field:"group_id",operator:"eq",value:parseInt(s)}],pagination:{mode:"off"},meta:{select:"user_id, group_id"}}),{mutate:m,isLoading:h}=$s(),g=async()=>{if(t.length===0){$.error("Wybierz przynajmniej jednego ucznia");return}try{const N=t.map(C=>m({resource:"group_members",values:{user_id:C,group_id:parseInt(s)}},{onSuccess:()=>{console.log(`Student ${C} assigned successfully`)},onError:q=>{console.error("Error assigning student:",C,q)}}));await Promise.all(N),$.success(`Dodano ${t.length} uczniów do grupy`),a(`/groups/show/${s}`)}catch(N){$.error("Błąd podczas dodawania uczniów"),console.error("Error details:",N)}};if(l||u||d)return e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const j=o?.data,k=x?.data?.map(N=>N.user_id)||[],y=c?.data?.filter(N=>!k.includes(N.id))||[],w=y.filter(N=>N.full_name.toLowerCase().includes(i.toLowerCase())||N.email.toLowerCase().includes(i.toLowerCase())),M=N=>{r(C=>C.includes(N)?C.filter(q=>q!==N):[...C,N])},P=()=>{r(w.map(N=>N.id))},Q=()=>{r([])};return e.jsxs(R,{children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>a(`/groups/show/${s}`),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Powrót do grupy"]}),e.jsx(S,{children:e.jsx(U,{title:"Dodaj uczniów",description:`Dodawanie uczniów do grupy: ${j?.name}`})}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsxs(S,{children:[e.jsx(z,{children:"Dostępni uczniowie"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:P,disabled:w.length===0,children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Zaznacz wszystkich"]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:Q,disabled:t.length===0,children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Odznacz wszystkich"]})]})]})}),e.jsxs(b,{children:[e.jsx(I,{placeholder:"Szukaj uczniów...",value:i,onChange:N=>n(N.target.value),className:"mb-4"}),w.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:y.length===0?e.jsxs(e.Fragment,{children:[e.jsx(Ms,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Wszyscy uczniowie są już w tej grupie"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ms,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Nie znaleziono uczniów"})]})}):e.jsx("div",{className:"space-y-2",children:w.map(N=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 border rounded-lg hover:bg-muted/50 cursor-pointer",onClick:()=>M(N.id),children:[e.jsx(gs,{checked:t.includes(N.id),onCheckedChange:()=>M(N.id),onClick:C=>C.stopPropagation()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:N.full_name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Ie,{className:"w-3 h-3"}),N.email]})]}),e.jsx(O,{variant:"secondary",className:"text-xs",children:"Uczeń"})]},N.id))}),t.length>0&&e.jsxs("div",{className:"mt-6 p-4 bg-muted rounded-lg",children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-3",children:["Wybrano ",t.length," uczniów do dodania"]}),e.jsxs(S,{children:[e.jsx(f,{variant:"outline",onClick:()=>a(`/groups/show/${s}`),children:"Anuluj"}),e.jsx(f,{onClick:g,disabled:h,children:h?"Dodawanie...":"Dodaj uczniów"})]})]})]})]})]})},Kl={name:"groups",list:"/groups",create:"/groups/create",edit:"/groups/edit/:id",show:"/groups/show/:id",meta:{label:"Grupy",icon:e.jsx(ae,{className:"h-4 w-4"})}},Zl=[e.jsx(E,{path:"/groups",element:e.jsx(ql,{})},"groups-list"),e.jsx(E,{path:"/groups/create",element:e.jsx(Ul,{})},"groups-create"),e.jsx(E,{path:"/groups/edit/:id",element:e.jsx(Fl,{})},"groups-edit"),e.jsx(E,{path:"/groups/show/:id",element:e.jsx(Bl,{})},"groups-show"),e.jsx(E,{path:"/groups/:id/assign-courses",element:e.jsx(Wl,{})},"groups-assign-courses"),e.jsx(E,{path:"/groups/:id/assign-students",element:e.jsx(Gl,{})},"groups-assign-students")],Vl=()=>{const{create:s,edit:a,show:t}=ee(),{mutate:r}=Xe(),[i,n]=p.useState("all"),{tableQuery:{data:o,isLoading:l,isError:c},current:u,setCurrent:x,pageSize:d,setFilters:m}=Es({sorters:{initial:[{field:"created_at",order:"desc"}]},meta:{select:"*, user_stats(total_points, current_level)"}}),h=Bs({isLoading:l,isError:c});if(h)return h;const g=(w,M)=>{confirm(`Czy na pewno chcesz usunąć użytkownika "${M}"?`)&&r({resource:"users",id:w})},j=w=>{const M=[];w&&M.push({operator:"or",value:[{field:"full_name",operator:"contains",value:w},{field:"email",operator:"contains",value:w}]}),i!=="all"&&M.push({field:"role",operator:"eq",value:i}),m(M)},k=w=>{switch(w){case"admin":return e.jsx(As,{className:"w-3 h-3"});case"teacher":return e.jsx(Rs,{className:"w-3 h-3"});default:return e.jsx(Ji,{className:"w-3 h-3"})}},y=w=>{switch(w){case"admin":return"destructive";case"teacher":return"default";default:return"secondary"}};return e.jsxs(R,{children:[e.jsxs(S,{children:[e.jsx(U,{title:"Użytkownicy",description:"Zarządzaj użytkownikami systemu"}),e.jsxs(f,{onClick:()=>s("users"),children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Dodaj użytkownika"]})]}),e.jsxs(S,{className:"gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(ha,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(I,{placeholder:"Szukaj po nazwie lub email...",className:"pl-10",onChange:w=>j(w.target.value)})]}),e.jsxs(Me,{value:i,onValueChange:w=>{n(w),j("")},children:[e.jsx(ve,{className:"w-[180px]",children:e.jsx(De,{placeholder:"Filtruj po roli"})}),e.jsxs(be,{children:[e.jsx(V,{value:"all",children:"Wszystkie role"}),e.jsx(V,{value:"student",children:"Studenci"}),e.jsx(V,{value:"teacher",children:"Nauczyciele"}),e.jsx(V,{value:"admin",children:"Administratorzy"})]})]})]}),e.jsx("div",{className:"space-y-4",children:o?.data?.map(w=>e.jsx(v,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-muted flex items-center justify-center",children:e.jsx(ae,{className:"h-6 w-6 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:w.full_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:w.email})]}),e.jsxs(O,{variant:y(w.role),children:[k(w.role),e.jsx("span",{className:"ml-1 capitalize",children:w.role})]}),e.jsx(O,{variant:w.is_active?"outline":"secondary",children:w.is_active?"Aktywny":"Nieaktywny"})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[w.user_stats&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Punkty"}),e.jsx("p",{className:"font-semibold",children:w.user_stats.total_points})]}),e.jsxs(vs,{children:[e.jsx(bs,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"sm",children:e.jsx(ps,{className:"h-4 w-4"})})}),e.jsxs(ss,{align:"end",children:[e.jsxs(Y,{onClick:()=>t("users",w.id),children:[e.jsx(ds,{className:"mr-2 h-4 w-4"}),"Podgląd"]}),e.jsxs(Y,{onClick:()=>a("users",w.id),children:[e.jsx(ke,{className:"mr-2 h-4 w-4"}),"Edytuj"]}),e.jsxs(Y,{onClick:()=>g(w.id,w.full_name),className:"text-red-600",children:[e.jsx($e,{className:"mr-2 h-4 w-4"}),"Usuń"]})]})]})]})]})})},w.id))}),e.jsx(Ks,{current:u,pageSize:d,total:o?.total||0,setCurrent:x,itemName:"użytkowników"})]})},Ql=()=>{const{list:s}=ee(),{data:a}=me(),{refineCore:{onFinish:t},register:r,handleSubmit:i,setValue:n,watch:o,formState:{errors:l,isSubmitting:c}}=Ne({defaultValues:{full_name:"",email:"",vendor_id:a?.vendor_id||0,role:"student",is_active:!0}});return e.jsxs(R,{children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>s("users"),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsx(S,{children:e.jsx(U,{title:"Dodaj użytkownika",description:"Utwórz nowe konto użytkownika"})}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Dane użytkownika"})}),e.jsx(b,{children:e.jsxs(he,{onSubmit:i(t),children:[e.jsxs(K,{variant:"1-2-2",children:[e.jsx(L,{label:"Imię i nazwisko",htmlFor:"full_name",error:l.full_name?.message?.toString(),required:!0,children:e.jsx(I,{id:"full_name",placeholder:"np. Jan Kowalski",...r("full_name",{required:"Imię i nazwisko są wymagane",minLength:{value:3,message:"Minimum 3 znaki"}})})}),e.jsx(L,{label:"Email",htmlFor:"email",error:l.email?.message?.toString(),required:!0,children:e.jsx(I,{id:"email",type:"email",placeholder:"np. jan.kowalski@example.com",...r("email",{required:"Email jest wymagany",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Nieprawidłowy format email"}})})}),e.jsx(L,{label:"Rola",error:l.role?.message?.toString(),required:!0,children:e.jsxs(Me,{value:o("role"),onValueChange:u=>n("role",u),children:[e.jsx(ve,{children:e.jsx(De,{placeholder:"Wybierz rolę"})}),e.jsxs(be,{children:[e.jsx(V,{value:"student",children:"Student"}),e.jsx(V,{value:"teacher",children:"Nauczyciel"}),e.jsx(V,{value:"admin",children:"Administrator"})]})]})})]}),e.jsx(L,{label:"Status konta",children:e.jsxs(S,{variant:"start",children:[e.jsx(fe,{checked:o("is_active"),onCheckedChange:u=>n("is_active",u)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Konto aktywne (użytkownik może się zalogować)"})]})}),e.jsxs(pe,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>s("users"),children:"Anuluj"}),e.jsx(f,{type:"submit",disabled:c,children:c?"Tworzenie...":"Utwórz użytkownika"})]})]})})]})]})},Hl=()=>{const{list:s}=ee(),{id:a}=ie(),{data:t,isLoading:r}=X({resource:"users",id:a,liveMode:"off"}),{refineCore:{onFinish:i},register:n,handleSubmit:o,setValue:l,watch:c,reset:u,formState:{errors:x,isSubmitting:d}}=Ne({refineCoreProps:{resource:"users",id:a,redirect:"list",liveMode:"off"}});return p.useEffect(()=>{t?.data&&u({full_name:t.data.full_name,email:t.data.email,role:t.data.role,is_active:t.data.is_active,vendor_id:t.data.vendor_id})},[t,u]),r?e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsxs(R,{children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>s("users"),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsx(S,{children:e.jsx(U,{title:"Edytuj użytkownika",description:`Edycja: ${t?.data?.full_name}`})}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Dane użytkownika"})}),e.jsx(b,{children:e.jsxs(he,{onSubmit:o(i),children:[e.jsxs(K,{variant:"1-2-2",children:[e.jsx(L,{label:"Imię i nazwisko",htmlFor:"full_name",error:x.full_name?.message,required:!0,children:e.jsx(I,{id:"full_name",placeholder:"np. Jan Kowalski",...n("full_name",{required:"Imię i nazwisko są wymagane",minLength:{value:3,message:"Minimum 3 znaki"}})})}),e.jsx(L,{label:"Email",htmlFor:"email",error:x.email?.message,required:!0,children:e.jsx(I,{id:"email",type:"email",placeholder:"np. jan.kowalski@example.com",...n("email",{required:"Email jest wymagany",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Nieprawidłowy format email"}}),disabled:!0})}),e.jsx(L,{label:"Rola",error:x.role?.message,required:!0,children:e.jsxs(Me,{value:c("role")||"student",onValueChange:m=>l("role",m),children:[e.jsx(ve,{children:e.jsx(De,{placeholder:"Wybierz rolę"})}),e.jsxs(be,{children:[e.jsx(V,{value:"student",children:"Student"}),e.jsx(V,{value:"teacher",children:"Nauczyciel"}),e.jsx(V,{value:"admin",children:"Administrator"})]})]})})]}),e.jsx(L,{label:"Status konta",children:e.jsxs(S,{variant:"start",children:[e.jsx(fe,{checked:c("is_active")??!0,onCheckedChange:m=>l("is_active",m)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Konto aktywne (użytkownik może się zalogować)"})]})}),e.jsxs(pe,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>s("users"),children:"Anuluj"}),e.jsx(f,{type:"submit",disabled:d,children:d?"Zapisywanie...":"Zapisz zmiany"})]})]})})]})]})},Jl=()=>{const{list:s,edit:a}=ee(),{id:t}=ie(),{data:r,isLoading:i}=X({resource:"users",id:t,meta:{select:"*, user_stats(*)"}}),{data:n}=te({resource:"activity_progress",filters:[{field:"user_id",operator:"eq",value:t}]});if(i)return e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const o=r?.data,l=o?.user_stats?.[0]||{},c=u=>{switch(u){case"admin":return e.jsx(As,{className:"w-4 h-4"});case"teacher":return e.jsx(de,{className:"w-4 h-4"});default:return e.jsx(Ce,{className:"w-4 h-4"})}};return e.jsxs(R,{children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>s("users"),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Powrót do listy"]}),e.jsxs(S,{children:[e.jsx(U,{title:o?.full_name,description:o?.email}),e.jsxs(f,{onClick:()=>a("users",o?.id??""),children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Edytuj użytkownika"]})]}),e.jsxs(K,{children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Informacje podstawowe"})}),e.jsx(b,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Imię i nazwisko"}),e.jsx("p",{className:"text-lg",children:o?.full_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Email"}),e.jsxs("p",{className:"text-lg flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4"}),o?.email]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Rola"}),e.jsxs(O,{variant:"default",className:"mt-1",children:[c(o?.role),e.jsx("span",{className:"ml-1 capitalize",children:o?.role})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsx(O,{variant:o?.is_active?"outline":"secondary",className:"mt-1",children:o?.is_active?"Aktywny":"Nieaktywny"})]})]})})]}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Statystyki gamifikacji"})}),e.jsx(b,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx(ce,{className:"w-8 h-8 mx-auto mb-2 text-yellow-500"}),e.jsx("p",{className:"text-2xl font-bold",children:l.total_points||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Punkty"})]}),e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx(we,{className:"w-8 h-8 mx-auto mb-2 text-blue-500"}),e.jsx("p",{className:"text-2xl font-bold",children:l.current_level||1}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Poziom"})]}),e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx(ca,{className:"w-8 h-8 mx-auto mb-2 text-green-500"}),e.jsx("p",{className:"text-2xl font-bold",children:l.daily_streak||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Dni z rzędu"})]}),e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx(ze,{className:"w-8 h-8 mx-auto mb-2 text-purple-500"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round((l.total_time_spent||0)/60)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Godzin nauki"})]})]})})]}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Postępy w nauce"})}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Ukończone quizy"}),e.jsx("span",{className:"font-bold",children:l.quizzes_completed||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Wyniki perfekcyjne"}),e.jsx("span",{className:"font-bold",children:l.perfect_scores||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Ukończone aktywności"}),e.jsx("span",{className:"font-bold",children:n?.data?.filter(u=>u.completed_at).length||0})]})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{className:"text-lg",children:"Daty"})}),e.jsxs(b,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Utworzono"}),e.jsx("p",{className:"text-sm font-medium",children:new Date(o?.created_at).toLocaleDateString("pl-PL")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ostatnia aktywność"}),e.jsx("p",{className:"text-sm font-medium",children:l.last_active?new Date(l.last_active).toLocaleDateString("pl-PL"):"Brak aktywności"})]})]})]}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{className:"text-lg",children:"Idle Game"})}),e.jsxs(b,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Punkty/h"}),e.jsx("span",{className:"font-bold",children:l.idle_points_rate||1})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ostatnie odebranie"}),e.jsx("p",{className:"text-sm font-medium",children:l.last_idle_claim?new Date(l.last_idle_claim).toLocaleString("pl-PL"):"Nigdy"})]})]})]})]})]})]})},Yl={name:"users",list:"/users",create:"/users/create",edit:"/users/edit/:id",show:"/users/show/:id",meta:{label:"Użytkownicy",icon:e.jsx(ae,{className:"h-4 w-4"})}},Xl=[e.jsx(E,{path:"/users",element:e.jsx(Vl,{})},"users-list"),e.jsx(E,{path:"/users/create",element:e.jsx(Ql,{})},"users-create"),e.jsx(E,{path:"/users/edit/:id",element:e.jsx(Hl,{})},"users-edit"),e.jsx(E,{path:"/users/show/:id",element:e.jsx(Jl,{})},"users-show")],ec=()=>{const{tableQuery:{data:s,isLoading:a,isError:t},current:r,setCurrent:i,pageSize:n,setFilters:o}=Es({sorters:{initial:[{field:"created_at",order:"desc"}]}}),l=Bs({isLoading:a,isError:t});return l||e.jsxs(R,{children:[e.jsx(U,{title:"Organizacje",description:"Lista wszystkich organizacji w systemie"}),e.jsx(S,{children:e.jsx(I,{placeholder:"Szukaj organizacji...",className:"max-w-sm",onChange:c=>{o([{operator:"or",value:[{field:"name",operator:"contains",value:c.target.value},{field:"subdomain",operator:"contains",value:c.target.value}]}])}})}),e.jsx(K,{children:s?.data?.map(c=>e.jsxs(v,{children:[e.jsx(_,{children:e.jsxs(S,{children:[e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(pa,{className:"w-5 h-5"}),c.name]}),e.jsx(O,{variant:c.is_active?"default":"secondary",children:c.is_active?"Aktywna":"Nieaktywna"})]})}),e.jsxs(b,{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Yi,{className:"w-3 h-3"}),e.jsxs("span",{children:[c.subdomain,".example.com"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ut,{className:"w-3 h-3"}),e.jsxs("span",{children:["Utworzono: ",new Date(c.created_at).toLocaleDateString("pl-PL")]})]})]})]},c.id))}),e.jsx(Ks,{current:r,pageSize:n,total:s?.total||0,setCurrent:i,itemName:"organizacji"})]})},sc={name:"vendors",list:"/vendors",meta:{label:"Organizacje",icon:e.jsx(pa,{className:"h-4 w-4"})}},tc=[e.jsx(E,{path:"/vendors",element:e.jsx(ec,{})},"vendors-list")],ac=()=>{const[s,a]=p.useState("users"),[t,r]=p.useState("month"),[i,n]=p.useState(!1),o=async()=>{n(!0);try{alert("Funkcja generowania raportów będzie dostępna wkrótce")}catch(c){console.error("Error generating report:",c)}finally{n(!1)}},l=[{id:"users",name:"Raport użytkowników",description:"Statystyki użytkowników, postępy, aktywność",icon:ae},{id:"courses",name:"Raport kursów",description:"Popularność kursów, wskaźniki ukończenia",icon:de},{id:"gamification",name:"Raport gamifikacji",description:"Punkty, poziomy, rankingi",icon:ls},{id:"activity",name:"Raport aktywności",description:"Logi, czas nauki, częstotliwość",icon:qs}];return e.jsxs(R,{children:[e.jsx(U,{title:"Raporty",description:"Generuj raporty i analizy systemu"}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Generator raportów"})}),e.jsxs(b,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Typ raportu"}),e.jsxs(Me,{value:s,onValueChange:a,children:[e.jsx(ve,{children:e.jsx(De,{})}),e.jsx(be,{children:l.map(c=>e.jsx(V,{value:c.id,children:c.name},c.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Zakres czasowy"}),e.jsxs(Me,{value:t,onValueChange:r,children:[e.jsx(ve,{children:e.jsx(De,{})}),e.jsxs(be,{children:[e.jsx(V,{value:"week",children:"Ostatni tydzień"}),e.jsx(V,{value:"month",children:"Ostatni miesiąc"}),e.jsx(V,{value:"quarter",children:"Ostatni kwartał"}),e.jsx(V,{value:"year",children:"Ostatni rok"}),e.jsx(V,{value:"all",children:"Wszystkie dane"})]})]})]})]}),e.jsx("div",{className:"p-4 border rounded-lg bg-muted/50",children:l.find(c=>c.id===s)&&e.jsxs("div",{className:"flex items-start gap-3",children:[(()=>{const c=l.find(u=>u.id===s).icon;return e.jsx(c,{className:"w-5 h-5 mt-0.5 text-muted-foreground"})})(),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:l.find(c=>c.id===s).name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.find(c=>c.id===s).description})]})]})}),e.jsxs(f,{onClick:o,disabled:i,className:"w-full",children:[e.jsx(Xi,{className:"w-4 h-4 mr-2"}),i?"Generowanie...":"Generuj raport"]})]})]}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Ostatnie raporty"})}),e.jsx(b,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ge,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Brak wygenerowanych raportów"}),e.jsx("p",{className:"text-sm mt-1",children:"Wygenerowane raporty będą wyświetlane tutaj"})]})})]})]})},rc={name:"reports",list:"/reports",meta:{label:"Raporty",icon:e.jsx(ge,{className:"h-4 w-4"})}},ic=[e.jsx(E,{path:"/reports",element:e.jsx(ac,{})},"reports")],Ke=p.forwardRef(({className:s,value:a,...t},r)=>e.jsx(aa,{ref:r,className:D("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",s),...t,children:e.jsx(pi,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})}));Ke.displayName=aa.displayName;const Ss=({icon:s,label:a,value:t,color:r="blue",trend:i,subtitle:n})=>{const o={blue:"from-blue-500 to-blue-600",purple:"from-purple-500 to-purple-600",pink:"from-pink-500 to-pink-600",green:"from-green-500 to-green-600",yellow:"from-yellow-500 to-yellow-600",orange:"from-orange-500 to-orange-600"};return e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-gray-200 to-gray-300 rounded-2xl blur-xl opacity-0 group-hover:opacity-20 transition-opacity"}),e.jsx(v,{className:"relative hover:shadow-lg transition-all duration-300",children:e.jsxs(b,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-xl bg-gradient-to-br ${o[r]} shadow-lg`,children:e.jsx(s,{className:"w-6 h-6 text-white"})}),i&&e.jsxs("div",{className:`flex items-center gap-1 text-sm ${i>0?"text-green-600":"text-red-600"}`,children:[i>0?e.jsx(en,{className:"w-4 h-4"}):e.jsx(sn,{className:"w-4 h-4"}),e.jsxs("span",{children:[Math.abs(i),"%"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:t}),e.jsx("p",{className:"text-sm font-medium text-gray-600 mt-1",children:a}),n&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:n})]})]})})]})},Cr=({course:s,onClick:a})=>e.jsxs(v,{className:"cursor-pointer hover:shadow-lg transition-all duration-300 overflow-hidden group",onClick:a,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-600/5 to-pink-600/5 opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs(b,{className:"p-6 relative",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-4xl",children:s.emoji}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg line-clamp-1",children:s.title}),s.lastActivity&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(ze,{className:"w-3 h-3"}),s.lastActivity]})]})]}),s.progress>0&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-green-600",children:[e.jsx(qs,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.progress,"%"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Postęp"}),e.jsxs("span",{className:"font-medium",children:[s.progress,"%"]})]}),e.jsx(Ke,{value:s.progress,className:"h-2"})]})]})]}),Sr=({activity:s,onStart:a})=>{const t=()=>s.type==="quiz"?ja:de,r=()=>s.type==="quiz"?"Quiz":"Materiał",i=()=>s.type==="quiz"?"bg-purple-500":"bg-blue-500",n=t();return e.jsx(v,{className:`transition-all duration-200 hover:shadow-md ${s.completed?"bg-gray-50/50":""}`,children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${i()} bg-opacity-10`,children:e.jsx(n,{className:`w-6 h-6 ${i().replace("bg-","text-")}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[e.jsx("h3",{className:"font-medium truncate",children:s.title}),s.completed&&e.jsx(Fs,{className:"w-5 h-5 text-green-500 flex-shrink-0"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsx(O,{variant:"secondary",className:"text-xs",children:r()}),s.duration&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ze,{className:"w-3 h-3"}),e.jsxs("span",{children:[s.duration," min"]})]}),s.points&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),e.jsxs("span",{children:[s.points," pkt"]})]}),s.score!==null&&s.score!==void 0&&e.jsxs(O,{variant:s.score>=80?"default":"secondary",className:"text-xs",children:[s.score,"%"]})]}),s.courseTitle&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:s.courseEmoji||"📚"}),e.jsx("span",{children:s.courseTitle})]})]}),e.jsx(f,{size:"sm",variant:s.completed?"ghost":"default",onClick:o=>{o.stopPropagation(),a()},className:"flex-shrink-0",children:s.completed?e.jsxs(e.Fragment,{children:["Powtórz",e.jsx(Be,{className:"w-4 h-4 ml-1"})]}):e.jsxs(e.Fragment,{children:["Rozpocznij",e.jsx(Be,{className:"w-4 h-4 ml-1"})]})})]})})})},nc=()=>{const s=W(),{data:a}=me(),{stats:t,isLoading:r,refetch:i}=Gs(),{data:n,isLoading:o}=fs("get_my_courses"),{data:l}=La("activity_progress",{select:`
      *,
      activities!inner(
        id,
        title,
        type,
        topics!inner(
          id,
          title,
          courses!inner(
            id,
            title,
            icon_emoji
          )
        )
      )
    `,filters:a?.id?[{field:"user_id",operator:"eq",value:a.id}]:[],sorts:[{field:"started_at",order:"desc"}],limit:5,enabled:!!a?.id}),c=async()=>{try{const{data:m,error:h}=await B.rpc("claim_daily_rewards");if(h)throw h;m&&($.success(`Odebrano ${m.total_earned} punktów!`,{description:m.daily_points>0?`Seria ${m.streak} dni!`:"Punkty idle zebrane"}),i())}catch(m){console.error("Error claiming rewards:",m),$.error("Nie można odebrać nagród")}},u=t.level>0?(t.points-(t.level-1)*(t.level-1)*100)/(t.level*t.level*100-(t.level-1)*(t.level-1)*100)*100:0;if(r||o)return e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const x=n||[],d=l||[];return e.jsx(R,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(S,{children:[e.jsx(U,{title:`Witaj, ${a?.full_name||"Uczniu"}! 👋`,description:"Kontynuuj swoją przygodę z nauką"}),e.jsxs(f,{onClick:c,variant:"outline",className:"gap-2",children:[e.jsx(tn,{className:"w-4 h-4"}),"Odbierz nagrody"]})]}),e.jsxs(K,{variant:"2-2-4",children:[e.jsx(Ss,{icon:ce,label:"Poziom",value:t.level,color:"yellow",subtitle:`${t.points}/${t.next_level_points} pkt`}),e.jsx(Ss,{icon:Os,label:"Seria dni",value:t.streak,color:"orange",trend:t.streak>7?15:0}),e.jsx(Ss,{icon:we,label:"Ukończone quizy",value:t.quizzes_completed,color:"green"}),e.jsx(Ss,{icon:ze,label:"Czas nauki",value:`${Math.floor(t.total_time/60)}h`,color:"purple"})]}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsxs(S,{children:[e.jsx(z,{children:"Postęp poziomu"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Poziom ",t.level," → ",t.level+1]})]})}),e.jsxs(b,{className:"space-y-2",children:[e.jsx(Ke,{value:u,className:"h-3"}),e.jsxs(S,{children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t.points," punktów"]}),e.jsxs("span",{className:"text-sm font-medium",children:[t.next_level_points-t.points," punktów do następnego poziomu"]})]})]})]}),x.length>0&&e.jsxs("div",{children:[e.jsxs(S,{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Twoje kursy"}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>s("/student/courses"),children:"Zobacz wszystkie"})]}),e.jsx(K,{children:x.slice(0,3).map(m=>e.jsx(Cr,{course:{id:m.course_id,title:m.title,emoji:m.icon_emoji||"📚",progress:m.progress_percent||0,lastActivity:m.last_activity?new Date(m.last_activity).toLocaleDateString("pl-PL"):null},onClick:()=>s(`/student/courses/${m.course_id}`)},m.course_id))})]}),d.length>0&&e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Ostatnie aktywności"})}),e.jsx(b,{className:"space-y-3",children:d.map(m=>e.jsx(Sr,{activity:{id:m.activity_id,title:m.activities?.title||"Bez tytułu",type:m.activities?.type||"material",completed:!!m.completed_at,score:m.score,courseTitle:m.activities?.topics?.courses?.title,courseEmoji:m.activities?.topics?.courses?.icon_emoji},onStart:()=>{const h=m.activities?.topics?.courses?.id,g=m.activity_id;h&&g&&(m.activities?.type==="quiz"?s(`/student/courses/${h}/quiz/${g}`):s(`/student/courses/${h}/lesson/${g}`))}},m.activity_id))})]})]})})},oc=()=>{const s=W(),[a,t]=A.useState(""),{data:r,isLoading:i}=fs("get_my_courses"),n=A.useMemo(()=>!r||!a?r||[]:r.filter(o=>o.title.toLowerCase().includes(a.toLowerCase())),[r,a]);return i?e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsx(R,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(U,{title:"Moje kursy",description:"Wybierz kurs i kontynuuj naukę"}),e.jsxs("div",{className:"relative",children:[e.jsx(ha,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(I,{placeholder:"Szukaj kursów...",className:"pl-10",value:a,onChange:o=>t(o.target.value)})]}),e.jsx(K,{children:n.map(o=>e.jsx(Cr,{course:{id:o.course_id,title:o.title,emoji:o.icon_emoji||"📚",progress:o.progress_percent||0,lastActivity:o.last_activity?new Date(o.last_activity).toLocaleDateString("pl-PL"):null},onClick:()=>s(`/student/courses/${o.course_id}`)},o.course_id))}),(!n||n.length===0)&&e.jsx(v,{children:e.jsxs(b,{className:"text-center py-12",children:[e.jsx(de,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-gray-500",children:a?"Nie znaleziono kursów":"Nie masz jeszcze żadnych kursów"})]})})]})})},lc=()=>{const{courseId:s}=ie(),a=W(),{data:t,isLoading:r}=fs("get_course_structure",{p_course_id:parseInt(s)},{enabled:!!s}),{data:i}=La("courses",{filters:[{field:"id",operator:"eq",value:parseInt(s)}],enabled:!!s}),n=A.useMemo(()=>{if(!t)return[];const c=t.reduce((u,x)=>{const d=`${x.topic_id}-${x.topic_title}`;return u[d]||(u[d]={id:x.topic_id,title:x.topic_title,position:x.topic_position,activities:[]}),x.activity_id&&u[d].activities.push({id:x.activity_id,title:x.activity_title,type:x.activity_type,position:x.activity_position,completed:x.is_completed,score:x.score}),u},{});return Object.values(c).sort((u,x)=>u.position-x.position)},[t]),o=A.useMemo(()=>{const c=n.flatMap(d=>d.activities),u=c.filter(d=>d.completed).length,x=c.length;return{totalActivities:x,completedActivities:u,progress:x>0?Math.round(u/x*100):0,topics:n.length}},[n]);if(r)return e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const l=i?.[0];return e.jsx(R,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>a("/student/courses"),className:"gap-2",children:[e.jsx(Us,{className:"w-4 h-4"}),"Powrót do kursów"]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-600 to-pink-600 rounded-2xl p-8 text-white",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-5xl",children:l?.icon_emoji||"📚"}),e.jsx("h1",{className:"text-3xl font-bold",children:l?.title})]}),e.jsx("p",{className:"text-white/80 max-w-2xl",children:l?.description})]}),e.jsxs(O,{className:"bg-white/20 text-white border-white/30",children:[o.progress,"% ukończone"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6 mt-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white/60",children:"Postęp"}),e.jsxs("p",{className:"text-2xl font-bold",children:[o.completedActivities,"/",o.totalActivities]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white/60",children:"Tematy"}),e.jsx("p",{className:"text-2xl font-bold",children:o.topics})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white/60",children:"Czas trwania"}),e.jsxs("p",{className:"text-2xl font-bold",children:["~",Math.ceil(o.totalActivities*15/60),"h"]})]})]}),e.jsx(Ke,{value:o.progress,className:"mt-6 h-3 bg-white/20"})]}),e.jsx("div",{className:"space-y-6",children:n.map(c=>{const u=c.activities.filter(d=>d.completed).length,x=u===c.activities.length;return e.jsxs(v,{children:[e.jsx(_,{children:e.jsxs(S,{children:[e.jsxs("div",{children:[e.jsxs(z,{className:"text-xl",children:["Temat ",c.position,": ",c.title]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[u,"/",c.activities.length," aktywności ukończonych"]})]}),x&&e.jsxs(O,{variant:"secondary",className:"gap-1",children:[e.jsx(Fs,{className:"w-3 h-3"}),"Ukończony"]})]})}),e.jsx(b,{className:"space-y-3",children:c.activities.map(d=>e.jsx(Sr,{activity:{id:d.id,title:d.title,type:d.type,completed:d.completed,score:d.score,points:d.type==="quiz"?20:10},onStart:()=>{d.type==="quiz"?a(`/student/courses/${s}/quiz/${d.id}`):a(`/student/courses/${s}/lesson/${d.id}`)}},d.id))})]},c.id)})})]})})},cc=()=>{const{courseId:s,lessonId:a}=ie(),t=W(),[r,i]=A.useState(!1),{data:n,isLoading:o}=X({resource:"activities",id:a,meta:{select:"*, topics(title, course_id, courses(title, icon_emoji))"}}),l=async()=>{i(!0);try{const{data:u,error:x}=await B.rpc("complete_material",{p_activity_id:parseInt(a)});if(x)throw x;u&&($.success("Lekcja ukończona!",{description:"Zdobyłeś punkty za ukończenie materiału"}),t(`/student/courses/${s}`))}catch(u){console.error("Complete error:",u),$.error("Nie udało się ukończyć lekcji",{description:u.message})}finally{i(!1)}};if(o)return e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const c=n?.data;return e.jsx(R,{children:e.jsxs("div",{className:"space-y-6 max-w-4xl mx-auto",children:[e.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>t(`/student/courses/${s}`),className:"gap-2",children:[e.jsx(Us,{className:"w-4 h-4"}),"Powrót do kursu"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:c?.topics?.courses?.icon_emoji||"📚"}),e.jsx("span",{children:c?.topics?.courses?.title}),e.jsx("span",{children:"/"}),e.jsx("span",{children:c?.topics?.title})]}),e.jsx("h1",{className:"text-3xl font-bold",children:c?.title}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{variant:"secondary",children:"Materiał"}),c?.duration_min&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(ze,{className:"w-3 h-3"}),e.jsxs("span",{children:[c?.duration_min," min"]})]})]})]}),e.jsx(v,{children:e.jsx(b,{className:"prose prose-lg max-w-none p-8",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:c?.content||""}})})}),e.jsx(v,{children:e.jsx(b,{className:"p-6",children:e.jsxs(S,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Ukończyłeś tę lekcję?"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Kliknij przycisk, aby zaznaczyć jako ukończone i otrzymać punkty"})]}),e.jsxs(f,{onClick:l,disabled:r,className:"gap-2",children:[e.jsx(Fs,{className:"w-4 h-4"}),r?"Zapisywanie...":"Oznacz jako ukończone"]})]})})})]})})},Pr=p.forwardRef(({className:s,...a},t)=>e.jsx(ra,{className:D("grid gap-2",s),...a,ref:t}));Pr.displayName=ra.displayName;const Rr=p.forwardRef(({className:s,...a},t)=>e.jsx(ia,{ref:t,className:D("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),...a,children:e.jsx(ji,{className:"flex items-center justify-center",children:e.jsx(da,{className:"h-3.5 w-3.5 fill-primary"})})}));Rr.displayName=ia.displayName;const dc=()=>{const{courseId:s,quizId:a}=ie(),t=W(),[r,i]=A.useState(0),[n,o]=A.useState({}),[l,c]=A.useState(null),[u,x]=A.useState(!1),[d,m]=A.useState([]),[h,g]=A.useState(!0),{data:j,isLoading:k}=X({resource:"activities",id:a,meta:{select:"*, topics(title, course_id, courses(title, icon_emoji))"}});A.useEffect(()=>{(async()=>{if(a)try{const{error:C}=await B.rpc("start_activity",{p_activity_id:parseInt(a)});C&&(console.error("Error starting quiz:",C),$.error("Nie udało się rozpocząć quizu",{icon:e.jsx(ks,{size:24})})),g(!0);const{data:q,error:F}=await B.rpc("get_quiz_questions",{p_activity_id:parseInt(a)});if(F)console.error("Error fetching questions:",F),$.error("Nie udało się pobrać pytań",{icon:e.jsx(ks,{size:24})});else{const Z=typeof q=="string"?JSON.parse(q):q;console.log("Questions data:",Z),Z&&Z.length>0&&console.log("First question options:",Z[0].options),m(Array.isArray(Z)?Z:[])}}catch(C){console.error("Quiz init error:",C),$.error("Błąd podczas ładowania quizu",{icon:e.jsx(ks,{size:24})})}finally{g(!1)}})()},[a]),A.useEffect(()=>{j?.data?.time_limit&&l===null&&c(j.data.time_limit*60)},[j]),A.useEffect(()=>{if(l!==null&&l>0){const N=setTimeout(()=>c(l-1),1e3);return()=>clearTimeout(N)}else l===0&&M()},[l]);const y=j?.data,w=(N,C)=>{o(q=>({...q,[N]:C}))},M=async()=>{x(!0);try{const N=Object.entries(n).map(([F,Z])=>({question_id:parseInt(F),option_id:Z}));console.log("Submitting answers:",N);const{data:C,error:q}=await B.rpc("finish_quiz",{p_activity_id:parseInt(a),p_answers:N});if(q)throw q;if(C){const{score:F,passed:Z,points_earned:je}=C;Z?$.success(`Quiz zaliczony! Wynik: ${F}%`,{description:`Zdobyłeś ${je} punktów!`,icon:e.jsx(Re,{size:24})}):$.warning(`Quiz niezaliczony. Wynik: ${F}%`,{description:`Wymagane minimum ${y?.passing_score||70}% do zaliczenia. Spróbuj ponownie!`,icon:e.jsx(es,{size:24})}),t(`/student/courses/${s}?refresh=true`)}}catch(N){console.error("Submit error:",N),$.error("Nie udało się przesłać odpowiedzi",{description:N.message,icon:e.jsx(ks,{size:24})})}finally{x(!1)}};if(k||h)return e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const P=d[r],Q=d.length>0?(r+1)/d.length*100:0;return e.jsx(R,{children:e.jsxs("div",{className:"space-y-6 max-w-4xl mx-auto",children:[e.jsxs(S,{children:[e.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>t(`/student/courses/${s}`),className:"gap-2",children:[e.jsx(Us,{className:"w-4 h-4"}),"Powrót do kursu"]}),l!==null&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ze,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium",children:[Math.floor(l/60),":",String(l%60).padStart(2,"0")]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold",children:y?.title}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{variant:"default",children:"Quiz"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Pytanie ",r+1," z ",d.length]})]})]}),e.jsx(Ke,{value:Q,className:"h-2"}),P&&d.length>0?e.jsxs(v,{children:[e.jsx(_,{children:e.jsxs(S,{children:[e.jsx(z,{className:"text-xl",children:P.question}),e.jsxs(O,{variant:"secondary",children:[P.points," pkt"]})]})}),e.jsxs(b,{className:"space-y-4",children:[e.jsx(Pr,{value:String(n[P.id]||""),onValueChange:N=>w(P.id,parseInt(N)),children:P.options&&Array.isArray(P.options)&&P.options.map(N=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Rr,{value:String(N.id),id:`radio-${P.id}-${N.id}`}),e.jsx(ye,{htmlFor:`radio-${P.id}-${N.id}`,className:"flex-1 cursor-pointer py-2",children:N.text})]},`option-${P.id}-${N.id}`))}),!n[P.id]&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-amber-600",children:[e.jsx(tt,{className:"w-4 h-4"}),e.jsx("span",{children:"Wybierz odpowiedź"})]})]})]}):d.length===0&&!h?e.jsx(v,{children:e.jsxs(b,{className:"text-center py-12",children:[e.jsx(tt,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-gray-500",children:"Nie znaleziono pytań dla tego quizu"})]})}):null,e.jsxs(S,{children:[e.jsx(f,{variant:"outline",onClick:()=>i(Math.max(0,r-1)),disabled:r===0,children:"Poprzednie"}),e.jsx("div",{className:"flex gap-2",children:d.map((N,C)=>e.jsx("button",{onClick:()=>i(C),className:`w-10 h-10 rounded-lg border-2 transition-all ${C===r?"border-primary bg-primary text-white":n[N.id]?"border-green-500 bg-green-50":"border-gray-300"}`,children:C+1},`nav-${N.id}-${C}`))}),r<d.length-1?e.jsx(f,{onClick:()=>i(r+1),disabled:!n[P?.id],children:"Następne"}):e.jsx(f,{onClick:M,disabled:u||Object.keys(n).length<d.length,variant:"default",children:u?"Przesyłanie...":"Zakończ quiz"})]})]})})},mc={"⚡":xt,"🚀":ga,"🧠":ja,"☕":rn,"📚":an},uc=()=>{const{stats:s,refetch:a}=Gs(),{data:t,isLoading:r,refetch:i}=fs("get_idle_upgrades"),n=async l=>{try{const{data:c,error:u}=await B.rpc("buy_idle_upgrade",{p_upgrade_id:l});if(u)throw u;c&&($.success("Ulepszenie zakupione!",{description:`Nowy poziom: ${c.new_level}`}),a(),i())}catch(c){$.error("Nie udało się kupić ulepszenia",{description:c.message||"Niewystarczająca ilość punktów"})}},o=t||[];return r?e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):e.jsx(R,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(U,{title:"Gamifikacja",description:"Ulepsz swoje możliwości zdobywania punktów"}),e.jsxs(v,{className:"bg-gradient-to-br from-purple-600 to-pink-600 text-white",children:[e.jsx(_,{children:e.jsx(z,{className:"text-2xl",children:"Idle Game"})}),e.jsx(b,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-80",children:"Punkty na godzinę"}),e.jsx("p",{className:"text-4xl font-bold",children:s.idle_rate})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-80",children:"Twoje punkty"}),e.jsx("p",{className:"text-4xl font-bold",children:s.points})]})]})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Ulepszenia"}),e.jsx(K,{children:o.map(l=>{const c=s.points>=l.next_cost,u=mc[l.icon]||cs;return e.jsxs(v,{className:"relative overflow-hidden",children:[e.jsx(_,{children:e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-purple-500 to-pink-500",children:e.jsx(u,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx(z,{className:"text-lg",children:l.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["+",l.bonus_per_level," pkt/h za poziom"]})]})]}),e.jsxs(O,{variant:"secondary",children:["Lvl ",l.current_level]})]})}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Aktualny bonus"}),e.jsxs("span",{className:"font-bold text-green-600",children:["+",l.total_bonus," pkt/h"]})]}),e.jsxs(f,{className:"w-full",onClick:()=>n(l.id),disabled:!c,variant:c?"default":"secondary",children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),"Ulepsz (",l.next_cost," pkt)"]})]})})]},l.id)})})]})]})})},xc=()=>{const{data:s}=me(),[a,t]=A.useState("all"),{data:r,isLoading:i,refetch:n}=fs("get_leaderboard",{p_limit:20,p_filter:a});A.useEffect(()=>{n()},[a]);const o=u=>{switch(u){case 1:return e.jsx(ce,{className:"w-5 h-5 text-yellow-500"});case 2:return e.jsx(nn,{className:"w-5 h-5 text-gray-400"});case 3:return e.jsx(ls,{className:"w-5 h-5 text-orange-600"});default:return e.jsxs("span",{className:"text-sm font-bold text-gray-500",children:["#",u]})}},l=u=>{switch(u){case 1:return"bg-yellow-50 border-yellow-200";case 2:return"bg-gray-50 border-gray-200";case 3:return"bg-orange-50 border-orange-200";default:return""}};if(i)return e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})});const c=r||[];return e.jsx(R,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(U,{title:"Ranking",description:"Zobacz jak wypadasz na tle innych uczniów"}),e.jsxs(qn,{value:a,onValueChange:u=>t(u),children:[e.jsxs(za,{className:"grid w-full grid-cols-3",children:[e.jsx(Ps,{value:"all",children:"Wszyscy"}),e.jsx(Ps,{value:"students",children:"Uczniowie"}),e.jsx(Ps,{value:"teachers",children:"Nauczyciele"})]}),e.jsx(_a,{value:a,className:"mt-6",children:e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Top 20"})}),e.jsx(b,{className:"space-y-2",children:c.map(u=>{const x=u.user_id===s?.id;return e.jsxs("div",{className:`flex items-center gap-4 p-4 rounded-xl transition-all ${x?"bg-purple-50 border-2 border-purple-200":`border ${l(u.rank)} hover:bg-gray-50`}`,children:[e.jsx("div",{className:"w-10 flex justify-center",children:o(u.rank)}),e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center text-white font-bold",children:u.full_name.charAt(0)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-semibold",children:[u.full_name,x&&e.jsx(O,{className:"ml-2",variant:"secondary",children:"Ty"})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Poziom ",u.level," • Seria ",u.streak," dni"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-lg",children:u.points}),e.jsx("p",{className:"text-xs text-gray-500",children:"punktów"})]})]},u.user_id)})})]})})]})]})})},is=[{id:1,icon:Os,title:"Pierwszy Krok",description:"Ukończ pierwszą lekcję",unlocked:!0,rarity:"common",unlockedAt:"2024-01-15",progress:100},{id:2,icon:fa,title:"Perfekcjonista",description:"Zdobądź 100% w 10 quizach",unlocked:!0,rarity:"rare",unlockedAt:"2024-02-20",progress:100},{id:3,icon:xt,title:"Błyskawica",description:"Ukończ 5 lekcji w jeden dzień",unlocked:!1,rarity:"epic",progress:60},{id:4,icon:ce,title:"Mistrz",description:"Osiągnij poziom 50",unlocked:!1,rarity:"legendary",progress:24},{id:5,icon:we,title:"Snajper",description:"Odpowiedz poprawnie na 100 pytań z rzędu",unlocked:!1,rarity:"epic",progress:45},{id:6,icon:ga,title:"Rakieta",description:"Ukończ kurs w mniej niż tydzień",unlocked:!1,rarity:"rare",progress:0}],Mt={common:{gradient:"from-gray-400 to-gray-500",bgColor:"bg-gray-50",borderColor:"border-gray-200",label:"Pospolite"},rare:{gradient:"from-blue-400 to-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200",label:"Rzadkie"},epic:{gradient:"from-purple-400 to-purple-600",bgColor:"bg-purple-50",borderColor:"border-purple-200",label:"Epiczne"},legendary:{gradient:"from-yellow-400 to-orange-500",bgColor:"bg-orange-50",borderColor:"border-orange-200",label:"Legendarne"}},hc=()=>{const s=is.filter(t=>t.unlocked).length,a=is.length;return e.jsx(R,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(U,{title:"Osiągnięcia",description:`Odblokowano ${s} z ${a} osiągnięć`}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Postęp osiągnięć"})}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ke,{value:s/a*100,className:"h-3"}),e.jsx("div",{className:"grid grid-cols-4 gap-4 text-center",children:Object.entries(Mt).map(([t,r])=>{const i=is.filter(o=>o.rarity===t&&o.unlocked).length,n=is.filter(o=>o.rarity===t).length;return e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[i,"/",n]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.label})]},t)})})]})})]}),e.jsx(K,{variant:"1-2-3",children:is.map(t=>{const r=Mt[t.rarity],i=t.icon;return e.jsxs(v,{className:`relative overflow-hidden ${t.unlocked?"":"opacity-75"} border-2 ${r.borderColor}`,children:[e.jsx("div",{className:`absolute inset-0 ${r.bgColor} opacity-20`}),e.jsx(b,{className:"relative p-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[e.jsx("div",{className:`w-20 h-20 rounded-full bg-gradient-to-br ${t.unlocked?r.gradient:"from-gray-300 to-gray-400"} flex items-center justify-center shadow-lg`,children:e.jsx(i,{className:"w-10 h-10 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:t.title}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:t.description})]}),t.unlocked?e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Odblokowano ",new Date(t.unlockedAt).toLocaleDateString("pl-PL")]}):e.jsxs("div",{className:"w-full space-y-2",children:[e.jsx(Ke,{value:t.progress,className:"h-2"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.progress,"% ukończone"]})]}),e.jsx(O,{variant:t.unlocked?"default":"secondary",children:r.label})]})})]},t.id)})})]})})},pc=()=>{const{data:s}=me(),{stats:a}=Gs();return e.jsx(R,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(U,{title:"Mój profil",description:"Zarządzaj swoim kontem i zobacz swoje statystyki"}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Informacje osobiste"})}),e.jsx(b,{children:e.jsxs("div",{className:"flex items-start gap-6",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center text-white text-3xl font-bold",children:s?.full_name?.charAt(0)||"U"}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:s?.full_name}),e.jsx(O,{variant:"secondary",className:"mt-1",children:"Uczeń"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ie,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{children:s?.email})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ut,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:["Dołączył: ",new Date(s?.created_at||Date.now()).toLocaleDateString("pl-PL")]})]})]})]}),e.jsx(f,{variant:"outline",children:"Edytuj profil"})]})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Moje osiągnięcia"}),e.jsxs(K,{variant:"2-2-4",children:[e.jsx(v,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-yellow-500 to-yellow-600",children:e.jsx(ce,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:a.points}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Punktów zdobytych"})]})]})})}),e.jsx(v,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-purple-500 to-purple-600",children:e.jsx(we,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:a.quizzes_completed}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ukończonych quizów"})]})]})})}),e.jsx(v,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-green-500 to-green-600",children:e.jsx(we,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:a.perfect_scores}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Perfekcyjnych wyników"})]})]})})}),e.jsx(v,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-orange-500 to-orange-600",children:e.jsx(Os,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[a.streak," dni"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Najdłuższa seria"})]})]})})}),e.jsx(v,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600",children:e.jsx(ze,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[Math.floor(a.total_time/60),"h"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Czasu nauki"})]})]})})}),e.jsx(v,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-pink-500 to-pink-600",children:e.jsx(Ce,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:["Poziom ",a.level]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aktualny poziom"})]})]})})})]})]}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(z,{children:"Ustawienia konta"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsx(f,{variant:"outline",className:"w-full justify-start",children:"Zmień hasło"}),e.jsx(f,{variant:"outline",className:"w-full justify-start",children:"Ustawienia powiadomień"}),e.jsx(f,{variant:"outline",className:"w-full justify-start text-red-600 hover:text-red-700",children:"Usuń konto"})]})]})]})})},jc=[e.jsx(E,{path:"/student/dashboard",element:e.jsx(nc,{})},"student-dashboard"),e.jsx(E,{path:"/student/courses",element:e.jsx(oc,{})},"student-courses"),e.jsx(E,{path:"/student/courses/:courseId",element:e.jsx(lc,{})},"student-course-detail"),e.jsx(E,{path:"/student/courses/:courseId/lesson/:lessonId",element:e.jsx(cc,{})},"student-lesson"),e.jsx(E,{path:"/student/courses/:courseId/quiz/:quizId",element:e.jsx(dc,{})},"student-quiz"),e.jsx(E,{path:"/student/gamification",element:e.jsx(uc,{})},"student-gamification"),e.jsx(E,{path:"/student/leaderboard",element:e.jsx(xc,{})},"student-leaderboard"),e.jsx(E,{path:"/student/achievements",element:e.jsx(hc,{})},"student-achievements"),e.jsx(E,{path:"/student/profile",element:e.jsx(pc,{})},"student-profile")],xe=({children:s})=>e.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center p-4 relative overflow-hidden",children:[e.jsx("div",{className:"h-96 fixed top-0 w-full -rotate-1 scale-125",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-400/0 via-pink-300/15 to-purple-500/10"})}),e.jsx("div",{className:"absolute top-20 -left-32 w-64 h-64 bg-gradient-to-br from-purple-300/20 to-pink-300/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-20 -right-32 w-96 h-96 bg-gradient-to-tl from-purple-400/15 to-pink-400/15 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-full h-64 bg-gradient-to-b from-pink-200/10 to-transparent"}),e.jsx("div",{className:"w-full max-w-lg space-y-3 relative z-10",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-300/5 to-pink-300/5 rounded-lg blur-md"}),e.jsx("div",{className:"relative bg-background/80 backdrop-blur-sm rounded-lg shadow-xl shadow-purple-200/20 border border-purple-200/20 p-8",children:s})]})})]}),gc=()=>{const{mutate:s,isLoading:a}=Si(),[t,r]=A.useState(""),[i,n]=A.useState(""),[o,l]=A.useState(null),c=A.useCallback(()=>{if(console.log("🚀 Login attempt:",{email:t}),!t.trim()||!i.trim()){l("Wypełnij wszystkie pola");return}l(null),s({email:t.trim(),password:i},{onSuccess:x=>{console.log("✅ Login success:",x)},onError:x=>{console.error("❌ Login error:",x);let d="Błąd logowania";x?.message&&(x.message.includes("Invalid login credentials")?d="Nieprawidłowe dane logowania":x.message.includes("Email not confirmed")?d="Potwierdź email przed zalogowaniem":d=x.message),l(d)}})},[t,i,s]),u=A.useCallback(x=>{x.preventDefault(),c()},[c]);return{email:t,password:i,setEmail:r,setPassword:n,isLoading:a,error:o,login:c,handleSubmit:u}},fc=()=>{const[s]=hs(),{email:a,password:t,setEmail:r,setPassword:i,isLoading:n,error:o,handleSubmit:l}=gc(),{data:c,isLoading:u}=Pi(),{data:x,isLoading:d}=me(),m=s.get("verified")==="true",h=s.get("passwordChanged")==="true",g=a.trim().length>0&&t.length>0,j=w=>w.includes("nie zostało potwierdzone")?"warning":"destructive",k=w=>w.includes("nie zostało potwierdzone")?wa:es,y=w=>{if(o){if(w==="email"&&o.toLowerCase().includes("email"))return"Sprawdź poprawność adresu email";if(w==="password"&&o.toLowerCase().includes("hasło"))return"Sprawdź poprawność hasła"}};if(u||d)return e.jsx(xe,{children:e.jsx(v,{children:e.jsx(b,{className:"flex items-center justify-center py-12",children:e.jsx(We,{className:"h-8 w-8 animate-spin"})})})});if(c&&x){const w=x.role?`/${x.role}`:"/profiles";return e.jsx(Ye,{to:w,replace:!0})}return e.jsx(xe,{children:e.jsxs(v,{children:[e.jsxs(_,{className:"space-y-1",children:[e.jsx(z,{className:"text-2xl text-center",children:"Zaloguj się"}),e.jsx(Ae,{className:"text-center",children:"Wprowadź swoje dane aby się zalogować"})]}),e.jsxs(b,{children:[m&&e.jsxs(H,{className:"mb-4 border-green-200 bg-green-50",children:[e.jsx(Re,{className:"h-4 w-4 text-green-600"}),e.jsxs(J,{className:"text-green-800",children:[e.jsx("strong",{children:"Email potwierdzony!"})," Możesz się teraz zalogować."]})]}),h&&e.jsxs(H,{className:"mb-4 border-green-200 bg-green-50",children:[e.jsx(Re,{className:"h-4 w-4 text-green-600"}),e.jsxs(J,{className:"text-green-800",children:[e.jsx("strong",{children:"Hasło zmienione!"})," Możesz się zalogować używając nowego hasła."]})]}),e.jsxs(he,{onSubmit:l,children:[e.jsx(L,{label:e.jsxs("span",{className:"flex items-center",children:[e.jsx(Ie,{className:"mr-2 h-4 w-4"}),"Email"]}),htmlFor:"email",error:y("email"),required:!0,children:e.jsx(I,{id:"email",type:"email",placeholder:"przykład@email.com",value:a,onChange:w=>r(w.target.value),disabled:n,className:y("email")?"border-red-500":""})}),e.jsx(L,{label:e.jsxs("span",{className:"flex items-center",children:[e.jsx(on,{className:"mr-2 h-4 w-4"}),"Hasło"]}),htmlFor:"password",error:y("password"),required:!0,children:e.jsx(I,{id:"password",type:"password",placeholder:"Wprowadź hasło",value:t,onChange:w=>i(w.target.value),disabled:n,className:y("password")?"border-red-500":""})}),o&&e.jsxs(H,{variant:j(o),children:[A.createElement(k(o),{className:"h-4 w-4"}),e.jsxs(J,{children:[e.jsx("strong",{children:"Błąd logowania:"})," ",o,o.includes("nie zostało potwierdzone")&&e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsxs("p",{children:["💡 ",e.jsx("strong",{children:"Co robić:"})]}),e.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-1",children:[e.jsx("li",{children:"Sprawdź swoją skrzynkę email (także spam)"}),e.jsx("li",{children:"Kliknij link aktywacyjny w emailu"}),e.jsxs("li",{children:["Jeśli nie otrzymałeś emaila, możesz"," ",e.jsx(ns,{to:"/resend-confirmation",className:"underline",children:"wysłać ponownie"})]})]})]}),o.includes("Nieprawidłowe dane")&&e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsxs("p",{children:["💡 ",e.jsx("strong",{children:"Sprawdź:"})]}),e.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-1",children:[e.jsx("li",{children:"Czy email jest wpisany poprawnie"}),e.jsx("li",{children:"Czy hasło jest poprawne (uwaga na wielkość liter)"}),e.jsx("li",{children:"Czy masz już założone konto"})]})]})]})]}),e.jsx(pe,{className:"!border-0 !pt-0 justify-center",children:e.jsxs(f,{type:"submit",className:"w-full",disabled:n||!g,children:[n&&e.jsx(We,{className:"mr-2 h-4 w-4 animate-spin"}),n?"Logowanie...":"Zaloguj się"]})})]}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsx("div",{className:"text-center text-sm",children:e.jsx(ns,{to:"/register/step1",className:"text-blue-600 hover:text-blue-500 transition-colors",children:"Nie masz konta? Zarejestruj się"})}),e.jsx("div",{className:"text-center text-sm",children:e.jsx(ns,{to:"/forgot-password",className:"text-blue-600 hover:text-blue-500 transition-colors",children:"Zapomniałeś hasła?"})}),e.jsx("div",{className:"border-t pt-4 mt-4",children:e.jsxs("div",{className:"text-center text-xs text-gray-500",children:[e.jsx("p",{children:"Problemy z logowaniem?"}),e.jsx(ns,{to:"/contact",className:"text-blue-600 hover:text-blue-500 transition-colors",children:"Skontaktuj się z pomocą techniczną"})]})})]})]})]})})},wc=()=>{const{mutate:s,isLoading:a,error:t}=Ri(),[r,i]=A.useState(1),[n,o]=A.useState(""),[l,c]=A.useState(""),[u,x]=A.useState(""),[d,m]=A.useState(""),[h,g]=A.useState(""),j=[{value:"beneficiary",label:"Beneficiary",description:"Użytkownik końcowy systemu",icon:Ce},{value:"auditor",label:"Auditor",description:"Audytor z uprawnieniami kontrolnymi",icon:As}],k=P=>{if(P.preventDefault(),g(""),l!==u){g("Hasła nie są identyczne");return}if(l.length<6){g("Hasło musi mieć co najmniej 6 znaków");return}i(2)},y=()=>{if(!d){g("Wybierz rolę");return}s({email:n,password:l,role:d})},w=P=>{m(P),g("")},M=()=>{i(1),g("")};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"max-w-md w-full space-y-8",children:r===1?e.jsxs(v,{children:[e.jsxs(_,{className:"space-y-1",children:[e.jsx(z,{className:"text-2xl text-center",children:"Zarejestruj się"}),e.jsx(Ae,{className:"text-center",children:"Krok 1/2: Podaj swoje dane"})]}),e.jsxs(b,{children:[e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ye,{htmlFor:"email",children:"Email"}),e.jsx(I,{id:"email",type:"email",placeholder:"przykład@email.com",value:n,onChange:P=>o(P.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ye,{htmlFor:"password",children:"Hasło"}),e.jsx(I,{id:"password",type:"password",placeholder:"Minimum 6 znaków",value:l,onChange:P=>c(P.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ye,{htmlFor:"confirmPassword",children:"Potwierdź hasło"}),e.jsx(I,{id:"confirmPassword",type:"password",placeholder:"Powtórz hasło",value:u,onChange:P=>x(P.target.value),required:!0})]}),h&&e.jsx(H,{variant:"destructive",children:e.jsx(J,{children:h})}),e.jsx(f,{type:"submit",className:"w-full",children:"Dalej"})]}),e.jsx("div",{className:"mt-4 text-center text-sm",children:e.jsx("a",{href:"/login",className:"text-blue-600 hover:text-blue-500",children:"Masz już konto? Zaloguj się"})})]})]}):e.jsxs(v,{children:[e.jsxs(_,{className:"space-y-1",children:[e.jsx(z,{className:"text-2xl text-center",children:"Wybierz rolę"}),e.jsx(Ae,{className:"text-center",children:"Krok 2/2: Jaka jest Twoja rola w systemie?"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:j.map(P=>{const Q=P.icon;return e.jsx("div",{onClick:()=>w(P.value),className:`p-4 border-2 rounded-lg cursor-pointer transition-all hover:bg-gray-50 ${d===P.value?"border-blue-500 bg-blue-50":"border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Q,{className:`h-6 w-6 mt-1 ${d===P.value?"text-blue-600":"text-gray-400"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-medium ${d===P.value?"text-blue-900":"text-gray-900"}`,children:P.label}),e.jsx("p",{className:`text-sm ${d===P.value?"text-blue-700":"text-gray-500"}`,children:P.description})]})]})},P.value)})}),h&&e.jsx(H,{variant:"destructive",children:e.jsx(J,{children:h})}),t&&e.jsx(H,{variant:"destructive",children:e.jsx(J,{children:t?.message||"Błąd rejestracji"})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(f,{variant:"outline",onClick:M,className:"flex-1",disabled:a,children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Wstecz"]}),e.jsxs(f,{onClick:y,className:"flex-1",disabled:a||!d,children:[a&&e.jsx(We,{className:"mr-2 h-4 w-4 animate-spin"}),"Zarejestruj się"]})]})]})]})})})},yc=()=>{const{mutate:s,isLoading:a,error:t,isSuccess:r}=Mi(),[i,n]=A.useState(""),o=l=>{l.preventDefault(),s({email:i})};return r?e.jsx(xe,{children:e.jsxs(v,{children:[e.jsxs(_,{className:"space-y-1",children:[e.jsxs(z,{className:"text-2xl text-center flex items-center justify-center gap-2",children:[e.jsx(Re,{className:"h-6 w-6 text-green-500"}),"Email wysłany"]}),e.jsx(Ae,{className:"text-center",children:"Sprawdź swoją skrzynkę odbiorczą"})]}),e.jsxs(b,{children:[e.jsx(H,{children:e.jsxs(J,{children:["Wysłaliśmy link do resetowania hasła na adres ",e.jsx("strong",{children:i}),". Sprawdź swoją skrzynkę odbiorczą i kliknij w link, aby zresetować hasło."]})}),e.jsx("div",{className:"text-center",children:e.jsx("a",{href:"/login",className:"text-blue-600 hover:text-blue-500",children:"Powrót do logowania"})})]})]})}):e.jsx(xe,{children:e.jsxs(v,{children:[e.jsxs(_,{className:"space-y-1",children:[e.jsx(z,{className:"text-2xl text-center",children:"Resetuj hasło"}),e.jsx(Ae,{className:"text-center",children:"Wprowadź swój email, aby otrzymać link do resetowania hasła"})]}),e.jsxs(b,{children:[e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ye,{htmlFor:"email",children:"Email"}),e.jsx(I,{id:"email",type:"email",placeholder:"przykład@email.com",value:i,onChange:l=>n(l.target.value),required:!0})]}),t&&e.jsx(H,{variant:"destructive",children:e.jsx(J,{children:t.message||"Błąd podczas wysyłania emaila"})}),e.jsxs(f,{type:"submit",className:"w-full",disabled:a,children:[a&&e.jsx(We,{className:"mr-2 h-4 w-4 animate-spin"}),"Wyślij link resetujący"]})]}),e.jsx("div",{className:"mt-4 text-center text-sm",children:e.jsx("a",{href:"/login",className:"text-blue-600 hover:text-blue-500",children:"Powrót do logowania"})})]})]})})},vc=()=>{const s=W(),{mutate:a,isLoading:t,error:r}=Di(),[i,n]=A.useState(""),[o,l]=A.useState(""),[c,u]=A.useState(""),[x,d]=A.useState(!0),[m,h]=A.useState(!0),[g,j]=A.useState(!1);A.useEffect(()=>{(async()=>{try{const{data:w}=await B.auth.getSession(),P=new URLSearchParams(window.location.hash.substring(1)).get("type");!w.session&&P!=="recovery"?(console.log("No valid recovery session found"),d(!1),setTimeout(()=>{s("/forgot-password")},3e3)):(console.log("Valid session found"),d(!0))}catch(w){console.error("Session check error:",w),d(!1)}finally{h(!1)}})()},[s]);const k=async y=>{if(y.preventDefault(),u(""),i!==o){u("Hasła nie są identyczne");return}if(i.length<6){u("Hasło musi mieć co najmniej 6 znaków");return}if(i.length>72){u("Hasło nie może być dłuższe niż 72 znaki");return}a({password:i},{onSuccess:()=>{j(!0),setTimeout(()=>{s("/login?passwordChanged=true")},3e3)},onError:w=>{console.error("Password update error:",w),u(w?.message||"Błąd aktualizacji hasła")}})};return m?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(We,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Weryfikacja sesji..."})]})}):x?g?e.jsx(xe,{children:e.jsxs(v,{className:"border-green-200",children:[e.jsx(_,{children:e.jsxs(z,{className:"text-2xl text-center flex items-center justify-center gap-2",children:[e.jsx(Re,{className:"h-6 w-6 text-green-600"}),"Hasło zmienione!"]})}),e.jsx(b,{children:e.jsxs(H,{className:"border-green-200 bg-green-50",children:[e.jsx(Re,{className:"h-4 w-4 text-green-600"}),e.jsx(J,{className:"text-green-800",children:"Twoje hasło zostało pomyślnie zmienione. Za chwilę zostaniesz przekierowany do strony logowania..."})]})})]})}):e.jsx(xe,{children:e.jsxs(v,{children:[e.jsxs(_,{className:"space-y-1",children:[e.jsxs(z,{className:"text-2xl text-center flex items-center justify-center gap-2",children:[e.jsx(ln,{className:"h-6 w-6"}),"Nowe hasło"]}),e.jsx(Ae,{className:"text-center",children:"Wprowadź nowe hasło dla swojego konta"})]}),e.jsxs(b,{children:[e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ye,{htmlFor:"password",children:"Nowe hasło"}),e.jsx(I,{id:"password",type:"password",placeholder:"Minimum 6 znaków",value:i,onChange:y=>n(y.target.value),disabled:t,required:!0,autoFocus:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ye,{htmlFor:"confirmPassword",children:"Potwierdź nowe hasło"}),e.jsx(I,{id:"confirmPassword",type:"password",placeholder:"Powtórz nowe hasło",value:o,onChange:y=>l(y.target.value),disabled:t,required:!0})]}),e.jsxs(H,{children:[e.jsx(wa,{className:"h-4 w-4"}),e.jsxs(J,{children:[e.jsx("strong",{children:"Wymagania hasła:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 text-sm",children:[e.jsx("li",{children:"Minimum 6 znaków"}),e.jsx("li",{children:"Maksimum 72 znaki"}),e.jsx("li",{children:"Zalecane użycie liter, cyfr i znaków specjalnych"})]})]})]}),(r||c)&&e.jsxs(H,{variant:"destructive",children:[e.jsx(es,{className:"h-4 w-4"}),e.jsx(J,{children:c||r?.message||"Błąd aktualizacji hasła"})]}),e.jsxs(f,{type:"submit",className:"w-full",disabled:t,children:[t&&e.jsx(We,{className:"mr-2 h-4 w-4 animate-spin"}),t?"Aktualizowanie...":"Zaktualizuj hasło"]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Pamiętasz hasło?"," ",e.jsx("a",{href:"/login",className:"text-blue-600 hover:text-blue-500",children:"Wróć do logowania"})]})})]})]})}):e.jsx(xe,{children:e.jsx(v,{className:"border-red-200",children:e.jsx(b,{className:"pt-6",children:e.jsxs(H,{variant:"destructive",children:[e.jsx(es,{className:"h-4 w-4"}),e.jsxs(J,{children:[e.jsx("strong",{children:"Nieprawidłowa lub wygasła sesja."}),e.jsx("br",{}),"Link do resetowania hasła mógł wygasnąć. Za chwilę zostaniesz przekierowany do strony resetowania hasła..."]})]})})})})},Mr=({schemaPath:s,onSubmit:a,submitLabel:t="Dalej",className:r=""})=>{const{getSchemaFragment:i,setData:n,getData:o}=js(),[l]=s.split("."),[c,u]=A.useState(""),[x,d]=A.useState({}),m=i(s),h=o(l);if(!m)return e.jsx(H,{variant:"destructive",children:e.jsxs(J,{children:["Nie znaleziono schematu dla ścieżki: ",s]})});const g=y=>{y.preventDefault(),u(""),d({});const w={};if(m.required)for(const M of m.required)h[M]||(w[M]="To pole jest wymagane");if(Object.keys(w).length>0){d(w);return}if(m.validation){const M=m.validation(h);if(M){u(M);return}}a(h)},j=(y,w)=>{n(l,{...h,[y]:w}),x[y]&&d(M=>{const P={...M};return delete P[y],P})},k=(y,w)=>{const M=h[y]||"",P=m.required?.includes(y),Q=x[y];switch(w.type){case"text":case"email":case"password":return e.jsx(L,{label:w.title||y,htmlFor:y,error:Q,required:P,children:e.jsx(I,{id:y,type:w.type,value:M,placeholder:w.placeholder,onChange:N=>j(y,N.target.value),className:Q?"border-red-500":""})},y);case"select":return e.jsx(L,{label:w.title||y,htmlFor:y,error:Q,required:P,children:e.jsxs(Me,{value:M,onValueChange:N=>j(y,N),children:[e.jsx(ve,{className:Q?"border-red-500":"",children:e.jsx(De,{placeholder:w.placeholder||"Wybierz opcję"})}),e.jsx(be,{children:w.options?.map(N=>e.jsx(V,{value:N.value,children:N.label},N.value))})]})},y);default:return null}};return e.jsxs(v,{className:r,children:[e.jsx(_,{children:e.jsx(z,{children:m.title})}),e.jsx(b,{children:e.jsxs(he,{onSubmit:g,children:[e.jsxs(K,{variant:"1-1-1",children:[m.properties&&Object.entries(m.properties).map(([y,w])=>k(y,w)),c&&e.jsx(H,{variant:"destructive",className:"mt-4",children:e.jsx(J,{children:c})})]}),e.jsx(pe,{className:"mt-6 pt-6",children:e.jsx(f,{type:"submit",className:"w-full sm:w-auto",children:t})})]})})]})},bc=()=>{const s=W(),{register:a}=js();p.useEffect(()=>{a({id:"registration",title:"Proces rejestracji",schema:{step1:{title:"Dane podstawowe",type:"object",properties:{email:{type:"email",title:"Email",placeholder:"przykład@email.com"},name:{type:"text",title:"Imię i nazwisko",placeholder:"Jan Kowalski"}},required:["email","name"],validation:r=>r.name&&r.name.trim().length<3?"Imię i nazwisko musi mieć co najmniej 3 znaki":r.name&&!r.name.includes(" ")?"Podaj zarówno imię jak i nazwisko":null},step2:{title:"Hasło",type:"object",properties:{password:{type:"password",title:"Hasło",placeholder:"Minimum 6 znaków"},confirmPassword:{type:"password",title:"Potwierdź hasło",placeholder:"Powtórz hasło"}},required:["password","confirmPassword"],validation:r=>r.password&&r.password.length<6?"Hasło musi mieć co najmniej 6 znaków":r.password!==r.confirmPassword?"Hasła nie są identyczne":null},step3:{title:"Podsumowanie",type:"object",properties:{}}}})},[a]);const t=r=>{console.log("RegisterStep1 - Otrzymane dane z formularza:",r),s("/register/step2")};return e.jsxs(xe,{children:[e.jsxs("div",{className:"flex items-start gap-5 ",children:[e.jsx(Ms,{className:"mt-2 bg-white rounded-full p-2 w-12 h-12"}),e.jsx(U,{title:"Rejestracja",description:"1 z 3 Podaj podstawowe informacje"})]}),e.jsx(Mr,{schemaPath:"registration.step1",onSubmit:t,submitLabel:"Dalej"}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx(ns,{to:"/login",className:"text-blue-600 hover:text-blue-500 text-sm",children:"Masz już konto? Zaloguj się"})})]})},Nc=()=>{const s=W(),{setData:a}=js(),t=i=>{a("registration",i),s("/register/step3")},r=()=>{s("/register/step1")};return e.jsxs(xe,{children:[e.jsxs("div",{className:"flex items-start gap-5 ",children:[e.jsx(cn,{className:"mt-2 bg-white rounded-full p-2 w-12 h-12"}),e.jsx(U,{title:"Rejestracja",description:"2 z 3 Ustaw hasło do konta"})]}),e.jsx(Mr,{schemaPath:"registration.step2",onSubmit:t,submitLabel:"Dalej"}),e.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[e.jsxs(f,{variant:"outline",onClick:r,className:"flex items-center",children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Wstecz"]}),e.jsx("a",{href:"/login",className:"text-blue-600 hover:text-blue-500 text-sm",children:"Masz już konto? Zaloguj się"})]})]})},kc=()=>{const s=W(),{getData:a,setData:t}=js(),[r,i]=A.useState(!1),[n,o]=A.useState(!1),[l,c]=A.useState(null),u=a("registration"),x=A.useCallback(async()=>{if(!at.register){c("Funkcja rejestracji nie jest dostępna");return}if(!u?.email||!u?.password){c("Brak wymaganych danych. Rozpocznij proces rejestracji od początku.");return}i(!0),c(null);try{console.log("📝 Attempting registration with:",{email:u.email,name:u.name});const m=await at.register({email:u.email,password:u.password,name:u.name});if(console.log("📝 Registration result:",m),m.success)o(!0),t("registration",{...u,registrationComplete:!0,registrationDate:new Date().toISOString(),user:m.user}),setTimeout(()=>{s("/register/step4")},1500);else{const h=m.error?.message||"Rejestracja nie powiodła się";console.error("❌ Registration failed:",h),c(h)}}catch(m){console.error("❌ Registration error:",m);const h=m?.message||"Wystąpił nieoczekiwany błąd";c(h)}finally{i(!1)}},[u,t,s]),d=A.useCallback(()=>{s("/register/step2")},[s]);return{isLoading:r,isSuccess:n,error:l,register:x,goBack:d,processData:u}},zc=()=>{const s=W(),{isLoading:a,isSuccess:t,error:r,register:i,goBack:n,processData:o}=kc();return!o||!o.email?e.jsxs(xe,{children:[e.jsx(U,{title:"Rejestracja",description:"Błąd - brak danych"}),e.jsxs(H,{variant:"destructive",children:[e.jsx(es,{className:"h-4 w-4"}),e.jsx(J,{children:"Brak danych rejestracji. Rozpocznij proces od początku."})]}),e.jsx(f,{onClick:()=>s("/register/step1"),className:"mt-4",children:"Wróć do kroku 1"})]}):e.jsxs(xe,{children:[e.jsxs("div",{className:"flex items-start gap-5 ",children:[e.jsx(dn,{className:"mt-2 bg-white rounded-full p-2 w-12 h-12"}),e.jsx(U,{title:"Rejestracja",description:"3 z 4 Potwierdzenie danych"})]}),t&&e.jsxs(H,{className:"mb-4 border-green-200 bg-green-50",children:[e.jsx(Ee,{className:"h-4 w-4 text-green-600"}),e.jsxs(J,{className:"text-green-800",children:[e.jsx("strong",{children:"Rejestracja udana!"})," Za chwilę zostaniesz przekierowany..."]})]}),r&&!t&&e.jsxs(H,{variant:"destructive",className:"mb-4",children:[e.jsx(es,{className:"h-4 w-4"}),e.jsxs(J,{children:[e.jsx("strong",{children:"Rejestracja nieudana:"})," ",r]})]}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsxs(z,{className:"flex items-center",children:[e.jsx(Ee,{className:"mr-2 h-5 w-5 text-blue-600"}),"Podsumowanie"]})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-blue-800 font-medium",children:"Co się stanie:"}),e.jsxs("ul",{className:"text-sm text-blue-700 mt-2 space-y-1",children:[e.jsx("li",{children:"• Konto zostanie utworzone"}),e.jsx("li",{children:"• Otrzymasz email z potwierdzeniem"}),e.jsx("li",{children:"• Po aktywacji będziesz mógł się zalogować"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(Ie,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Email"}),e.jsx("p",{className:"text-sm text-gray-600",children:o.email})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(Ce,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Imię i nazwisko"}),e.jsx("p",{className:"text-sm text-gray-600",children:o.name})]})]})]}),r&&!t&&e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-sm text-red-800 font-medium",children:"Wskazówki w przypadku problemów:"}),e.jsxs("ul",{className:"text-sm text-red-700 mt-2 space-y-1",children:[e.jsx("li",{children:"• Sprawdź czy email ma prawidłowy format"}),e.jsx("li",{children:"• Upewnij się że hasło spełnia wymagania (6-72 znaków)"}),e.jsx("li",{children:"• Jeśli masz już konto, przejdź do logowania"}),e.jsx("li",{children:"• W przypadku dalszych problemów skontaktuj się z pomocą"})]})]})]})]}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsxs(f,{variant:"outline",onClick:n,disabled:a||t,children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Wstecz"]}),e.jsxs(f,{onClick:i,disabled:a||t,children:[a&&e.jsx(We,{className:"mr-2 h-4 w-4 animate-spin"}),a?"Rejestruję...":t?"Udane!":r?"Spróbuj ponownie":"Zarejestruj się"]})]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("a",{href:"/login",className:"text-blue-600 hover:text-blue-500 text-sm",children:"Masz już konto? Zaloguj się"})})]})},_c=()=>{const s=W(),{getData:a,unregister:t}=js(),[r,i]=A.useState(!1),[n,o]=A.useState(!1),l=a("registration"),c=l?.email||"user@example.com",u=l?.name||"Użytkownik";A.useEffect(()=>{const m=setTimeout(()=>{t("registration","data")},3e4);return()=>clearTimeout(m)},[t]);const x=async()=>{i(!0);try{await new Promise(m=>setTimeout(m,2e3)),o(!0),setTimeout(()=>o(!1),3e3)}catch(m){console.error("Błąd wysyłania maila:",m)}finally{i(!1)}},d=()=>{t("registration","data"),s("/login")};return e.jsxs(xe,{children:[e.jsx(U,{title:"Rejestracja zakończona!",description:"4 z 4 Sprawdź swoją skrzynkę mailową"}),e.jsxs(v,{className:"border-green-200 bg-green-50",children:[e.jsx(_,{children:e.jsxs(z,{className:"flex items-center text-green-800",children:[e.jsx(Re,{className:"mr-2 h-6 w-6 text-green-600"}),"Konto zostało utworzone!"]})}),e.jsx(b,{className:"space-y-4",children:e.jsxs("div",{className:"text-green-700",children:[e.jsx("p",{className:"font-medium",children:"Gratulacje! Twoje konto zostało pomyślnie utworzone."}),e.jsxs("p",{className:"text-sm mt-1",children:["Wysłaliśmy email z potwierdzeniem na adres ",e.jsx("strong",{children:c})]})]})})]}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsxs(z,{className:"flex items-center",children:[e.jsx(Ce,{className:"mr-2 h-5 w-5"}),"Podsumowanie konta"]})}),e.jsxs(b,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(Ie,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Adres email"}),e.jsx("p",{className:"text-sm text-gray-600",children:c})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(Ce,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Imię i nazwisko"}),e.jsx("p",{className:"text-sm text-gray-600",children:u})]})]})]})]}),e.jsxs(v,{className:"border-blue-200",children:[e.jsx(_,{children:e.jsxs(z,{className:"flex items-center text-blue-800",children:[e.jsx(Ie,{className:"mr-2 h-5 w-5 text-blue-600"}),"Co dalej?"]})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center text-xs font-bold",children:"1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Sprawdź swoją skrzynkę mailową"}),e.jsxs("p",{className:"text-gray-600",children:["Email potwierdzający został wysłany na adres ",e.jsx("strong",{children:c})]})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center text-xs font-bold",children:"2"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Kliknij link w emailu"}),e.jsx("p",{className:"text-gray-600",children:"Aktywuj swoje konto klikając w link potwierdzający"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center text-xs font-bold",children:"3"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Zaloguj się do systemu"}),e.jsx("p",{className:"text-gray-600",children:"Po aktywacji możesz się zalogować używając swojego emailu i hasła"})]})]})]}),e.jsxs(H,{children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsxs(J,{children:[e.jsx("strong",{children:"Ważne:"})," Email może dotrzeć w ciągu kilku minut. Sprawdź także folder SPAM/Niechciane."]})]})]})]}),e.jsx(v,{children:e.jsx(b,{className:"pt-6",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Nie otrzymałeś emaila?"}),n&&e.jsxs(H,{className:"border-green-200 bg-green-50",children:[e.jsx(Re,{className:"h-4 w-4 text-green-600"}),e.jsx(J,{className:"text-green-800",children:"Email został wysłany ponownie!"})]}),e.jsxs(f,{variant:"outline",onClick:x,disabled:r,className:"w-full sm:w-auto",children:[r&&e.jsx(ua,{className:"mr-2 h-4 w-4 animate-spin"}),r?"Wysyłanie...":"Wyślij email ponownie"]})]})})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs(f,{onClick:d,className:"w-full",size:"lg",children:["Przejdź do logowania",e.jsx(_e,{className:"ml-2 h-4 w-4"})]}),e.jsx("div",{className:"text-center",children:e.jsx("a",{href:"/help",className:"text-blue-600 hover:text-blue-500 text-sm",children:"Potrzebujesz pomocy? Skontaktuj się z nami"})})]})]})},Cc=[e.jsx(E,{path:"/login",element:e.jsx(fc,{})},"auth-login"),e.jsx(E,{path:"/register",element:e.jsx(wc,{})},"auth-register"),e.jsx(E,{path:"/forgot-password",element:e.jsx(yc,{})},"auth-forgot-password"),e.jsx(E,{path:"/update-password",element:e.jsx(vc,{})},"auth-update-password"),e.jsx(E,{path:"/register/step1",element:e.jsx(bc,{})},"auth-register-1"),e.jsx(E,{path:"/register/step2",element:e.jsx(Nc,{})},"auth-register-2"),e.jsx(E,{path:"/register/step3",element:e.jsx(zc,{})},"auth-register-3"),e.jsx(E,{path:"/register/step4",element:e.jsx(_c,{})},"auth-register-4")],Sc=()=>{const s=W(),[a,t]=p.useState(0),[r,i]=p.useState("");p.useEffect(()=>{const o=()=>t(window.scrollY);return window.addEventListener("scroll",o),()=>window.removeEventListener("scroll",o)},[]);const n=[{name:"Sty",value:65},{name:"Lut",value:72},{name:"Mar",value:78},{name:"Kwi",value:85},{name:"Maj",value:88},{name:"Cze",value:94}];return e.jsxs("div",{className:"min-h-screen bg-white text-foreground",children:[e.jsx("nav",{className:"fixed top-0 w-full z-50 bg-white/80 backdrop-blur-xl border-b border-gray-100",children:e.jsx("div",{className:"container mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-pink-600 to-purple-700 rounded-xl flex items-center justify-center",children:e.jsx(ce,{className:"w-5 h-5 text-white"})}),e.jsx("span",{className:"text-xl font-bold",children:"Smart Up"})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-8",children:[e.jsx("a",{href:"#funkcje",className:"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Funkcje"}),e.jsx("a",{href:"#kursy",className:"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Kursy"}),e.jsx("a",{href:"#firma",className:"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Dla firm"}),e.jsx("a",{href:"#cennik",className:"text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors",children:"Cennik"}),e.jsx(f,{className:"bg-gray-900 hover:bg-gray-800 text-white text-sm px-6",onClick:()=>s("/login"),children:"Rozpocznij"})]})]})})}),e.jsx("section",{className:"pt-32 pb-20 overflow-hidden",children:e.jsx("div",{className:"container mx-auto px-6",children:e.jsxs("div",{className:"grid lg:grid-cols-12 gap-8 items-center",children:[e.jsxs("div",{className:"lg:col-span-5",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-purple-50 rounded-full mb-8",children:[e.jsx(xt,{className:"w-4 h-4 text-purple-700"}),e.jsx("span",{className:"text-sm font-medium text-purple-700",children:"Gamifikacja w edukacji"})]}),e.jsxs("h1",{className:"text-5xl md:text-6xl font-bold leading-tight mb-6",children:["Nauka, która",e.jsx("span",{className:"block text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-700",children:"motywuje"})]}),e.jsx("p",{className:"text-lg text-gray-600 mb-8 leading-relaxed",children:"Przekształć edukację w angażującą przygodę. System poziomów, punktów i nagród sprawia, że nauka staje się uzależniająca."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-12",children:[e.jsxs(f,{size:"lg",className:"bg-gray-900 hover:bg-gray-800 text-white px-8",onClick:()=>s("/login"),children:["Zacznij za darmo",e.jsx(_e,{className:"ml-2 h-4 w-4"})]}),e.jsx(f,{size:"lg",variant:"outline",className:"border-gray-300",children:"Zobacz demo"})]}),e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:"15k+"}),e.jsx("div",{className:"text-sm text-gray-500",children:"aktywnych uczniów"})]}),e.jsx("div",{className:"w-px h-12 bg-gray-200"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:"92%"}),e.jsx("div",{className:"text-sm text-gray-500",children:"ukończalność"})]}),e.jsx("div",{className:"w-px h-12 bg-gray-200"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:"4.9"}),e.jsx("div",{className:"text-sm text-gray-500",children:"ocena"})]})]})]}),e.jsx("div",{className:"lg:col-span-7",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -inset-4 bg-gradient-to-r from-pink-600/5 to-purple-700/5 rounded-3xl blur-2xl"}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-pink-600 to-purple-700 rounded-lg flex items-center justify-center",children:e.jsx(ce,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:"font-semibold",children:"Dashboard ucznia"})]}),e.jsx(O,{className:"bg-green-50 text-green-700 border-green-200",children:"Online"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-pink-50 to-pink-100 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(cs,{className:"w-5 h-5 text-pink-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"+125"})]}),e.jsx("div",{className:"text-2xl font-bold",children:"1,842"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Punkty XP"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(we,{className:"w-5 h-5 text-purple-700"}),e.jsx("span",{className:"text-xs text-gray-500",children:"75%"})]}),e.jsx("div",{className:"text-2xl font-bold",children:"Lvl 12"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Poziom"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-teal-50 to-teal-100 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ls,{className:"w-5 h-5 text-teal-600"}),e.jsx("span",{className:"text-xs text-gray-500",children:"New!"})]}),e.jsx("div",{className:"text-2xl font-bold",children:"24"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Odznaki"})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-sm font-medium",children:"Postęp nauki"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ostatnie 6 miesięcy"})]}),e.jsx(mn,{width:"100%",height:120,children:e.jsxs(un,{data:n,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorProgress",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#db2777",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#db2777",stopOpacity:0})]})}),e.jsx(xn,{type:"monotone",dataKey:"value",stroke:"#db2777",strokeWidth:2,fill:"url(#colorProgress)"}),e.jsx(hn,{dataKey:"name",axisLine:!1,tickLine:!1,tick:{fontSize:11}}),e.jsx(pn,{hide:!0})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Aktywne kursy"}),e.jsx("a",{href:"#",className:"text-purple-700 hover:underline",children:"Zobacz wszystkie"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-pink-600 to-purple-700 rounded-lg flex items-center justify-center",children:e.jsx(st,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:"JavaScript: Gra w kodowanie"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Rozdział 4 z 12"})]})]}),e.jsx(Be,{className:"w-4 h-4 text-gray-400"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-teal-500 to-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(_t,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:"Analiza danych: Quest"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Rozdział 7 z 10"})]})]}),e.jsx(Be,{className:"w-4 h-4 text-gray-400"})]})]})]})]})]})]})})]})})}),e.jsx("section",{id:"funkcje",className:"py-20 bg-gray-50",children:e.jsxs("div",{className:"container mx-auto px-6",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsxs("h2",{className:"text-4xl font-bold mb-4",children:["Funkcje, które"," ",e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-700",children:"angażują"})]}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"System zaprojektowany, aby uczynić naukę uzależniającą jak najlepsza gra"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-pink-600/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-pink-600 to-purple-700 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(ce,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"System poziomów"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"99 poziomów do zdobycia. Każdy poziom odblokowuje nowe możliwości i nagrody."}),e.jsxs("div",{className:"flex items-center text-sm text-pink-600 font-medium",children:["Dowiedz się więcej",e.jsx(_e,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-700/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-purple-700 to-teal-500 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(cs,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Idle Points"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Zdobywaj punkty nawet gdy nie uczysz się aktywnie. System pasywnego rozwoju."}),e.jsxs("div",{className:"flex items-center text-sm text-purple-700 font-medium",children:["Dowiedz się więcej",e.jsx(_e,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-teal-500/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-teal-500 to-blue-600 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(we,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Wyzwania"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Codzienne i tygodniowe wyzwania z dodatkowymi nagrodami za ukończenie."}),e.jsxs("div",{className:"flex items-center text-sm text-teal-600 font-medium",children:["Dowiedz się więcej",e.jsx(_e,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-500/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-orange-500 to-yellow-500 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(ae,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Rankingi"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Rywalizuj z innymi uczniami. Rankingi globalne, lokalne i grupowe."}),e.jsxs("div",{className:"flex items-center text-sm text-orange-600 font-medium",children:["Dowiedz się więcej",e.jsx(_e,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-700/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-purple-700 to-pink-600 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(ls,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Odznaki"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Kolekcjonuj unikalne odznaki za osiągnięcia i kamienie milowe."}),e.jsxs("div",{className:"flex items-center text-sm text-purple-700 font-medium",children:["Dowiedz się więcej",e.jsx(_e,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"group relative bg-white rounded-2xl p-8 hover:shadow-lg transition-all duration-300 cursor-pointer border border-gray-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-teal-500/5 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-teal-500 to-purple-700 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(_t,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Analityka"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Szczegółowe statystyki postępów i personalizowane rekomendacje."}),e.jsxs("div",{className:"flex items-center text-sm text-teal-600 font-medium",children:["Dowiedz się więcej",e.jsx(_e,{className:"w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform"})]})]})]})]})]})}),e.jsx("section",{className:"py-20 bg-white",children:e.jsxs("div",{className:"container mx-auto px-6",children:[e.jsxs("div",{className:"max-w-3xl mx-auto text-center mb-16",children:[e.jsxs("h2",{className:"text-4xl font-bold mb-4",children:["Jak to"," ",e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-700",children:"działa"})]}),e.jsx("p",{className:"text-lg text-gray-600",children:"Cztery proste kroki do rozpoczęcia nauki z gamifikacją"})]}),e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 top-0 bottom-0 w-0.5 bg-gray-200"}),e.jsx("div",{className:"space-y-12",children:[{number:"01",title:"Stwórz profil",description:"Wybierz swoją rolę i spersonalizuj doświadczenie nauki",icon:ae,color:"from-pink-600 to-purple-700"},{number:"02",title:"Wybierz kursy",description:"Przeglądaj bibliotekę kursów i wybierz te, które Cię interesują",icon:Rs,color:"from-purple-700 to-teal-500"},{number:"03",title:"Ucz się i graj",description:"Rozwiązuj quizy, zdobywaj punkty i awansuj na kolejne poziomy",icon:st,color:"from-teal-500 to-blue-600"},{number:"04",title:"Śledź postępy",description:"Monitoruj swoje osiągnięcia i rywalizuj z innymi",icon:qs,color:"from-orange-500 to-yellow-500"}].map((o,l)=>e.jsx("div",{className:"relative",children:e.jsxs("div",{className:`flex items-center ${l%2===0?"flex-row":"flex-row-reverse"}`,children:[e.jsxs("div",{className:`w-5/12 ${l%2===0?"text-right pr-8":"text-left pl-8"}`,children:[e.jsxs("div",{className:`inline-flex items-center gap-4 mb-2 ${l%2===0?"flex-row-reverse":""}`,children:[e.jsx("h3",{className:"text-2xl font-bold",children:o.title}),e.jsx("span",{className:"text-4xl font-bold text-gray-200",children:o.number})]}),e.jsx("p",{className:"text-gray-600 text-lg",children:o.description})]}),e.jsx("div",{className:"w-2/12 flex justify-center",children:e.jsx("div",{className:`relative z-10 w-16 h-16 bg-gradient-to-br ${o.color} rounded-2xl flex items-center justify-center shadow-lg`,children:e.jsx(o.icon,{className:"w-8 h-8 text-white"})})}),e.jsx("div",{className:"w-5/12"})]})},l))})]})})]})}),e.jsx("section",{className:"py-20 bg-gradient-to-br from-gray-900 to-gray-800",children:e.jsx("div",{className:"container mx-auto px-6",children:e.jsx("div",{className:"grid md:grid-cols-4 gap-8",children:[{value:"15k+",label:"Aktywnych uczniów",icon:ae},{value:"200+",label:"Kursów",icon:Rs},{value:"92%",label:"Ukończalność",icon:we},{value:"4.9/5",label:"Ocena",icon:fa}].map((o,l)=>e.jsxs("div",{className:"text-center",children:[e.jsx(o.icon,{className:"w-8 h-8 mx-auto mb-4 text-white/60"}),e.jsx("div",{className:"text-4xl font-bold text-white mb-2",children:o.value}),e.jsx("div",{className:"text-sm text-white/60",children:o.label})]},l))})})}),e.jsx("section",{className:"py-20 bg-white",children:e.jsx("div",{className:"container mx-auto px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsxs("h2",{className:"text-4xl font-bold mb-6",children:["Gotowy na naukę, która"," ",e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-pink-600 to-purple-700",children:"wciąga"}),"?"]}),e.jsx("p",{className:"text-lg text-gray-600 mb-8 max-w-2xl mx-auto",children:"Dołącz do tysięcy uczniów, którzy odkryli radość z nauki dzięki gamifikacji. Pierwsze 30 dni gratis."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center mb-8",children:[e.jsx(I,{type:"email",placeholder:"twoj@email.pl",value:r,onChange:o=>i(o.target.value),className:"max-w-xs h-12"}),e.jsxs(f,{size:"lg",className:"bg-gradient-to-r from-pink-600 to-purple-700 hover:opacity-90 text-white px-8 h-12",onClick:()=>s("/login"),children:["Rozpocznij za darmo",e.jsx(_e,{className:"ml-2 h-4 w-4"})]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Bez karty kredytowej • Anuluj w każdej chwili • Pełny dostęp"})]})})}),e.jsx("footer",{className:"bg-gray-900 text-white py-12",children:e.jsx("div",{className:"container mx-auto px-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-white/10 rounded-lg flex items-center justify-center",children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx("span",{className:"text-lg font-bold",children:"Smart Up"})]}),e.jsx("div",{className:"text-sm text-white/60",children:"© 2025 Smart Up. Wszystkie prawa zastrzeżone."})]})})})]})},et=()=>{const{data:s}=me();return s?.role==="student"?e.jsx(Ye,{to:"/student/dashboard",replace:!0}):e.jsx(Ye,{to:"/dashboard/overview",replace:!0})};function Pc(){return e.jsx(wi,{children:e.jsxs(Li,{dataProvider:Ui(B),liveProvider:qi(B),authProvider:at,routerProvider:Ii,resources:[so,_l,Rl,El,Kl,Yl,sc,rc],options:{syncWithLocation:!0,warnWhenUnsavedChanges:!0,useNewQueryKeys:!0,liveMode:"auto"},children:[e.jsxs(yi,{children:[e.jsx(E,{path:"/",element:e.jsx(Sc,{})}),...Cc,e.jsxs(E,{element:e.jsx(zt,{fallback:e.jsx($i,{to:"/login"}),children:e.jsx(Hn,{children:e.jsx(vi,{})})},"protected-layout"),children:[e.jsx(E,{path:"/admin",element:e.jsx(et,{})}),e.jsx(E,{path:"/teacher",element:e.jsx(et,{})}),e.jsx(E,{path:"/student",element:e.jsx(Ye,{to:"/student/dashboard",replace:!0})}),e.jsx(E,{path:"/dashboard",element:e.jsx(Ye,{to:"/dashboard/overview",replace:!0})}),...to,...Cl,...Ml,...$l,...Ol,...Zl,...Xl,...tc,...ic,...jc,e.jsx(E,{path:"*",element:e.jsx(Ei,{})})]}),e.jsx(E,{path:"*",element:e.jsx(zt,{fallback:e.jsx(Ye,{to:"/login",replace:!0}),children:e.jsx(et,{})},"catch-all-redirect")})]}),e.jsx(Ai,{}),e.jsx(Ti,{})]})})}const Rc=document.getElementById("root"),Mc=gn.createRoot(Rc);Mc.render(e.jsxs(A.StrictMode,{children:[e.jsx(Pc,{}),e.jsx(ki,{position:"top-right",richColors:!0,closeButton:!0,duration:4e3,toastOptions:{style:{width:"500px",fontSize:"20px"},className:"sonner-toast"}})]}));
